"use strict";(self.webpackChunkcritical_web=self.webpackChunkcritical_web||[]).push([[688],{9975:(w,R,c)=>{c.d(R,{Q:()=>P});var O=c(9212);let P=(()=>{class E{fromJson(I){I=I??{};let u=I?.metadata??{};return u=u?{assignmentCompleted:u.assignmentCompleted??!1,time:u.time??null,cost:u.cost??null}:{assignmentCompleted:!1,time:null,cost:null},{name:I?.name??null,group:I?.group??null,subgroup:I?.subgroup??null,metadata:I?.metadata??null,data:I?.data??null,children:I?.children??[],id:I?.id??null,parent:I.parent??null,parentNodeId:I?.parentNodeId??null}}toJson(I){}head(){return{id:0,group:0,subgroup:0,name:"head",data:null,children:[],parent:null,metadata:null,parentNodeId:null}}static#e=this.\u0275fac=function(u){return new(u||E)};static#t=this.\u0275prov=O.Yz7({token:E,factory:E.\u0275fac,providedIn:"root"})}return E})()},1339:(w,R,c)=>{c.d(R,{Z:()=>M});class O{constructor(u){null!=u&&u.profile.planned_completion_date?this.endDate=new Date(u.profile.planned_completion_date).getTime():(this.endDate=null,this.duration=0,this.startDate=null),this.duration=u.profile.duration??0,this.activityId=u.profile.id;const t=new Date(u.profile.planned_completion_date??"").getTime()-864e5*this.duration;this.startDate=t}isOverlap(u,t){return!(!this.startDate||!this.endDate)&&(this.startDate<u&&this.endDate>t||this.startDate>u&&this.startDate<t||this.endDate>u&&this.endDate<t||this.startDate>u&&this.endDate<t)}}class P{constructor(){this.name="",this.schedule=[]}scheduleActivity(u){let t=!0;for(const n of this.schedule)t=t&&!this.isOverlap(n,u);if(t){const n=new O(u);return this.schedule.push(n),!0}return!1}isOverlap(u,t){if(!t.profile.planned_completion_date||void 0===t.profile.duration)return!1;const n=new Date(t.profile.planned_completion_date),f=new Date(n.getTime()-864e5*t.profile.duration);return u.isOverlap(f.getTime(),n.getTime())}}var E=c(9212);let M=(()=>{class I{constructor(){}sortDummiesLast(t){const n=t.activities.sort((o,_)=>o.profile.id-_.profile.id),f=n.filter(o=>!o.chartInfo.isDummy||null!==o.chartInfo.milestoneNodeId);n.filter(o=>o.chartInfo.isDummy&&null===o.chartInfo.milestoneNodeId).forEach(o=>f.push(o)),t.activities=f}reorderIds(t){t.activities.sort((o,_)=>o.profile.id-_.profile.id);const n=t.activities.filter(o=>null!==o.profile.planned_completion_date),f=t.activities.filter(o=>null===o.profile.planned_completion_date),a=n.concat(f);t.activities=a,t.activities.forEach((o,_)=>{o.profile.sortOrder=_}),t.activities.forEach((o,_)=>{o.profile.sortOrder=_})}sortById(t){t.activities.sort((n,f)=>n.profile.id-f.profile.id),t.activities.forEach(n=>n.assign.isStartBranch=!1)}sortByBranches(t){const f=t.activities.filter(h=>h.assign.phases.length>0).length>0;let a=[];const o=t.activities.filter(h=>null!==h.profile.planned_completion_date&&0!==h.profile.duration),_=t.activities.filter(h=>null===h.profile.planned_completion_date||0===h.profile.duration);if(this.sortActivitiesForResources(o),!0===f)t.phases.map(v=>v.name).filter((v,g,e)=>e.indexOf(v)===g).forEach(v=>{const g=o.filter(r=>void 0!==r.assign.phases.find(s=>s.name===v)),e=this.assignResources(g);a.push(e)});else{const h=this.assignResources(o);a.push(h)}a=a.filter(h=>void 0!==h),this.sortActivities(t,a,_)}sortActivities(t,n,f){const a=[];n.forEach(o=>{o.forEach(_=>{const h=_.schedule.sort((v,g)=>(v.startDate??0)-(g.startDate??0));let D=0;h.forEach(v=>{const g=t.activities.find(e=>e.profile.id===v.activityId);null!=g&&(0===D&&(g.assign.isStartBranch=!0),a.push(g)),D++})})}),f.forEach(o=>{a.push(o)}),t.activities=a}getStartDate(t){return new Date(t.profile.planned_completion_date??"").getTime()-864e5*(t.profile.duration??0)}sortActivitiesForResources(t){return t.sort((n,f)=>this.getStartDate(n)-this.getStartDate(f)),t.sort((n,f)=>n.chartInfo.tf-f.chartInfo.tf),t}assignResources(t){if(!this.validateActivities(t))return[];const f=[];return t.forEach(a=>{!1===a.chartInfo.isDummy&&this.setResource(a,f)}),f}validateActivities(t){return t.filter(f=>this.validTimeframe(f)).length>0}validTimeframe(t){return!(null===t.profile.planned_completion_date||0===t.profile.duration)}setResource(t,n){if(0===n.length){const a=new P;return a.name="Resource 1",a.scheduleActivity(t),void n.push(a)}let f=!1;if(n.forEach(a=>{if(!f){const o=a.scheduleActivity(t);f=f||o}}),!f){const a=new P;a.name="Resource "+(n.length+1),a.scheduleActivity(t),n.push(a)}}static#e=this.\u0275fac=function(n){return new(n||I)};static#t=this.\u0275prov=E.Yz7({token:I,factory:I.\u0275fac,providedIn:"root"})}return I})()},155:(w,R,c)=>{c.d(R,{v:()=>n});var O=c(9862),P=c(7398),E=c(7631),M=c(9500),I=c(2119),u=c(3830),t=c(9212);let n=(()=>{class f{constructor(o,_){this.http=o,this.projectSerializer=_}compileMsProject(o){const _=new FormData;return _.append("file",o,o.name),this.http.post((0,M.Z)(E.N.mappingApi,u.sv),_).pipe((0,P.U)(h=>(new I.z).fromJson(h)))}compileArrowGraph(o){const _=JSON.stringify(o),h=(new O.WM).set("Content-Type","application/json");return this.http.post((0,M.Z)(E.N.mappingApi,u.l0),_,{headers:h}).pipe((0,P.U)(D=>D?this.projectSerializer.fromJson(D):null))}autoAssignResourceCount(o,_=null){const D=JSON.stringify({project:o,resourceCount:_}),v=(new O.WM).set("Content-Type","application/json");return this.http.post((0,M.Z)(E.N.mappingApi,u.dO),D,{headers:v}).pipe((0,P.U)(g=>g?this.projectSerializer.fromJson(g):null))}static#e=this.\u0275fac=function(_){return new(_||f)(t.LFG(O.eN),t.LFG(I.z))};static#t=this.\u0275prov=t.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},6399:(w,R,c)=>{c.d(R,{h:()=>D});var O=c(4403),P=c(9212),E=c(2119),M=c(9635),I=c(2069),u=c(6265),t=c(580),n=c(9304),f=c(5233),a=c(7399),o=c(9989),_=c(6562),h=c(9975);let D=(()=>{class v{constructor(e,r,d,s,i,m,p,z,L,j,S,C,T,N,y){this.projectSerializer=e,this.projProfSerializer=r,this.treeNodeSerializer=d,this.resProfSerializer=s,this.resSerializer=i,this.resSumSerializer=m,this.roleSerializer=p,this.phaseSerializer=z,this.roleSumSerializer=L,this.asResSerializer=j,this.actSerializer=S,this.actProfSerializer=C,this.chartSerializer=T,this.intSerializer=N,this.projectSubProjectSerializer=y}setProp(e,r,d){return e[d]=r[d]}mapProjectToNode(e){const r=this.treeNodeSerializer.fromJson();return r.parentNodeId=0,r.id=e.profile.id,r.data=e,r}mapTreeNode(e){return e.data=this.projectSerializer.fromJson(e.data),e}createTreeHeadNode(){const e=this.treeNodeSerializer.fromJson();return e.parentNodeId=null,e.id=0,e.data=this.projectSerializer.fromJson(),e}getNode(e,r){const d=this.projProfSerializer.fromJson(),s=this.treeNodeSerializer.fromJson();if(e){const K=Object.keys(e);for(const J of K)d.hasOwnProperty(J)&&this.setProp(d,e,J),s.hasOwnProperty(J)&&this.setProp(s,e,J),s.parentNodeId=e[O.cT]??null,s.id=e[O.v0]??null}const{activityData:i,arrowData:m,integrationData:p,activityResourceData:z,activityPhaseData:L,rolesData:j,resourcesData:S,phaseData:C,resourceRoleData:T,subProjectData:N}=r,y=this.mapActivities(e,i,m),B=this.mapResources(e,S),l=this.mapPhases(e,C),A=this.mapIntegrations(e,p),U=this.mapRoles(e,j),W=this.mapSubProject(e,N);this.mapActivityResources(e,z,y),this.mapActivityPhases(e,L,y),this.mapResourceRoles(e,T,B);const F=this.projectSerializer.fromJson();return F.activities=y,F.integrations=A,F.profile=d,F.resources=B,F.phases=l,F.roles=U,s.data=F,null!==W&&(F.profile.subProject=W),this.updateNodeMetadata(y,s),s}updateNodeMetadata(e,r){const d=e.filter(i=>!i.chartInfo.isDummy).length,s=e.filter(i=>!i.chartInfo.isDummy&&i.assign.resources.length>0).length;r.metadata={assignmentCompleted:d==s,time:0,cost:0}}mapSubProject(e,r){const d=r.filter(s=>s.nodeId===e.nodeId).map(s=>{const i=this.projectSubProjectSerializer.fromJson(),m=Object.keys(s);for(const p of m)i.hasOwnProperty(p)&&this.setProp(i,s,p);return i});return 1===d.length?d[0]:null}mapResources(e,r){return r.filter(s=>s.nodeId===e.nodeId).map(s=>{const i=this.resProfSerializer.fromJson(),m=Object.keys(s);for(const z of m)i.hasOwnProperty(z)&&this.setProp(i,s,z);const p=this.resSerializer.fromJson();return p.profile=i,p.id=s.id,p.view.color.color=s.colorV,p.view.color.backgroundcolor=s.backgroundcolor,p})}mapRoles(e,r){return r.filter(s=>s.nodeId===e.nodeId).map(s=>{const i=this.roleSerializer.fromJson(),m=Object.keys(s);for(const p of m)i.hasOwnProperty(p)&&this.setProp(i,i,p);return i.view.color=s.backgroundcolor,i})}mapPhases(e,r){return r.filter(s=>s.nodeId===e.nodeId).map(s=>{const i=this.phaseSerializer.fromJson(),m=Object.keys(s);for(const p of m)i.hasOwnProperty(p)&&this.setProp(i,s,p);return i.view.color.color=s.colorV,i.view.color.backgroundcolor=s.backgroundcolor,i})}mapResourceRoles(e,r,d){const s=this.roleSumSerializer;r.filter(i=>i.nodeId===e.nodeId).forEach(i=>{const m=d.find(L=>L.id===i.resourceId),p=s.fromJson(),z=Object.keys(i);for(const L of z)p.hasOwnProperty(L)&&this.setProp(p,i,L);p.color=i.colorV,m?.assign.roles.push(p)})}mapActivityResources(e,r,d){const s=this.resSumSerializer;r.filter(i=>i.nodeId===e.nodeId).forEach(i=>{const m=d.find(L=>L.profile.id===i.activityId),p=s.fromJson(),z=Object.keys(i);for(const L of z)p.hasOwnProperty(L)&&this.setProp(p,i,L);p.color.color=i.colorV,p.color.backgroundcolor=i.backgroundcolor,m?.assign.resources.push(p)})}mapActivityPhases(e,r,d){}mapActivities(e,r,d){const s=this.asResSerializer;return r.filter(m=>m.nodeId===e.nodeId).map(m=>{const p=this.actSerializer.fromJson(),z=this.actProfSerializer.fromJson(),L=Object.keys(m);for(const S of L)z.hasOwnProperty(S)&&this.setProp(z,m,S);p.profile=z;const j=d.filter(S=>S.nodeId===e.nodeId).find(S=>S.id===m.id);if(j){const S=this.chartSerializer.fromJson(),C=Object.keys(j);for(const T of C)S.hasOwnProperty(T)&&this.setProp(S,j,T);p.chartInfo=S}return m.assign=s.fromJson(),this.setActivityDates(p),p}).filter(m=>void 0!==m.chartInfo.source_id&&m.chartInfo.source_id!==m.chartInfo.target_id||void 0===m.chartInfo.source_id)}setActivityDates(e){}mapIntegrations(e,r){return r.filter(s=>s.nodeId===e.nodeId).map(s=>{const i=this.intSerializer.fromJson(),m=Object.keys(s);for(const p of m)i.hasOwnProperty(p)&&this.setProp(i,s,p);return i})}getHistoryEntryWorkbook(e){const r=e.data,d={name:e.name,nodeId:e.id,group:e.group,subgroup:e.subgroup,parentNodeId:e.parentNodeId},s=r.activities.map(l=>({...l.profile,graphId:r.profile.id,nodeId:d.nodeId})),i=r.activities.map(l=>({...l.chartInfo,id:l.profile.id,graphId:r.profile.id,nodeId:d.nodeId})),m=r.integrations.map(l=>({...l,nodeId:d.nodeId})),p={...r.profile,...d},z={...r.profile.subProject,graphId:r.profile.id,nodeId:d.nodeId},L=r.phases.map(l=>({...l,backgroundcolor:l.view.color.backgroundcolor,colorV:l.view.color.color,view:void 0,graphId:r.profile.id,nodeId:d.nodeId})),j=r.resources.map(l=>({...l.profile,colorV:l.view.color.color,backgroundcolor:l.view.color.backgroundcolor,id:l.id,graphId:r.profile.id,nodeId:d.nodeId})),S=r.roles.map(l=>({...l,backgroundcolor:l.view.color.backgroundcolor,colorV:l.view.color.color,view:void 0,graphId:r.profile.id,nodeId:d.nodeId}));let C=[],T=[];r.tags&&r.tags.map(l=>l.tags.map(A=>({...A,group:l.name,graphId:r.profile.id,nodeId:d.nodeId}))).map(l=>T=[...l,...T]),r.activities.map(l=>l.assign.phases.map(A=>({...A,activityId:l.profile.id,graphId:r.profile.id,nodeId:d.nodeId}))).map(l=>C=[...l,...C]);let N=[];r.activities.map(l=>l.assign.resources.map(A=>({...A,colorV:A.color.color,backgroundcolor:A.color.backgroundcolor,activityId:l.profile.id,graphId:r.profile.id,nodeId:d.nodeId}))).map(l=>N=[...l,...N]);let y=[];r.resources.map(l=>l.assign.roles.map(A=>({...A,resourceId:l.id,graphId:r.profile.id,nodeId:d.nodeId}))).map(l=>y=[...l,...y]);const B=[];return r.activities.forEach(l=>{l.tags?.forEach(A=>{A.tags.forEach(U=>{B.push({...U,group:A.name,activityId:l.profile.id,graphId:r.profile.id,nodeId:d.nodeId})})})}),{profiles:s,nodes:m,chartInfos:i,projProfile:p,phases:L,resources:j,roles:S,activityPhases:C,activityResources:N,resourceRoles:y,tagPool:T,activityTags:B,subProject:z}}static#e=this.\u0275fac=function(r){return new(r||v)(P.LFG(E.z),P.LFG(E._),P.LFG(h.Q),P.LFG(M.Ne),P.LFG(M.H4),P.LFG(M.k1),P.LFG(I.Jl),P.LFG(u.Ek),P.LFG(I.tB),P.LFG(t.e),P.LFG(n.w),P.LFG(f.C),P.LFG(a.I),P.LFG(o.i),P.LFG(_.M))};static#t=this.\u0275prov=P.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()},6602:(w,R,c)=>{c.d(R,{W:()=>t});var O=c(2119),P=c(9212),E=c(9728),M=c(6399),I=c(96),u=c(9680);let t=(()=>{class n{constructor(a,o,_,h,D){this.storageApi=a,this.mapper=o,this.projSerializer=_,this.treeSerializer=h,this.sanitizer=D}import(a){return this.importFromProjectList(a)}importFromTreeNodeList(a){return new Promise((o,_)=>{const h=new FileReader;h.readAsText(a),h.onload=D=>{const e=JSON.parse(D.target.result).map(r=>this.mapper.mapTreeNode(r));o(e)}})}importFromProjectList(a){return new Promise((o,_)=>{const h=new FileReader;h.readAsText(a),h.onload=D=>{const g=JSON.parse(D.target.result),e=new O.z,r=g.map(m=>e.fromJson(m)),i=[this.mapper.createTreeHeadNode(),...r.map(m=>this.mapper.mapProjectToNode(m))];o(i)}})}export(a,o="history"){const _=a.map(g=>{const e=this.treeSerializer.fromJson(g);if(e.children=[],e.parent=null,g.data){const r=this.projSerializer.fromJson(g.data);this.sanitizer.sanatizeForSave(r),e.data=r}return e}),h=JSON.stringify(_),D=new Blob([h],{type:"application/json"}),v=document.createElement("a");v.href=window.URL.createObjectURL(D),v.download=`${o}.cp.json`,v.click()}exportProjectList(a,o="profile"){const _=a.map(g=>{const e=this.projSerializer.fromJson(g);if(g){const r=this.projSerializer.fromJson(g);this.sanitizer.sanatizeForSave(r)}return e}),h=JSON.stringify(_),D=new Blob([h],{type:"application/json"}),v=document.createElement("a");v.href=window.URL.createObjectURL(D),v.download=`${o}.cp.json`,v.click()}importTree(a){return new Promise((o,_)=>{const h=new FileReader;h.readAsText(a),h.onload=D=>{const g=JSON.parse(D.target.result);o(g)}})}static#e=this.\u0275fac=function(o){return new(o||n)(P.LFG(E.K),P.LFG(M.h),P.LFG(O.z),P.LFG(I.Q),P.LFG(u.B))};static#t=this.\u0275prov=P.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()},7649:(w,R,c)=>{c.d(R,{h:()=>t});var O=c(9212),P=c(8962),E=c(9011),M=c(1339),I=c(7808),u=c(1568);let t=(()=>{class n{constructor(a,o,_,h,D){this.nodeConstructor=a,this.riskCompiler=o,this.endNodesLocator=_,this.nodeArranger=h,this.activitySorter=D}compileProjectFromFile(a){this.nodeConstructor.connectArrowsToNodes(a),this.endNodesLocator.setStartEndNodesFromLongestPath(a),this.riskCompiler.compileRiskProperties(a),this.nodeArranger.arrangeNodes(a),this.activitySorter.sortDummiesLast(a)}static#e=this.\u0275fac=function(o){return new(o||n)(O.LFG(P.E),O.LFG(E.r),O.LFG(I.d),O.LFG(u.g),O.LFG(M.Z))};static#t=this.\u0275prov=O.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()}}]);