"use strict";(self.webpackChunkcritical_web=self.webpackChunkcritical_web||[]).push([[187],{2357:(qt,At,ot)=>{ot.d(At,{w:()=>ge});var O=ot(9212),w=ot(3920),H=ot(4595),Ht=ot(5619),rt=ot(2181),st=ot(3633),D=ot(4745),j=ot(9989);let ut=(()=>{class z{constructor(){}getNodeById(s,f){return f.integrations.find(v=>v.id===s)}getInEdges(s,f){return f.activities.filter(v=>v.chartInfo.target_id===s)}getOutEdges(s,f){return f.activities.filter(v=>v.chartInfo.source_id===s)}joinNodes(s,f,v){const M=this.getInEdges(s.id,v),E=this.getOutEdges(s.id,v);for(const P of M)P.chartInfo.target_id=f.id,P.chartInfo.target=f;for(const P of E)P.chartInfo.source_id=f.id,P.chartInfo.source=f;v.integrations.splice(v.integrations.indexOf(s),1)}splitUpNode(s,f){if(null==s)return null;const v=this.getInEdges(s.id,f),M=this.getOutEdges(s.id,f);let E=Math.max(...f.integrations.map(wt=>wt.id));const P=s.y,V=s.x,K=v.length,q=new Map,T=new Map;let nt=0;v.forEach(wt=>{E++;const bt=P-6*(K-nt),_t=(new j.i).new(E,E.toString(),0,V,bt);wt.chartInfo.target_id=E,wt.chartInfo.target=_t,f.integrations.push(_t),T.set(E,_t),nt++,wt.chartInfo.dPath=void 0});const vt=M.length;return nt=0,M.forEach(wt=>{E++;const bt=P+6*(vt-nt),_t=(new j.i).new(E,E.toString(),0,V,bt);wt.chartInfo.source_id=E,wt.chartInfo.source=_t,f.integrations.push(_t),q.set(E,_t),wt.chartInfo.dPath=void 0}),f.integrations.splice(f.integrations.indexOf(s),1),{sources:q,targets:T}}static#t=this.\u0275fac=function(f){return new(f||z)};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})();var pt=ot(4961),yt=ot(9304);let lt=(()=>{class z{constructor(){this.blockDelete=!1,this.selected_node=null,this.last_selected_node=null,this.activity_created=null,this.selected_link=null,this.links=null,this.mousedown_node=null,this.drag_node=null,this.mouseover_node=null,this.mouseup_node=null,this.mousedown_link=null,this.ctrl_down=!1,this.lastKeyDown=null,this.macMetaDown=!1,this.allowDeletes=!0,this.width=null,this.height=null,this.prevProjId=null,this.nodeRisk=new Map,this.arrowRisk=new Map}static#t=this.\u0275fac=function(f){return new(f||z)};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})();var Tt=ot(9127);let J=(()=>{class z{constructor(s,f,v){this.st=s,this.actBuilder=f,this.msFactory=v}addProjectActivity(s,f,v){const E=Math.max(...v.activities.map(V=>V.profile.id),0)+1,P=(new yt.w).new(E,E.toString(),s.id,f.id,0,0);return P.chartInfo.isDummy=v.profile.view.createAsDummy,P.chartInfo.source=s,P.chartInfo.target=f,P.subProject.subGraphId=-1,P.profile.sortOrder=E,v.activities.push(P),v.profile.view.selectedActivity=P,P}handleNodeCreation(s,f,v){if(this.st.blockDelete=!1,s||this.st.mousedown_node||this.st.mousedown_link)return!1;this.clearSelectedLink(v),this.clearSelectedNode(v);const M=Math.max(...v.integrations.map(P=>P.id),0)+1,E=(new j.i).new(M,M.toString(),0,f[0],f[1]);return E.x=Math.round(f[0]),E.y=Math.round(f[1]),v.integrations.push(E),!0}addFastActivity(s,f,v,M){const E=s.key,V=s.target.value.trim();if("Enter"===E&&""!==V){const K=V.split(","),q=K[0].trim();let T=0;if(K.length>1){const nt=K[1].trim();isNaN(+nt)||(T=+nt)}return f.profile.view.autoZoom=!0,this.actBuilder.addActivity(f,q,T,v,M)}return null}clearSelectedLink(s){const f=this.st.selected_link;f&&(f.chartInfo.isSelected=!1,this.st.selected_link=null),s.profile.view.selectedActivity=null}clearSelectedNode(s){const f=this.st.selected_node;f&&(f.selected=!1,this.st.selected_node=null),s.profile.view.selectedIntegration=null}updateStartEndNodes(s,f,v=null){let M;const E=this.filterOutMilestones(f);if("end"!==v&&f.profile.start===s.id){let P=0,V=null;M=E.forEach(K=>{K.chartInfo.source.id===s.id&&(P++,V=K.chartInfo.target.id)}),1===P&&null!==V&&(f.profile.start=V)}if("start"!==v&&f.profile.end===s.id){let P=0,V=null;M=E.forEach(K=>{K.chartInfo.target.id===s.id&&(P++,V=K.chartInfo.source.id)}),1===P&&null!==V&&(f.profile.end=V)}}filterOutMilestones(s){return s.activities.filter(f=>null===f.chartInfo.milestoneNodeId)}deleteSelectedNodeOrLink(s){const f=this.filterOutMilestones(s);if(!this.st.blockDelete){let v;if(null!=this.st.selected_node)this.updateStartEndNodes(this.st.selected_node,s),this.msFactory.removeMilestoneByNode(this.st.selected_node,s);else if(this.st.selected_link){const M=this.st.selected_link,E=s.activities.find(T=>T.profile.id===M.profile.id);if(void 0===E)return;const{source:P,target:V}=E.chartInfo;if(void 0===P||void 0===V)return;this.updateStartEndNodes(P,s,"start"),this.updateStartEndNodes(V,s,"end"),v=s.activities.indexOf(E),s.activities.splice(v,1);const K=f.find(T=>T.chartInfo.source_id===P.id||T.chartInfo.target_id===P.id),q=f.find(T=>T.chartInfo.source_id===V.id||T.chartInfo.target_id===V.id);if(null==K){const T=s.integrations.indexOf(P);s.integrations.splice(T,1)}if(null==q){const T=s.integrations.indexOf(V);s.integrations.splice(T,1)}}this.clearSelectedLink(s),this.st.selected_link=null,this.st.selected_node=null,s.profile.view.selectedActivity=null}}static#t=this.\u0275fac=function(f){return new(f||z)(O.LFG(lt),O.LFG(Tt.I),O.LFG(pt.y))};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})(),U=(()=>{class z{constructor(s,f,v,M){this.networkOps=s,this.msFactory=f,this.elFactory=v,this.st=M}checkDeselect(s){return!(!this.st.selected_node&&null===s.profile.view.selectedActivity&&null===s.profile.view.selectedIntegration&&!this.st.selected_link)}deselectActivity(s){s.activities.forEach(f=>f.chartInfo.isSelected=!1),s.profile.view.selectedActivity=null,this.st.selected_link=null,this.st.links?.classed("selected",!1)}filterOutMilestones(s){return s.activities.filter(f=>null===f.chartInfo.milestoneNodeId)}deselectNode(s){s.integrations.forEach(f=>f.selected=!1),s.profile.view.selectedActivity=null,s.profile.view.selectedIntegration=null,this.st.selected_node=null,this.st.links?.classed("selected",!1)}selectNode(s,f){f.integrations.forEach(v=>v.selected=v.id===s.id),f.profile.view.selectedIntegration=s}sortNodes(s,f){f.sort((v,M)=>v.id!==s.id?1:-1)}initNodeDragState(s,f,v){this.st.nodes.classed("selected",M=>s==M),this.deselectNode(v),s.selected||(s.selected=!0),this.st.nodes.select("circle").classed("active",!1),this.st.drag_node=s,this.sortNodes(this.st.drag_node,this.st.nodes)}deactivateSelectedNode(s,f){this.deselectNode(s),f.select("circle").classed("active",!1)}activateSelectedNode(s,f,v){f.classed("selected",s.selected=!0),this.st.selected_node=this.st.mousedown_node,this.st.last_selected_node=this.st.mousedown_node,this.selectNode(this.st.selected_node,v),f.select("circle").classed("active",!0)}hideDragLine(){this.st.drag_line.classed("hidden",!0).style("marker-end","")}updateDragLine(s){this.st.drag_line.style("marker-end","url(#end-arrow)").classed("hidden",!1).attr("d",`M${s.x},${s.y}L${s.x},${s.y}`)}createArrowEvent(s,f){if(!this.st.mousedown_node)return!1;if(this.hideDragLine(),this.st.mouseup_node=s,this.st.mouseup_node===this.st.mousedown_node)return this.resetState(),!1;this.st.nodes.selectAll("circle").attr("transform",P=>"");const v=this.st.mousedown_node,M=this.st.mouseup_node;if(v===M)return!1;let E=this.filterOutMilestones(f).filter(P=>P.chartInfo.source===v&&P.chartInfo.target===M)[0];if(!E){E=this.elFactory.addProjectActivity(v,M,f);const P=this.st.activity_created;null!=P&&"name"===f.profile.view.displayText&&setTimeout(()=>{P.next(!0)},100)}return this.st.selected_link=E,this.setLinkIsSelected(E,f,!0),null!=this.st.selected_node&&(this.st.selected_node.selected=!1),f.profile.view.selectedIntegration=null,this.st.selected_node=null,!0}setLinkIsSelected(s,f,v){s?.chartInfo&&(s.chartInfo.isSelected=v,f.profile.view.selectedActivity=s),v||(f.profile.view.selectedActivity=null)}resetState(){this.st.mousedown_node=null,this.st.mouseup_node=null,this.st.mousedown_link=null,this.st.drag_node=null}setNodeDownStates(s,f,v,M){this.deselectActivity(M),this.st.blockDelete=!1,f?this.initNodeDragState(s,v,M):(this.st.mousedown_node=s,this.st.nodes.select("circle").classed("active",!1),null!==this.st.selected_node&&this.st.mousedown_node.id===this.st.selected_node.id?this.deactivateSelectedNode(M,v):this.activateSelectedNode(s,v,M),this.updateDragLine(this.st.mousedown_node))}joinNodesOrCreateArrow(s,f){this.st.nodes.filter(P=>P==s);const M=this.st.mouseover_node;let E=!1;if(s.x=Math.round(s.x),s.y=Math.round(s.y),null!=M){const P=M.el.select("circle");E=this.joinNodesEvent(M.d,P,f),E||(E=this.createArrowEvent(M.d,f)),this.st.nodes?.classed("selected",!1)}return this.clearSelectionAndHideLine(),E}clearSelectionAndHideLine(){return this.st.mousedown_node&&(this.st.drag_line.classed("hidden",!0).style("marker-end",""),this.st.nodes?.classed("selected",!1)),this.st.mainG.classed("active",!1),this.resetState()}setMouseOverNodeStates(s,f){this.st.mouseover_node={d:s,el:f},null!=this.st.drag_node&&s!==this.st.drag_node&&f.select("circle").attr("transform",v=>s===v?"scale(1.3)":""),this.st.mousedown_node&&s!==this.st.mousedown_node&&f.select("circle").attr("transform",v=>s===v?"scale(1.1)":"")}clearMouseOverNodeStates(s,f){this.st.mouseover_node=null,null!=this.st.drag_node&&s!==this.st.drag_node&&f.select("circle").attr("transform",v=>""),this.st.mousedown_node&&s!==this.st.mousedown_node&&f.select("circle").attr("transform",v=>"")}setSelectedLinkState(s,f,v){return!f&&(this.st.blockDelete=!1,this.st.mousedown_link=s,null!==this.st.selected_link&&this.st.mousedown_link.profile.id===this.st.selected_link.profile.id?(this.setLinkIsSelected(null,v,!1),this.st.links.classed("selected",!1),this.st.selected_link=null):(this.st.selected_link=this.st.mousedown_link,this.setLinkIsSelected(this.st.selected_link,v,!0),this.st.links.classed("selected",M=>M===s)),null!=this.st.selected_node&&(this.st.selected_node.selected=!1),this.st.selected_node=null,v.profile.view.selectedIntegration=null,this.st.nodes.select("circle").classed("selected",!1),this.st.nodes.select("circle").classed("active",!1),!0)}joinNodesEvent(s,f,v){if(null!=this.st.drag_node){if(s===this.st.drag_node)return this.resetState(),!1;f.select("circle").attr("transform",P=>"");const M=this.st.drag_node,E=s;return E.id!==M.id&&!this.existsDirectConnectingLink(E.id,M.id,v)&&(this.st.drag_node=null,this.networkOps.joinNodes(E,M,v),!0)}return!1}existsDirectConnectingLink(s,f,v){return v.activities.some(M=>M.chartInfo.source_id===s&&M.chartInfo.target_id===f||M.chartInfo.source_id===f&&M.chartInfo.target_id===s)}makeDummy(){this.st.selected_node&&(this.st.selected_node.isDummy=!this.st.selected_node.isDummy)}makeMilestone(s){this.st.selected_node&&this.msFactory.createMilestone(s,this.st.selected_node)}splitUpNode(s,f){this.networkOps.splitUpNode(s,f),f.profile.view.selectedIntegration=null}static#t=this.\u0275fac=function(f){return new(f||z)(O.LFG(ut),O.LFG(pt.y),O.LFG(J),O.LFG(lt))};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})(),Q=(()=>{class z{constructor(s){this.st=s}getNodeCss(s,f){const v=this.filterOutMilestones(f);if(f.profile.view.showOrphaned){const M=v.filter(P=>P.chartInfo.source_id===s.id),E=v.filter(P=>P.chartInfo.target_id===s.id);return 0===M.length?"risk-end":0===E.length?"risk-start":"unprocessed risk-0"}return null===s.lft?"unprocessed risk-"+s.risk:"risk-"+s.risk}getNodeName(s){return s.isMilestone?s.milestoneName:s.name}getTextAboveNode(s,f){return"label"===f.profile.view.showEftLft&&s.label?s.label:"eft"===f.profile.view.showEftLft&&s.eft?s.eft+"/"+s.lft:"pcd"===f.profile.view.showEftLft&&null!=s.maxPCD?s.maxPCD:"milestone"===f.profile.view.showEftLft&&s.milestoneActivity?s.milestoneActivity.profile.name:""}getTagColor(s,f){if(s.tags){const v=s.tags.find(M=>M.name===f);if(v){const M=v.tags[0];return M?M.backgroundcolor:H.xU.UNPROCESSED}return H.xU.UNPROCESSED}return H.xU.UNPROCESSED}getRiskColor(s){let f;switch(s){case H.uF.NEW:f=H.xU.NEW;break;case H.uF.LOW:f=H.xU.LOW;break;case H.uF.MEDIUM:f=H.xU.MEDIUM;break;case H.uF.HIGH:f=H.xU.HIGH;break;case H.uF.CRITICAL:f=H.xU.CRITICAL;break;default:f=H.xU.UNPROCESSED}return f}getArrowColor(s,f,v,M,E){const P=v.profile.view.selectedTagGroup;if(P)return this.getTagColor(f,P);let V=f.chartInfo.risk;const K=M.get(f.profile.id);!E&&s&&M&&void 0!==K&&(V=K);let q=this.getRiskColor(V);return null===f.chartInfo.tf&&(q=H.xU.UNPROCESSED),f.chartInfo.tf===1/0&&(q=H.xU.UNPROCESSED),v.profile.view.showOrphaned&&(q=H.xU.UNPROCESSED),(v.profile.view.fade&&f.processInfo.completed||v.profile.view.fade&&f.processInfo.completed)&&(q=H.xU.COMPLETED),q}getWrappedTextColor(s,f){const v=this.getArrowColor(!1,s,f,new Map,!0),M=this.expandColor(v);return this.darkenColor(M,.3)}expandColor(s){return 4===s.length?"#"+s[1]+s[1]+s[2]+s[2]+s[3]+s[3]:s}darkenColor(s,f){const v=parseInt(s.slice(1,3),16),M=parseInt(s.slice(3,5),16),E=parseInt(s.slice(5,7),16),P=Math.floor(v*(1-f)),V=Math.floor(M*(1-f)),K=Math.floor(E*(1-f));return"#"+P.toString(16).padStart(2,"0")+V.toString(16).padStart(2,"0")+K.toString(16).padStart(2,"0")}getNodeColor(s,f,v,M,E){if(v.profile.view.selectedTagGroup)return H.xU.UNASSIGNED;let V=f.risk;const K=M.get(f.id);!E&&s&&M&&void 0!==K&&(V=K);let q=this.getRiskColor(V);if((null===f.lft||f.lft===1/0)&&(q=H.xU.UNPROCESSED),v.profile.view.fade&&f.completed&&(q=H.xU.COMPLETED),v.profile.view.showOrphaned){const T=v.activities.filter(vt=>vt.chartInfo.source_id===f.id),nt=v.activities.filter(vt=>vt.chartInfo.target_id===f.id);q=H.xU.UNPROCESSED,0===T.length&&(q=H.xU.END),0===nt.length&&(q=H.xU.START)}return q}getLinkCss(s,f){return f.profile.view.selectedTagGroup?"assigning":null==s.chartInfo.tf?s.chartInfo.isDummy?"dummy unprocessed":"unprocessed":f.profile.view.showOrphaned?"risk-0":s.chartInfo.isDummy?"dummy risk-"+s.chartInfo.risk:"risk-"+s.chartInfo.risk}isCompleted(s,f){return f.profile.view.markCompleted&&s.processInfo.completed}isHighlighted(s,f){return s.subProject.subGraphId===f.profile.view.activeSubProjectId}isSelected(s,f){return s===this.st.selected_link||s===f.profile.view.selectedActivity}getLinkEndMarker(s,f){return null==s.chartInfo.tf||s.chartInfo.tf===1/0||f.profile.view.showOrphaned?"url(#end-u)":f.profile.view.markCompleted&&s.processInfo.completed?"url(#end-completed)":`url(#end-${s.chartInfo.risk})`}getLowerLinkText(s,f){return"float"!==f.profile.view.lowerArrowText||null===s.chartInfo.ff||null===s.chartInfo.tf||s.chartInfo.isDummy?"subproj"===f.profile.view.lowerArrowText&&(null!==s.subProject.subGraphLoaded||s.subProject.isParent||s.risk.criticalCount>0||s.risk.greenCount>0)?`g${s.risk.greenCount}  y${s.risk.yellowCount}  r${s.risk.redCount}  c${s.risk.criticalCount}`:"":s.chartInfo.ff+"/"+s.chartInfo.tf}getLowerLinkTextYPos(s,f){return void 0===s.chartInfo.source?.y||void 0===s.chartInfo.target?.y?(console.error("getLowerLinkTextYPos link node is missing y position"),0):s.chartInfo.source.y+(s.chartInfo.target.y-s.chartInfo.source.y)/2+14}getLowerLinkTextXPos(s,f){return void 0===s.chartInfo.source?.x||void 0===s.chartInfo.target?.x?(console.error("getLowerLinkTextXPos link node is missing x position"),0):"subproj"===f.profile.view.lowerArrowText?s.chartInfo.source.x+(s.chartInfo.target.x-s.chartInfo.source.x)/2:s.chartInfo.source.x+(s.chartInfo.target.x-s.chartInfo.source.x)/2-10}getActivityFontSize(s,f){return"subproj"===f.profile.view.lowerArrowText?"9px":"8px"}getLinkTextPosY(s,f){return void 0===s.chartInfo.source?.y||void 0===s.chartInfo.target?.y?(console.error("getLinkTextPosY link node is missing y position"),0):"name"===f.profile.view.displayText?s.chartInfo.source.y+(s.chartInfo.target.y-s.chartInfo.source.y)/2-14:s.chartInfo.source.y+(s.chartInfo.target.y-s.chartInfo.source.y)/2-6}getLinkTextPosX(s,f){return void 0===s.chartInfo.source?.x||void 0===s.chartInfo.target?.x?(console.error("getLinkTextPosX link node is missing x position"),0):s.chartInfo.source.x+(s.chartInfo.target.x-s.chartInfo.source.x)/2-10}getLinkText(s,f){let v;if("id"===f.profile.view.displayText){if(!f.profile.view.showDummies&&s.chartInfo.isDummy)return"";v=s.profile.id}else if("duration"===f.profile.view.displayText)v=s.profile.duration;else if("name"===f.profile.view.displayText){if(s.chartInfo.isDummy&&!f.profile.view.showDummies)return"";v=s.profile.name}else{if("resource"===f.profile.view.displayText)return s.assign.resources.map(M=>M.name).join(", ");if("abbreviated"===f.profile.view.displayText){if(s.chartInfo.isDummy&&!f.profile.view.showDummies)return"";if(+s.profile.name==+s.profile.id)return s.profile.id.toString();v=s.profile.id+" "+s.profile.name.split(" ").map(M=>M.substring(0,3)).join(" ")+" "+s.profile.duration+"d"}else if(f.profile.view.displayText.startsWith("tag")){const M=parseInt(f.profile.view.displayText.split(".")[1])??-1;if(-1===M)return s.assign.resources.map(E=>E.name).join(", ");{const E=s.tags?.find(P=>P.name===f.tags?.[M].name);if(E&&E.tags[0])return E.tags.map(V=>V.name).join(", ")}return""}}return v=this.getSubProjMarkerText(s,v?.toString()??""),v}getSubProjMarkerText(s,f){return null!==s.subProject.subGraphLoaded||s.subProject.isParent||s.risk.criticalCount>0||s.risk.greenCount>0?f+=":":-1!==s.subProject.subGraphId&&!s.chartInfo.isDummy&&(f+="*"),f}filterOutMilestones(s){return s.activities.filter(f=>null===f.chartInfo.milestoneNodeId)}static#t=this.\u0275fac=function(f){return new(f||z)(O.LFG(lt))};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})(),Y=(()=>{class z{constructor(s){this.st=s}nudgeGroup(s,f,v,M){this.moveNode(s,f),this.repositionConnectedArrows(),this.repositionArrowText("text.label",M),this.repositionArrowText("text.glow",M),this.repositionArrowText("foreignObject",M,null,-25,-15),this.repositionArrowFloatText(M)}updateGroupPosition(s,f){this.repositionConnectedArrows(f),this.repositionArrowText("text.label",s,f),this.repositionArrowText("text.glow",s,f),this.repositionArrowText("foreignObject",s,null,-25,-15),this.repositionArrowFloatText(s,f)}moveNode(s,f){this.st.nodes.filter(v=>v===this.st.drag_node).attr("transform",v=>(v.x+=s,v.y+=f,`translate(${v.x},${v.y})`))}repositionConnectedArrows(s=null){this.st.links.filter(f=>s?s.includes(f.chartInfo.source_id):f.chartInfo.source.selected).select("path").attr("d",f=>(f.chartInfo.dPath=void 0,this.getPath(f))),this.st.links.filter(f=>s?s.includes(f.chartInfo.target_id):f.chartInfo.target.selected).select("path").attr("d",f=>(f.chartInfo.dPath=void 0,this.getPath(f)))}repositionArrowText(s,f,v=null,M=0,E=0){this.st.links.filter(P=>v?v.includes(P.chartInfo.source.id)||v.includes(P.chartInfo.target.id):P.chartInfo.target.selected||P.chartInfo.source.selected).select(s).attr("y",P=>{const V=P.chartInfo;return"name"===f.profile.view.displayText?V.source.y+(V.target.y-V.source.y)/2-14:V.source.y+(V.target.y-V.source.y)/2-6+E}).attr("x",function(P){const V=P.chartInfo;return"name"===f.profile.view.displayText?V.source.x+(V.target.x-V.source.x)/4:V.source.x+(V.target.x-V.source.x)/2+M})}repositionArrowFloatText(s,f=null){this.st.links.filter(v=>f?f.includes(v.chartInfo.source.id)||f.includes(v.chartInfo.target.id):v.chartInfo.target.selected||v.chartInfo.source.selected).select("text.float").attr("y",v=>v.chartInfo.source.y+(v.chartInfo.target.y-v.chartInfo.source.y)/2+14).attr("x",v=>{const M=v.subProject,E=v.risk,P=v.chartInfo;return null!==M.subGraphLoaded||M.isParent||E.criticalCount>0||E.greenCount>0?P.source.x+(P.target.x-P.source.x)/2-25:P.source.x+(P.target.x-P.source.x)/2-3})}getPath(s){if(s.chartInfo.dPath)return s.chartInfo.dPath;const f=s.chartInfo.target.x-s.chartInfo.source.x,v=s.chartInfo.target.y-s.chartInfo.source.y,M=Math.sqrt(f*f+v*v),E=f/M,P=v/M;return"M"+(s.chartInfo.source.x+12*E)+","+(s.chartInfo.source.y+12*P)+"L"+(s.chartInfo.target.x-17*E)+","+(s.chartInfo.target.y-17*P)}setElPositions(s,f,v,M,E){this.st.ctrl_down?(this.st.drag_line.classed("hidden",!0).style("marker-end",""),this.nudgeGroup(f,v,M,E)):this.updateLinePos(s)}updateLinePos(s){const f=this.st.mousedown_node;f&&this.st.drag_line.attr("d",`M${f.x},${f.y}L${s[0]},${s[1]}`)}static#t=this.\u0275fac=function(f){return new(f||z)(O.LFG(lt))};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})(),dt=(()=>{class z{constructor(s,f,v,M){this.events=s,this.props=f,this.factory=v,this.positioner=M}getPath(s){return this.positioner.getPath(s)}onNodeGroupDrag(s,f,v,M,E){return this.positioner.setElPositions(s,f,v,M,E)}updateLinePos(s){return this.positioner.updateLinePos(s)}handleNodeCreation(s,f,v){return this.factory.handleNodeCreation(s,f,v)}deleteSelectedNodeOrLink(s){return this.factory.deleteSelectedNodeOrLink(s)}addFastActivity(s,f,v,M){return this.factory.addFastActivity(s,f,v,M)}getNodeName(s){return this.props.getNodeName(s)}getTextAboveNode(s,f){return this.props.getTextAboveNode(s,f)}getNodeColor(s,f,v,M,E){return this.props.getNodeColor(s,f,v,M,E)}isCompleted(s,f){return this.props.isCompleted(s,f)}isSelected(s,f){return this.props.isSelected(s,f)}isHighlighted(s,f){return this.props.isHighlighted(s,f)}getArrowColor(s,f,v,M,E){return this.props.getArrowColor(s,f,v,M,E)}getWrappedTextColor(s,f){return this.props.getWrappedTextColor(s,f)}getLinkTextPosY(s,f){return this.props.getLinkTextPosY(s,f)}getLinkTextPosX(s,f){return this.props.getLinkTextPosX(s,f)}getLowerLinkTextYPos(s,f){return this.props.getLowerLinkTextYPos(s,f)}getLowerLinkTextXPos(s,f){return this.props.getLowerLinkTextXPos(s,f)}getActivityFontSize(s,f){return this.props.getActivityFontSize(s,f)}getLinkText(s,f){return this.props.getLinkText(s,f)}getLinkEndMarker(s,f){return this.props.getLinkEndMarker(s,f)}getLinkCss(s,f){return this.props.getLinkCss(s,f)}getNodeCss(s,f){return this.props.getNodeCss(s,f)}getLowerLinkText(s,f){return this.props.getLowerLinkText(s,f)}setMouseDownLink(s,f,v){return this.events.setSelectedLinkState(s,f,v)}onNodeGroupMouseUp(s,f){return this.events.joinNodesOrCreateArrow(s,f)}onNodeGroupMouseDown(s,f,v,M){return this.events.setNodeDownStates(s,f,v,M)}onNodeMouseOver(s,f){this.events.setMouseOverNodeStates(s,f)}onNodeMouseOut(s,f){this.events.clearMouseOverNodeStates(s,f)}clearClassesAndHideLine(){return this.events.clearSelectionAndHideLine()}splitUpNode(s,f){return this.events.splitUpNode(s,f)}makeDummy(){return this.events.makeDummy()}makeMilestone(s){return this.events.makeMilestone(s)}deselectNode(s){return this.events.deselectNode(s)}deselectActivity(s){return this.events.deselectActivity(s)}checkDeselect(s){return this.events.checkDeselect(s)}updateGroupPosition(s,f){return this.positioner.updateGroupPosition(s,f)}static#t=this.\u0275fac=function(f){return new(f||z)(O.LFG(U),O.LFG(Q),O.LFG(J),O.LFG(Y))};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})(),ft=(()=>{class z{constructor(s,f,v){this.dashboard=s,this.arrowController=f,this.st=v,this.transform={k:1,x:0,y:0},this.lassoStart=null,this.lassoEnd=null,this.pivotNode=null,this.clickCount=0,this.clickTimer=null,this.originalDragPoint=null,this.previousPos=null,this.skipDrag=!1}setTransform(s){this.transform=s}buildLasso(s){!0===s.profile.view.lassoOn?this.init(s,this.id):this.remove(this.id)}init(s,f){this.id=f,this.st.svg.selectAll(".lasso").remove(),this.mainG=this.st.svg,this.lassoG=this.st.svg.append("g"),this.lassoG.classed("lasso",!0),this.targetArea=this.lassoG.append("rect"),this.selectedNodes=s.profile.view.lassoedNodes,this.selectedActivities=s.profile.view.lassoedLinks,this.targetArea.attr("width","100%").attr("height","100%").style("fill","red").style("opacity",.1),this.project=s,this.dynPath=this.lassoG.append("path").attr("class","drawn"),this.closePath=this.lassoG.append("path").attr("class","loop_close"),this.originNode=this.lassoG.append("circle").attr("class","origin"),this.drawnCoords=[],this.tpath="";const v=w.ohM().filter(M=>!M.button).on("start",M=>this.dragstart(M)).on("drag",M=>this.dragmove(M)).on("end",()=>this.dragend());this.targetArea.call(v),this.st.nodes.classed("possible",M=>this.selectedNodes.indexOf(M.id)>-1),this.st.links.classed("possible",M=>this.selectedActivities.indexOf(M.profile.id)>-1),this.st.nodes.classed("pivot",M=>this.pivotNode?.id===M.id)}keydown(s){if(s.keyCode===D.s.Ctrl&&!0===this.project?.profile.view.lassoOn){this.previousPos=null;const f=w.ohM().filter(v=>!v.button).on("start",this.nodeMoveDragStart).on("drag",v=>this.nodeMoveDragMove(v)).on("end",this.nodeMoveDragEnd);this.targetArea.call(f)}}keyup(s){s.keyCode===D.s.Ctrl&&!0===this.project?.profile.view.lassoOn&&this.init(this.project,this.id)}nodeMoveDragStart(){}nodeMoveDragMove(s){const f=w.cx$(s,this.mainG.node()),[v,M]=this.unTransformPt(f);if(null!==this.pivotNode&&null!==this.originalDragPoint){const[E,P]=this.originalDragPoint;this.transformPoints([v-E,M-P]),this.arrowController.updateGroupPosition(this.project,this.selectedNodes)}else if(this.previousPos){const[E,P]=this.previousPos,V=v-E,K=M-P;this.st.nodes.attr("transform",q=>this.selectedNodes.indexOf(q.id)>-1?(q.x=q.x+V,q.y=q.y+K,`translate(${q.x}, ${q.y})`):`translate(${q.x}, ${q.y})`),this.arrowController.updateGroupPosition(this.project,this.selectedNodes)}this.previousPos=[v,M],this.originalDragPoint=[v,M]}nodeMoveDragEnd(){this.previousPos=null,this.originalDragPoint=null}remove(s){this.id=s,this.st.svg.selectAll(".lasso").remove()}isInsideNode(s){const[f,v]=s,M=this.project.integrations.find(E=>{const P=this.transformPt([E.x,E.y]);return Math.sqrt(Math.pow(f-P[0],2)+Math.pow(v-P[1],2))<20});if(M&&this.selectedNodes.indexOf(M.id)>-1)return this.pivotNode&&M&&this.pivotNode.id===M.id?void(this.pivotNode=null):(this.pivotNode=M??null,M);this.pivotNode=null}transformPoints(s){if(!this.pivotNode||!this.originalDragPoint)return;const[f,v]=s,[M,E]=this.originalDragPoint,P=M+f,V=E+v,K=Math.sqrt(Math.pow(M-this.pivotNode.x,2)+Math.pow(E-this.pivotNode.y,2)),T=Math.sqrt(Math.pow(P-this.pivotNode.x,2)+Math.pow(V-this.pivotNode.y,2))/K,nt=Math.atan2(E-this.pivotNode.y,M-this.pivotNode.x),wt=Math.atan2(V-this.pivotNode.y,P-this.pivotNode.x)-nt;this.st.nodes.attr("transform",bt=>{if(this.selectedNodes.indexOf(bt.id)>-1){if(!this.pivotNode||void 0===this.pivotNode.x||void 0===this.pivotNode.y)return`translate(${bt.x}, ${bt.y})`;const _t=bt.x-this.pivotNode.x,Qt=bt.y-this.pivotNode.y;let se=_t*Math.cos(wt)-Qt*Math.sin(wt),ve=_t*Math.sin(wt)+Qt*Math.cos(wt);se*=T,ve*=T;const _e=se+this.pivotNode.x,Kt=ve+this.pivotNode.y;return bt.x=_e,bt.y=Kt,`translate(${_e}, ${Kt})`}return`translate(${bt.x}, ${bt.y})`})}dragstart(s){if(this.clickCount>0){console.log("double click detected!");const f=w.cx$(s,this.mainG.node());this.isInsideNode(f),this.clickCount=0,this.skipDrag=!0}this.clickTimer||(this.clickTimer=setTimeout(()=>{this.clickCount=0,clearTimeout(this.clickTimer),this.clickTimer=null},300)),this.clickCount++,this.drawnCoords=[],this.dynPath.attr("d",null),this.closePath.attr("d",null)}dragmove(s){if(this.skipDrag)return void(this.skipDrag=!1);const{x:f,y:v}=s,[M,E]=w.cx$(s,this.mainG.node());""===this.tpath?(this.tpath=this.tpath+"M "+M+" "+E,this.origin=[f,v],this.torigin=[M,E],this.originNode.attr("cx",M).attr("cy",E).attr("r",7).attr("display",null)):this.tpath=this.tpath+" L "+M+" "+E,this.drawnCoords.push([f,v]);const P=Math.sqrt(Math.pow(f-this.origin[0],2)+Math.pow(v-this.origin[1],2)),V="M "+M+" "+E+" L "+this.torigin[0]+" "+this.torigin[1];this.dynPath.attr("d",this.tpath),this.closePath.attr("d",V);const T=P<=75;this.selectedNodes=[],this.project.integrations.forEach(nt=>{const wt=this.transformPt([nt.x,nt.y]);this.pointInPolygon(wt,this.drawnCoords)&&this.selectedNodes.push(nt.id)}),this.st.nodes.classed("possible",nt=>this.selectedNodes.indexOf(nt.id)>-1),this.st.nodes.classed("pivot",nt=>this.pivotNode?.id===nt.id),this.closePath.attr("display",T?null:"none")}transformPt(s){return[s[0]*this.transform.k+this.transform.x,s[1]*this.transform.k+this.transform.y]}unTransformPt(s){return[s[0]/this.transform.k-this.transform.x,s[1]/this.transform.k-this.transform.y]}dragend(){this.tpath="",this.drawnCoords=[],this.dynPath.attr("d",null),this.closePath.attr("d",null),this.originNode.attr("display","none"),this.selectedActivities=[],this.selectActivities(),this.project.profile.view.isSubProjSelected=this.isSubProject(),this.project.profile.view.lassoedLinks=this.selectedActivities,this.project.profile.view.lassoedNodes=this.selectedNodes,this.project.profile.view.lassoStart=this.lassoStart,this.project.profile.view.lassoEnd=this.lassoEnd,this.lassoEnd=null,this.lassoStart=null,this.selectedNodes=[],this.dashboard.updateProject(this.project,!1)}isSubProject(){if(this.selectedNodes.length<3)return!1;const s=[],f=[];this.project.activities.forEach(T=>{this.selectedNodes.indexOf(T.chartInfo.target_id)>-1&&-1===this.selectedNodes.indexOf(T.chartInfo.source_id)&&s.push(T),this.selectedNodes.indexOf(T.chartInfo.source_id)>-1&&-1===this.selectedNodes.indexOf(T.chartInfo.target_id)&&f.push(T)});const v=[],M=[];if(this.selectedNodes.forEach(T=>{this.project.activities.filter(_t=>_t.chartInfo.source_id===T).find(_t=>this.selectedNodes.indexOf(_t.chartInfo.target_id)>-1)||M.push(T),this.project.activities.filter(_t=>_t.chartInfo.target_id===T).find(_t=>this.selectedNodes.indexOf(_t.chartInfo.source_id)>-1)||v.push(T)}),M.length>1||v.length>1||this.project.activities.find(T=>T.chartInfo.target_id===M[0]&&T.chartInfo.source_id===v[0]))return!1;this.lassoStart=v[0],this.lassoEnd=M[0];const P=s.map(T=>T.chartInfo.target_id),V=f.map(T=>T.chartInfo.source_id),K=P.filter(T=>-1===v.indexOf(T)&&-1===M.indexOf(T)),q=V.filter(T=>-1===v.indexOf(T)&&-1===M.indexOf(T));return 0===K.length&&0===q.length}selectActivities(){this.project.activities.forEach(s=>{this.selectedNodes.indexOf(s.chartInfo.source_id)>-1&&this.selectedNodes.indexOf(s.chartInfo.target_id)>-1&&this.selectedActivities.push(s.profile.id)}),this.st.links.classed("possible",s=>this.selectedActivities.indexOf(s.profile.id)>-1)}pointInPolygon(s,f){let v,M,E,P,K;const q=s[0],T=s[1];let nt=!1;for(let vt=0,wt=f.length-1;vt<f.length;wt=vt++)v=f[vt][0],E=f[vt][1],M=f[wt][0],P=f[wt][1],K=E>T!=P>T&&q<(M-v)*(T-E)/(P-E)+v,K&&(nt=!nt);return nt}static#t=this.\u0275fac=function(f){return new(f||z)(O.LFG(st.Ou),O.LFG(dt),O.LFG(lt))};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})();var Ot=ot(1568);let F=(()=>{class z{constructor(s,f,v,M){this.st=s,this.controller=f,this.lassoTool=v,this.dashboard=M}bindGlobalEvents(){this.st.svg.on("dblclick",s=>{s.preventDefault(),this.dblclick(s)}).on("click",s=>{this.st.allowDeletes=!0,this.st.last_selected_node=null}).on("mousemove",s=>this.mousemove(s)).on("mouseup",()=>this.mouseup()),w.Ys(window).on("keydown",s=>{this.keydown(s),this.lassoTool.keydown(s)}).on("keyup",s=>{this.keyup(s),this.lassoTool.keyup(s)})}dblclick(s){(!s.ctrlKey||null!=this.st.drag_node)&&s.stopPropagation(),this.st.mainG.classed("active",!0);const f=this.dashboard.activeProject$.getValue();this.controller.handleNodeCreation(s.ctrlKey,w.cx$(s,this.st.mainG.node()),f)&&this.dashboard.updateProject(f,!0,!0)}mousemove(s){s.ctrlKey||s.stopPropagation(),this.controller.updateLinePos(w.cx$(this.st.mainG.node()))}mouseup(){this.controller.clearClassesAndHideLine()}keydown(s){const f=this.dashboard.activeProject$.getValue();(this.st.lastKeyDown===D.s.Ctrl||this.st.macMetaDown)&&s.keyCode===D.s.X&&(s.preventDefault(),null!=this.st.selected_node&&this.controller.splitUpNode(this.st.selected_node,f),this.dashboard.updateProject(f,!0,!0)),(this.st.lastKeyDown===D.s.Ctrl||this.st.macMetaDown)&&s.keyCode===D.s.D&&(s.preventDefault(),this.controller.makeDummy(),this.dashboard.updateProject(f,!0,!0)),(this.st.lastKeyDown===D.s.Ctrl||this.st.macMetaDown)&&s.keyCode===D.s.M&&(s.preventDefault(),this.controller.makeMilestone(f),this.dashboard.updateProject(f,!0,!0)),s.keyCode===D.s.Backspace&&s.metaKey&&this.st.allowDeletes&&(this.controller.deleteSelectedNodeOrLink(f),this.dashboard.updateProject(f,!0,!0)),this.st.lastKeyDown||(this.st.lastKeyDown=s.keyCode,s.metaKey&&(s.preventDefault(),this.st.macMetaDown=!0,this.st.ctrl_down=!0),s.keyCode===D.s.Ctrl&&(this.st.ctrl_down=!0),s.keyCode!==D.s.Delete)||this.st.allowDeletes&&(this.controller.deleteSelectedNodeOrLink(f),this.dashboard.updateProject(f,!0,!0))}keyup(s){this.st.lastKeyDown=null,this.st.macMetaDown&&!s.metaKey&&(this.st.macMetaDown=!1,this.st.ctrl_down=!1),s.keyCode===D.s.Ctrl&&(this.st.ctrl_down=!1)}static#t=this.\u0275fac=function(f){return new(f||z)(O.LFG(lt),O.LFG(dt),O.LFG(ft),O.LFG(st.Ou))};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})(),ht=(()=>{class z{constructor(s,f,v){this.st=s,this.controller=f,this.dashboard=v}createNodes(s){this.st.nodes=this.st.mainG.append("g").attr("class","node").selectAll("g");let f=this.st.mainG.select("g.node");f.empty()&&(f=this.st.mainG.append("g").attr("class","node"));const v=f.selectAll("g"),M=w.eRy().duration(H.aV).ease(H.I2),E=v.data(s.integrations,T=>T.id);E.exit().remove();const P=E.enter().append("g").attr("class",T=>this.controller.getNodeCss(T,s)).classed("milestone",T=>T.isMilestone).classed("completed",T=>s.profile.view.markCompleted&&T.completed).attr("transform",T=>`translate(${T.x},${T.y})`);P.append("circle").attr("r",T=>T.isMilestone?14:12).classed("node",!0).classed("dummy",T=>T.isDummy).classed("active",T=>T===this.st.selected_node).classed("last-selected",T=>T===this.st.last_selected_node),P.append("text").attr("class","label").attr("text-anchor","middle").attr("y",".3em").text(T=>this.controller.getNodeName(T)),"none"!==s.profile.view.showEftLft&&P.append("text").attr("class","label float risk-stats").attr("text-anchor","middle").attr("y",T=>T.isMilestone?"-2.3em":"-1.9em").text(T=>this.controller.getTextAboveNode(T,s));const V=w.ohM().filter(T=>!T.button).on("start",T=>{}).on("drag",(T,nt)=>{this.controller.onNodeGroupDrag([T.x,T.y],T.dx,T.dy,nt,s)}).on("end",(T,nt)=>{const vt=this.controller.onNodeGroupMouseUp(nt,s);this.dashboard.updateProject(s,!0,vt)});P.on("mousedown",(T,nt)=>{this.st.allowDeletes=!0,this.controller.onNodeGroupMouseDown(nt,this.st.ctrl_down||this.st.macMetaDown,w.Ys(T.currentTarget),s)}).on("mouseover",(T,nt)=>this.controller.onNodeMouseOver(nt,w.Ys(T.currentTarget))).on("mouseout",(T,nt)=>this.controller.onNodeMouseOut(nt,w.Ys(T.currentTarget))).call(V);const K=P.merge(E),q=this.st.prevProjId!==s.profile.id;K.style("stroke",T=>this.controller.getNodeColor(!0,T,s,this.st.nodeRisk,q)).transition(M).style("stroke",T=>this.controller.getNodeColor(!1,T,s,this.st.nodeRisk,q)),this.st.nodes=K}createArrows(s){let f=this.st.mainG.select("g.link");f.empty()&&(f=this.st.mainG.append("g").attr("class","link"));const v=f.selectAll("g.activity"),M=s.activities.filter(T=>!T.chartInfo.milestoneNodeId),E=v.data(M,T=>T.profile.id);E.exit().remove();const P=E.enter().append("g").attr("class","activity").on("mouseover",T=>w.Ys(T.currentTarget).classed("hover",!0)).on("mouseout",T=>w.Ys(T.currentTarget).classed("hover",!1)).on("mousedown",(T,nt)=>{this.st.allowDeletes=!0,this.controller.setMouseDownLink(nt,this.st.ctrl_down,s),this.dashboard.updateProject(s,!0),T.stopPropagation()});this.createArrowBody(s,P),this.createMainArrowText(s,P),this.createTextGlow(s,P),this.createLowerText(s,P);const V=P.merge(E),K=w.eRy().duration(H.aV).ease(H.I2),q=this.st.prevProjId!==s.profile.id;V.attr("class",T=>this.controller.getLinkCss(T,s)).classed("completed",T=>this.controller.isCompleted(T,s)).classed("selected",T=>this.controller.isSelected(T,s)).classed("sub-project",T=>this.controller.isHighlighted(T,s)).style("stroke",T=>this.controller.getArrowColor(!0,T,s,this.st.arrowRisk,q)).transition(K).style("stroke",T=>this.controller.getArrowColor(!1,T,s,this.st.arrowRisk,q)),this.st.links=V,s.profile.view.activeSubProjectId=void 0}createMainArrowText(s,f){if(s.profile.view.wrapText){const v=this;f.append("foreignObject").attr("x",M=>this.controller.getLinkTextPosX(M,s)-25).attr("y",M=>this.controller.getLinkTextPosY(M,s)-15).attr("width","80px").each(function(M){let E=null;M!==s.profile.view.selectedActivity&&(E=v.controller.getWrappedTextColor(M,s));const P=w.Ys(this).append("xhtml:div").style("font-size",v.controller.getActivityFontSize(M,s)).style("color","#aaa").style("font-weight","bold").style("color",()=>E),V=v.controller.getLinkText(M,s).split(",");if(P.selectAll("div").data(V).enter().append("xhtml:div").style("font-size",v.controller.getActivityFontSize(M,s)).text(K=>K),P){const K=P.node().getBoundingClientRect();w.Ys(this).attr("height",K.height+"px")}})}else f.append("text").attr("class","label").classed("selected",v=>v===this.st.selected_link).attr("y",v=>this.controller.getLinkTextPosY(v,s)).attr("x",v=>this.controller.getLinkTextPosX(v,s)).style("font-size",v=>this.controller.getActivityFontSize(v,s)).style("text-anchor","middle").text(v=>this.controller.getLinkText(v,s))}createArrowBody(s,f){f.append("svg:path").attr("class","link main").classed("dummy",v=>v.chartInfo.isDummy).classed("selected",v=>v===this.st.selected_link).attr("d",v=>this.controller.getPath(v)).style("marker-end",v=>this.controller.getLinkEndMarker(v,s))}createTextGlow(s,f){s.profile.view.wrapText||f.insert("text","text").attr("class","glow").style("font-size",v=>this.controller.getActivityFontSize(v,s)).attr("y",v=>this.controller.getLinkTextPosY(v,s)).attr("x",v=>this.controller.getLinkTextPosX(v,s)).text(v=>this.controller.getLinkText(v,s))}createLowerText(s,f){f.append("text").attr("class","label float").attr("y",v=>this.controller.getLowerLinkTextYPos(v,s)).attr("x",v=>this.controller.getLowerLinkTextXPos(v,s)).style("text-anchor","middle").text(v=>this.controller.getLowerLinkText(v,s)).style("font-size",v=>this.controller.getActivityFontSize(v,s))}createArrowHeads(){const s=this.st.mainG.append("svg:defs").selectAll("marker");this.addArrowHead(s,"end-0","risk-0"),this.addArrowHead(s,"end-1","risk-1"),this.addArrowHead(s,"end-2","risk-2"),this.addArrowHead(s,"end-3","risk-3"),this.addArrowHead(s,"end-undefined","risk-undefined"),this.addArrowHead(s,"end-u","unprocessed"),this.addArrowHead(s,"end-completed","completed"),s.data(["end-arrow"]).enter().append("svg:marker").attr("id",String).attr("class","endarrow").attr("viewBox","0 -5 10 10").attr("refX",6).attr("markerWidth",3).attr("markerHeight",3).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").attr("fill","#000")}addArrowHead(s,f,v){s=s.data([f]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",6).attr("markerWidth",3).attr("markerHeight",3).attr("orient","auto").attr("class",v).append("svg:path").attr("d","M0,-5L10,0L0,5")}clearElements(){this.st.mainG.selectAll("g.link").remove(),this.st.mainG.selectAll("g.node").remove(),this.st.mainG.selectAll("defs").remove(),this.st.mainG.selectAll("g.missing-data").remove()}static#t=this.\u0275fac=function(f){return new(f||z)(O.LFG(lt),O.LFG(dt),O.LFG(st.Ou))};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})(),et=(()=>{class z{constructor(s,f){this.st=s,this.lassoTool=f}zoom(s){if(1==s.profile.view.lassoOn)return void this.st.svg.on(".zoom",null);if(s.integrations.length<2)return void(s.profile.view.autoZoom=!1);const f=this.getSvgZoom(s);if(f){const v=this.getZoomOrigin(s);w.sPX().translateTo(this.st.svg,v.translate[0],v.translate[1]),w.sPX().scaleTo(this.st.svg,v.scale)}this.st.svg.call(w.sPX().on("zoom",(v,M)=>{this.st.mainG.attr("transform",v.transform),this.lassoTool.setTransform(v.transform)})),this.st.svg.on("dblclick.zoom",null),null!=f&&(this.st.mainG.attr("transform",`translate(${f.translate})scale(${f.scale})`),this.lassoTool.setTransform({k:f.scale,x:f.translate[0],y:f.translate[1]}))}getSvgZoom(s){if(null==s||0===s.integrations.length)return{scale:1,translate:[0,0]};if(!s.profile.view.autoZoom)return null;s.profile.view.autoZoom=!1;const M=s.integrations.map(Kt=>Kt.x),E=s.integrations.map(Kt=>Kt.y),P=Math.max(...M),V=Math.min(...M),K=Math.max(...E),q=Math.min(...E),bt=(P+V)/2,_t=(K+q)/2,Qt=.9/Math.max((P-V)/this.st.width,(K-q)/this.st.height);return{translate:[this.st.width/2-Qt*bt-0,this.st.height/2-Qt*_t-0],scale:Qt}}getZoomOrigin(s){const f=s.integrations.map(bt=>bt.x),v=s.integrations.map(bt=>bt.y),M=Math.max(...f),E=Math.min(...f),P=Math.max(...v),V=Math.min(...v);return{translate:[(M-E)/2+E,(P-V)/2+V],scale:.9/Math.max((M-E)/this.st.width,(P-V)/this.st.height)}}static#t=this.\u0275fac=function(f){return new(f||z)(O.LFG(lt),O.LFG(ft))};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})(),Lt=(()=>{class z{constructor(s,f,v,M,E,P,V,K,q,T){this.dashboard=s,this.eventService=f,this.ngZone=v,this.lassoTool=M,this.controller=E,this.nodeArranger=P,this.events=V,this.elements=K,this.svgZoom=q,this.st=T,this.projIsEmpty=new Ht.X(!0)}init(s,f,v,M,E){this.id=v,this.st.width=s,this.st.height=f,this.rebuild=M,this.initSvg(s,f,E),this.events.bindGlobalEvents(),this.data=this.dashboard.activeProject$,this.sub=this.data.pipe((0,rt.h)(P=>!!P)).subscribe(P=>{this.ngZone.runOutsideAngular(()=>{this.createChart(P)})}),this.st.activity_created=this.eventService.get(H.BT)}destroy(){this.sub&&this.sub.unsubscribe()}createFastActivity(s,f,v=!1){const M=this.controller.addFastActivity(s,this.proj,f,this.st.last_selected_node);M&&(f===H.T5&&(this.st.last_selected_node=M.chartInfo.target??null),!0===v&&this.nodeArranger.arrangeNodes(this.proj),this.dashboard.updateProject(this.proj,!0,!0))}deselectItem(){this.st.allowDeletes=!1,this.controller.checkDeselect(this.proj)&&(this.controller.deselectActivity(this.proj),this.controller.deselectNode(this.proj),this.dashboard.updateProject(this.proj,!1))}disableDeletes(){this.st.allowDeletes=!1}initSvg(s,f,v){const M=this.st,E="big-arrow-"+this.id;if(this.rebuild&&w.Ys(v).select("svg").remove(),!this.st.svg||this.rebuild){const P=w.Ys(v).append("svg").attr("class",E);this.st.svg=P.style("width","100%").style("height",null).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${s} ${f}`),M.mainG=M.svg.append("g"),M.mainG.classed("main-arrow",!0),M.drag_line=M.mainG.append("svg:path").attr("class","link dragline hidden").attr("d","M0,0L0,0")}}createChart(s){this.proj=s;const f=0===s.integrations.length;this.projIsEmpty.next(f),this.rebuild&&this.elements.clearElements(),!f&&(this.svgZoom.zoom(s),this.elements.createArrowHeads(),this.elements.createNodes(s),this.elements.createArrows(s),this.buildDict(s),this.lassoTool.buildLasso(s),this.st.prevProjId=s.profile.id)}buildDict(s){this.st.arrowRisk=new Map,s.activities.forEach((f,v)=>this.st.arrowRisk.set(f.profile.id,f.chartInfo.risk)),this.st.nodeRisk=new Map,s.integrations.forEach((f,v)=>this.st.nodeRisk.set(f.id,f.risk))}static#t=this.\u0275fac=function(f){return new(f||z)(O.LFG(st.Ou),O.LFG(st.WO),O.LFG(O.R0b),O.LFG(ft),O.LFG(dt),O.LFG(Ot.g),O.LFG(F),O.LFG(ht),O.LFG(et),O.LFG(lt))};static#e=this.\u0275prov=O.Yz7({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})();const $t=["chart"];function mt(z,pi){if(1&z){const s=O.EpF();O.TgZ(0,"div",8)(1,"div")(2,"div"),O._uU(3,"Add Activity"),O.qZA(),O.TgZ(4,"input",9),O.NdJ("ngModelChange",function(v){O.CHM(s);const M=O.oxw();return O.KtG(M.activityTxt=v)})("keydown",function(v){O.CHM(s);const M=O.oxw();return O.KtG(M.processActivityTxt(v))}),O.qZA()(),O.TgZ(5,"div",10)(6,"div"),O._uU(7,"Mode"),O.qZA(),O.TgZ(8,"div",11)(9,"div",12)(10,"input",13),O.NdJ("ngModelChange",function(v){O.CHM(s);const M=O.oxw();return O.KtG(M.creationMode=v)}),O.qZA(),O.TgZ(11,"label",14),O._uU(12,"Subgroup"),O.qZA()(),O.TgZ(13,"div",12)(14,"input",15),O.NdJ("ngModelChange",function(v){O.CHM(s);const M=O.oxw();return O.KtG(M.creationMode=v)}),O.qZA(),O.TgZ(15,"label",16),O._uU(16,"Multigroup"),O.qZA()(),O.TgZ(17,"div",17)(18,"input",18),O.NdJ("change",function(){O.CHM(s);const v=O.oxw();return O.KtG(v.autoArrange=!v.autoArrange)}),O.qZA(),O.TgZ(19,"label",19),O._uU(20,"Auto Arrange"),O.qZA()()()()()}if(2&z){const s=O.oxw();O.xp6(4),O.Q6J("ngModel",s.activityTxt),O.xp6(6),O.Q6J("ngModel",s.creationMode),O.xp6(4),O.Q6J("ngModel",s.creationMode),O.xp6(4),O.Q6J("checked",s.autoArrange)}}const Gt=()=>["mat-calendar-body-cell-content","keep-selected-item"];let ge=(()=>{class z{constructor(){this.showFastCreator=!0,this.creationMode=H.MB,this.autoArrange=!1,this.showList=!1,this.ui=(0,O.f3M)(Lt)}ngOnInit(){this.isEmpty=this.ui.projIsEmpty,this.ui.init(this.width,this.height,this.id,this.rebuild,this.chart.nativeElement)}deselectItem(s){this.ui.deselectItem()}disableDeletes(s){this.ui.disableDeletes()}processActivityTxt(s){this.ui.createFastActivity(s,this.creationMode,this.autoArrange),"Enter"===s.key&&(this.activityTxt="")}ngOnDestroy(){this.ui.destroy()}static#t=this.\u0275fac=function(f){return new(f||z)};static#e=this.\u0275cmp=O.Xpm({type:z,selectors:[["cp-arrow-chart"]],viewQuery:function(f,v){if(1&f&&O.Gf($t,7),2&f){let M;O.iGM(M=O.CRH())&&(v.chart=M.first)}},hostAttrs:[1,"cp-arrow-chart"],inputs:{id:"id",width:"width",height:"height",rebuild:"rebuild",showFastCreator:"showFastCreator"},features:[O._Bn([Lt,dt,et,U,F,J,ft,ht,lt,Y,Q])],decls:11,vars:7,consts:[[1,"arrow-empty-message",3,"hidden"],[1,"arrow-component-wrapper"],["class","create-txt",4,"ngIf"],["outsideClick","",1,"arrow-chart-container",3,"skipList","outListSelect","inListSelect"],["chart",""],[1,"arrow-list"],[1,"list",3,"hidden"],[1,"toggle","fas","fa-list",3,"click"],[1,"create-txt"],["type","text",3,"ngModel","ngModelChange","keydown"],[1,"create-mode"],[1,"creation-config"],[1,"custom-control","custom-radio","custom-control-inline"],["type","radio","id","sub","name","create","value","sub",1,"custom-control-input",3,"ngModel","ngModelChange"],["for","sub",1,"custom-control-label"],["type","radio","id","multi","name","create","value","multi",1,"custom-control-input",3,"ngModel","ngModelChange"],["for","multi",1,"custom-control-label"],[1,"custom-control","custom-checkbox","custom-control-inline"],["type","checkbox","id","arrange",1,"custom-control-input",3,"checked","change"],["for","arrange",1,"custom-control-label"]],template:function(f,v){1&f&&(O.TgZ(0,"div",0),O.ALo(1,"async"),O._uU(2,"Arrow diagram: click to add nodes and arrows"),O.qZA(),O.TgZ(3,"div",1),O.YNc(4,mt,21,4,"div",2),O.TgZ(5,"div",3,4),O.NdJ("outListSelect",function(E){return v.deselectItem(E)})("inListSelect",function(E){return v.disableDeletes(E)}),O.qZA(),O.TgZ(7,"div",5)(8,"div",6),O._UZ(9,"cp-arrow-list"),O.qZA(),O.TgZ(10,"i",7),O.NdJ("click",function(){return v.showList=!v.showList}),O.qZA()()()),2&f&&(O.Q6J("hidden",!O.lcZ(1,4,v.isEmpty)),O.xp6(4),O.Q6J("ngIf",v.showFastCreator),O.xp6(1),O.Q6J("skipList",O.DdM(6,Gt)),O.xp6(3),O.Q6J("hidden",!v.showList))},styles:[".cp-arrow-chart{display:block;position:relative}.cp-arrow-chart .arrow-component-wrapper{position:relative;top:0;left:0}.cp-arrow-chart .arrow-component-wrapper .create-txt{position:absolute;top:10px;left:5px;padding:7px;border-radius:7px;background-color:#f9f9f9;z-index:12;display:flex}.cp-arrow-chart .arrow-component-wrapper .create-txt .create-mode{padding-left:20px}.cp-arrow-chart .arrow-component-wrapper svg{background-color:#fff}.cp-arrow-chart path.dragline{stroke:#000}.cp-arrow-chart path.link{stroke-width:4px;cursor:default}.cp-arrow-chart svg:not(.active):not(.ctrl) path.link{cursor:pointer}.cp-arrow-chart path.link{fill:none;stroke-width:4px;cursor:default}.cp-arrow-chart .link{stroke-opacity:.6}.cp-arrow-chart .node{stroke-width:1px;fill:#fff}.cp-arrow-chart g.selected *{stroke-opacity:1}.cp-arrow-chart g.selected .node{fill:#aaf}.cp-arrow-chart .node .risk-0{stroke-opacity:.5}.cp-arrow-chart .node .risk-1,.cp-arrow-chart .node .risk-2{stroke-opacity:.6}.cp-arrow-chart .node .risk-3{stroke-opacity:.9}.cp-arrow-chart .link .risk-0 text{stroke-opacity:.5}.cp-arrow-chart .link .risk-1 text{stroke-opacity:.6}.cp-arrow-chart .link .risk-2 text{stroke-opacity:.6}.cp-arrow-chart .link .risk-3 text{stroke-opacity:.5}.cp-arrow-chart .risk-undefined{stroke:#bbb;stroke-opacity:.9}.cp-arrow-chart g.completed{fill:#fdf;stroke-opacity:.9}.cp-arrow-chart marker.risk-0{fill:#1c1;opacity:1}.cp-arrow-chart marker.risk-1{fill:#ffd800;opacity:1}.cp-arrow-chart marker.risk-2{fill:red;opacity:1}.cp-arrow-chart marker.risk-3{fill:#000;opacity:1}.cp-arrow-chart marker.risk-undefined{fill:#bbb;opacity:1}.cp-arrow-chart marker.unprocessed{fill:#bbb;opacity:1}.cp-arrow-chart marker.completed{fill:#fdf;opacity:1}.cp-arrow-chart .risk-0 path.link{stroke-opacity:.4}.cp-arrow-chart .risk-1 path.link{stroke-opacity:.6}.cp-arrow-chart .risk-2 path.link{stroke-opacity:.6}.cp-arrow-chart .risk-3 path.link{stroke-opacity:.9}.cp-arrow-chart .risk-undefined path.link{opacity:1}.cp-arrow-chart .completed path.link{stroke:#fdf;stroke-opacity:.8}.cp-arrow-chart .unprocessed path.link{stroke-opacity:.9}.cp-arrow-chart .glow{text-anchor:middle;font-size:13px;stroke:#fff;stroke-width:6;stroke-opacity:.7;fill:#fff}.cp-arrow-chart g path.dummy{stroke-dasharray:10,2}.cp-arrow-chart .dummy text{stroke-dasharray:10,0}.cp-arrow-chart g.sub-project path.link.main{stroke:purple;opacity:.9}.cp-arrow-chart circle.last-selected{stroke:purple}.cp-arrow-chart g.selected text.label{stroke:#00f}.cp-arrow-chart g.selected foreignObject>div{color:#00f}.cp-arrow-chart foreignObject>div{text-shadow:rgb(255,255,255) 0px 0px 3px,rgb(255,255,255) 0px 0px 4px,rgb(255,255,255) 0px 0px 3px,rgb(255,255,255) 0px 0px 3px;font-size:15px}.cp-arrow-chart text.glow,.cp-arrow-chart text.label,.cp-arrow-chart foreignObject>div{pointer-events:all;cursor:pointer}.cp-arrow-chart path.link.dragline{pointer-events:none}.cp-arrow-chart path.link.hidden{stroke-width:0}.cp-arrow-chart circle.node{stroke-width:1.5px;cursor:pointer}.cp-arrow-chart text,.cp-arrow-chart foreignObject>div{font:12px sans-serif;pointer-events:none}.cp-arrow-chart text.id{text-anchor:middle;font-weight:700}.cp-arrow-chart .activity-labels div{float:left;width:158px}.cp-arrow-chart .activity-labels div:first-child{width:23px}.cp-arrow-chart .dim{opacity:.8}.cp-arrow-chart g.dummy path{stroke-dasharray:10,2}.cp-arrow-chart g circle.dummy{stroke-dasharray:7,3;stroke-width:2.5px}.cp-arrow-chart g.milestone circle{stroke-width:4px}.cp-arrow-chart g.milestone{stroke-opacity:.8;fill:#000}.cp-arrow-chart g.selected path.link.main{stroke:#00f;opacity:.9}.cp-arrow-chart circle.active{stroke:#00f;stroke-width:2.5}.cp-arrow-chart .hover path{stroke-width:5.5px}.cp-arrow-chart text.risk-stats{font-size:8px;stroke-opacity:.4;fill:#000;font-weight:400}.cp-arrow-chart .arrow-empty-message{position:absolute;top:40%;left:50%;z-index:11;transform:translate(-50%,-50%)}.cp-arrow-chart .risk-end{stroke-opacity:.8;stroke-width:3px}.cp-arrow-chart .risk-end circle.node,.cp-arrow-chart .risk-start circle.node{stroke-width:3px}.cp-arrow-chart .risk-start{stroke-opacity:.8;stroke-width:3px}.cp-arrow-chart .arrow-empty-message{font-weight:700}.cp-arrow-chart .creation-config{display:flex;align-items:baseline}.cp-arrow-chart .lasso path{stroke:#505050;stroke-width:2px}.cp-arrow-chart .lasso .drawn{fill-opacity:.05}.cp-arrow-chart .lasso .loop_close{fill:none;stroke-dasharray:4,4}.cp-arrow-chart .lasso .origin{fill:#39f;fill-opacity:.5}.cp-arrow-chart .not_possible{fill:#c8c8c8}.cp-arrow-chart .possible circle,.cp-arrow-chart .possible path,.cp-arrow-chart .unprocessed.possible path.link{fill:#ec888c;stroke:#ec888c}.cp-arrow-chart .pivot circle{fill:#00f;stroke:#00f}.cp-arrow-chart .arrow-list{position:absolute;right:0;top:0;display:flex}.cp-arrow-chart .toggle{padding:5px}.cp-arrow-chart .arrow-list{height:100%}.cp-arrow-chart .list{padding-left:5px;height:100%;width:350px;overflow-y:auto;box-shadow:-6px 0 6px -4px #00000040;background-color:#fff}\n"],encapsulation:2})}return z})()},5547:(qt,At,ot)=>{ot.d(At,{S:()=>J});var O=ot(6814),w=ot(2357),H=ot(6223),Ht=ot(179),rt=ot(3633),st=ot(2181),D=ot(9212);const j=U=>({selected:U});function ut(U,Q){if(1&U){const Y=D.EpF();D.ynx(0),D.TgZ(1,"div",3),D.NdJ("click",function(){D.CHM(Y);const ft=D.oxw().$implicit,Ot=D.oxw(2);return D.KtG(Ot.selectActivity(ft))}),D._uU(2),D.qZA(),D.TgZ(3,"div")(4,"input",4),D.NdJ("ngModelChange",function(ft){D.CHM(Y);const Ot=D.oxw().$implicit;return D.KtG(Ot.profile.name=ft)})("ngModelChange",function(){D.CHM(Y);const ft=D.oxw(3);return D.KtG(ft.updateProject())}),D.qZA()(),D.TgZ(5,"div")(6,"input",5),D.NdJ("ngModelChange",function(ft){D.CHM(Y);const Ot=D.oxw().$implicit;return D.KtG(Ot.profile.depends_on=ft)})("ngModelChange",function(){D.CHM(Y);const ft=D.oxw(3);return D.KtG(ft.updateProject())}),D.qZA()(),D.TgZ(7,"div")(8,"input",6),D.NdJ("ngModelChange",function(ft){D.CHM(Y);const Ot=D.oxw().$implicit;return D.KtG(Ot.profile.duration=ft)})("ngModelChange",function(){D.CHM(Y);const ft=D.oxw(3);return D.KtG(ft.updateProject())}),D.qZA()(),D.BQk()}if(2&U){const Y=D.oxw().$implicit,dt=D.oxw(2);D.xp6(1),D.Q6J("ngClass",D.VKq(6,j,dt.selectedActivity===Y)),D.xp6(1),D.Oqu(Y.profile.id),D.xp6(2),D.Q6J("title",Y.profile.name)("ngModel",Y.profile.name),D.xp6(2),D.Q6J("ngModel",Y.profile.depends_on),D.xp6(2),D.Q6J("ngModel",Y.profile.duration)}}function pt(U,Q){if(1&U&&(D.TgZ(0,"div",2),D.YNc(1,ut,9,8,"ng-container",0),D.qZA()),2&U){const Y=Q.$implicit;D.xp6(1),D.Q6J("ngIf",!Y.chartInfo.isDummy)}}function yt(U,Q){if(1&U&&(D.TgZ(0,"div"),D.YNc(1,pt,2,1,"div",1),D.qZA()),2&U){const Y=D.oxw();D.xp6(1),D.Q6J("ngForOf",Y.project.activities)}}let lt=(()=>{class U{constructor(Y,dt){this.dashboard=Y,this.eventService=dt}ngOnInit(){this.sub=this.dashboard.activeProject$.pipe((0,st.h)(Y=>!!Y)).subscribe(Y=>{this.project=Y})}selectActivity(Y){this.selectedActivity=Y,this.project.profile.view.selectedActivity=Y,this.dashboard.updateProject(this.project)}ngOnDestroy(){this.sub?.unsubscribe()}updateProject(){null!==this.project&&this.dashboard.updateProject(this.project,!0)}static#t=this.\u0275fac=function(dt){return new(dt||U)(D.Y36(rt.Ou),D.Y36(rt.WO))};static#e=this.\u0275cmp=D.Xpm({type:U,selectors:[["cp-arrow-list"]],decls:3,vars:1,consts:[[4,"ngIf"],["class","activity",4,"ngFor","ngForOf"],[1,"activity"],[1,"cursor-pointer",3,"ngClass","click"],["type","text",3,"title","ngModel","ngModelChange"],["type","text",1,"depends-on",3,"ngModel","ngModelChange"],["type","number",1,"duration",3,"ngModel","ngModelChange"]],template:function(dt,ft){1&dt&&(D.TgZ(0,"p"),D._uU(1,"Activity List"),D.qZA(),D.YNc(2,yt,2,1,"div",0)),2&dt&&(D.xp6(2),D.Q6J("ngIf",void 0!==ft.project))},dependencies:[O.mk,O.sg,O.O5,H.Fj,H.wV,H.JJ,H.On],styles:[".activity[_ngcontent-%COMP%]{display:flex}input[_ngcontent-%COMP%]{border-left:none;border-top:none;border-right:none;border-bottom:1px solid #999}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer;flex-basis:25px;flex-grow:0;flex-shrink:0}.depends-on[_ngcontent-%COMP%]{max-width:105px}.duration[_ngcontent-%COMP%]{max-width:45px;text-align:right}.selected[_ngcontent-%COMP%]{background-color:#00f;color:#fff}"]})}return U})();var Tt=ot(4585);let J=(()=>{class U{static#t=this.\u0275fac=function(dt){return new(dt||U)};static#e=this.\u0275mod=D.oAB({type:U});static#i=this.\u0275inj=D.cJS({imports:[O.ez,H.u5,Ht.g]})}return U})();D.B6R(w.w,[O.O5,H.Fj,H._,H.JJ,H.On,Tt.A,lt],[O.Ov])},4585:(qt,At,ot)=>{ot.d(At,{A:()=>w});var O=ot(9212);let w=(()=>{class H{onClick(rt){let st=rt.target,D=!0;for(;st;){if("string"==typeof st.className&&this.skipList.filter(ut=>st.className?.includes(ut)).length){D=!1;break}st=st.parentElement}!this.elementRef.nativeElement.contains(rt.target)&&D?this.outListSelect.emit(rt):!this.elementRef.nativeElement.contains(rt.target)&&this.inListSelect.observers.length>0&&this.inListSelect.emit(rt)}constructor(rt){this.elementRef=rt,this.outListSelect=new O.vpe,this.inListSelect=new O.vpe}static#t=this.\u0275fac=function(st){return new(st||H)(O.Y36(O.SBq))};static#e=this.\u0275dir=O.lG2({type:H,selectors:[["","outsideClick",""]],hostBindings:function(st,D){1&st&&O.NdJ("mousedown",function(ut){return D.onClick(ut)},!1,O.evT)},inputs:{skipList:"skipList"},outputs:{outListSelect:"outListSelect",inListSelect:"inListSelect"}})}return H})()},179:(qt,At,ot)=>{ot.d(At,{g:()=>w});var O=ot(9212);let w=(()=>{class H{static#t=this.\u0275fac=function(st){return new(st||H)};static#e=this.\u0275mod=O.oAB({type:H});static#i=this.\u0275inj=O.cJS({})}return H})()},4403:(qt,At,ot)=>{ot.d(At,{FU:()=>D,Lc:()=>pt,MP:()=>Tt,N4:()=>rt,Nz:()=>lt,S6:()=>Y,SI:()=>O,_w:()=>yt,cT:()=>J,dZ:()=>Q,dt:()=>H,nE:()=>Ht,nQ:()=>st,tu:()=>w,u_:()=>j,v0:()=>U,vx:()=>ut});const O="Activities",w="Arrow Info",H="Integrations",Ht="Profile",rt="Sub-Parent Projects",st="Phases",D="Roles",j="Resources",ut="Activity Assigned Resources",pt="Activity Assinged Phases",yt="Resource Roles",lt="Tag Pool",Tt="Activity Tags",J="parentNodeId",U="nodeId",Q="Jira Assignee";let Y=(()=>{class dt{static#t=this.XLSX="xlsx";static#e=this.JSON="json";static#i=this.ELECTRON_SAVE="electron-save"}return dt})()},9127:(qt,At,ot)=>{ot.d(At,{I:()=>rt});var O=ot(9989),w=ot(9304),H=ot(9844),Ht=ot(9212);let rt=(()=>{class st{constructor(){this.nodeSerializer=new O.i}addActivity(j,ut="",pt=0,yt=H.MB,lt=null){let Tt=0;j.activities.length>0&&(Tt=Math.max(...j.activities.map(z=>z.profile.id)));const J=Tt+1;let U=-1;if(j.integrations.length>0&&(U=Math.max(...j.integrations.map(ge=>ge.id))),lt&&-1!==j.integrations.indexOf(lt))return this.addToExistingActivity(lt,J,U+1,j,ut,pt,yt);const Q=U+1,Y=Q+1,dt=Math.floor(Q/20),ft=Q%20,et=120+120*dt,Lt=20*(ft+1)+100,$t=this.nodeSerializer.new(Q,Q+"",0,50+120*dt,20*(ft+1)+100),mt=this.nodeSerializer.new(Y,Y+"",0,et,Lt);j.integrations.push($t),j.integrations.push(mt);const Gt=(new w.w).new(J,ut,Q,Y,0,pt);return Gt.subProject.subGraphId=-1,Gt.chartInfo.source=$t,Gt.chartInfo.target=mt,Gt.profile.sortOrder=J,j.activities.push(Gt),Gt}addToExistingActivity(j,ut,pt,yt,lt,Tt,J){const U=(j.x??0)+120,Q=j.y??0,Y=(new w.w).new(ut,lt,j.id,pt,0,Tt),dt=this.nodeSerializer.new(pt,pt+"",0,U,Q);yt.integrations.push(dt),Y.subProject.subGraphId=-1,Y.chartInfo.source=j,Y.chartInfo.target=dt,Y.profile.sortOrder=ut,yt.activities.push(Y);const ft=yt.activities.filter($t=>$t.chartInfo.source===j),Ot=ft.filter($t=>void 0===yt.activities.find(mt=>mt.chartInfo.source===$t.chartInfo.target)),ht=(ft.filter($t=>!Ot.includes($t)),j.x??0),et=j.y??0;let Lt=0;return Ot.forEach(($t,mt)=>{Lt=this.calculatePos($t,yt.activities,ht,et,Lt),Lt++}),Y}calculatePos(j,ut,pt,yt,lt){if(j.chartInfo.target){j.chartInfo.target.x=pt+120;const J=30*(lt%2==0?-1:1)*Math.ceil(lt/2);j.chartInfo.target.y=yt+J,ut.find(Q=>!!Q.chartInfo.target&&Q.profile.id!==j.profile.id&&Q.chartInfo.target.y===j.chartInfo.target?.y&&Q.chartInfo.target.x===j.chartInfo.target?.x)&&(lt=this.calculatePos(j,ut,pt,yt,lt+1))}return lt}static#t=this.\u0275fac=function(ut){return new(ut||st)};static#e=this.\u0275prov=Ht.Yz7({token:st,factory:st.\u0275fac,providedIn:"root"})}return st})()},7808:(qt,At,ot)=>{ot.d(At,{d:()=>w});var O=ot(9212);let w=(()=>{class H{constructor(){}getInEdges(rt,st){return st.activities.filter(D=>D.chartInfo.target_id===rt)}setStartEndNodesFromLongestPath(rt){if(0===rt.activities.length)return;if(1===rt.activities.length)return rt.profile.start=rt.activities[0].chartInfo.source?.id,void(rt.profile.end=rt.activities[0].chartInfo.target?.id);const D=rt.activities.filter(j=>null!=rt.activities.find(pt=>j.chartInfo.source_id===pt.chartInfo.target_id||j.chartInfo.target_id===pt.chartInfo.source_id)).filter(j=>0===this.getInEdges(j.chartInfo.source_id,rt).length);if(rt.profile.start=D[0].chartInfo.source?.id,void 0!==rt.profile.start){const j=this.calcLongestPath(rt,rt.profile.start,null);null!=j&&j.length>0&&(rt.profile.end=j[j.length-1].id)}return rt}getOutEdges(rt,st){return rt.activities.filter(D=>D.chartInfo.source_id===st)}calcLongestPath(rt,st,D){const j=rt.integrations.find(lt=>lt.id===st),ut=rt.integrations.find(lt=>lt.id===D),pt=[];return null==j?pt:this.walkTree(rt,j,pt,ut)}walkTree(rt,st,D,j){const ut=D.slice(0);if(void 0===st)return ut;ut.push(st);const pt=this.getOutEdges(rt,st.id);if(st===j||0===pt.length)return ut;let yt=ut;for(const lt of pt){const Tt=this.walkTree(rt,lt.chartInfo.target,ut,j);Tt.length>yt.length&&(yt=Tt)}return yt}static#t=this.\u0275fac=function(st){return new(st||H)};static#e=this.\u0275prov=O.Yz7({token:H,factory:H.\u0275fac,providedIn:"root"})}return H})()},1568:(qt,At,ot)=>{ot.d(At,{g:()=>zo});var O=ot(3920),w=Object.create,H=Object.defineProperty,Ht=Object.defineProperties,rt=Object.getOwnPropertyDescriptor,st=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,ut=Object.getPrototypeOf,pt=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable,lt=(t,e)=>{if(e=Symbol[t])return e;throw Error("Symbol."+t+" is not defined")},Tt=(t,e,o)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,J=(t,e)=>{for(var o in e||(e={}))pt.call(e,o)&&Tt(t,o,e[o]);if(j)for(var o of j(e))yt.call(e,o)&&Tt(t,o,e[o]);return t},U=(t,e)=>Ht(t,st(e)),Q=(t,e)=>{var o={};for(var i in t)pt.call(t,i)&&e.indexOf(i)<0&&(o[i]=t[i]);if(null!=t&&j)for(var i of j(t))e.indexOf(i)<0&&yt.call(t,i)&&(o[i]=t[i]);return o},Y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ft=(t,e,o)=>(o=null!=t?w(ut(t)):{},((t,e,o,i)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let r of D(e))!pt.call(t,r)&&undefined!==r&&H(t,r,{get:()=>e[r],enumerable:!(i=rt(e,r))||i.enumerable});return t})(!e&&t&&t.__esModule?o:H(o,"default",{value:t,enumerable:!0}),t)),Ot=(t,e,o)=>{if(!e.has(t))throw TypeError("Cannot "+o)},F=(t,e,o)=>(Ot(t,e,"read from private field"),o?o.call(t):e.get(t)),ht=(t,e,o)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,o)},et=(t,e,o,i)=>(Ot(t,e,"write to private field"),i?i.call(t,o):e.set(t,o),o),Lt=(t,e,o)=>(Ot(t,e,"access private method"),o),$t=function(t,e){this[0]=t,this[1]=e},mt=t=>{var i,e=t[lt("asyncIterator")],o=!1,r={};return null==e?(e=t[lt("iterator")](),i=n=>r[n]=a=>e[n](a)):(e=e.call(t),i=n=>r[n]=a=>{if(o){if(o=!1,"throw"===n)throw a;return a}return o=!0,{done:!1,value:new $t(new Promise(l=>{var d=e[n](a);if(!(d instanceof Object))throw TypeError("Object expected");l(d)}),1)}}),r[lt("iterator")]=()=>r,i("next"),"throw"in e?i("throw"):r.throw=n=>{throw n},"return"in e&&i("return"),r},Gt=Y((t,e)=>{function o(i,r,n,a){this.feasible=n,this.evaluation=r,this.bounded=a,this._tableau=i}e.exports=o,o.prototype.generateSolutionSet=function(){for(var i={},r=this._tableau,n=r.varIndexByRow,a=r.variablesPerIndex,l=r.matrix,d=r.rhsColumn,h=r.height-1,c=Math.round(1/r.precision),u=1;u<=h;u+=1){var g=a[n[u]];void 0!==g&&!0!==g.isSlack&&(i[g.id]=Math.round((Number.EPSILON+l[u][d])*c)/c)}return i}}),ge=Y((t,e)=>{var o=Gt();function i(r,n,a,l,d){o.call(this,r,n,a,l),this.iter=d}e.exports=i,i.prototype=Object.create(o.prototype),i.constructor=i}),z=Y((t,e)=>{var o=Gt(),i=ge();function r(a){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=a||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}function n(a,l){this.priority=a,this.reducedCosts=new Array(l);for(var d=0;d<l;d+=1)this.reducedCosts[d]=0}e.exports=r,r.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()},n.prototype.copy=function(){var a=new n(this.priority,this.reducedCosts.length);return a.reducedCosts=this.reducedCosts.slice(),a},r.prototype.setOptionalObjective=function(a,l,d){var h=this.objectivesByPriority[a];void 0===h&&(h=new n(a,Math.max(this.width,l+1)),this.objectivesByPriority[a]=h,this.optionalObjectives.push(h),this.optionalObjectives.sort(function(u,p){return u.priority-p.priority})),h.reducedCosts[l]=d},r.prototype.initialize=function(a,l,d,h){this.variables=d,this.unrestrictedVars=h,this.width=a,this.height=l;for(var c=new Array(a),u=0;u<a;u++)c[u]=0;this.matrix=new Array(l);for(var p=0;p<l;p++)this.matrix[p]=c.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=a+l-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars},r.prototype._resetMatrix=function(){var c,u,a=this.model.variables,l=this.model.constraints,d=a.length,h=l.length,p=this.matrix[0],g=!0===this.model.isMinimization?-1:1;for(c=0;c<d;c+=1){var b=a[c],y=b.priority,I=g*b.cost;0===y?p[c+1]=I:this.setOptionalObjective(y,c+1,I),this.rowByVarIndex[u=a[c].index]=-1,this.colByVarIndex[u]=c+1,this.varIndexByCol[c+1]=u}for(var _=1,m=0;m<h;m+=1){var x=l[m],S=x.index;this.rowByVarIndex[S]=_,this.colByVarIndex[S]=-1,this.varIndexByRow[_]=S;var L,k,A=x.terms,$=A.length,B=this.matrix[_++];if(x.isUpperBound){for(L=0;L<$;L+=1)B[this.colByVarIndex[(k=A[L]).variable.index]]=k.coefficient;B[0]=x.rhs}else{for(L=0;L<$;L+=1)B[this.colByVarIndex[(k=A[L]).variable.index]]=-k.coefficient;B[0]=-x.rhs}}},r.prototype.setModel=function(a){return this.model=a,this.initialize(a.nVariables+1,a.nConstraints+1,a.variables,a.unrestrictedVariables),this._resetMatrix(),this},r.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var a=this.lastElementIndex;return this.lastElementIndex+=1,a},r.prototype.density=function(){for(var a=0,l=this.matrix,d=0;d<this.height;d++)for(var h=l[d],c=0;c<this.width;c++)0!==h[c]&&(a+=1);return a/(this.height*this.width)},r.prototype.setEvaluation=function(){var a=Math.round(1/this.precision),d=Math.round((Number.EPSILON+this.matrix[this.costRowIndex][this.rhsColumn])*a)/a;this.evaluation=d,0===this.simplexIters&&(this.bestPossibleEval=d)},r.prototype.getSolution=function(){var a=!0===this.model.isMinimization?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new i(this,a,this.feasible,this.bounded,this.branchAndCutIterations):new o(this,a,this.feasible,this.bounded)}}),pi=Y(()=>{var t=z();t.prototype.simplex=function(){return this.bounded=!0,this.phase1(),!0===this.feasible&&this.phase2(),this},t.prototype.phase1=function(){for(var o=this.model.checkForCycles,i=[],r=this.matrix,n=this.rhsColumn,a=this.width-1,l=this.height-1,h=0;;){for(var c=0,u=-this.precision,p=1;p<=l;p++){var g=r[p][n];g<u&&(u=g,c=p)}if(0===c)return this.feasible=!0,h;for(var b=0,y=-1/0,I=r[0],_=r[c],m=1;m<=a;m++){var x=_[m];if(!0===this.unrestrictedVars[this.varIndexByCol[m]]||x<-this.precision){var S=-I[m]/x;y<S&&(y=S,b=m)}}if(0===b)return this.feasible=!1,h;if(o){i.push([this.varIndexByRow[c],this.varIndexByCol[b]]);var L=this.checkForCycles(i);if(L.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+L[0]),this.model.messages.push("Length :"+L[1]),this.feasible=!1,h}this.pivot(c,b),h+=1}},t.prototype.phase2=function(){for(var p,g,o=this.model.checkForCycles,i=[],r=this.matrix,n=this.rhsColumn,a=this.width-1,l=this.height-1,d=this.precision,h=this.optionalObjectives.length,c=null,u=0;;){var b=r[this.costRowIndex];h>0&&(c=[]);for(var y=0,I=d,_=!1,m=1;m<=a;m++)p=b[m],g=!0===this.unrestrictedVars[this.varIndexByCol[m]],h>0&&-d<p&&p<d?c.push(m):g&&p<0?-p>I&&(I=-p,y=m,_=!0):p>I&&(I=p,y=m,_=!1);if(h>0)for(var x=0;0===y&&c.length>0&&x<h;){var S=[],L=this.optionalObjectives[x].reducedCosts;I=d;for(var k=0;k<c.length;k++)g=!0===this.unrestrictedVars[this.varIndexByCol[m=c[k]]],-d<(p=L[m])&&p<d?S.push(m):g&&p<0?-p>I&&(I=-p,y=m,_=!0):p>I&&(I=p,y=m,_=!1);c=S,x+=1}if(0===y)return this.setEvaluation(),this.simplexIters+=1,u;for(var N=0,A=1/0,B=1;B<=l;B++){var R=r[B],W=R[n],Z=R[y];if(!(-d<Z&&Z<d)){if(Z>0&&d>W&&W>-d){A=0,N=B;break}var tt=_?-W/Z:W/Z;tt>d&&A>tt&&(A=tt,N=B)}}if(A===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[y],u;if(o){i.push([this.varIndexByRow[N],this.varIndexByCol[y]]);var ct=this.checkForCycles(i);if(ct.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+ct[0]),this.model.messages.push("Length :"+ct[1]),this.feasible=!1,u}this.pivot(N,y,!0),u+=1}};var e=[];t.prototype.pivot=function(o,i){var r=this.matrix,n=r[o][i],a=this.height-1,l=this.width-1,d=this.varIndexByRow[o],h=this.varIndexByCol[i];this.varIndexByRow[o]=h,this.varIndexByCol[i]=d,this.rowByVarIndex[h]=o,this.rowByVarIndex[d]=-1,this.colByVarIndex[h]=-1,this.colByVarIndex[d]=i;for(var c=r[o],u=0,p=0;p<=l;p++)c[p]>=-1e-16&&c[p]<=1e-16?c[p]=0:(c[p]/=n,e[u]=p,u+=1);c[i]=1/n;for(var g,b,y,_=0;_<=a;_++)if(_!==o&&!(r[_][i]>=-1e-16&&r[_][i]<=1e-16)){var m=r[_];if((g=m[i])>=-1e-16&&g<=1e-16)0!==g&&(m[i]=0);else{for(b=0;b<u;b++)(y=c[p=e[b]])>=-1e-16&&y<=1e-16?0!==y&&(c[p]=0):m[p]=m[p]-g*y;m[i]=-g/n}}var x=this.optionalObjectives.length;if(x>0)for(var S=0;S<x;S+=1){var L=this.optionalObjectives[S].reducedCosts;if(0!==(g=L[i])){for(b=0;b<u;b++)0!==(y=c[p=e[b]])&&(L[p]=L[p]-g*y);L[i]=-g/n}}},t.prototype.checkForCycles=function(o){for(var i=0;i<o.length-1;i++)for(var r=i+1;r<o.length;r++){var n=o[i],a=o[r];if(n[0]===a[0]&&n[1]===a[1]){if(r-i>o.length-r)break;for(var l=!0,d=1;d<r-i;d++){var h=o[i+d],c=o[r+d];if(h[0]!==c[0]||h[1]!==c[1]){l=!1;break}}if(l)return[i,r-i]}}return[]}}),s=Y((t,e)=>{function o(h,c,u,p){this.id=h,this.cost=c,this.index=u,this.value=0,this.priority=p}function i(h,c,u,p){o.call(this,h,c,u,p)}function r(h,c){o.call(this,h,0,c,0)}function n(h,c){this.variable=h,this.coefficient=c}function a(h,c,u){return 0===u||"required"===u?null:(c=c||1,u=u||1,!1===h.isMinimization&&(c=-c),h.addVariable(c,"r"+h.relaxationIndex++,!1,!1,u))}function l(h,c,u,p){this.slack=new r("s"+u,u),this.index=u,this.model=p,this.rhs=h,this.isUpperBound=c,this.terms=[],this.termsByVarIndex={},this.relaxation=null}function d(h,c){this.upperBound=h,this.lowerBound=c,this.model=h.model,this.rhs=h.rhs,this.relaxation=null}i.prototype.isInteger=!0,r.prototype.isSlack=!0,l.prototype.addTerm=function(h,c){var u=c.index,p=this.termsByVarIndex[u];return void 0===p?(p=new n(c,h),this.termsByVarIndex[u]=p,this.terms.push(p),!0===this.isUpperBound&&(h=-h),this.model.updateConstraintCoefficient(this,c,h)):this.setVariableCoefficient(p.coefficient+h,c),this},l.prototype.removeTerm=function(h){return this},l.prototype.setRightHandSide=function(h){if(h!==this.rhs){var c=h-this.rhs;!0===this.isUpperBound&&(c=-c),this.rhs=h,this.model.updateRightHandSide(this,c)}return this},l.prototype.setVariableCoefficient=function(h,c){var u=c.index;if(-1!==u){var p=this.termsByVarIndex[u];if(void 0===p)this.addTerm(h,c);else if(h!==p.coefficient){var g=h-p.coefficient;!0===this.isUpperBound&&(g=-g),p.coefficient=h,this.model.updateConstraintCoefficient(this,c,g)}return this}console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.")},l.prototype.relax=function(h,c){this.relaxation=a(this.model,h,c),this._relax(this.relaxation)},l.prototype._relax=function(h){null!==h&&this.setVariableCoefficient(this.isUpperBound?-1:1,h)},d.prototype.isEquality=!0,d.prototype.addTerm=function(h,c){return this.upperBound.addTerm(h,c),this.lowerBound.addTerm(h,c),this},d.prototype.removeTerm=function(h){return this.upperBound.removeTerm(h),this.lowerBound.removeTerm(h),this},d.prototype.setRightHandSide=function(h){this.upperBound.setRightHandSide(h),this.lowerBound.setRightHandSide(h),this.rhs=h},d.prototype.relax=function(h,c){this.relaxation=a(this.model,h,c),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)},e.exports={Constraint:l,Variable:o,IntegerVariable:i,SlackVariable:r,Equality:d,Term:n}}),f=Y(()=>{var t=z(),e=s().SlackVariable;t.prototype.addCutConstraints=function(o){for(var i=o.length,r=this.height,n=r+i,a=r;a<n;a+=1)void 0===this.matrix[a]&&(this.matrix[a]=this.matrix[a-1].slice());this.height=n,this.nVars=this.width+this.height-2;for(var l,d=this.width-1,h=0;h<i;h+=1){var c=o[h],u=r+h,p="min"===c.type?-1:1,g=c.varIndex,b=this.rowByVarIndex[g],y=this.matrix[u];if(-1===b){for(y[this.rhsColumn]=p*c.value,l=1;l<=d;l+=1)y[l]=0;y[this.colByVarIndex[g]]=p}else{var I=this.matrix[b];for(y[this.rhsColumn]=p*(c.value-I[this.rhsColumn]),l=1;l<=d;l+=1)y[l]=-p*I[l]}var m=this.getNewElementIndex();this.varIndexByRow[u]=m,this.rowByVarIndex[m]=u,this.colByVarIndex[m]=-1,this.variablesPerIndex[m]=new e("s"+m,m),this.nVars+=1}},t.prototype._addLowerBoundMIRCut=function(o){if(o===this.costRowIndex)return!1;var r=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[o]].isInteger)return!1;var a=r[o][this.rhsColumn],l=a-Math.floor(a);if(l<this.precision||1-this.precision<l)return!1;var d=this.height;r[d]=r[d-1].slice(),this.height+=1,this.nVars+=1;var h=this.getNewElementIndex();this.varIndexByRow[d]=h,this.rowByVarIndex[h]=d,this.colByVarIndex[h]=-1,this.variablesPerIndex[h]=new e("s"+h,h),r[d][this.rhsColumn]=Math.floor(a);for(var c=1;c<this.varIndexByCol.length;c+=1)if(this.variablesPerIndex[this.varIndexByCol[c]].isInteger){var p=r[o][c],g=Math.floor(p)+Math.max(0,p-Math.floor(p)-l)/(1-l);r[d][c]=g}else r[d][c]=Math.min(0,r[o][c]/(1-l));for(var b=0;b<this.width;b+=1)r[d][b]-=r[o][b];return!0},t.prototype._addUpperBoundMIRCut=function(o){if(o===this.costRowIndex)return!1;var r=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[o]].isInteger)return!1;var a=r[o][this.rhsColumn],l=a-Math.floor(a);if(l<this.precision||1-this.precision<l)return!1;var d=this.height;r[d]=r[d-1].slice(),this.height+=1,this.nVars+=1;var h=this.getNewElementIndex();this.varIndexByRow[d]=h,this.rowByVarIndex[h]=d,this.colByVarIndex[h]=-1,this.variablesPerIndex[h]=new e("s"+h,h),r[d][this.rhsColumn]=-l;for(var c=1;c<this.varIndexByCol.length;c+=1){var u=this.variablesPerIndex[this.varIndexByCol[c]],p=r[o][c],g=p-Math.floor(p);r[d][c]=u.isInteger?g<=l?-g:-(1-g)*l/g:p>=0?-p:p*l/(1-l)}return!0},t.prototype.applyMIRCuts=function(){}}),v=Y(()=>{var t=z();t.prototype._putInBase=function(e){var o=this.rowByVarIndex[e];if(-1===o){for(var i=this.colByVarIndex[e],r=1;r<this.height;r+=1){var n=this.matrix[r][i];if(n<-this.precision||this.precision<n){o=r;break}}this.pivot(o,i)}return o},t.prototype._takeOutOfBase=function(e){var o=this.colByVarIndex[e];if(-1===o){for(var i=this.rowByVarIndex[e],r=this.matrix[i],n=1;n<this.height;n+=1){var a=r[n];if(a<-this.precision||this.precision<a){o=n;break}}this.pivot(i,o)}return o},t.prototype.updateVariableValues=function(){for(var e=this.variables.length,o=Math.round(1/this.precision),i=0;i<e;i+=1){var r=this.variables[i],a=this.rowByVarIndex[r.index];r.value=-1===a?0:Math.round((this.matrix[a][this.rhsColumn]+Number.EPSILON)*o)/o}},t.prototype.updateRightHandSide=function(e,o){var i=this.height-1,r=this.rowByVarIndex[e.index];if(-1===r){for(var n=this.colByVarIndex[e.index],a=0;a<=i;a+=1){var l=this.matrix[a];l[this.rhsColumn]-=o*l[n]}var d=this.optionalObjectives.length;if(d>0)for(var h=0;h<d;h+=1){var c=this.optionalObjectives[h].reducedCosts;c[this.rhsColumn]-=o*c[n]}}else this.matrix[r][this.rhsColumn]-=o},t.prototype.updateConstraintCoefficient=function(e,o,i){if(e.index===o.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var r=this._putInBase(e.index),n=this.colByVarIndex[o.index];if(-1===n)for(var a=this.rowByVarIndex[o.index],l=0;l<this.width;l+=1)this.matrix[r][l]+=i*this.matrix[a][l];else this.matrix[r][n]-=i},t.prototype.updateCost=function(e,o){var i=e.index,r=this.width-1,n=this.colByVarIndex[i];if(-1===n){var l,a=this.matrix[this.rowByVarIndex[i]];if(0===e.priority){var d=this.matrix[0];for(l=0;l<=r;l+=1)d[l]+=o*a[l]}else{var h=this.objectivesByPriority[e.priority].reducedCosts;for(l=0;l<=r;l+=1)h[l]+=o*a[l]}}else this.matrix[0][n]-=o},t.prototype.addConstraint=function(e){var o=e.isUpperBound?1:-1,i=this.height,r=this.matrix[i];void 0===r&&(r=this.matrix[0].slice(),this.matrix[i]=r);for(var n=this.width-1,a=0;a<=n;a+=1)r[a]=0;r[this.rhsColumn]=o*e.rhs;for(var l=e.terms,d=l.length,h=0;h<d;h+=1){var c=l[h],u=c.coefficient,p=c.variable.index,g=this.rowByVarIndex[p];if(-1===g)r[this.colByVarIndex[p]]+=o*u;else{var b=this.matrix[g];for(a=0;a<=n;a+=1)r[a]-=o*u*b[a]}}var I=e.index;this.varIndexByRow[i]=I,this.rowByVarIndex[I]=i,this.colByVarIndex[I]=-1,this.height+=1},t.prototype.removeConstraint=function(e){var o=e.index,i=this.height-1,r=this._putInBase(o),n=this.matrix[i];this.matrix[i]=this.matrix[r],this.matrix[r]=n,this.varIndexByRow[r]=this.varIndexByRow[i],this.varIndexByRow[i]=-1,this.rowByVarIndex[o]=-1,this.availableIndexes[this.availableIndexes.length]=o,e.slack.index=-1,this.height-=1},t.prototype.addVariable=function(e){var o=this.height-1,i=this.width,r=!0===this.model.isMinimization?-e.cost:e.cost,n=e.priority,a=this.optionalObjectives.length;if(a>0)for(var l=0;l<a;l+=1)this.optionalObjectives[l].reducedCosts[i]=0;0===n?this.matrix[0][i]=r:(this.setOptionalObjective(n,i,r),this.matrix[0][i]=0);for(var d=1;d<=o;d+=1)this.matrix[d][i]=0;var h=e.index;this.varIndexByCol[i]=h,this.rowByVarIndex[h]=-1,this.colByVarIndex[h]=i,this.width+=1},t.prototype.removeVariable=function(e){var o=e.index,i=this._takeOutOfBase(o),r=this.width-1;if(i!==r){for(var n=this.height-1,a=0;a<=n;a+=1){var l=this.matrix[a];l[i]=l[r]}var d=this.optionalObjectives.length;if(d>0)for(var h=0;h<d;h+=1){var c=this.optionalObjectives[h].reducedCosts;c[i]=c[r]}var u=this.varIndexByCol[r];this.varIndexByCol[i]=u,this.colByVarIndex[u]=i}this.varIndexByCol[r]=-1,this.colByVarIndex[o]=-1,this.availableIndexes[this.availableIndexes.length]=o,e.index=-1,this.width-=1}}),M=Y(()=>{z().prototype.log=function(e,o){console.log("****",e,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var a,l,h,c,u,p,g,y,I,_,m,r="",n=[" "];for(l=1;l<this.width;l+=1)g=(p=void 0===(c=this.variablesPerIndex[u=this.varIndexByCol[l]])?"c"+u:c.id).length,Math.abs(g-5),y=" ",I="\t",g>5?y+=" ":I+="\t",n[l]=y,r+=I+p;console.log(r);var S=this.matrix[this.costRowIndex],L="\t";for(a=1;a<this.width;a+=1)L+="\t",L+=n[a],L+=S[a].toFixed(5);for(L+="\t"+n[0]+S[0].toFixed(5),console.log(L+"\tZ"),h=1;h<this.height;h+=1){for(_=this.matrix[h],m="\t",l=1;l<this.width;l+=1)m+="\t"+n[l]+_[l].toFixed(5);m+="\t"+n[0]+_[0].toFixed(5),p=void 0===(c=this.variablesPerIndex[u=this.varIndexByRow[h]])?"c"+u:c.id,console.log(m+"\t"+p)}console.log("");var k=this.optionalObjectives.length;if(k>0){console.log("    Optional objectives:");for(var N=0;N<k;N+=1){var A=this.optionalObjectives[N].reducedCosts,$="";for(a=1;a<this.width;a+=1)$+=A[a]<0?"":" ",$+=n[a],$+=A[a].toFixed(5);$+=(A[0]<0?"":" ")+n[0]+A[0].toFixed(5),console.log($+" z"+N)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this}}),E=Y(()=>{var t=z();t.prototype.copy=function(){var e=new t(this.precision);e.width=this.width,e.height=this.height,e.nVars=this.nVars,e.model=this.model,e.variables=this.variables,e.variablesPerIndex=this.variablesPerIndex,e.unrestrictedVars=this.unrestrictedVars,e.lastElementIndex=this.lastElementIndex,e.varIndexByRow=this.varIndexByRow.slice(),e.varIndexByCol=this.varIndexByCol.slice(),e.rowByVarIndex=this.rowByVarIndex.slice(),e.colByVarIndex=this.colByVarIndex.slice(),e.availableIndexes=this.availableIndexes.slice();for(var o=[],i=0;i<this.optionalObjectives.length;i++)o[i]=this.optionalObjectives[i].copy();e.optionalObjectives=o;for(var r=this.matrix,n=new Array(this.height),a=0;a<this.height;a++)n[a]=r[a].slice();return e.matrix=n,e},t.prototype.save=function(){this.savedState=this.copy()},t.prototype.restore=function(){if(null!==this.savedState){var i,r,e=this.savedState,o=e.matrix;for(this.nVars=e.nVars,this.model=e.model,this.variables=e.variables,this.variablesPerIndex=e.variablesPerIndex,this.unrestrictedVars=e.unrestrictedVars,this.lastElementIndex=e.lastElementIndex,this.width=e.width,this.height=e.height,i=0;i<this.height;i+=1){var n=o[i],a=this.matrix[i];for(r=0;r<this.width;r+=1)a[r]=n[r]}var l=e.varIndexByRow;for(r=0;r<this.height;r+=1)this.varIndexByRow[r]=l[r];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var d=e.varIndexByCol;for(i=0;i<this.width;i+=1)this.varIndexByCol[i]=d[i];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var h=e.rowByVarIndex,c=e.colByVarIndex,u=0;u<this.nVars;u+=1)this.rowByVarIndex[u]=h[u],this.colByVarIndex[u]=c[u];if(e.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var p=0;p<e.optionalObjectives.length;p++){var g=e.optionalObjectives[p].copy();this.optionalObjectives[p]=g,this.optionalObjectivePerPriority[g.priority]=g}}}}}),P=Y(()=>{var t=z();function e(o,i){this.index=o,this.value=i}t.prototype.getMostFractionalVar=function(){for(var o=0,i=null,r=null,a=this.model.integerVariables,l=a.length,d=0;d<l;d++){var h=a[d].index,c=this.rowByVarIndex[h];if(-1!==c){var u=this.matrix[c][this.rhsColumn],p=Math.abs(u-Math.round(u));o<p&&(o=p,i=h,r=u)}}return new e(i,r)},t.prototype.getFractionalVarWithLowestCost=function(){for(var o=1/0,i=null,r=null,n=this.model.integerVariables,a=n.length,l=0;l<a;l++){var d=n[l],h=d.index,c=this.rowByVarIndex[h];if(-1!==c){var u=this.matrix[c][this.rhsColumn];if(Math.abs(u-Math.round(u))>this.precision){var p=d.cost;o>p&&(o=p,i=h,r=u)}}}return new e(i,r)}}),V=Y(()=>{var t=z();t.prototype.countIntegerValues=function(){for(var e=0,o=1;o<this.height;o+=1)if(this.variablesPerIndex[this.varIndexByRow[o]].isInteger){var i=this.matrix[o][this.rhsColumn];(i-=Math.floor(i))<this.precision&&-i<this.precision&&(e+=1)}return e},t.prototype.isIntegral=function(){for(var e=this.model.integerVariables,o=e.length,i=0;i<o;i++){var r=this.rowByVarIndex[e[i].index];if(-1!==r){var n=this.matrix[r][this.rhsColumn];if(Math.abs(n-Math.round(n))>this.precision)return!1}}return!0},t.prototype.computeFractionalVolume=function(e){for(var o=-1,i=1;i<this.height;i+=1)if(this.variablesPerIndex[this.varIndexByRow[i]].isInteger){var r=this.matrix[i][this.rhsColumn];if(r=Math.abs(r),Math.min(r-Math.floor(r),Math.floor(r+1))<this.precision){if(!e)return 0}else-1===o?o=r:o*=r}return-1===o?0:o}}),K=Y((t,e)=>{pi(),f(),v(),M(),E(),P(),V(),e.exports=z()}),q=Y(()=>{var t=z();function e(r,n,a){this.type=r,this.varIndex=n,this.value=a}function o(r,n){this.relaxedEvaluation=r,this.cuts=n}function i(r,n){return n.relaxedEvaluation-r.relaxedEvaluation}t.prototype.applyCuts=function(r){if(this.restore(),this.addCutConstraints(r),this.simplex(),this.model.useMIRCuts)for(var n=!0;n;){var a=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex(),this.computeFractionalVolume(!0)>=.9*a&&(n=!1)}},t.prototype.branchAndCut=function(){var r=[],n=0,a=this.model.tolerance,l=!0,d=1e99;this.model.timeout&&(d=Date.now()+this.model.timeout);for(var h=1/0,c=null,u=[],p=0;p<this.optionalObjectives.length;p+=1)u.push(1/0);var g=new o(-1/0,[]);for(r.push(g);r.length>0&&!0===l&&Date.now()<d;)if(a>0&&h<(this.model.isMinimization?this.bestPossibleEval*(1+a):this.bestPossibleEval*(1-a))&&(l=!1),!((g=r.pop()).relaxedEvaluation>h)){var y=g.cuts;if(this.applyCuts(y),n++,!1!==this.feasible){var I=this.evaluation;if(!(I>h)){if(I===h){for(var _=!0,m=0;m<this.optionalObjectives.length&&!(this.optionalObjectives[m].reducedCosts[0]>u[m]);m+=1)if(this.optionalObjectives[m].reducedCosts[0]<u[m]){_=!1;break}if(_)continue}if(!0===this.isIntegral()){if(this.__isIntegral=!0,1===n)return void(this.branchAndCutIterations=n);c=g,h=I;for(var x=0;x<this.optionalObjectives.length;x+=1)u[x]=this.optionalObjectives[x].reducedCosts[0]}else{1===n&&this.save();for(var S=this.getMostFractionalVar(),L=S.index,k=[],N=[],A=y.length,$=0;$<A;$+=1){var B=y[$];B.varIndex===L?"min"===B.type?N.push(B):k.push(B):(k.push(B),N.push(B))}var R=Math.ceil(S.value),W=Math.floor(S.value),Z=new e("min",L,R);k.push(Z);var tt=new e("max",L,W);N.push(tt),r.push(new o(I,k)),r.push(new o(I,N)),r.sort(i)}}}}null!==c&&this.applyCuts(c.cuts),this.branchAndCutIterations=n}}),T=Y((t,e)=>{var o=z(),r=(q(),s()),n=r.Constraint,a=r.Equality,l=r.Variable,d=r.IntegerVariable;function c(u,p){this.tableau=new o(u),this.name=p,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}e.exports=c,c.prototype.minimize=function(){return this.isMinimization=!0,this},c.prototype.maximize=function(){return this.isMinimization=!1,this},c.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var u=this.lastElementIndex;return this.lastElementIndex+=1,u},c.prototype._addConstraint=function(u){var p=u.slack;this.tableau.variablesPerIndex[p.index]=p,this.constraints.push(u),this.nConstraints+=1,!0===this.tableauInitialized&&this.tableau.addConstraint(u)},c.prototype.smallerThan=function(u){var p=new n(u,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(p),p},c.prototype.greaterThan=function(u){var p=new n(u,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(p),p},c.prototype.equal=function(u){var p=new n(u,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(p);var g=new n(u,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(g),new a(p,g)},c.prototype.addVariable=function(u,p,g,b,y){if("string"==typeof y)switch(y){case"required":default:y=0;break;case"strong":y=1;break;case"medium":y=2;break;case"weak":y=3}var _,I=this.tableau.getNewElementIndex();return null==p&&(p="v"+I),null==u&&(u=0),null==y&&(y=0),g?(_=new d(p,u,I,y),this.integerVariables.push(_)):_=new l(p,u,I,y),this.variables.push(_),this.tableau.variablesPerIndex[I]=_,b&&(this.unrestrictedVariables[I]=!0),this.nVariables+=1,!0===this.tableauInitialized&&this.tableau.addVariable(_),_},c.prototype._removeConstraint=function(u){var p=this.constraints.indexOf(u);-1!==p?(this.constraints.splice(p,1),this.nConstraints-=1,!0===this.tableauInitialized&&this.tableau.removeConstraint(u),u.relaxation&&this.removeVariable(u.relaxation)):console.warn("[Model.removeConstraint] Constraint not present in model")},c.prototype.removeConstraint=function(u){return u.isEquality?(this._removeConstraint(u.upperBound),this._removeConstraint(u.lowerBound)):this._removeConstraint(u),this},c.prototype.removeVariable=function(u){var p=this.variables.indexOf(u);if(-1!==p)return this.variables.splice(p,1),!0===this.tableauInitialized&&this.tableau.removeVariable(u),this;console.warn("[Model.removeVariable] Variable not present in model")},c.prototype.updateRightHandSide=function(u,p){return!0===this.tableauInitialized&&this.tableau.updateRightHandSide(u,p),this},c.prototype.updateConstraintCoefficient=function(u,p,g){return!0===this.tableauInitialized&&this.tableau.updateConstraintCoefficient(u,p,g),this},c.prototype.setCost=function(u,p){var g=u-p.cost;return!1===this.isMinimization&&(g=-g),p.cost=u,this.tableau.updateCost(p,g),this},c.prototype.loadJson=function(u){this.isMinimization="max"!==u.opType;for(var p=u.variables,g=u.constraints,b={},y={},I=Object.keys(g),_=I.length,m=0;m<_;m+=1){var $,B,x=I[m],S=g[x],L=S.equal,k=S.weight,N=S.priority,A=void 0!==k||void 0!==N;if(void 0===L){var R=S.min;void 0!==R&&($=this.greaterThan(R),b[x]=$,A&&$.relax(k,N));var W=S.max;void 0!==W&&(B=this.smallerThan(W),y[x]=B,A&&B.relax(k,N))}else{$=this.greaterThan(L),b[x]=$,B=this.smallerThan(L),y[x]=B;var Z=new a($,B);A&&Z.relax(k,N)}}var tt=Object.keys(p),ct=tt.length;this.tolerance=u.tolerance||0,u.timeout&&(this.timeout=u.timeout),u.options&&(u.options.timeout&&(this.timeout=u.options.timeout),0===this.tolerance&&(this.tolerance=u.options.tolerance||0),u.options.useMIRCuts&&(this.useMIRCuts=u.options.useMIRCuts),this.checkForCycles=typeof u.options.exitOnCycles>"u"||u.options.exitOnCycles);for(var it=u.ints||{},at=u.binaries||{},gt=u.unrestricted||{},Mt=u.optimize,Dt=0;Dt<ct;Dt+=1){var It=tt[Dt],Pt=p[It],$e=!!at[It],Ct=this.addVariable(Pt[Mt]||0,It,!!it[It]||$e,!!gt[It]);$e&&this.smallerThan(1).addTerm(1,Ct);var pe=Object.keys(Pt);for(m=0;m<pe.length;m+=1){var Ft=pe[m];if(Ft!==Mt){var Ie=Pt[Ft],Je=b[Ft];void 0!==Je&&Je.addTerm(Ie,Ct);var Xe=y[Ft];void 0!==Xe&&Xe.addTerm(Ie,Ct)}}}return this},c.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length},c.prototype.solve=function(){return!1===this.tableauInitialized&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()},c.prototype.isFeasible=function(){return this.tableau.feasible},c.prototype.save=function(){return this.tableau.save()},c.prototype.restore=function(){return this.tableau.restore()},c.prototype.activateMIRCuts=function(u){this.useMIRCuts=u},c.prototype.debug=function(u){this.checkForCycles=u},c.prototype.log=function(u){return this.tableau.log(u)}}),nt=Y(t=>{t.CleanObjectiveAttributes=function(e){var o,i,r;if("string"==typeof e.optimize){if(e.constraints[e.optimize]){for(i in o=Math.random(),e.variables)e.variables[i][e.optimize]&&(e.variables[i][o]=e.variables[i][e.optimize]);return e.constraints[o]=e.constraints[e.optimize],delete e.constraints[e.optimize],e}return e}for(r in e.optimize)if(e.constraints[r])if("equal"===e.constraints[r])delete e.optimize[r];else{for(i in o=Math.random(),e.variables)e.variables[i][r]&&(e.variables[i][o]=e.variables[i][r]);e.constraints[o]=e.constraints[r],delete e.constraints[r]}return e}}),vt=Y((t,e)=>{e.exports=function(r){return r.length?function o(r){var n={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},a={opType:"",optimize:"_obj",constraints:{},variables:{}},l={">=":"min","<=":"max","=":"equal"},d="",c=null,u="",p="",g="",b=0;"string"==typeof r&&(r=r.split("\n"));for(var y=0;y<r.length;y++)if(g="__"+y,c=null,n.is_objective.test(d=r[y]))a.opType=d.match(/(max|min)/gi)[0],(c=d.match(n.parse_lhs).map(function(m){return m.replace(/\s+/,"")}).slice(1)).forEach(function(m){u=null===(u=m.match(n.get_num))?"-"===m.substr(0,1)?-1:1:u[0],u=parseFloat(u),p=m.match(n.get_word)[0].replace(/\;$/,""),a.variables[p]=a.variables[p]||{},a.variables[p]._obj=u});else if(n.is_int.test(d))c=d.match(n.parse_int).slice(1),a.ints=a.ints||{},c.forEach(function(m){m=m.replace(";",""),a.ints[m]=1});else if(n.is_bin.test(d))c=d.match(n.parse_bin).slice(1),a.binaries=a.binaries||{},c.forEach(function(m){m=m.replace(";",""),a.binaries[m]=1});else if(n.is_constraint.test(d)){var I=d.indexOf(":");(c=(-1===I?d:d.slice(I+1)).match(n.parse_lhs).map(function(m){return m.replace(/\s+/,"")})).forEach(function(m){u=null===(u=m.match(n.get_num))?"-"===m.substr(0,1)?-1:1:u[0],u=parseFloat(u),p=m.match(n.get_word)[0],a.variables[p]=a.variables[p]||{},a.variables[p][g]=u}),b=parseFloat(d.match(n.parse_rhs)[0]),d=l[d.match(n.parse_dir)[0]],a.constraints[g]=a.constraints[g]||{},a.constraints[g][d]=b}else n.is_unrestricted.test(d)&&(c=d.match(n.parse_int).slice(1),a.unrestricted=a.unrestricted||{},c.forEach(function(m){m=m.replace(";",""),a.unrestricted[m]=1}));return a}(r):function i(r){if(!r)throw new Error("Solver requires a model to operate on");var n="",d={max:"<=",min:">=",equal:"="},h=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(r.opType)for(var c in n+=r.opType+":",r.variables)r.variables[c][c]=r.variables[c][c]?r.variables[c][c]:1,r.variables[c][r.optimize]&&(n+=" "+r.variables[c][r.optimize]+" "+c.replace(h,"_"));else n+="max:";for(var u in n+=";\n\n",r.constraints)for(var p in r.constraints[u])if(typeof d[p]<"u"){for(var g in r.variables)typeof r.variables[g][u]<"u"&&(n+=" "+r.variables[g][u]+" "+g.replace(h,"_"));n+=" "+d[p]+" "+r.constraints[u][p],n+=";\n"}if(r.ints)for(var b in n+="\n\n",r.ints)n+="int "+b.replace(h,"_")+";\n";if(r.unrestricted)for(var y in n+="\n\n",r.unrestricted)n+="unrestricted "+y.replace(h,"_")+";\n";return n}(r)}}),wt=Y(()=>{}),bt=Y(()=>{}),_t=Y(t=>{function e(o){return(o=(o=o.replace("\\r\\n","\r\n")).split("\r\n")).filter(function(i){var r;return!(!0===(r=new RegExp(" 0$","gi")).test(i)||(r=new RegExp("\\d$","gi"),!1===r.test(i)))}).map(function(i){return i.split(/\:{0,1} +(?=\d)/)}).reduce(function(i,r,n){return i[r[0]]=r[1],i},{})}t.reformat=vt(),t.solve=function(o){return new Promise(function(i,r){typeof window<"u"&&r("Function Not Available in Browser");var n=vt()(o);o.external||r("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),o.external.binPath||r("No Executable | Binary path provided in arguments as 'binPath'"),o.external.args||r("No arguments array for cli | bash provided on 'args' attribute"),o.external.tempName||r("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on"),wt().writeFile(o.external.tempName,n,function(l,d){if(l)r(l);else{var h=bt().execFile;o.external.args.push(o.external.tempName),h(o.external.binPath,o.external.args,function(c,u){c?1===c.code?i(e(u)):r({code:c.code,meaning:{"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"}[c.code],data:u}):i(e(u))})}})})}}),Qt=Y((t,e)=>{e.exports={lpsolve:_t()}}),se=Y((t,e)=>{e.exports=function(o,i){var l,g,b,y,I,r=i.optimize,n=JSON.parse(JSON.stringify(i.optimize)),a=Object.keys(i.optimize),d=0,h={},c="",u={},p=[];for(delete i.optimize,g=0;g<a.length;g++)n[a[g]]=0;for(g=0;g<a.length;g++){for(I in i.optimize=a[g],i.opType=r[a[g]],l=o.Solve(i,void 0,void 0,!0),a)if(!i.variables[a[I]])for(y in l[a[I]]=l[a[I]]?l[a[I]]:0,i.variables)i.variables[y][a[I]]&&l[y]&&(l[a[I]]+=l[y]*i.variables[y][a[I]]);for(c="base",b=0;b<a.length;b++)c+=l[a[b]]?"-"+(1e3*l[a[b]]|0)/1e3:"-0";if(!h[c]){for(h[c]=1,d++,b=0;b<a.length;b++)l[a[b]]&&(n[a[b]]+=l[a[b]]);delete l.feasible,delete l.result,p.push(l)}}for(g=0;g<a.length;g++)i.constraints[a[g]]={equal:n[a[g]]/d};for(g in i.optimize="cheater-"+Math.random(),i.opType="max",i.variables)i.variables[g].cheater=1;for(g in p)for(y in p[g])u[y]=u[y]||{min:1e99,max:-1e99};for(g in u)for(y in p)p[y][g]?(p[y][g]>u[g].max&&(u[g].max=p[y][g]),p[y][g]<u[g].min&&(u[g].min=p[y][g])):(p[y][g]=0,u[g].min=0);return{midpoint:l=o.Solve(i,void 0,void 0,!0),vertices:p,ranges:u}}}),ve=Y((t,e)=>{var o=K(),i=T(),r=q(),n=s(),a=nt(),l=n.Constraint,d=n.Variable,h=n.Numeral,c=n.Term,u=Qt(),p=function(){this.Model=i,this.branchAndCut=r,this.Constraint=l,this.Variable=d,this.Numeral=h,this.Term=c,this.Tableau=o,this.lastSolvedModel=null,this.External=u,this.Solve=function(g,b,y,I){if(I)for(var _ in a)g=a[_](g);if(!g)throw new Error("Solver requires a model to operate on");if("object"==typeof g.optimize&&Object.keys(g.optimize>1))return se()(this,g);if(g.external){var m=Object.keys(u);if(m=JSON.stringify(m),!g.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+m);if(!u[g.external.solver])throw new Error("No support (yet) for "+g.external.solver+". Please use one of these instead:"+m);return u[g.external.solver].solve(g)}g instanceof i||(g=new i(b).loadJson(g));var x=g.solve();if(this.lastSolvedModel=g,x.solutionSet=x.generateSolutionSet(),y)return x;var S={};return S.feasible=x.feasible,S.result=x.evaluation,S.bounded=x.bounded,x._tableau.__isIntegral&&(S.isIntegral=!0),Object.keys(x.solutionSet).forEach(function(L){0!==x.solutionSet[L]&&(S[L]=x.solutionSet[L])}),S},this.ReformatLP=vt(),this.MultiObjective=function(g){return se()(this,g)}};"function"==typeof define?define([],function(){return new p}):"object"==typeof window?window.solver=new p:"object"==typeof self&&(self.solver=new p),e.exports=new p}),_e=Y((t,e)=>{var i,r,o=1e-60;do{i=1+.1*(o+=o),r=1+.2*o}while(i<=1||r<=1);e.exports=o}),Kt=Y((t,e)=>{e.exports=function o(i,r,n){let a,l;for(let d=1;d<=n;d+=1){i[d][d]=1/i[d][d],l=-i[d][d];for(let h=1;h<d;h+=1)i[h][d]*=l;if(a=d+1,n<a)break;for(let h=a;h<=n;h+=1){l=i[d][h],i[d][h]=0;for(let c=1;c<=d;c+=1)i[c][h]+=l*i[c][d]}}}}),ir=Y((t,e)=>{e.exports=function o(i,r,n,a){let l,d;for(l=1;l<=n;l+=1){d=0;for(let h=1;h<l;h+=1)d+=i[h][l]*a[h];a[l]=(a[l]-d)/i[l][l]}for(let h=1;h<=n;h+=1){l=n+1-h,a[l]/=i[l][l],d=-a[l];for(let c=1;c<l;c+=1)a[c]+=d*i[c][l]}}}),rr=Y((t,e)=>{e.exports=function o(i,r,n,a){let l,d,h;for(let c=1;c<=n;c+=1){if(a[1]=c,h=0,l=c-1,l<1){if(h=i[c][c]-h,h<=0)break;i[c][c]=Math.sqrt(h)}else{for(let u=1;u<=l;u+=1){d=i[u][c];for(let p=1;p<u;p+=1)d-=i[p][c]*i[p][u];d/=i[u][u],i[u][c]=d,h+=d*d}if(h=i[c][c]-h,h<=0)break;i[c][c]=Math.sqrt(h)}a[1]=0}}}),or=Y((t,e)=>{var o=_e(),i=Kt(),r=ir(),n=rr();e.exports=function a(l,d,h,c,u,p,g,b,y,I,_,m,x,S=0,L,k,N){let A,$,B,R,W,Z,tt,ct,it,at,gt,Mt,Dt,It,Pt=Math.min(c,_),St=2*c+Pt*(Pt+5)/2+2*_+1;for(let C=1;C<=c;C+=1)k[C]=d[C];for(let C=c+1;C<=St;C+=1)k[C]=0;for(let C=1;C<=_;C+=1)x[C]=0,p[C]=0;let $e=[];if(0===N[1]){if(n(l,h,c,$e),0!==$e[1])return void(N[1]=2);r(l,h,c,d),i(l,h,c)}else{for(let C=1;C<=c;C+=1){u[C]=0;for(let X=1;X<=C;X+=1)u[C]+=l[X][C]*d[X]}for(let C=1;C<=c;C+=1){d[C]=0;for(let X=C;X<=c;X+=1)d[C]+=l[C][X]*u[X]}}g[1]=0;for(let C=1;C<=c;C+=1){u[C]=d[C],g[1]+=k[C]*u[C],k[C]=0;for(let X=C+1;X<=c;X+=1)l[X][C]=0}g[1]=-g[1]/2,N[1]=0;let ne=c,Zt=ne+c,Ct=Zt+Pt,pe=Ct+Pt+1,Ft=pe+Pt*(Pt+1)/2,Ie=Ft+_;for(let C=1;C<=_;C+=1){Z=0;for(let X=1;X<=c;X+=1)Z+=b[X][C]*b[X][C];k[Ie+C]=Math.sqrt(Z)}function Je(){L[1]+=1,St=Ft;for(let C=1;C<=_;C+=1){St+=1,Z=-y[C];for(let X=1;X<=c;X+=1)Z+=b[X][C]*u[X];if(Math.abs(Z)<o&&(Z=0),C>m)k[St]=Z;else if(k[St]=-Math.abs(Z),Z>0){for(let X=1;X<=c;X+=1)b[X][C]=-b[X][C];y[C]=-y[C]}}for(let C=1;C<=R;C+=1)k[Ft+x[C]]=0;B=0,W=0;for(let C=1;C<=_;C+=1)k[Ft+C]<W*k[Ie+C]&&(B=C,W=k[Ft+C]/k[Ie+C]);if(0===B){for(let C=1;C<=R;C+=1)p[x[C]]=k[Ct+C];return 999}return 0}function Xe(){for(let C=1;C<=c;C+=1){Z=0;for(let X=1;X<=c;X+=1)Z+=l[X][C]*b[X][B];k[C]=Z}A=ne;for(let C=1;C<=c;C+=1)k[A+C]=0;for(let C=R+1;C<=c;C+=1)for(let X=1;X<=c;X+=1)k[A+X]=k[A+X]+l[X][C]*k[C];Mt=!0;for(let C=R;C>=1;C-=1){Z=k[C],St=pe+C*(C+3)/2,A=St-C;for(let X=C+1;X<=R;X+=1)Z-=k[St]*k[Zt+X],St+=X;Z/=k[A],k[Zt+C]=Z,!(x[C]<=m)&&(Z<=0||(Mt=!1,$=C))}if(!Mt){tt=k[Ct+$]/k[Zt+$];for(let C=1;C<=R;C+=1)x[C]<=m||k[Zt+C]<=0||(W=k[Ct+C]/k[Zt+C],W<tt&&(tt=W,$=C))}Z=0;for(let C=ne+1;C<=ne+c;C+=1)Z+=k[C]*k[C];if(Math.abs(Z)<=o){if(Mt)return N[1]=1,999;for(let C=1;C<=R;C+=1)k[Ct+C]=k[Ct+C]-tt*k[Zt+C];return k[Ct+R+1]=k[Ct+R+1]+tt,700}Z=0;for(let C=1;C<=c;C+=1)Z+=k[ne+C]*b[C][B];ct=-k[Ft+B]/Z,Dt=!0,Mt||tt<ct&&(ct=tt,Dt=!1);for(let C=1;C<=c;C+=1)u[C]+=ct*k[ne+C],Math.abs(u[C])<o&&(u[C]=0);g[1]+=ct*Z*(ct/2+k[Ct+R+1]);for(let C=1;C<=R;C+=1)k[Ct+C]=k[Ct+C]-ct*k[Zt+C];if(k[Ct+R+1]=k[Ct+R+1]+ct,!Dt){Z=-y[B];for(let C=1;C<=c;C+=1)Z+=u[C]*b[C][B];if(B>m)k[Ft+B]=Z;else if(k[Ft+B]=-Math.abs(Z),Z>0){for(let C=1;C<=c;C+=1)b[C][B]=-b[C][B];y[B]=-y[B]}return 700}R+=1,x[R]=B,St=pe+(R-1)*R/2+1;for(let C=1;C<=R-1;C+=1)k[St]=k[C],St+=1;if(R===c)k[St]=k[c];else{for(let C=c;C>=R+1;C-=1)if(0!==k[C]&&(it=Math.max(Math.abs(k[C-1]),Math.abs(k[C])),at=Math.min(Math.abs(k[C-1]),Math.abs(k[C])),W=k[C-1]>=0?Math.abs(it*Math.sqrt(1+at*at/(it*it))):-Math.abs(it*Math.sqrt(1+at*at/(it*it))),it=k[C-1]/W,at=k[C]/W,1!==it))if(0===it){k[C-1]=at*W;for(let X=1;X<=c;X+=1)W=l[X][C-1],l[X][C-1]=l[X][C],l[X][C]=W}else{k[C-1]=W,gt=at/(1+it);for(let X=1;X<=c;X+=1)W=it*l[X][C-1]+at*l[X][C],l[X][C]=gt*(l[X][C-1]+W)-l[X][C],l[X][C-1]=W}k[St]=k[R]}return 0}function Fo(){if(St=pe+$*($+1)/2+1,A=St+$,0===k[A]||(it=Math.max(Math.abs(k[A-1]),Math.abs(k[A])),at=Math.min(Math.abs(k[A-1]),Math.abs(k[A])),W=k[A-1]>=0?Math.abs(it*Math.sqrt(1+at*at/(it*it))):-Math.abs(it*Math.sqrt(1+at*at/(it*it))),it=k[A-1]/W,at=k[A]/W,1===it))return 798;if(0===it){for(let C=$+1;C<=R;C+=1)W=k[A-1],k[A-1]=k[A],k[A]=W,A+=C;for(let C=1;C<=c;C+=1)W=l[C][$],l[C][$]=l[C][$+1],l[C][$+1]=W}else{gt=at/(1+it);for(let C=$+1;C<=R;C+=1)W=it*k[A-1]+at*k[A],k[A]=gt*(k[A-1]+W)-k[A],k[A-1]=W,A+=C;for(let C=1;C<=c;C+=1)W=it*l[C][$]+at*l[C][$+1],l[C][$+1]=gt*(l[C][$]+W)-l[C][$+1],l[C][$]=W}return 0}function Ro(){A=St-$;for(let C=1;C<=$;C+=1)k[A]=k[St],St+=1,A+=1;return k[Ct+$]=k[Ct+$+1],x[$]=x[$+1],$+=1,$<R?797:0}function er(){return k[Ct+R]=k[Ct+R+1],k[Ct+R+1]=0,x[R]=0,R-=1,L[2]+=1,0}for(R=S,L[1]=0,L[2]=0,It=0;;){if(It=Je(),999===It)return;for(;It=Xe(),0!==It;){if(999===It)return;if(700===It)if($===R)er();else{for(;Fo(),It=Ro(),797===It;);er()}}}}}),nr=Y(t=>{var e=or();t.solveQP=function o(i,r,n,a=[],l=0,d=[0,0]){let h=[],c=[],u=[],p=[],g=[],b=[],y="",I=i.length-1,_=n[1].length-1;if(!a)for(let S=1;S<=_;S+=1)a[S]=0;if(I!==i[1].length-1&&(y="Dmat is not symmetric!"),I!==r.length-1&&(y="Dmat and dvec are incompatible!"),I!==n.length-1&&(y="Amat and dvec are incompatible!"),_!==a.length-1&&(y="Amat and bvec are incompatible!"),(l>_||l<0)&&(y="Value of meq is invalid!"),""!==y)return{message:y};for(let S=1;S<=_;S+=1)c[S]=0,p[S]=0;let x=Math.min(I,_);for(let S=1;S<=I;S+=1)u[S]=0;h[1]=0;for(let S=1;S<=2*I+x*(x+5)/2+2*_+1;S+=1)g[S]=0;for(let S=1;S<=2;S+=1)b[S]=0;return e(i,r,I,I,u,p,h,n,a,I,_,l,c,0,b,g,d),1===d[1]&&(y="constraints are inconsistent, no solution!"),2===d[1]&&(y="matrix D in quadratic function is not positive definite!"),{solution:u,Lagrangian:p,value:h,unconstrained_solution:r,iterations:b,iact:c,message:y}}}),sr=Y((t,e)=>{e.exports=nr()});function lr(t){for(let e of t)return e}function De(t){for(let e of t)return t.delete(e),e}function je(t,e,o){let i=t.get(e);void 0===i?t.set(e,[o]):i.push(o)}function qe(t,e,o){let i=t.get(e);void 0===i?t.set(e,new Set([o])):i.add(o)}function gi(t,e,o){let i=t.get(e);void 0!==i&&(i.delete(o),i.size||t.delete(e))}var{toString:cr}=Object.prototype,{propertyIsEnumerable:ur}=Object.prototype;function*Ce(t,...e){let i,o=new Set;for(;void 0!==(i=e.pop());)o.has(i)||(yield i,o.add(i),e.push(...t(i)))}function Qe(t,e){let o=[];for(let[i,r]of Nt(e))o.push(t[i]),o.push(r);return o.push(t[t.length-1]),o.join("")}function G(t,...e){let o=xt(e,i=>function pr(t,e,o){let i=[];return function r(n,a={},l=""){let h,d=a.indent||"\t";h=void 0===a.inlineCharacterLimit?{newline:"\n",newlineOrSpace:"\n",pad:l,indent:l+d}:{newline:"@@__STRINGIFY_OBJECT_NEW_LINE__@@",newlineOrSpace:"@@__STRINGIFY_OBJECT_NEW_LINE_OR_SPACE__@@",pad:"@@__STRINGIFY_OBJECT_PAD__@@",indent:"@@__STRINGIFY_OBJECT_INDENT__@@"};let c=u=>{if(void 0===a.inlineCharacterLimit)return u;let p=u.replace(new RegExp(h.newline,"g"),"").replace(new RegExp(h.newlineOrSpace,"g")," ").replace(new RegExp(h.pad+"|"+h.indent,"g"),"");return p.length<=a.inlineCharacterLimit?p:u.replace(new RegExp(h.newline+"|"+h.newlineOrSpace,"g"),"\n").replace(new RegExp(h.pad,"g"),l).replace(new RegExp(h.indent,"g"),l+d)};if(i.includes(n))return'"[Circular]"';if(null==n||"number"==typeof n||"boolean"==typeof n||"function"==typeof n||"symbol"==typeof n||function hr(t){return"[object RegExp]"===cr.call(t)}(n))return String(n);if(n instanceof Date)return`new Date('${n.toISOString()}')`;if(Array.isArray(n)){if(0===n.length)return"[]";i.push(n);let u="["+h.newline+n.map((p,g)=>{let b=n.length-1===g?h.newline:","+h.newlineOrSpace,y=r(p,a,l+d);return a.transform&&(y=a.transform(n,g,y)),h.indent+y+b}).join("")+h.pad+"]";return i.pop(),c(u)}if(function dr(t){let e=typeof t;return null!==t&&("object"===e||"function"===e)}(n)){let u=function fr(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t).filter(e=>ur.call(t,e))]}(n);if(a.filter&&(u=u.filter(g=>a.filter(n,g))),0===u.length)return"{}";i.push(n);let p="{"+h.newline+u.map((g,b)=>{let y=u.length-1===b?h.newline:","+h.newlineOrSpace,I="symbol"==typeof g,_=!I&&/^[a-z$_][$\w]*$/i.test(g),m=I||_?g:r(g,a),x=r(n[g],a,l+d);return a.transform&&(x=a.transform(n,g,x)),h.indent+String(m)+": "+x+y}).join("")+h.pad+"}";return i.pop(),c(p)}return n=n.replace(/\\/g,"\\\\"),n=String(n).replace(/[\r\n]/g,u=>"\n"===u?"\\n":"\\r"),!1===a.singleQuotes?`"${n=n.replace(/"/g,'\\"')}"`:`'${n=n.replace(/'/g,"\\'")}'`}(t,e,o)}(i,{indent:"  ",singleQuotes:!1,inlineCharacterLimit:60}));return new Error(Qe(t,o))}function vi(t){return`internal error: ${t}; if you encounter this please submit an issue at: https://github.com/erikbrinkman/d3-dag/issues`}function te(t,...e){let o=xt(e,i=>i.toString());return new Error(vi(Qe(t,o)))}function Vt(t,e,...o){let[i,...r]=t,a=Qe(r,xt(o,d=>d.toString())),l=e.name||"anonymous";return new Error("d3dagBuiltin"in e?vi(`builtin ${i}'${l}'${a}`):`custom ${i}'${l}'${a}`)}function*Nt(t){let e=0;for(let o of t)yield[e++,o]}function*Me(t,e){for(let[o,i]of Nt(t))yield*mt(e(i,o))}function*xt(t,e){for(let[o,i]of Nt(t))yield e(i,o)}function*Se(t,e){for(let[o,i]of Nt(t))e(i,o)&&(yield i)}function mi(t,e){for(let[o,i]of Nt(t))if(e(i,o))return!0;return!1}function kt(t,e=0,o=t.length,i=1){if(i>0)return function*mr(t,e,o,i){let r=Math.min(o,t.length);for(let n=e;n<r;n+=i)yield t[n]}(t,e,o,i);if(i<0)return function*wr(t,e,o,i){let r=Math.max(o,-1);for(let n=e;n>r;n+=i)yield t[n]}(t,e,o,i);throw G`can't slice with zero stride`}function*ee(...t){for(let e of t)yield*mt(e)}function*Bt(t){let e=t[Symbol.iterator](),o=e.next();if(!o.done){let r,i=o.value;for(;!(r=e.next()).done;)yield[i,r.value],i=r.value}}function yi(t){let o,e=[],i=new Map;for(let[n,a]of Nt(t.nodes()))i.set(a,n),e.push({x:a.ux,y:a.uy,data:a.data}),a===t&&(o=n);let r=[];for(let{source:n,target:a,data:l,points:d}of t.links())r.push({source:i.get(n),target:i.get(a),points:d,data:l});return{nodes:e,links:r,index:o,v:1}}var _r=class{constructor(t,e,o,i="inactive"){this.node=t,this.indeg=e,this.outdeg=o,this.stat=i}bucket(){let t=0===this.indeg?-1/0:0===this.outdeg?1/0:this.indeg-this.outdeg;return"top"===this.stat?Math.min(t,0):"bottom"===this.stat?Math.max(t,0):t}isTop(){return this.indeg<=this.outdeg&&"bottom"!==this.stat||"top"===this.stat}};function xi(t,e){let o=t[e];if(void 0===o){let i=new Set;return t[e]=i,i}return o}function ki(t){var e;let o;for(;t.length&&(null==(e=o=t[t.length-1])||!e.size);)t.pop();return o||void 0}function bi(t,e=(()=>{})){let o=new Map,i=new Map,r=new Set,n=new Set,a=[],l=[];function d(x){return x===-1/0?r:x===1/0?n:x<=0?xi(a,-x):xi(l,x-1)}for(let x of t){let S=x.nparentLinks(),L=x.nchildLinks(),k=new _r(x,S,L),N=e(x);o.set(x,k),void 0===N?(k.stat="active",d(k.bucket()).add(k)):qe(i,N,k)}let h=[...i].sort(([x],[S])=>x-S).map(([,x])=>x),c=0,u=h.length,p=h.length?h[c++]:new Set,g=h.length>1?h[--u]:new Set;for(let x of p)x.stat="top",d(x.bucket()).add(x);for(let x of g)x.stat="bottom",d(x.bucket()).add(x);function b(){var x;let S;if(S=null!=(x=De(r))?x:De(n))return S;let L=ki(a),k=ki(l);return k?De(a.length>l.length?L:k):L?De(L):void 0}let m,y=Array(o.size),I=0,_=o.size;for(;m=b();){let{node:x}=m,S=m.isTop()?I++:--_;m.stat="ranked",y[S]=x;for(let[L,k]of x.parentCounts()){let N=o.get(L);d(N.bucket()).delete(N),N.outdeg-=k,"ranked"!==N.stat&&"inactive"!==N.stat&&d(N.bucket()).add(N)}for(let[L,k]of x.childCounts()){let N=o.get(L);d(N.bucket()).delete(N),N.indeg-=k,"ranked"!==N.stat&&"inactive"!==N.stat&&d(N.bucket()).add(N)}if(p.delete(m),!p.size&&c<u){p=h[c++];for(let L of p)L.stat="top",d(L.bucket()).add(L)}if(g.delete(m),!g.size&&c<u){g=h[--u];for(let L of g)L.stat="bottom",d(L.bucket()).add(L)}}return y}function Ii(t,e){let n,o=new Set,i=new Set,r=[];for(let a of t)if(!i.has(a)){for(r.push(a);n=r.pop();)o.delete(n),!i.has(n)&&(i.add(n),r.push(...e(n)));o.add(a)}return o}var ae,le,ce,Yt,Be,ze,ti,ei,ii,Mr=class{constructor(){ht(this,ae,0),ht(this,le,0),ht(this,ce,0),ht(this,Yt,!0),ht(this,Be,new Set),ht(this,ze,new Set),ht(this,ti,()=>{et(this,ae,F(this,ae)-1)}),ht(this,ei,(t,e)=>{et(this,le,F(this,le)+1),t?et(this,ce,F(this,ce)+1):!e&&!0===F(this,Yt)&&et(this,Yt,null)}),ht(this,ii,t=>{et(this,le,F(this,le)-1),t?et(this,ce,F(this,ce)-1):!1===F(this,Yt)&&et(this,Yt,null)})}*nodes(){for(let t of this.split())yield*mt(t.nodes())}topological(t){return bi(this.nodes(),t)}*links(){for(let t of this.nodes())yield*mt(t.childLinks())}nnodes(){return F(this,ae)}nlinks(){return F(this,le)}*roots(){for(let t of this.split())yield*mt(t.roots())}*leaves(){for(let t of this.split())yield*mt(t.leaves())}*split(){let t;for(yield*mt(F(this,Be));t=lr(F(this,ze));)yield t,t.nnodes()}connected(){let t=!1;for(let e of this.split()){if(t)return!1;t=!0}return!0}multi(){return!!F(this,ce)}acyclic(){if(null===F(this,Yt)){for(let t of this.split())if(!t.acyclic())return et(this,Yt,!1),!1;return et(this,Yt,!0),!0}return F(this,Yt)}node(t){return et(this,ae,F(this,ae)+1),new Ci(this,F(this,Be),F(this,ze),F(this,ti),F(this,ei),F(this,ii),t)}link(t,e,o){return t.link(t,e,o)}toJSON(){return yi(this)}};function _i(t){for(let e of t.values())for(let o of e)return o}function me(t){return t instanceof Ci}ae=new WeakMap,le=new WeakMap,ce=new WeakMap,Yt=new WeakMap,Be=new WeakMap,ze=new WeakMap,ti=new WeakMap,ei=new WeakMap,ii=new WeakMap;var zt,Fe,Re,Ge,ie,he,Jt,de,Wt,ue,Ut,Rt,Et,we,Le,Xt,re,ri,Ci=class{constructor(t,e,o,i,r,n,a){this.data=a,ht(this,we),ht(this,Xt),ht(this,zt,void 0),ht(this,Fe,void 0),ht(this,Re,void 0),ht(this,Ge,void 0),ht(this,ie,void 0),ht(this,he,void 0),ht(this,Jt,0),ht(this,de,0),ht(this,Wt,new Map),ht(this,ue,0),ht(this,Ut,new Map),ht(this,Rt,void 0),ht(this,Et,void 0),ht(this,ri,l=>{var d,h;let{source:c,target:u}=l,p=c.nchildLinksTo(u)>1;if(p){et(c,Jt,F(c,Jt)-1);let g=Lt(d=c,Xt,re).call(d);g.nlinks-=1,g.multis-=1}else{let g=Lt(h=c,we,Le).call(h);et(g,Et,null),F(this,ie).delete(g),F(this,he).add(c),et(c,Rt,c),et(c,Et,null),F(this,he).add(u),et(u,Rt,u),et(u,Et,null)}F(this,Ge).call(this,p),gi(F(c,Ut),u,l),et(c,ue,F(c,ue)-1),gi(F(u,Wt),c,l),et(u,de,F(u,de)-1)}),et(this,zt,t),et(this,ie,e),et(this,he,o),et(this,Fe,i),et(this,Re,r),et(this,Ge,n),et(this,Rt,this),et(this,Et,{nnodes:1,nlinks:0,multis:0,acyclic:!0,roots:[this],leaves:[this]}),F(this,ie).add(this)}get x(){if(void 0===this.ux)throw G`can't get \`x\` when \`ux\` is undefined`;return this.ux}set x(t){this.ux=t}get y(){if(void 0===this.uy)throw G`can't get \`y\` when \`uy\` is undefined`;return this.uy}set y(t){this.uy=t}*nodes(){yield*mt(Ce(t=>ee(t.children(),t.parents()),this))}topological(t){return bi(this.nodes(),t)}*links(){for(let t of this.nodes())yield*mt(t.childLinks())}nnodes(){return Lt(this,Xt,re).call(this).nnodes}nlinks(){return Lt(this,Xt,re).call(this).nlinks}*split(){yield this}connected(){return!0}multi(){return Lt(this,Xt,re).call(this).multis>0}acyclic(){let t=Lt(this,Xt,re).call(this);return null===t.acyclic?t.acyclic=function Cr(t){let i,e=new Map(xt(t,r=>[r,r.nparents()])),o=[...xt(Se(e,([,r])=>0===r),([r])=>r)];for(let r of o)e.delete(r);for(;i=o.pop();)for(let r of i.children()){let n=e.get(r)-1;n?e.set(r,n):(e.delete(r),o.push(r))}return!e.size}(this.nodes()):t.acyclic}node(t){if(F(this,zt))return F(this,zt).node(t);throw G`can't add a node from a deleted node`}link(t,e,o){var i,r;if(F(this,zt)){if(t===e)throw G`tried to create a link between the same node, but self loops are not supported`;if(me(t)&&me(e)&&F(t,zt)===F(e,zt)&&F(this,zt)===F(t,zt)){let n=new Sr(F(this,zt),t,e,F(this,ri),o),a=t.nchildLinksTo(e)>0,l=Lt(i=t,we,Le).call(i),d=F(l,Et),h=Lt(r=e,we,Le).call(r),c=F(h,Et);if(a&&d)et(t,Jt,F(t,Jt)+1),d.nlinks+=1,d.multis+=1;else if(a)et(t,Jt,F(t,Jt)+1);else if(l===h&&d)d.nlinks+=1,!0===d.acyclic&&(d.acyclic=null);else if(l!==h&&d&&c){let[u,p,g,b]=d.nnodes>c.nnodes?[l,d,h,c]:[h,c,l,d];F(this,ie).delete(g),et(g,Rt,u),et(g,Et,void 0),p.nnodes+=b.nnodes,p.nlinks+=b.nlinks+1,p.multis+=b.multis,p.acyclic=!1!==p.acyclic&&!1!==b.acyclic&&(!0===p.acyclic&&!0===b.acyclic||null),p.roots=null,p.leaves=null}else l!==h&&(et(l,Et,null),et(h,Et,null));return F(this,Re).call(this,a,l!==h),et(t,ue,F(t,ue)+1),qe(F(t,Ut),e,n),et(e,de,F(e,de)+1),qe(F(e,Wt),t,n),n}throw G`when creating a link, both source and target must be current members of the same graph, and can't have been deleted`}throw G`can't add a link from a deleted node`}nparents(){return F(this,Wt).size}nchildren(){return F(this,Ut).size}nparentLinks(){return F(this,de)}nchildLinks(){return F(this,ue)}nparentLinksTo(t){var e,o;return me(t)&&null!=(o=null==(e=F(this,Wt).get(t))?void 0:e.size)?o:0}*parentLinksTo(t){if(me(t)){let e=F(this,Wt).get(t);e&&(yield*mt(e))}}nchildLinksTo(t){var e,o;return me(t)&&null!=(o=null==(e=F(this,Ut).get(t))?void 0:e.size)?o:0}*childLinksTo(t){if(me(t)){let e=F(this,Ut).get(t);e&&(yield*mt(e))}}*parents(){yield*mt(F(this,Wt).keys())}*children(){yield*mt(F(this,Ut).keys())}*parentCounts(){for(let[t,e]of F(this,Wt))yield[t,e.size]}*childCounts(){for(let[t,e]of F(this,Ut))yield[t,e.size]}*parentLinks(){for(let t of F(this,Wt).values())yield*mt(t)}*childLinks(){for(let t of F(this,Ut).values())yield*mt(t)}*ancestors(){yield*mt(Ce(t=>t.parents(),this))}*descendants(){yield*mt(Ce(t=>t.children(),this))}*roots(){let t=Lt(this,Xt,re).call(this);t.roots||(t.roots=[...Ii(this.nodes(),e=>e.children())]),yield*mt(t.roots)}*leaves(){let t=Lt(this,Xt,re).call(this);t.leaves||(t.leaves=[...Ii(this.nodes(),e=>e.parents())]),yield*mt(t.leaves)}parent(t,e){return this.link(t,this,e)}child(t,e){return this.link(this,t,e)}delete(){if(F(this,zt)){let t;for(;t=_i(F(this,Ut));)t.delete();for(;t=_i(F(this,Wt));)t.delete();F(this,ie).delete(this),F(this,he).delete(this),F(this,Fe).call(this),et(this,zt,null),et(this,Et,null)}}toJSON(){return yi(this)}};zt=new WeakMap,Fe=new WeakMap,Re=new WeakMap,Ge=new WeakMap,ie=new WeakMap,he=new WeakMap,Jt=new WeakMap,de=new WeakMap,Wt=new WeakMap,ue=new WeakMap,Ut=new WeakMap,Rt=new WeakMap,Et=new WeakMap,we=new WeakSet,Le=function(){let t=this;for(;F(t,Rt)!==t;)et(t,Rt,F(F(t,Rt),Rt)),t=F(t,Rt);return t},Xt=new WeakSet,re=function(){let t=Lt(this,we,Le).call(this);if(void 0===F(t,Et))throw te`undefined cached info`;if(null!==F(t,Et))return F(t,Et);{let e=0,o=0,i=0;for(let r of this.nodes())e+=1,o+=r.nchildLinks(),i+=F(r,Jt),et(r,Rt,this),et(r,Et,void 0),F(this,he).delete(r);return F(this,ie).add(this),et(this,Et,{nnodes:e,nlinks:o,multis:i,acyclic:null,roots:null,leaves:null})}},ri=new WeakMap;var Oe,Ve,Sr=class{constructor(t,e,o,i,r){this.source=e,this.target=o,this.data=r,ht(this,Oe,void 0),ht(this,Ve,void 0),this.points=[],et(this,Oe,t),et(this,Ve,i)}delete(){F(this,Oe)&&(F(this,Ve).call(this,this),et(this,Oe,null))}};function ye(){return new Mr}function oi(t){if("string"!=typeof t)throw G`id is supposed to be type string but got type ${typeof t}`;return t}function We(t){function e(n){var a;let l=ye(),d=new Map,h=[];for(let[c,u]of n.entries()){let p=oi(t.id(u,c)),g=l.node(u),b=null!=(a=t.parentData(u,c))?a:[];for(let[y,I]of b)h.push([y,g,I]);if(d.has(p))throw G`found a duplicate id: ${o}, but ids passed to \`graphStratify()\` must be unique`;d.set(p,g)}for(let[c,u,p]of h){let g=d.get(c);if(!g)throw G`missing id: ${c}; this id was references in a node's parentIds, but no node with that id exists`;l.link(g,u,p)}return l}function o(n){if(void 0===n)return t.id;{let d=Q(t,["id"]);return We(U(J({},d),{id:n}))}}return e.id=o,e.parentData=function i(n){if(void 0===n)return t.parentData;{let h=Q(t,["parentIds","parentData"]);return We(U(J({},h),{parentIds:Er(n),parentData:n}))}},e.parentIds=function r(n){if(void 0===n)return t.parentIds;{let h=Q(t,["parentIds","parentData"]);return We(U(J({},h),{parentIds:n,parentData:Li(n)}))}},e}function Li(t){function e(o,i){var r;return xt(null!=(r=t(o,i))?r:[],n=>[n,void 0])}return e.wrapped=t,e}function Er(t){function e(o,i){var r;return xt(null!=(r=t(o,i))?r:[],([n])=>n)}return e.wrapped=t,e}function Pr(t){if("object"!=typeof t||null===t||!("id"in t))throw G`datum did not have an id field, and no id accessor was specified; try calling \`graphStratify().id(d => d...)\` to set a custom id accessor`;let{id:e}=t;if("string"==typeof e)return e;throw G`datum has an id field that was not a string, and no id accessor was specified; try calling \`graphStratify().id(d => d...)\` to set a custom id accessor`}function Oi(t){if("object"!=typeof t||null===t)throw G`default parentIds function expected datum to be an object but got: ${t}; try setting a custom accessor for parentIds with \`graphStratify().parentIds(d => ...)\``;if(!("parentIds"in t))return;let{parentIds:e}=t;if(void 0===e||function wi(t){return"object"==typeof t&&null!==t&&Symbol.iterator in t&&"function"==typeof t[Symbol.iterator]}(e)&&function vr(t,e){return!mi(t,(o,i)=>!e(o,i))}(e,o=>"string"==typeof o))return e;throw G`default parentIds function expected parentIds to be an iterable of strings but got: ${e}; try setting a custom accessor for parentIds with \`graphStratify().parentIds(d => ...)\``}function $r(...t){if(t.length)throw G`got arguments to graphStratify(${t}), but constructor takes no arguments; these were probably meant as data which should be called as \`graphStratify()(...)\``;return We({id:Pr,parentIds:Oi,parentData:Li(Oi)})}function Te(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Ai(t,e){return(null==t||!(t>=t))-(null==e||!(e>=e))||(t<e?-1:t>e?1:0)}function Ti(t,e){let o;if(void 0===e)for(let i of t)null!=i&&(o<i||void 0===o&&i>=i)&&(o=i);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(o<r||void 0===o&&r>=r)&&(o=r)}return o}function Ni(t,e){let o;if(void 0===e)for(let i of t)null!=i&&(o>i||void 0===o&&i>=i)&&(o=i);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(o>r||void 0===o&&r>=r)&&(o=r)}return o}function Ei(t,e,o=0,i=1/0,r){if(e=Math.floor(e),o=Math.floor(Math.max(0,o)),i=Math.floor(Math.min(t.length-1,i)),!(o<=e&&e<=i))return t;for(r=void 0===r?Ai:function Br(t=Te){if(t===Te)return Ai;if("function"!=typeof t)throw new TypeError("compare is not a function");return(e,o)=>{let i=t(e,o);return i||0===i?i:(0===t(o,o))-(0===t(e,e))}}(r);i>o;){if(i-o>600){let d=i-o+1,h=e-o+1,c=Math.log(d),u=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*u*(d-u)/d)*(h-d/2<0?-1:1);Ei(t,e,Math.max(o,Math.floor(e-h*u/d+p)),Math.min(i,Math.floor(e+(d-h)*u/d+p)),r)}let n=t[e],a=o,l=i;for(Ne(t,o,e),r(t[i],n)>0&&Ne(t,o,i);a<l;){for(Ne(t,a,l),++a,--l;r(t[a],n)<0;)++a;for(;r(t[l],n)>0;)--l}0===r(t[o],n)?Ne(t,o,l):(++l,Ne(t,l,i)),l<=e&&(o=l+1),e<=l&&(i=l-1)}return t}function Ne(t,e,o){let i=t[e];t[e]=t[o],t[o]=i}function si(t,e){return function zr(t,e,o){if(t=Float64Array.from(function*Dr(t,e){if(void 0===e)for(let o of t)null!=o&&(o=+o)>=o&&(yield o);else{let o=-1;for(let i of t)null!=(i=e(i,++o,t))&&(i=+i)>=i&&(yield i)}}(t,o)),(i=t.length)&&!isNaN(e=+e)){if(e<=0||i<2)return Ni(t);if(e>=1)return Ti(t);var i,r=(i-1)*e,n=Math.floor(r),a=Ti(Ei(t,n).subarray(0,n+1));return a+(Ni(t.subarray(n+1))-a)*(r-n)}}(t,.5,e)}Oe=new WeakMap,Ve=new WeakMap;var Zr=ft(ve());function ke(t,e,o,i,r={}){let n=Zr.Solve.call({},{optimize:t,opType:e,constraints:i,variables:o,ints:r}),{feasible:a}=n,l=Q(n,["feasible"]);if(!a)throw te`could not find a feasible simplex solution`;return l}var jr=ft(sr());function Qr(t){let e=[...t];if(e.sort((o,i)=>o-i),0!==e.length){if(2===e.length)return(e[0]+e[1])/2;if(e.length%2==0){let o=e.length/2,r=e[o-1],n=e[o],l=r-e[0],d=e[e.length-1]-n;return(r*d+n*l)/(l+d)}return e[(e.length-1)/2]}}function $i({aggregate:t}){function e(i,r,n){let[a,l]=n?[r,i]:[i,r],d=n?u=>u.parents():u=>u.children(),h=new Map(l.map((u,p)=>[u,p])),c=new Map(a.map(u=>[u,h.get(u)??t(xt(d(u),b=>h.get(b)))]));!function Kr(t,e){let o=new Map;for(let c of t){let u=e.get(c);void 0!==u&&je(o,u,c)}let i=[...o.entries()].sort(([c],[u])=>c-u).flatMap(([,c])=>c),r=new Map(t.map((c,u)=>[c,u])),n=t.filter(c=>void 0===e.get(c)),a=new Array(n.length).fill(null);(function l(c,u,p,g){if(u<=c)return;let b=Math.floor((c+u)/2),I=r.get(n[b]),_=0,m=[_];for(let S=p;S<g;++S)_+=r.get(i[S])<I?-1:1,m.push(_);let x=p+m.indexOf(Math.min(...m));a[b]=x,l(c,b,p,x),l(b+1,u,x,g)})(0,n.length,0,i.length),a.push(i.length+1);let d=0,h=0;for(let[c,u]of i.entries()){for(;a[h]==c;)t[d++]=n[h++];t[d++]=u}for(;a[h]==i.length;)t[d++]=n[h++]}(a,c)}return e.aggregator=function o(i){return void 0===i?t:$i({aggregate:i})},e.d3dagBuiltin=!0,e}function to(...t){if(t.length)throw G`got arguments to twolayerAgg(${t}); you probably forgot to construct twolayerAgg before passing to order: \`decrossTwoLayer().order(twolayerAgg())\`, note the trailing "()"`;return $i({aggregate:Qr})}function ro(t,e,o,i){t[o][o]+=i,t[o][e]-=i,t[e][o]-=i,t[e][e]+=i}function zi(t,e,o,i,r,n){let a=r+n;t[i][i]+=n*n,t[i][o]-=n*a,t[i][e]+=n*r,t[o][i]-=a*n,t[o][o]+=a*a,t[o][e]-=a*r,t[e][i]+=r*n,t[e][o]-=r*a,t[e][e]+=r*r}function Ze(t){return function qr(t){let e=0,o=0;for(let i of t)o++,e+=(i-e)/o;return o?e:void 0}(Me(t,e=>xt(e.children(),o=>o.y-e.y)))}function Ri([t,e,o]){if(t<=0||e<=0||o<=0)throw G`simplex weights must be positive, but got: ${t}, ${e}, ${o}`}function Gi(t){function e(i,r){var n;let a={},l={},d=function oo(t,e){if("function"!=typeof e){let[o,i,r]=e;return(n,a)=>{switch(+("node"===n.data.role)+ +("node"===a.data.role)){case 0:return r;case 1:return i;case 2:return o;default:throw te`invalid count`}}}{let o=new Map;for(let i of Me(t,r=>r))if("node"===i.data.role){let r=i.data.node,n=new Map;for(let a of r.childLinks()){let{target:l}=a,d=e(a);Ri(d),n.set(l,d)}o.set(r,n)}return(i,r)=>{if("link"===i.data.role){let{source:n,target:a}=i.data.link,[,l,d]=o.get(n).get(a);return"link"===r.data.role?d:l}if("link"===r.data.role){let{source:n,target:a}=r.data.link,[,l]=o.get(n).get(a);return l}{let[n]=o.get(i.data.node).get(r.data.node);return n}}}}(i,t.weight),h=new Map,c=0;for(let _ of i)for(let m of _)if(!h.has(m)){let x=""+c++;h.set(m,x),a[x]={}}function u(_){return h.get(_)}for(let _ of i)for(let[m,x]of Bt(_)){let S=u(m),L=u(x),k=`layer ${S} -> ${L}`,N=r(m,x);l[k]={min:N},a[S][k]=-1,a[L][k]=1}let p=Ze(h.keys());for(let _ of h.keys()){let m=u(_);for(let x of _.children()){let S=u(x),L=`link ${m} -> ${S}`,k=`${L} parent`;l[k]={min:0};let N=`${L} child`;l[N]={min:0},a[m][k]=1,a[m][N]=-1,a[S][k]=-1,a[S][N]=1;let A=d(_,x);a[L]={opt:A/((x.y-_.y)/p),[k]:1,[N]:1}}}let g=ke("opt","min",a,l);for(let[_,m]of h)_.x=null!=(n=g[m])?n:0;let b=0,y=0;for(let _ of i){let m=_[0];b=Math.min(b,m.x-r(void 0,m));let x=_[_.length-1];y=Math.max(y,x.x+r(x,void 0))}for(let _ of h.keys())_.x-=b;let I=y-b;if(I<=0)throw G`must assign nonzero width to at least one node; double check the callback passed to \`sugiyama().nodeSize(...)\``;return I}return e.weight=function o(i){if(void 0===i)return t.weight;{"function"!=typeof i&&Ri(i);let a=Q(t,["weight"]);return Gi(U(J({},a),{weight:i}))}},e.d3dagBuiltin=!0,e}function no(...t){if(t.length)throw G`got arguments to coordSimplex(${t}); you probably forgot to construct coordSimplex before passing to coord: \`sugiyama().coord(coordSimplex())\`, note the trailing "()"`;return Gi({weight:[1,2,8]})}function Vi(t,e){let o=new Map,i=new Map(t.map((n,a)=>[n,a]));return function r(n,a){var l;let d=null==(l=o.get(n))?void 0:l.get(a);if(void 0!==d)return d;if(i.has(n)||i.has(a))return-1/0;{let h=0;for(let[p,g]of e(n)){let b=i.get(p);for(let[y,I]of e(a)){let _=i.get(y);h+=Math.sign(b-_)*g*I}}let c=o.get(n);void 0===c?o.set(n,new Map([[a,h]])):c.set(a,h);let u=o.get(a);return void 0===u?o.set(a,new Map([[n,-h]])):u.set(n,-h),h}}}function ai({baseOp:t,doScan:e}){function o(n,a,l){t(n,a,l);let d=l?a:n,h=l?Vi(n,c=>c.parentCounts()):Vi(a,c=>c.childCounts());e?function ao(t,e){let o=Array(t.length*(t.length-1)/2);for(;;){let i=0;for(let h=1;h<t.length;++h){let c=0,u=i;for(let p=h-1;p>=0;--p)o[u]=c,c+=e(t[p],t[h]),u-=t.length-p-1;i+=t.length-h}let r=0,n=0,a=0,l=0;for(let h=0;h<t.length-1;++h){let c=0;for(let u=h+1;u<t.length;++u){c+=e(t[h],t[u]);let p=o[r++]+c;p>n&&(n=p,a=h,l=u)}}if(0===n)break;let d=t[l];t[l]=t[a],t[a]=d}}(d,h):function so(t,e){let i,o=[[0,t.length]];for(;i=o.pop();){let[r,n]=i;if(r>=n)continue;let a=0,l=n;for(let d=r;d<n-1;++d){let h=e(t[d],t[d+1]);h>a&&(a=h,l=d)}if(l!==n){let d=t[l+1];t[l+1]=t[l],t[l]=d,o.push([r,l],[l+2,n])}}}(d,h)}return o.base=function i(n){return void 0===n?t:ai({baseOp:n,doScan:e})},o.scan=function r(n){return void 0===n?e:ai({baseOp:t,doScan:n})},o.d3dagBuiltin=!0,o}function lo(...t){if(t.length)throw G`got arguments to twolayerGreedy(${t}); you probably forgot to construct twolayerGreedy before passing to order: \`decrossTwoLayer().order(twolayerGreedy())\`, note the trailing "()"`;return ai({baseOp:()=>{},doScan:!1})}function li(t){let e=0;for(let[o,i]of Bt(t)){let r=new Map(i.map((n,a)=>[n,a]));for(let[n,a]of o.entries())for(let l of o.slice(n+1))for(let[d,h]of a.childCounts())for(let[c,u]of l.childCounts())d!==c&&r.get(d)>r.get(c)&&(e+=h*u)}return e}function Wi(t){function e(i){let r;r=t.topDown?Ce(n=>[...n.children()].sort((a,l)=>l.nchildren()-a.nchildren()),...Me(i,n=>[...Se(n,a=>!a.nparents())].sort((a,l)=>l.nchildren()-a.nchildren()))):Ce(n=>[...n.parents()].sort((a,l)=>l.nparents()-a.nparents()),...Me(kt(i,i.length-1,-1,-1),n=>[...Se(n,a=>!a.nchildren())].sort((a,l)=>l.nparents()-a.nparents())));for(let n of i)n.splice(0);for(let n of r){let{data:a}=n;if("node"===a.role)for(let l=a.topLayer;l<=a.bottomLayer;++l)i[l].push(n);else i[a.layer].push(n)}}return e.topDown=function o(i){return void 0===i?t.topDown:Wi({topDown:i})},e.d3dagBuiltin=!0,e}function Ui(...t){if(t.length)throw G`got arguments to decrossDfs(${t}); you probably forgot to construct decrossDfs before passing to decross: \`sugiyama().decross(decrossDfs())\`, note the trailing "()"`;return Wi({topDown:!0})}function He(t){function e(n){let a=n.slice().reverse(),l=n.map(c=>c.slice()),d=li(l),h=t.inits.length?t.inits:[()=>{}];for(let c of h){c(n);let u=!0;for(let p=0;p<t.passes&&u;++p){u=!1;for(let[y,I]of Bt(n)){let _=I.slice();t.order(y,I,!0),I.some((m,x)=>_[x]!==m)&&(u=!0)}let g=li(n);g<d&&(d=g,l=n.map(y=>y.slice()));for(let[y,I]of Bt(a)){let _=I.slice();t.order(I,y,!1),I.some((m,x)=>_[x]!==m)&&(u=!0)}let b=li(n);b<d&&(d=b,l=n.map(y=>y.slice()))}}n.splice(0,n.length,...l)}return e.order=function o(n){if(void 0===n)return t.order;{let d=Q(t,["order"]);return He(U(J({},d),{order:n}))}},e.inits=function i(n){if(void 0===n)return[...t.inits];{let d=Q(t,["inits"]);return He(U(J({},d),{inits:n}))}},e.passes=function r(n){if(void 0===n)return t.passes;if(n<=0)throw G`number of passes must be positive`;return He(U(J({},t),{passes:n}))},e.d3dagBuiltin=!0,e}function ho(...t){if(t.length)throw G`got arguments to decrossTwoLayer(${t}); you probably forgot to construct decrossTwoLayer before passing to decross: \`sugiyama().decross(decrossTwoLayer())\`, note the trailing "()"`;return He({order:lo().base(to()),inits:[Ui().topDown(!0),Ui().topDown(!1)],passes:24})}function uo(t,e){return+!(!t||!e)}function ci(t){function e(r,n){var a;let l={},d={},h=new Map(xt(r.nodes(),(m,x)=>[m,x.toString()]));function c(m){return h.get(m)}function u(m){return l[c(m)]}function p(m,x,S,L,k=0){let N=u(x),A=u(S),$=`${m}: ${c(x)} -> ${c(S)}`;d[$]={min:L},N[$]=-1,A[$]=1,N.opt+=k,A.opt-=k}function g(m,x,S){p(`${m} before`,x,S,0),p(`${m} after`,S,x,0)}let b=[],y=new Map;for(let m of r.nodes()){let x=c(m);l[x]={opt:0};let S=t.rank(m);void 0!==S&&b.push([S,m]);let L=t.group(m);if(void 0!==L){let k=y.get(L);k?k.push(m):y.set(L,[m])}}let I=new Set;for(let m of r.topological(t.rank)){for(let[x,S]of m.childCounts())I.has(x)?p("link",x,m,n(x,m),S):p("link",m,x,n(m,x),S);I.add(m)}let _=b.sort(([m],[x])=>m-x);for(let[[m,x],[S,L]]of Bt(_))m<S?p("rank",x,L,n(x,L)):g("rank",x,L);for(let m of y.values())for(let[x,S]of Bt(m))g("group",x,S);try{let m=ke("opt","max",l,d,{}),x=0,S=0;for(let L of r.nodes()){let k=null!=(a=m[c(L)])?a:0;L.y=k,x=Math.min(x,k-n(void 0,L)),S=Math.max(S,k+n(L,void 0))}for(let L of r.nodes())L.y-=x;return S-x}catch{throw y.size?G`could not find a feasible simplex layout; this is likely due to group constraints producing an infeasible layout, try relaxing the functions you're passing to \`layeringSimplex().group(...)\``:te`could not find a feasible simplex solution`}}return e.rank=function o(r){if(void 0===r)return t.rank;{let l=Q(t,["rank"]);return ci(U(J({},l),{rank:r}))}},e.group=function i(r){if(void 0===r)return t.group;{let l=Q(t,["group"]);return ci(U(J({},l),{group:r}))}},e.d3dagBuiltin=!0,e}function Yi(){}function fo(...t){if(t.length)throw G`got arguments to layeringSimplex(${t}); you probably forgot to construct layeringSimplex before passing to layering: \`sugiyama().layering(layeringSimplex())\`, note the trailing "()"`;return ci({rank:Yi,group:Yi})}function fe(t,e){function o(h){let c;if(h.nnodes()){let[u,p]=function Xr(t){if("function"!=typeof t){let[e,o]=t;return[()=>e,()=>o]}{let e=t;return[o=>e(o)[0],o=>e(o)[1]]}}(function Jr(t){if("function"!=typeof t){let[e,o]=t;if(e<=0||o<=0)throw G`all node sizes must be positive, but got width ${e} and height ${o}`;return()=>[e,o]}{let e=new Map;return o=>{let i=e.get(o);if(void 0===i){i=t(o);let[r,n]=i;if(r<=0||n<=0)throw G`all node sizes must be positive, but got width ${r} and height ${n} for node with data: ${o.data}; make sure the callback passed to \`sugiyama().nodeSize(...)\` is doing that`;e.set(o,i)}return i}}}(t.nodeSize)),[g,b]=e.gap,y=t.layering(h,uo)+1,[I,_]=function po(t,e,o,i,r){let n=ye(),a=Array(i).fill(!1),l=new Map;for(let p of t.nodes()){let g=p.uy;if(void 0===g)throw Vt`layering ${r} didn't assign a layer to a node`;if(g<0||g>=i)throw Vt`layering ${r} assigned node an invalid layer: ${g}`;{let b=ee(p.parentCounts(),p.childCounts());!a[g]&&mi(b,([{uy:I},_])=>_>1&&I===g-1)&&(a[g]=!0);let y={node:p,topLayer:g,bottomLayer:g,role:"node"};l.set(p,[y,n.node(y)])}}let d=0,h=a.map(p=>d+=+p);for(let[p]of l.values()){let g=h[p.topLayer];p.topLayer+=g,p.bottomLayer+=g}let c=function Zi(t,e,o,i){for(let[n,[a,l]]of e){let d=a.bottomLayer;for(let h of n.childLinks()){let[c,u]=e.get(h.target),p=c.topLayer;if(p>d){let g=l;for(let b=d+1;b<p;++b){let y=t.node({link:h,layer:b,role:"link"});g.child(y,void 0),g=y}g.child(u)}else{if(!(p<d))throw Vt`layering ${i} assigned nodes with an edge to the same layer`;{let g=u;for(let b=p+1;b<d;++b){let y=t.node({link:h,layer:b,role:"link"});g.child(y,void 0),g=y}g.child(l)}}}}let r=Array(o).fill(null).map(()=>[]);for(let n of t.nodes()){let{data:a}=n;if("node"===a.role){let{topLayer:l,bottomLayer:d}=a;for(let h=l;h<=d;++h)r[h].push(n)}else{let{layer:l}=a;r[l].push(n)}}for(let n of r)if(!n.length)throw Vt`layering ${i} didn't assign a node to every layer`;return r}(n,l,i+d,r),u=-o;for(let p of c){u+=o;let g=Math.max(-o,...xt(p,({data:y})=>"node"===y.role?e(y.node):-1/0)),b=u+g/2;for(let y of p)y.y=b;u+=g}return[c,u]}(h,p,b,y,t.layering);t.decross(I);let m=function co(t,e){return function o(i,r){let l=((i?t(i):0)+(r?t(r):0))/2;return i&&r?l+e:l}}(function vo(t,e=0){return({data:o})=>"node"===o.role?t(o.node):e}(u),g),x=t.coord(I,m);(function mo(t,e,o,i,r=.001){for(let n of t){for(let a of n)if(void 0===a.ux)throw Vt`coord ${i} didn't assign an x to every node`;for(let[[a,l],[d,h]]of Bt(ee([[void 0,0]],xt(n,c=>[c,c.x]),[[void 0,o]])))if(h-l<e(a,d)-r)throw Vt`coord ${i} assigned nodes too close for separation`}})(I,m,x,t.coord),function go(t){for(let e of t)for(let o of e)if("node"===o.data.role){let{node:i}=o.data;i.x=o.x,i.y=o.y;for(let r of o.children()){let a,n=[[o.x,o.y]];for(;"link"===r.data.role;)a=r.data.link,n.push([r.x,r.y]),[r]=r.children();n.push([r.x,r.y]);let l=r.data.node,d=ee(i.childLinksTo(l),i.parentLinksTo(l));a||([a]=d),a.source!==i&&n.reverse(),a.points.splice(0,a.points.length,...n)}}}(I),c={width:x,height:_}}else c={width:0,height:0};for(let u of t.tweaks)c=u(h,c);return c}return o.layering=function i(h){if(void 0===h)return t.layering;{let p=Q(t,["layering"]);return fe(U(J({},p),{layering:h}),e)}},o.decross=function r(h){if(void 0===h)return t.decross;{let p=Q(t,["decross"]);return fe(U(J({},p),{decross:h}),e)}},o.coord=function n(h){if(void 0===h)return t.coord;{let p=Q(t,["coord"]);return fe(U(J({},p),{coord:h}),e)}},o.tweaks=function a(h){if(void 0===h)return t.tweaks;{let p=Q(t,["tweaks"]);return fe(U(J({},p),{tweaks:h}),e)}},o.nodeSize=function l(h){if(void 0===h)return t.nodeSize;if("function"!=typeof h&&(h[0]<=0||h[1]<=0)){let[c,u]=h;throw G`constant nodeSize must be positive, but got: [${c}, ${u}]`}{let p=Q(t,["nodeSize"]);return fe(U(J({},p),{nodeSize:h}),e)}},o.gap=function d(h){if(void 0!==h){let[c,u]=h;if(c<0||u<0)throw G`gap width (${c}) and height (${u}) must be non-negative`;return fe(t,U(J({},e),{gap:h}))}{let[c,u]=e.gap;return[c,u]}},o}function Hi(t,e){for(let o of t){let i=si([...xt(e(o),({x:r})=>r)]);void 0!==i&&(o.x=i)}}function Ji(t,e){for(let o of t){let[i]=e(o);"link"===o.data.role&&"link"===i.data.role&&(o.x=i.x)}}function Ee(t,e){let o=t[t.length-1],i=o.x,r=[i];for(let n of kt(t,t.length-2,-1,-1)){let a=Math.min(n.x,i-e(o,n));r.push(a),o=n,i=a}r.reverse(),o=t[0],i=o.x,o.x=(i+r[0])/2;for(let[n,a]of Nt(kt(t,1))){let l=Math.max(a.x,i+e(o,a));a.x=(l+r[n+1])/2,o=a,i=l}}function yo(t,e){for(let[o,i]of t.entries()){let r=e[o];for(let[n,{x:a}]of i.entries())if(r[n]!==a)return!1}return!0}function hi(t,e,o){if("function"!=typeof t)return()=>t;{let i=new Map;return r=>{let n=i.get(r);if(void 0===n){let a=t(r);if(a<0)throw new Error(`${e} weights must be non-negative; double check the accessor passed into \`coordQuad().${o}(...)\``);return i.set(r,a),a}return n}}}function be(t){function e(l,d){let x,h=function io(t){let e=new Map,o=0;for(let i of t)for(let r of i)e.has(r)||e.set(r,o++);return e}(l),[c,u,p,g]=function Bi(t,e,o,i=0){let r=1+Math.max(...e.values()),n=Array(r).fill(null).map((h,c)=>Array(r).fill(null).map((u,p)=>c===p?i:0)),a=Array(r).fill(0),l=[],d=[];for(let h of t)for(let[c,u]of Bt(h)){let p=e.get(c),g=e.get(u),b=Array(r).fill(0);b[p]=1,b[g]=-1,l.push(b),d.push(-o(c,u))}return[n,a,l,d]}(l,h,d,t.comp),b=function ko(t,e){if("function"!=typeof t)return()=>t;{let o=new Map;for(let i of Me(e,r=>r))if("node"===i.data.role){let r=i.data.node,n=new Map;for(let a of r.childLinks()){let l=t(a);if(l<0)throw G`link weights must be non-negative; double check the accessor passed into \`coordQuad().vertWeak(...)\``;n.set(a.target,l)}o.set(r,n)}return(i,r)=>o.get(i).get(r)}}(t.vertWeak,l),y=hi(t.vertStrong,"link","vertStrong"),I=hi(t.linkCurve,"link","linkCurve"),_=hi(t.nodeCurve,"node","nodeCurve"),m=Ze(h.keys());for(let[S,L]of h){let k=S.data,N="node"===k.role?k.node:k.link.source;for(let A of S.children()){let $=h.get(A),B=A.data,R="node"===B.role?B.node:B.link.target,W="node"===k.role?b(N,R):y(k.link),Z="node"===B.role?b(N,R):y(B.link),tt="node"===B.role?_(B.node):I(B.link),ct=(A.y-S.y)/m;ro(c,L,$,(W+Z)/ct);for(let it of A.children())zi(c,L,$,h.get(it),tt/ct,tt/((it.y-A.y)/m))}}try{x=function Fi(t,e,o,i){for(let[a,l]of o)a.x=i[l];let r=1/0,n=-1/0;for(let a of t){let l=a[0],d=a[a.length-1];r=Math.min(r,l.x-e(void 0,l)),n=Math.max(n,d.x+e(d,void 0))}for(let a of o.keys())a.x-=r;return n-r}(l,d,h,function Di(t,e,o,i,r=0){e.pop(),t.pop(),t.forEach(a=>a.pop()),o.forEach(a=>a.pop());let n=function eo(t,e,o,i,r){if(!e.length)return[];let n=[[0]],a=[0],l=[[0]],d=[0];for(let u of t){let p=[0];p.push(...u),n.push(p)}a.push(...e),l.push(...e.map(()=>[0]));for(let u of o)for(let[p,g]of u.entries())l[p+1].push(-g);d.push(...i.map(u=>-u));let{solution:h,message:c}=(0,jr.solveQP)(n,a,l,d,r);if(c.length)throw te`quadratic program failed: ${c}`;return h.shift(),h}(t,e,o,i,r);return n.push(0),n}(c,u,p,g))}catch(S){throw"string"==typeof S?te`${S}`:te`undefined quadprog exception`}if(x<=0)throw G`must assign nonzero width to at least one node; double check the callback passed to \`sugiyama().nodeSize(...)\``;return x}return e.vertWeak=function o(l){if(void 0===l)return t.vertWeak;if("number"==typeof l&&l<0)throw G`vertWeak must be non-negative but was: ${l}`;{let c=Q(t,["vertWeak"]);return be(U(J({},c),{vertWeak:l}))}},e.vertStrong=function i(l){if(void 0===l)return t.vertStrong;if("number"==typeof l&&l<0)throw G`vertStrong must be non-negative but was: ${l}`;{let c=Q(t,["vertStrong"]);return be(U(J({},c),{vertStrong:l}))}},e.linkCurve=function r(l){if(void 0===l)return t.linkCurve;if("number"==typeof l&&l<0)throw G`linkCurve must be non-negative but was: ${l}`;{let c=Q(t,["linkCurve"]);return be(U(J({},c),{linkCurve:l}))}},e.nodeCurve=function n(l){if(void 0===l)return t.nodeCurve;if("number"==typeof l&&l<0)throw G`nodeCurve must be non-negative but was: ${l}`;{let c=Q(t,["nodeCurve"]);return be(U(J({},c),{nodeCurve:l}))}},e.compress=function a(l){if(void 0===l)return t.comp;if(l<=0)throw G`compress weight must be positive, but was: ${l}`;return be(U(J({},t),{comp:l}))},e.d3dagBuiltin=!0,e}function di(t){function e(r){var n;let a=r.reduce((L,k)=>L+k.length*Math.max(k.length-1,0)/2,0),l=[];if(t.dist)for(let[L,k]of Bt(r)){let N=k.filter(R=>!R.nparents()),A=L.map(R=>[...R.children()]);l.push([N,A]);let $=L.filter(R=>!R.nchildren()),B=k.map(R=>[...R.parents()]);l.push([$,B])}let d=function Io(t){var e,o;let i=[],r=new Map,n=new Map;for(let h of t){let[c]=h;c!==i[i.length-1]&&i.push(c);for(let u of kt(h,1)){let p=null!=(e=n.get(u))?e:0;n.set(u,p+1)}for(let[u,p]of Bt(h))je(r,u,p)}let d,a=new Map,l=0;for(;d=i.pop();){a.set(d,l++);for(let h of null!=(o=r.get(d))?o:[]){let c=n.get(h)-1;n.set(h,c),c||i.push(h)}}return a}(r),h=new Map;function c(L,k){var N;let A=`${L} => ${k}`;return null!=(N=h.get(A))?N:A}let u=new Map;for(let[L,k]of Nt(kt(r,0,r.length-1)))for(let N of k){if("node"!==N.data.role||N.data.bottomLayer===L)continue;let A=d.get(N),$=!0;for(let B of k)if(B===N)$=!1;else if("node"!==B.data.role||B.data.bottomLayer===L){let R=d.get(B),W=$?c(R,A):c(A,R);for(let Z of B.children()){let tt=d.get(Z),ct=$?c(tt,A):c(A,tt);u.set(ct,W)}}}let p=new Map;for(let[L,k]of u){let A,N=k;for(;A=u.get(N);)N=A;let $=p.get(N);$?$.push(L):p.set(N,[N,L])}for(let L of p.values()){let k=`{ ${L.join(" & ")} }`;for(let N of L)h.set(N,k)}let g=1/(l.reduce((L,[k,N])=>N.reduce((A,$)=>A+$.length*$.length,0)*k.length,0)/4+1),b=g/(a+1),y={},I={},_={};for(let L of r){for(let[k,N]of L.entries()){let A=d.get(N);for(let $ of kt(L,k+1)){let R=c(A,d.get($));_[R]=1,I[R]={max:1},y[R]={opt:b,[R]:1}}}for(let[k,N]of L.entries()){let A=d.get(N);for(let[$,B]of Nt(kt(L,k+1))){let R=d.get(B);for(let W of L.slice(k+$+2)){let Z=d.get(W),tt=c(A,R),ct=c(A,Z),it=c(R,Z),at=`tri: ${A} - ${R} - ${Z}`,gt=`${at} +`,Mt=`${at} -`;I[gt]={max:1},y[tt][gt]=1,y[ct][gt]=-1,y[it][gt]=1,I[Mt]={min:0},y[tt][Mt]=1,y[ct][Mt]=-1,y[it][Mt]=1}}}}for(let[L,k]of Nt(kt(r,0,r.length-1)))for(let[N,A]of k.entries()){if("node"===A.data.role&&A.data.bottomLayer!==L)continue;let $=d.get(A);for(let B of kt(k,N+1)){if("node"===B.data.role&&B.data.bottomLayer!==L)continue;let W=c($,d.get(B)),Z=new Map;for(let[tt,ct]of A.childCounts()){let it=d.get(tt);for(let[at,gt]of B.childCounts()){if(tt===at)continue;let Mt=d.get(at),Dt=Math.sign(it-Mt),It=Dt<0?c(it,Mt):c(Mt,it),Pt=null!=(n=Z.get(It))?n:0;Z.set(It,Dt*ct*gt+Pt)}}for(let[tt,ct]of Z){let it=`slack: ${W} : ${tt}`,at=`${it} +`,gt=`${it} -`;ct<0?(y[it]={opt:-ct,[at]:1,[gt]:1},I[at]={min:0},y[W][at]=1,y[tt][at]=-1,I[gt]={min:0},y[W][gt]=-1,y[tt][gt]=1):ct>0&&(y[it]={opt:ct,[at]:1,[gt]:1},I[at]={min:1},y[W][at]=1,y[tt][at]=1,I[gt]={min:-1},y[W][gt]=-1,y[tt][gt]=-1)}}}for(let[L,k]of l)for(let N of L){let A=d.get(N);for(let $ of k)for(let[B,R]of Nt($)){let W=d.get(R);for(let Z of kt($,B+1)){let tt=d.get(Z),ct=`dist: ${W} - ${A} - ${tt}`,it=`${ct} :normal`,at=`${ct} :reversed`;y[ct]={opt:g,[it]:1,[at]:1};let gt=0;for(let[Mt,Dt]of[[W,A],[W,tt],[A,tt]]){let It=Math.sign(Mt-Dt),Pt=It<0?c(Mt,Dt):c(Dt,Mt);gt+=It,y[Pt][it]=-It,y[Pt][at]=It}I[it]={min:(gt+1)/-2},I[at]={min:(gt-1)/2}}}}let m=Object.keys(y).length,x=Object.keys(I).length;if("oom"!==t.check&&m>2e3)throw G`size of dag to decrossOpt is too large and will likely crash instead of complete; you probably want to use a cheaper decrossing strategy for sugiyama like \`sugiyama().decross(decrossTwoLayer())\`, but if you still want to continue you can suppress this check with \`sugiyama().decross(decrossOp().check("oom"))\``;if("fast"===t.check&&(m>1e3||x>5e3))throw G`size of dag to decrossOpt is too large and will likely not complete; you probably want to use a cheaper decrossing strategy for sugiyama like \`sugiyama().decross(decrossTwoLayer())\`, but if you still want to continue you can suppress this check with \`sugiyama().decross(decrossOp().check("slow"))\``;let S=ke("opt","min",y,I,_);if(!S.bounded)throw te`optimization result was not bounded`;for(let L of r)L.sort((k,N)=>{let A=d.get(k),$=d.get(N);return A<$?S[c(A,$)]||-1:-(S[c($,A)]||-1)})}return e.check=function o(r){return void 0===r?t.check:di(U(J({},t),{check:r}))},e.dist=function i(r){return void 0===r?t.dist:di(U(J({},t),{dist:r}))},e.d3dagBuiltin=!0,e}function ui(t,e){function o(n,a){let l=0,d=n.topological(t.rank);for(let h of d)h.uy=void 0;e.topDown&&d.reverse();for(let h of d){let c=Math.max(a(void 0,h),...xt(ee(h.parents(),h.children()),u=>{var p;return(null!=(p=u.uy)?p:-1/0)+a(u,h)}));l=Math.max(l,c+a(h,void 0)),h.y=c}for(let h of d.reverse()){let c=Math.min(...xt(Se(ee(h.parents(),h.children()),u=>h.y<u.y),u=>u.y-a(u,h)));c!==1/0&&(h.y=c)}if(e.topDown)for(let h of d)h.y=l-h.y;return l}return o.rank=function i(n){if(void 0===n)return t.rank;{let d=Q(t,["rank"]);return ui(U(J({},d),{rank:n}),e)}},o.topDown=function r(n){return void 0===n?e.topDown:ui(t,U(J({},e),{topDown:n}))},o.d3dagBuiltin=!0,o}function Co(){}function ji(...t){if(t.length)throw G`got arguments to layeringLongestPath(${t}); you probably forgot to construct layeringLongestPath before passing to layering: \`sugiyama().layering(layeringLongestPath())\`, note the trailing "()"`;return ui({rank:Co},{topDown:!0})}function qi(t){function e(i,r){let a,n=0;for(let l of i.topological(t.rank))n+=r(a,l),l.y=n,a=l;return n+=r(a,void 0),n}return e.rank=function o(i){if(void 0===i)return t.rank;{let a=Q(t,["rank"]);return qi(U(J({},a),{rank:i}))}},e.d3dagBuiltin=!0,e}function Mo(){}function So(...t){if(t.length)throw G`got arguments to layeringTopological(${t}); you probably forgot to construct layeringTopological before passing to layering: \`sugiyama().layering(layeringTopological())\`, note the trailing "()"`;return qi({rank:Mo})}function To(t,e,o,i){let[r,n]=t,[a,l]=e,[d,h]=o,[c,u]=i,p=r-a/2,g=r+a/2,b=n-l/2,y=n+l/2;function I(x,S){let L=0;return x<p?L|=1:x>g&&(L|=2),S<b?L|=4:S>y&&(L|=8),L}let _=I(d,h),m=I(c,u);if(!m)throw G`line from [${d}, ${h}] -> [${c}, ${u}] ended inside rectangle centered at [${r}, ${n}] with size [${a}, ${l}]`;for(;;){if(!m)return[c,u];if(_&m)return[d,h];8&m?(c=d+(c-d)*(y-h)/(u-h),u=y):4&m?(c=d+(c-d)*(b-h)/(u-h),u=b):2&m?(u=h+(u-h)*(g-d)/(c-d),c=g):(u=h+(u-h)*(p-d)/(c-d),c=p),m=I(c,u)}}function No(t,e,o,i){let[r,n]=t,[a,l]=e,[d,h]=o,[c,u]=i,p=a/2,g=l/2,b=c-d,y=d-r,I=u-h,_=h-n,m=p*p,x=g*g,S=m*I*I+x*b*b,L=b*_-I*y,k=S-L*L;if(k>=0){let N=p*g*Math.sqrt(k),A=b*y*x+I*_*m,B=(A-N)/-S;if((A+N)/-S<1&&1<B)throw G`line from [${d}, ${h}] -> [${c}, ${u}] ended inside ellipse at [${r}, ${n}] with size [${a}, ${l}]`;return 0<=B&&B<=1?[B*b+d,B*I+h]:[d,h]}return[d,h]}function Eo(t,e=To){return function o(i,r){for(let n of i.nodes()){let a=[n.x,n.y],l="function"==typeof t?t(n):t;for(let{points:d}of n.parentLinks()){let[h,c]=d.slice(-2),u=e(a,l,c,h);d.splice(-1,1,u)}for(let{points:d}of n.childLinks()){let[h,c]=d,u=e(a,l,h,c);d.splice(0,1,u)}}return r}}var tr=ot(9212),Bo=ot(7382);let zo=(()=>{class t{constructor(o){this.logger=o,this.offset=500,this.scaleFactor=7,this.multiChartOffset=0,this.multiChartscaleFactor=3,this.defaultLayoutProps={xGap:15,yGap:15,decross:!0,greedy:!1,quad:!1,layering:"longestPath",hasCurves:!0,bump:!0}}setXYLocations(o,i,r,n){const a=i.integrations.find(l=>l.id===+o.id);a&&(a.x=o.y*(r+i.activities.length*n),a.y=o.x*(r+i.activities.length*n)),o.children.forEach(l=>{this.setXYLocations(l,i,r,n)})}connectWithFakeStart(o,i){const r=o.integrations.filter(n=>0===o.activities.filter(l=>l.chartInfo.target_id===n.id).length);return r.length>1&&(i.push({id:-1e4,parentIds:[]}),r.forEach((n,a)=>{const l=i.find(d=>d.id===n.id);return l&&i.splice(i.indexOf(l),1),i.push({id:n.id,parentIds:[-1e4]}),{scale:this.multiChartscaleFactor,offset:this.multiChartOffset}})),{scale:this.scaleFactor,offset:this.offset}}arrangeNodes(o,i=this.defaultLayoutProps){const r=[];o.integrations.forEach(x=>{const S=o.activities.filter(L=>L.chartInfo.target_id===x.id).map(L=>L.chartInfo.source_id);r.push({id:x.id,parentIds:S.map(L=>L+"")})}),this.connectWithFakeStart(o,r);const a=$r().id(x=>x.id+"")(r),d=[36,36],h=i.bump?O.jvg().curve(O.qpX):O.jvg().curve(O.FdL),c=Eo(d,No),u=function wo(...t){if(t.length)throw G`got arguments to sugiyama(${t}), but constructor takes no arguments; these were probably meant as data which should be called as \`sugiyama()(...)\``;return fe({layering:fo(),decross:ho(),coord:no(),nodeSize:[1,1],tweaks:[]},{gap:[1,1]})}();let p;switch(i.layering){case"longestPath":default:p=u.layering(ji());break;case"topological":p=u.layering(So())}i.greedy&&(p=p.coord(function xo(...t){if(t.length)throw G`got arguments to coordGreedy(${t}); you probably forgot to construct coordGreedy before passing to coord: \`sugiyama().coord(coordGreedy())\`, note the trailing "()"`;function e(o,i){let r=0,n=0,a=new Set;for(let c of o)for(let u of c)a.has(u)||(a.add(u),void 0!==u.ux&&(r+=(u.ux-r)/++n));for(let c of o){let u=0,p=0;for(let b of c)void 0!==b.ux&&(u+=(b.ux-u)/++p);let g=p?u:r;for(let b of c)void 0===b.ux&&(b.ux=g);Ee(c,i)}for(let c of kt(o,1))Hi(c,u=>u.parents()),Ee(c,i);for(let c of kt(o,o.length-2,-1,-1))Hi(c,u=>u.children()),Ee(c,i);for(let c=0;c<o.length;++c){let u=o.map(p=>p.map(({x:g})=>g));for(let p of kt(o,1))Ji(p,g=>g.parents()),Ee(p,i);for(let p of kt(o,o.length-2,-1,-1))Ji(p,g=>g.children()),Ee(p,i);if(yo(o,u))break}let l=1/0,d=-1/0;for(let c of o){let u=c[0];l=Math.min(l,u.x-i(void 0,u));let p=c[c.length-1];d=Math.max(d,p.x+i(p,void 0))}for(let c of a)c.x-=l;let h=d-l;if(h<=0)throw G`must assign nonzero width to at least one node; double check the callback passed to \`sugiyama().nodeSize(...)\``;return h}return e.d3dagBuiltin=!0,e}())),i.quad&&(p=p.coord(function bo(...t){if(t.length)throw G`got arguments to coordQuad(${t}); you probably forgot to construct coordQuad before passing to coord: \`sugiyama().coord(coordQuad())\`, note the trailing "()"`;return be({vertWeak:1,vertStrong:0,linkCurve:1,nodeCurve:0,comp:1e-6})}()));const g=p.nodeSize(d).gap([18+i.yGap,18+i.xGap]).tweaks([c]);let b=!1;if(i.decross){const x=p.decross(function _o(...t){if(t.length)throw G`got arguments to decrossOpt(${t}); you probably forgot to construct decrossOpt before passing to decross: \`sugiyama().decross(decrossOpt())\`, note the trailing "()"`;return di({check:"fast",dist:!1})}()).nodeSize(d).gap([18+i.yGap,18+i.xGap]).tweaks([c]);try{x(a),this.logger.debug("decrossing layout")}catch{g(a),this.logger.debug("crossed layout"),b=!0}}else g(a),this.logger.debug("crossed layout");const y=Array.from(a.nodes()),I=Array.from(a.links()),_=new Map;o.activities.filter(x=>!x.chartInfo.milestoneNodeId).forEach(x=>{this.addActivity(_,x.chartInfo.target_id,x.chartInfo.source_id,x)});const m=new Map;return o.integrations.forEach(x=>{m.set(x.id,x)}),y.forEach(x=>{const S=m.get(+x.data.id);S.y=x.ux,S.x=x.uy}),I.forEach(x=>{const S=_.get(+x.target.data.id)?.get(+x.source.data.id);if(S&&x.points){if(!i.hasCurves)return void(S.chartInfo.dPath=void 0);S.chartInfo.dPath=h(x.points.map(L=>[L[1],L[0]]))??void 0}}),o.profile.view.autoZoom=!0,b}addActivity(o,i,r,n){o.has(i)||o.set(i,new Map),o.get(i).set(r,n)}static#t=this.\u0275fac=function(i){return new(i||t)(tr.LFG(Bo.m))};static#e=this.\u0275prov=tr.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()},4745:(qt,At)=>{var w;(w=At.s||(At.s={}))[w.Backspace=8]="Backspace",w[w.Tab=9]="Tab",w[w.Enter=13]="Enter",w[w.Shift=16]="Shift",w[w.Ctrl=17]="Ctrl",w[w.Alt=18]="Alt",w[w.PauseBreak=19]="PauseBreak",w[w.CapsLock=20]="CapsLock",w[w.Escape=27]="Escape",w[w.Space=32]="Space",w[w.PageUp=33]="PageUp",w[w.PageDown=34]="PageDown",w[w.End=35]="End",w[w.Home=36]="Home",w[w.LeftArrow=37]="LeftArrow",w[w.UpArrow=38]="UpArrow",w[w.RightArrow=39]="RightArrow",w[w.DownArrow=40]="DownArrow",w[w.Insert=45]="Insert",w[w.Delete=46]="Delete",w[w.Zero=48]="Zero",w[w.ClosedParen=48]="ClosedParen",w[w.One=49]="One",w[w.ExclamationMark=49]="ExclamationMark",w[w.Two=50]="Two",w[w.AtSign=50]="AtSign",w[w.Three=51]="Three",w[w.PoundSign=51]="PoundSign",w[w.Hash=51]="Hash",w[w.Four=52]="Four",w[w.DollarSign=52]="DollarSign",w[w.Five=53]="Five",w[w.PercentSign=53]="PercentSign",w[w.Six=54]="Six",w[w.Caret=54]="Caret",w[w.Hat=54]="Hat",w[w.Seven=55]="Seven",w[w.Ampersand=55]="Ampersand",w[w.Eight=56]="Eight",w[w.Star=56]="Star",w[w.Asterik=56]="Asterik",w[w.Nine=57]="Nine",w[w.OpenParen=57]="OpenParen",w[w.A=65]="A",w[w.B=66]="B",w[w.C=67]="C",w[w.D=68]="D",w[w.E=69]="E",w[w.F=70]="F",w[w.G=71]="G",w[w.H=72]="H",w[w.I=73]="I",w[w.J=74]="J",w[w.K=75]="K",w[w.L=76]="L",w[w.M=77]="M",w[w.N=78]="N",w[w.O=79]="O",w[w.P=80]="P",w[w.Q=81]="Q",w[w.R=82]="R",w[w.S=83]="S",w[w.T=84]="T",w[w.U=85]="U",w[w.V=86]="V",w[w.W=87]="W",w[w.X=88]="X",w[w.Y=89]="Y",w[w.Z=90]="Z",w[w.LeftWindowKey=91]="LeftWindowKey",w[w.RightWindowKey=92]="RightWindowKey",w[w.SelectKey=93]="SelectKey",w[w.Numpad0=96]="Numpad0",w[w.Numpad1=97]="Numpad1",w[w.Numpad2=98]="Numpad2",w[w.Numpad3=99]="Numpad3",w[w.Numpad4=100]="Numpad4",w[w.Numpad5=101]="Numpad5",w[w.Numpad6=102]="Numpad6",w[w.Numpad7=103]="Numpad7",w[w.Numpad8=104]="Numpad8",w[w.Numpad9=105]="Numpad9",w[w.Multiply=106]="Multiply",w[w.Add=107]="Add",w[w.Subtract=109]="Subtract",w[w.DecimalPoint=110]="DecimalPoint",w[w.Divide=111]="Divide",w[w.F1=112]="F1",w[w.F2=113]="F2",w[w.F3=114]="F3",w[w.F4=115]="F4",w[w.F5=116]="F5",w[w.F6=117]="F6",w[w.F7=118]="F7",w[w.F8=119]="F8",w[w.F9=120]="F9",w[w.F10=121]="F10",w[w.F11=122]="F11",w[w.F12=123]="F12",w[w.NumLock=144]="NumLock",w[w.ScrollLock=145]="ScrollLock",w[w.SemiColon=186]="SemiColon",w[w.Equals=187]="Equals",w[w.Comma=188]="Comma",w[w.Dash=189]="Dash",w[w.Period=190]="Period",w[w.UnderScore=189]="UnderScore",w[w.PlusSign=187]="PlusSign",w[w.ForwardSlash=191]="ForwardSlash",w[w.Tilde=192]="Tilde",w[w.GraveAccent=192]="GraveAccent",w[w.OpenBracket=219]="OpenBracket",w[w.ClosedBracket=221]="ClosedBracket",w[w.Quote=222]="Quote"}}]);