"use strict";(self.webpackChunkcritical_web=self.webpackChunkcritical_web||[]).push([[249],{7249:(Ft,J,i)=>{i.r(J),i.d(J,{HistoryModule:()=>Tt});var C=i(6814),k=i(7586),Y=i(9918),L=i(4347),$=i(3994),u=i(3633),U=i(2181),_=i(4595),t=i(9212),Q=i(2357),N=i(7007),I=i(1970),E=i(5269),W=i(5861),T=i(3830),R=i(6181),r=i(4403),G=i(2119),X=i(9680),V=i(7649),K=i(2425),q=i(155),a=i(1486),tt=i(6399);let ot=(()=>{class s{constructor(o){this.mapper=o}export(o){let e=[],n=[],c=[],l=[],p=[],d=[],f=[],v=[],y=[],m=[],b=[],P=[],x=[];for(const Dt of o){const g=this.mapper.getHistoryEntryWorkbook(Dt);e=[...e,...g.profiles],n=[...n,...g.chartInfos],c=[...c,...g.nodes],l=[...l,g.projProfile],p=[...p,g.subProject],d=[...d,...g.phases],f=[...f,...g.roles],v=[...v,...g.resources],y=[...y,...g.activityResources],m=[...m,...g.activityPhases],b=[...b,...g.resourceRoles],x=[...x,...g.tagPool],P=[...P,...g.activityTags]}const j=a.P6.json_to_sheet(e),A=a.P6.json_to_sheet(c),w=a.P6.json_to_sheet(n),Z=a.P6.json_to_sheet(l),S=a.P6.json_to_sheet(p),H=a.P6.json_to_sheet(d),B=a.P6.json_to_sheet(f),D=a.P6.json_to_sheet(v),F=a.P6.json_to_sheet(y),wt=a.P6.json_to_sheet(m),Zt=a.P6.json_to_sheet(b),St=a.P6.json_to_sheet(x),Ht=a.P6.json_to_sheet(P),h=a.P6.book_new();a.P6.book_append_sheet(h,j,r.SI),a.P6.book_append_sheet(h,w,r.tu),a.P6.book_append_sheet(h,A,r.dt),a.P6.book_append_sheet(h,Z,r.nE),a.P6.book_append_sheet(h,S,r.N4),a.P6.book_append_sheet(h,H,r.nQ),a.P6.book_append_sheet(h,B,r.FU),a.P6.book_append_sheet(h,D,r.u_),a.P6.book_append_sheet(h,F,r.vx),a.P6.book_append_sheet(h,wt,r.Lc),a.P6.book_append_sheet(h,Zt,r._w),a.P6.book_append_sheet(h,St,r.Nz),a.P6.book_append_sheet(h,Ht,r.MP),a.NC(h,"critical-pass-project.xlsx")}import(o){return new Promise((e,n)=>{const c=new FileReader;c.readAsBinaryString(o),c.onload=l=>{const d=a.ij(l.target.result,{type:"binary",cellDates:!0}),f=this.getWorksheetData(d,r.SI),v=this.getWorksheetData(d,r.tu),y=this.getWorksheetData(d,r.dt),m=this.getWorksheetData(d,r.nE),b=this.getWorksheetData(d,r.N4),B={phaseData:this.getWorksheetData(d,r.nQ),rolesData:this.getWorksheetData(d,r.FU),resourcesData:this.getWorksheetData(d,r.u_),activityResourceData:this.getWorksheetData(d,r.vx),activityPhaseData:this.getWorksheetData(d,r.Lc),resourceRoleData:this.getWorksheetData(d,r._w),activityData:f,arrowData:v,integrationData:y,tagPoolData:this.getWorksheetData(d,r.Nz),activityTagData:this.getWorksheetData(d,r.MP),subProjectData:b},D=m.map(F=>this.mapper.getNode(F,B));e(D)}})}getWorksheetData(o,e){return a.P6.sheet_to_json(o.Sheets[e])}static#t=this.\u0275fac=function(e){return new(e||s)(t.LFG(tt.h))};static#o=this.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var et=i(6602),nt=i(9975),O=i(6223),st=i(2671);function it(s,M){if(1&s){const o=t.EpF();t.TgZ(0,"i",16),t.NdJ("click",function(){t.CHM(o);const n=t.oxw();return t.KtG(n.showPeek=!1)}),t.qZA()}}function rt(s,M){if(1&s){const o=t.EpF();t.TgZ(0,"i",17),t.NdJ("click",function(){t.CHM(o);const n=t.oxw();return t.KtG(n.peekStorage())}),t.qZA()}}function at(s,M){if(1&s&&(t.TgZ(0,"div",18),t._UZ(1,"cp-arrow-snapshot",19),t.qZA()),2&s){const o=t.oxw();t.xp6(1),t.Q6J("project",o.peekProj)("width",390)("height",250)}}let ct=(()=>{class s extends R.O{constructor(o,e,n,c,l,p,d,f,v,y,m,b,P,x,j){super(o,e,n,c,l,p,d,f,j),this.zametekApi=v,this.fCompiler=y,this.fileManager=m,this.jsonFileManager=b,this.treeNodeSerializer=P,this.historyApi=x,this.fileType=r.S6.XLSX,this.isSelFileType=!1,this.resourceCount=null,this.allowSave=!1,this.saveMenuHeight="50px",n.get(_.cu).subscribe(A=>{this.history=A})}unstashTree(){var o=this;return(0,W.Z)(function*(){o.showPeek=!1,o.showPeek=!1;try{const e=yield o.storageApi.get(T.H3);if(null!==e){o.dashboard.updateProject(e,!1);const n=o.treeNodeSerializer.head();n.data=e,o.eventService.get(_.kV).next([n])}}catch(e){return o.toastr.error("Unstash Chart","Error occured."),void console.error(e)}o.toastr.success("Unstash Chart","Success!")})()}downloadHistory(o){o===r.S6.XLSX?this.fileManager.export(this.history):o===r.S6.JSON?this.jsonFileManager.export(this.history):o===r.S6.ELECTRON_SAVE&&this.historyApi.post(this.project.profile.id,this.history).subscribe(e=>{this.ngZone.run(()=>{e?this.toastr.success("History saved","Success"):this.toastr.error("History not saved","Error")})})}loadFile(o){const e=o.name.split(".").pop();e===r.S6.XLSX?this.fileManager.import(o).then(n=>{this.eventService.get(_.kV).next(n)}):e===r.S6.JSON&&this.jsonFileManager.import(o).then(n=>{this.eventService.get(_.kV).next(n)})}autoAssignResourceCount(){this.zametekApi.autoAssignResourceCount(this.dashboard.activeProject$.value,this.resourceCount).subscribe(o=>{null!==o&&(this.fCompiler.compileProjectFromFile(o),this.dashboard.updateProject(o,!0))})}navToSingleGraph(){this.router.navigateByUrl(`history/(${this.id}//sidebar:arrow/${this.id})`)}navToMetaGraph(){this.router.navigateByUrl(`history/(${this.id}//sidebar:lasso/${this.id})`)}static#t=this.\u0275fac=function(e){return new(e||s)(t.Y36(k.F0),t.Y36(u.Ou),t.Y36(u.WO),t.Y36(G.z),t.Y36(X.B),t.Y36(K._W),t.Y36(u.$y),t.Y36(u.$6),t.Y36(q.v),t.Y36(V.h),t.Y36(ot),t.Y36(et.W),t.Y36(nt.Q),t.Y36(u.gF),t.Y36(t.R0b))};static#o=this.\u0275cmp=t.Xpm({type:s,selectors:[["cp-history-action-buttons"]],features:[t.qOj],decls:26,vars:19,consts:[[1,"btn-row"],["href","javascript:void(0)",1,"btn","btn-secondary",3,"click"],[1,"baseline"],["type","number",1,"auto-resources",3,"ngModel","ngModelChange"],[1,"btn","btn-secondary",3,"click"],[1,"stash"],["href","javascript:void(0)",1,"btn","border-right",3,"click"],["href","javascript:void(0)",1,"btn",3,"click"],["href","javascript:void(0)",1,"btn"],["class","fas fa-chevron-up",3,"click",4,"ngIf"],["class","fas fa-chevron-down",3,"click",4,"ngIf"],["class","peek",4,"ngIf"],[3,"disableButtons","save","load"],[1,"alert-msg",3,"hidden"],[1,"overlay",3,"hidden"],[1,"overlay-txt"],[1,"fas","fa-chevron-up",3,"click"],[1,"fas","fa-chevron-down",3,"click"],[1,"peek"],[3,"project","width","height"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div")(2,"a",1),t.NdJ("click",function(){return n.navToSingleGraph()}),t._uU(3,"Base Controls"),t.qZA(),t.TgZ(4,"a",1),t.NdJ("click",function(){return n.navToMetaGraph()}),t._uU(5,"Meta Controls"),t.qZA()(),t.TgZ(6,"div",2)(7,"input",3),t.NdJ("ngModelChange",function(l){return n.resourceCount=l}),t.qZA(),t.TgZ(8,"button",4),t.NdJ("click",function(){return n.autoAssignResourceCount()}),t._uU(9,"Set Resource Count"),t.qZA()(),t.TgZ(10,"div")(11,"div",5)(12,"a",6),t.NdJ("click",function(){return!n.disableButtons&&n.stash()}),t._uU(13,"Stash"),t.qZA(),t.TgZ(14,"a",7),t.NdJ("click",function(){return!n.disableButtons&&n.unstashTree()}),t._uU(15," Unstash"),t.qZA(),t.TgZ(16,"a",8),t.YNc(17,it,1,0,"i",9)(18,rt,1,0,"i",10),t.qZA(),t.YNc(19,at,2,3,"div",11),t.qZA(),t.TgZ(20,"da-file-action-buttons",12),t.NdJ("save",function(l){return n.downloadHistory(l)})("load",function(l){return n.loadFile(l)}),t.qZA()()(),t.TgZ(21,"div",13),t._uU(22),t.qZA(),t.TgZ(23,"div",14)(24,"div",15),t._uU(25),t.qZA()()),2&e&&(t.xp6(7),t.Q6J("ngModel",n.resourceCount),t.xp6(1),t.ekj("disabled",n.disableButtons),t.xp6(4),t.ekj("disabled",n.disableButtons),t.xp6(2),t.ekj("disabled",n.disableButtons),t.xp6(3),t.Q6J("ngIf",n.showPeek),t.xp6(1),t.Q6J("ngIf",!n.showPeek),t.xp6(1),t.Q6J("ngIf",n.showPeek),t.xp6(1),t.Q6J("disableButtons",n.disableButtons),t.xp6(1),t.ekj("success","Saved"==n.alertMessage)("error","Error"==n.alertMessage),t.Q6J("hidden",""==n.alertMessage),t.xp6(1),t.Oqu(n.alertMessage),t.xp6(1),t.Q6J("hidden",""===n.actionText),t.xp6(2),t.Oqu(n.actionText))},dependencies:[C.O5,N.J,O.Fj,O.wV,O.JJ,O.On,st.D],styles:[".btn-secondary[_ngcontent-%COMP%]{border:1px solid #ddd;border-radius:2px;background-color:#f9f9f9;color:#666}.btn-secondary[_ngcontent-%COMP%]:hover{color:#fff;background-color:#5a6268;border-color:#545b62}.btn[_ngcontent-%COMP%]{font-size:.87rem}.border-right[_ngcontent-%COMP%]{border-right:1px solid #333}.stash[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{color:#45f}.btn-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between}.btn-row[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-direction:row}.btn-row[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 7px}.btn-row[_ngcontent-%COMP%]   div.file-types[_ngcontent-%COMP%]{display:block}.btn-row[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 5px}.btn-row[_ngcontent-%COMP%]   .stash[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0}.btn-row[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.btn-row[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{padding-top:3px}.help-btn[_ngcontent-%COMP%]{color:#999;cursor:pointer}.peek[_ngcontent-%COMP%]{width:410px;height:270px;position:absolute;border:1px solid #e9e9e9;z-index:1;background-color:#f9f9f9;top:38px;display:flex;align-items:center;justify-content:center}.file-types[_ngcontent-%COMP%]{width:88px;height:70px;position:absolute;border:1px solid #e9e9e9;z-index:1;background-color:#f9f9f9;top:34px;margin-left:-20px}.stash[_ngcontent-%COMP%], .pos-rel[_ngcontent-%COMP%]{position:relative}.help[_ngcontent-%COMP%]{position:absolute;top:18px;right:0;width:400px;height:auto;background-color:#fff;border-radius:5px;z-index:1000;padding:20px;box-shadow:1px 3px 5px #0000006b}.help[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{position:absolute;padding-top:10px}.help-container[_ngcontent-%COMP%]{position:relative}.help-close[_ngcontent-%COMP%]{position:absolute;right:13px;cursor:pointer;top:13px}.help-pointer[_ngcontent-%COMP%]{cursor:pointer;color:#999}.help-list[_ngcontent-%COMP%]{padding:55px 49px 35px}.alert-msg[_ngcontent-%COMP%]{background:#4a4;border:1px solid #ddd;position:fixed;height:70px;width:102px;text-align:center;vertical-align:center;padding-top:19px;left:50%;color:#fff;top:50%;font-size:18px;border-radius:15px;z-index:2000}.saved[_ngcontent-%COMP%]{background:#4a4;border:1px solid #ddd}.error[_ngcontent-%COMP%]{background:#a44;border:1px solid #ddd}.save-proj[_ngcontent-%COMP%]{display:inline}a.btn-primary[_ngcontent-%COMP%]{color:#fff}.top-buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.overlay[_ngcontent-%COMP%]{position:fixed;width:100vw;height:100vh;inset:0;color:#fff;background-color:#00000080;z-index:100000;cursor:pointer}.overlay-txt[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:20px;font-weight:700}.btn-secondary.disabled[_ngcontent-%COMP%], .btn-secondary[_ngcontent-%COMP%]:disabled{color:#fff;background-color:#6c757d;border-color:#6c757d}.file-input[_ngcontent-%COMP%]{display:none}.baseline[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:baseline}.auto-resources[_ngcontent-%COMP%]{width:42px;height:30px;border:1px solid #ccc;text-align:right}.btn-row[_ngcontent-%COMP%]   div.baseline[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0 2px}"]})}return s})();const lt=s=>({"selected-chart":s});function dt(s,M){if(1&s){const o=t.EpF();t.TgZ(0,"div",12),t.ALo(1,"async"),t.TgZ(2,"a",13),t.NdJ("click",function(){const c=t.CHM(o).$implicit,l=t.oxw(2);return t.KtG(l.load(c))}),t._UZ(3,"cp-arrow-snapshot",14),t.qZA()()}if(2&s){const o=M.$implicit,e=t.oxw(2);t.Q6J("ngClass",t.VKq(6,lt,t.lcZ(1,4,e.selectedTreeNode$)===o.id)),t.xp6(3),t.Q6J("project",o.data)("width",300)("height",200)}}function pt(s,M){if(1&s&&(t.ynx(0),t.TgZ(1,"div",2)(2,"div",3),t._UZ(3,"cp-history-action-buttons",4),t.qZA(),t.TgZ(4,"div",5),t._UZ(5,"cp-arrow-chart",6),t.qZA(),t.TgZ(6,"div",7)(7,"div",8),t._UZ(8,"cp-tree-buttons"),t.qZA(),t.TgZ(9,"div",8),t._UZ(10,"cp-project-tree",9),t.qZA(),t._UZ(11,"div",8),t.qZA(),t.TgZ(12,"div",10),t.YNc(13,dt,4,8,"div",11),t.ALo(14,"async"),t.qZA()(),t.BQk()),2&s){const o=t.oxw();t.xp6(3),t.Q6J("id",o.id),t.xp6(2),t.Q6J("id",o.id)("width",1214)("height",700)("rebuild",!0),t.xp6(5),t.Q6J("width",390)("height",700)("id",o.id),t.xp6(3),t.Q6J("ngForOf",t.lcZ(14,9,o.historyArray$))}}function ht(s,M){1&s&&(t.TgZ(0,"div",15),t._uU(1,"Loading..."),t.qZA())}let gt=(()=>{class s{constructor(o,e,n){this.dashboard=e,this.eventService=n,this.refresh=0,this.id=+o.snapshot.params.id,this.project$=this.dashboard.activeProject$,this.historyArray$=this.eventService.get(_.cu),this.selectedTreeNode$=this.eventService.get(_.Xq)}ngOnInit(){this.subscription=this.project$.pipe((0,U.h)(o=>!!o)).subscribe(o=>this.refresh++)}canDeactivate(){return this.refresh<2}load(o){this.dashboard.updateProject(o.data,!1),this.selectedTreeNode$.next(o.id)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.eventService.onDestroy()}static#t=this.\u0275fac=function(e){return new(e||s)(t.Y36(k.gz),t.Y36(u.Ou),t.Y36(u.WO))};static#o=this.\u0275cmp=t.Xpm({type:s,selectors:[["cp-history-layout"]],decls:4,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],[1,"page-content"],[1,"action-buttons"],[3,"id"],[1,"current-view"],[3,"id","width","height","rebuild"],[1,"right-content"],[1,"sb-chart"],[3,"width","height","id"],[1,"snapshots"],["class","sb-chart default-border",3,"ngClass",4,"ngFor","ngForOf"],[1,"sb-chart","default-border",3,"ngClass"],[3,"click"],[3,"project","width","height"],[1,"loader"]],template:function(e,n){if(1&e&&(t.YNc(0,pt,15,11,"ng-container",0),t.ALo(1,"async"),t.YNc(2,ht,2,0,"ng-template",null,1,t.W1O)),2&e){const c=t.MAs(3);t.Q6J("ngIf",!!t.lcZ(1,2,n.project$))("ngIfElse",c)}},dependencies:[C.mk,C.sg,C.O5,Q.w,N.J,I.P,E.u,ct,C.Ov],styles:["cp-history-layout{z-index:0}cp-history-layout *{padding:0;margin:0}cp-history-layout .current-view{grid-row:2/-1;grid-column:1/4;height:700px}cp-history-layout .current-view{height:700px}cp-history-layout .page-content{grid-row:2/-1;grid-column:2/-1;display:grid;grid-gap:20px;margin:12px}cp-history-layout .page-content{grid-template-columns:repeat(4,1fr);grid-template-rows:18px auto;background-color:#f9f9f9}cp-history-layout .page-content{padding:15px 15px 0;min-width:1655px;min-height:945px}cp-history-layout .action-buttons{grid-row:1/2;grid-column:1/4}cp-history-layout .action-buttons{margin-top:-5px}cp-history-layout .right-content{display:flex;flex-direction:column;grid-row:1/-1}cp-history-layout [hidden]{display:none}cp-history-layout .loader{position:absolute;top:48%;left:calc(50% + 115px);transform:translate(-50%,-50%)}cp-history-layout cp-arrow-chart{position:relative;display:block}cp-history-layout .snapshots{display:grid;grid-column:1/-1;grid-template-columns:repeat(5,1fr);grid-gap:15px}cp-history-layout .default-border{border:3px solid white;background-color:#fff}cp-history-layout .selected-chart{border:3px solid red;background-color:#fff}\n"],encapsulation:2})}return s})();var z=i(1374),ut=i(9397),ft=i(9315),vt=i(8962);let yt=(()=>{class s{constructor(o,e,n,c,l,p){this.dashboard=o,this.projectApi=e,this.storageApi=n,this.historyApi=c,this.eventService=l,this.nodeConnector=p}resolve(o){var e=this;return(0,W.Z)(function*(){if(e.dashboard.secondaryProject$.next(null),+o.params.id===T.ph){const n=yield e.storageApi.get(T._k);return null!==n&&(n.profile.view.autoZoom=!0,e.dashboard.cleanSlateForNewPage(n)),e.dashboard.activeProject$.pipe((0,z.P)()).toPromise()}{const n=e.projectApi.get(o.params.id),c=e.historyApi.get(o.params.id);return(0,ft.D)([n,c]).pipe((0,ut.b)(([l,p])=>{p&&p.length>0?(e.importHistory(p),e.eventService.get("project.tree.history.file").next(p)):(e.nodeConnector.connectArrowsToNodes(l),e.dashboard.activeProject$.next(l),e.eventService.get("project.tree.history.file").next(null))}),(0,z.P)()).toPromise()}})()}importHistory(o){o.forEach(e=>{this.nodeConnector.connectArrowsToNodes(e.data)})}static#t=this.\u0275fac=function(e){return new(e||s)(t.LFG(u.Ou),t.LFG(u.$6),t.LFG(u.$y),t.LFG(u.gF),t.LFG(u.WO),t.LFG(vt.E))};static#o=this.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var mt=i(5836);const bt=[{path:"",component:Y.r,children:[{path:":id",component:gt,resolve:{items:yt},canDeactivate:[mt.I]},{path:"arrow/:id",component:L.m,outlet:"sidebar"},{path:"lasso/:id",component:$.l,outlet:"sidebar"}]}];let Pt=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#o=this.\u0275mod=t.oAB({type:s});static#e=this.\u0275inj=t.cJS({imports:[k.Bz.forChild(bt),k.Bz]})}return s})();var xt=i(2596),Ct=i(40),_t=i(1281),Mt=i(2457),Ot=i(3680),jt=i(5616),At=i(2032),kt=i(5488);let Tt=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#o=this.\u0275mod=t.oAB({type:s});static#e=this.\u0275inj=t.cJS({imports:[C.ez,Pt,jt.FA,At.c,Ot.XK,xt.AV,Ct.S,_t.E,Mt.n,O.u5,kt.L]})}return s})()}}]);