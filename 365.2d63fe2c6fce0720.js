"use strict";(self.webpackChunkcritical_web=self.webpackChunkcritical_web||[]).push([[365],{1339:(j,M,a)=>{a.d(M,{Z:()=>b});class _{constructor(u){null!=u&&u.profile.planned_completion_date?this.endDate=new Date(u.profile.planned_completion_date).getTime():(this.endDate=null,this.duration=0,this.startDate=null),this.duration=u.profile.duration??0,this.activityId=u.profile.id;const e=new Date(u.profile.planned_completion_date??"").getTime()-864e5*this.duration;this.startDate=e}isOverlap(u,e){return!(!this.startDate||!this.endDate)&&(this.startDate<u&&this.endDate>e||this.startDate>u&&this.startDate<e||this.endDate>u&&this.endDate<e||this.startDate>u&&this.endDate<e)}}class C{constructor(){this.name="",this.schedule=[]}scheduleActivity(u){let e=!0;for(const r of this.schedule)e=e&&!this.isOverlap(r,u);if(e){const r=new _(u);return this.schedule.push(r),!0}return!1}isOverlap(u,e){if(!e.profile.planned_completion_date||void 0===e.profile.duration)return!1;const r=new Date(e.profile.planned_completion_date),o=new Date(r.getTime()-864e5*e.profile.duration);return u.isOverlap(o.getTime(),r.getTime())}}var A=a(9212);let b=(()=>{class t{constructor(){}sortDummiesLast(e){const r=e.activities.sort((s,c)=>s.profile.id-c.profile.id),o=r.filter(s=>!s.chartInfo.isDummy||null!==s.chartInfo.milestoneNodeId);r.filter(s=>s.chartInfo.isDummy&&null===s.chartInfo.milestoneNodeId).forEach(s=>o.push(s)),e.activities=o}reorderIds(e){e.activities.sort((s,c)=>s.profile.id-c.profile.id);const r=e.activities.filter(s=>null!==s.profile.planned_completion_date),o=e.activities.filter(s=>null===s.profile.planned_completion_date),n=r.concat(o);e.activities=n,e.activities.forEach((s,c)=>{s.profile.sortOrder=c}),e.activities.forEach((s,c)=>{s.profile.sortOrder=c})}sortById(e){e.activities.sort((r,o)=>r.profile.id-o.profile.id),e.activities.forEach(r=>r.assign.isStartBranch=!1)}sortByBranches(e){const o=e.activities.filter(f=>f.assign.phases.length>0).length>0;let n=[];const s=e.activities.filter(f=>null!==f.profile.planned_completion_date&&0!==f.profile.duration),c=e.activities.filter(f=>null===f.profile.planned_completion_date||0===f.profile.duration);if(this.sortActivitiesForResources(s),!0===o)e.phases.map(O=>O.name).filter((O,g,h)=>h.indexOf(O)===g).forEach(O=>{const g=s.filter(w=>void 0!==w.assign.phases.find(d=>d.name===O)),h=this.assignResources(g);n.push(h)});else{const f=this.assignResources(s);n.push(f)}n=n.filter(f=>void 0!==f),this.sortActivities(e,n,c)}sortActivities(e,r,o){const n=[];r.forEach(s=>{s.forEach(c=>{const f=c.schedule.sort((O,g)=>(O.startDate??0)-(g.startDate??0));let P=0;f.forEach(O=>{const g=e.activities.find(h=>h.profile.id===O.activityId);null!=g&&(0===P&&(g.assign.isStartBranch=!0),n.push(g)),P++})})}),o.forEach(s=>{n.push(s)}),e.activities=n}getStartDate(e){return new Date(e.profile.planned_completion_date??"").getTime()-864e5*(e.profile.duration??0)}sortActivitiesForResources(e){return e.sort((r,o)=>this.getStartDate(r)-this.getStartDate(o)),e.sort((r,o)=>r.chartInfo.tf-o.chartInfo.tf),e}assignResources(e){if(!this.validateActivities(e))return[];const o=[];return e.forEach(n=>{!1===n.chartInfo.isDummy&&this.setResource(n,o)}),o}validateActivities(e){return e.filter(o=>this.validTimeframe(o)).length>0}validTimeframe(e){return!(null===e.profile.planned_completion_date||0===e.profile.duration)}setResource(e,r){if(0===r.length){const n=new C;return n.name="Resource 1",n.scheduleActivity(e),void r.push(n)}let o=!1;if(r.forEach(n=>{if(!o){const s=n.scheduleActivity(e);o=o||s}}),!o){const n=new C;n.name="Resource "+(r.length+1),n.scheduleActivity(e),r.push(n)}}static#t=this.\u0275fac=function(r){return new(r||t)};static#e=this.\u0275prov=A.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()},155:(j,M,a)=>{a.d(M,{v:()=>r});var _=a(9862),C=a(7398),A=a(7631),b=a(9500),t=a(2119),u=a(3830),e=a(9212);let r=(()=>{class o{constructor(s,c){this.http=s,this.projectSerializer=c}compileMsProject(s){const c=new FormData;return c.append("file",s,s.name),this.http.post((0,b.Z)(A.N.mappingApi,u.sv),c).pipe((0,C.U)(f=>(new t.z).fromJson(f)))}compileArrowGraph(s){const c=JSON.stringify(s),f=(new _.WM).set("Content-Type","application/json");return this.http.post((0,b.Z)(A.N.mappingApi,u.l0),c,{headers:f}).pipe((0,C.U)(P=>P?this.projectSerializer.fromJson(P):null))}autoAssignResourceCount(s,c=null){const P=JSON.stringify({project:s,resourceCount:c}),O=(new _.WM).set("Content-Type","application/json");return this.http.post((0,b.Z)(A.N.mappingApi,u.dO),P,{headers:O}).pipe((0,C.U)(g=>g?this.projectSerializer.fromJson(g):null))}static#t=this.\u0275fac=function(c){return new(c||o)(e.LFG(_.eN),e.LFG(t.z))};static#e=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})()},3994:(j,M,a)=>{a.d(M,{l:()=>g});var _=a(3830),C=a(3633),A=a(2181),b=a(2433),t=a(9212),u=a(9989),e=a(2119),r=a(9304);let o=(()=>{class h{constructor(i,d,l){this.nodeSerializer=i,this.projectSerializer=d,this.activitySerializer=l}extractSubProject(i,d){if(i.profile.view.isSubProjSelected){const l=i.activities.filter(y=>i.profile.view.lassoedLinks.indexOf(y.profile.id)>-1);let p=null,m=null,S=i.integrations.filter(y=>(i.profile.view.lassoStart===y.id&&(p=y),i.profile.view.lassoEnd===y.id&&(m=y),i.profile.view.lassoedNodes.indexOf(y.id)>-1&&p?.id!==y.id&&m?.id!==y.id));if(m&&p){const y=this.nodeSerializer.fromJson(p),T=this.nodeSerializer.fromJson(m);l.forEach(v=>{v.chartInfo.target_id===p.id&&(v.chartInfo.target=y),v.chartInfo.source_id===p.id&&(v.chartInfo.source=y),v.chartInfo.target_id===m.id&&(v.chartInfo.target=T),v.chartInfo.source_id===m.id&&(v.chartInfo.source=T)}),i.activities=i.activities.filter(v=>-1===l.indexOf(v)),i.integrations=[...i.integrations.filter(v=>-1===S.indexOf(v))],S=S.map(v=>this.nodeSerializer.fromJson(v)),S.push(y,T);const L=this.projectSerializer.fromJson();let D=d-1;D>=-1&&(D=-2);const I=`Sub Project ${D}`;L.profile.id=D,L.profile.name=I,L.activities=l,L.integrations=[...S];const E=this.activitySerializer.fromJson(),k=Math.max(...i.activities.map(v=>v.profile.id))+1;return E.profile.id=k,E.chartInfo.source_id=p.id,E.chartInfo.target_id=m.id,E.subProject.graphId=D,E.subProject.subGraphId=D,E.profile.name=I,i.activities.push(E),i.profile.view.lassoStart=null,i.profile.view.lassoEnd=null,i.profile.view.lassoedLinks=[],i.profile.view.lassoedNodes=[],L}}return null}static#t=this.\u0275fac=function(d){return new(d||h)(t.LFG(u.i),t.LFG(e.z),t.LFG(r.w))};static#e=this.\u0275prov=t.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"})}return h})();var n=a(7586),s=a(9728),c=a(6814),f=a(9707);const P=h=>({active:h}),O=h=>({disabled:h});let g=(()=>{class h{constructor(i,d,l,p,m){this.dashboard=i,this.eventService=d,this.projectExtractor=l,this.router=p,this.storageApi=m,this.project=null,this.activity=null,this.showLoadBtn=!1,this.projectName="",this.isLasso=!1,this.isSubProjSelected=!1,this.networkArray$=this.eventService.get(b.Zs),this.filteredNetworkArray$=this.eventService.get(b.eB)}ngOnInit(){this.sub=this.dashboard.activeProject$.pipe((0,A.h)(i=>!!i)).subscribe(i=>{this.project=i,this.projectName=i.profile.name,this.activity=i.profile.view.selectedActivity,this.isLasso=i.profile.view.lassoOn,this.isSubProjSelected=i.profile.view.isSubProjSelected})}updateProjectName(i){this.projectName=i.target.value,this.project&&(this.project.profile.name=this.projectName)}keyPress(i){"Enter"===i.key&&this.updateProjectName(i)}toggleLasso(i){this.project&&(this.project.profile.view.lassoOn=i,this.project.profile.view.lassoedLinks=[],this.project.profile.view.lassoedNodes=[],this.dashboard.updateProject(this.project,!0))}extractSubProject(){if(this.isSubProjSelected&&this.project){const i=this.networkArray$.getValue()??[],d=this.filteredNetworkArray$.getValue()??[];let l=Math.min(...i.map(m=>m.profile.id));l===1/0&&!this.project.profile.id&&(this.project.profile.id=-2,this.project.profile.name="Origin Project",l=-2),0===d.length&&d.push(this.project),0===i.length&&i.push(this.project);const p=this.projectExtractor.extractSubProject(this.project,l);p&&(d.push(p),i.push(p),this.networkArray$.next(i),this.filteredNetworkArray$.next(d)),this.dashboard.updateProject(this.project,!0)}}storeToSnapshot(){if(null!==this.project){const i=this.networkArray$.getValue()??[],d=this.filteredNetworkArray$.getValue()??[],l=i.find(m=>m.profile.id===this.project.profile.id),p=d.find(m=>m.profile.id===this.project.profile.id);(null===this.project.profile.id||0===this.project.profile.id)&&(this.project.profile.id=-1*(i.length+1)),l?(i.splice(i.indexOf(l),1),i.push(this.project)):(i.push(this.project),this.networkArray$.next(i)),p?(d.splice(d.indexOf(p),1),d.push(this.project)):(d.push(this.project),this.filteredNetworkArray$.next(d))}}ngOnDestroy(){this.sub?.unsubscribe()}navToProjProfile(){this.storageApi.set(_._k,this.project),this.router.navigateByUrl(b.d4)}navToScenarioPlanning(){this.storageApi.set(_._k,this.project),this.router.navigateByUrl(b.au)}static#t=this.\u0275fac=function(d){return new(d||h)(t.Y36(C.Ou),t.Y36(C.WO),t.Y36(o),t.Y36(n.F0),t.Y36(s.K))};static#e=this.\u0275cmp=t.Xpm({type:h,selectors:[["cp-lasso-bar"]],decls:32,vars:13,consts:[[1,"meta-bar"],["href","javascript:void(0)",1,"btn",3,"click"],["type","text",3,"value","keypress","blur"],["href","https://criticalpass.azurewebsites.net/assets/sample-data/project-network.xlsx"],[1,"title"],["data-toggle","buttons",1,"btn-group","btn-group-toggle"],[1,"btn","btn-secondary","active",3,"ngClass"],["type","radio","id","float","value","float","name","bottom-text",1,"form-check-input",3,"click"],[1,"btn","btn-secondary",3,"ngClass"],["type","radio","id","under-none","value","under-none","name","bottom-text",1,"form-check-input",3,"click"],[1,"btn","btn-secondary",3,"ngClass","click"],[3,"projectPool"]],template:function(d,l){1&d&&(t.TgZ(0,"div",0)(1,"div")(2,"a",1),t.NdJ("click",function(){return l.navToProjProfile()}),t._uU(3,"Load Project in Profile"),t.qZA()(),t.TgZ(4,"div")(5,"a",1),t.NdJ("click",function(){return l.navToScenarioPlanning()}),t._uU(6,"Load in Scenarios"),t.qZA()(),t.TgZ(7,"div")(8,"div"),t._uU(9,"Project Name"),t.qZA(),t.TgZ(10,"input",2),t.NdJ("keypress",function(m){return l.keyPress(m)})("blur",function(m){return l.updateProjectName(m)}),t.qZA()(),t.TgZ(11,"div")(12,"a",3),t._uU(13,"Get Sample Data"),t.qZA()(),t.TgZ(14,"div")(15,"div",4),t._uU(16,"Lasso Tool"),t.qZA(),t.TgZ(17,"div",5)(18,"label",6)(19,"input",7),t.NdJ("click",function(){return l.toggleLasso(!1)}),t.qZA(),t._uU(20," Off "),t.qZA(),t.TgZ(21,"label",8)(22,"input",9),t.NdJ("click",function(){return l.toggleLasso(!0)}),t.qZA(),t._uU(23," On "),t.qZA()()(),t.TgZ(24,"div")(25,"div"),t._uU(26,"Sub Project"),t.qZA(),t.TgZ(27,"div")(28,"button",10),t.NdJ("click",function(){return l.extractSubProject()}),t._uU(29,"Extract Sub Project"),t.qZA()()(),t._UZ(30,"cp-selected-activity",11),t.ALo(31,"async"),t.qZA()),2&d&&(t.xp6(10),t.Q6J("value",l.projectName),t.xp6(8),t.Q6J("ngClass",t.VKq(7,P,!l.isLasso)),t.xp6(3),t.Q6J("ngClass",t.VKq(9,P,l.isLasso)),t.xp6(7),t.Q6J("ngClass",t.VKq(11,O,!l.isSubProjSelected)),t.xp6(2),t.Q6J("projectPool",t.lcZ(31,5,l.networkArray$)))},dependencies:[c.mk,f.Z,c.Ov],styles:[".meta-bar[_ngcontent-%COMP%]{padding-left:27px;padding-right:16px}.meta-bar[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:#bbb}.meta-bar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#007bff}.meta-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:#fff}.meta-bar[_ngcontent-%COMP%]   ccp-selected-activity[_ngcontent-%COMP%]{border-bottom:1px solid #fff;display:block}.meta-bar[_ngcontent-%COMP%]   cp-selected-activity[_ngcontent-%COMP%], .meta-bar[_ngcontent-%COMP%]   cp-risk-decompress[_ngcontent-%COMP%]{padding-top:20px;display:block}.meta-bar[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-weight:700;font-size:1rem}.meta-bar[_ngcontent-%COMP%]   .end-nodes[_ngcontent-%COMP%]{display:flex}.meta-bar[_ngcontent-%COMP%]   .end-nodes[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:4px}.meta-bar[_ngcontent-%COMP%]   .end-nodes[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:60px}.meta-bar[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{color:#000}.meta-bar[_ngcontent-%COMP%]   .btn-secondary[_ngcontent-%COMP%]:not(:disabled):not(.disabled):active.btn-secondary:focus, .meta-bar[_ngcontent-%COMP%]   .btn-secondary.focus[_ngcontent-%COMP%]{color:#fff;background-color:#545b62;border-color:#4e555b}.meta-bar[_ngcontent-%COMP%]   .btn-secondary.active[_ngcontent-%COMP%]:not(:disabled):not(.disabled):active.btn-secondary.active:focus, .meta-bar[_ngcontent-%COMP%]   .btn-secondary.focus[_ngcontent-%COMP%]{color:#fff;background-color:#6c757d;border-color:#6c757d}"]})}return h})()},7649:(j,M,a)=>{a.d(M,{h:()=>e});var _=a(9212),C=a(8962),A=a(9011),b=a(1339),t=a(7808),u=a(1568);let e=(()=>{class r{constructor(n,s,c,f,P){this.nodeConstructor=n,this.riskCompiler=s,this.endNodesLocator=c,this.nodeArranger=f,this.activitySorter=P}compileProjectFromFile(n){this.nodeConstructor.connectArrowsToNodes(n),this.endNodesLocator.setStartEndNodesFromLongestPath(n),this.riskCompiler.compileRiskProperties(n),this.nodeArranger.arrangeNodes(n),this.activitySorter.sortDummiesLast(n)}static#t=this.\u0275fac=function(s){return new(s||r)(_.LFG(C.E),_.LFG(A.r),_.LFG(t.d),_.LFG(u.g),_.LFG(b.Z))};static#e=this.\u0275prov=_.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})()}}]);