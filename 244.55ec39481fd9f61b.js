"use strict";(self.webpackChunkcritical_web=self.webpackChunkcritical_web||[]).push([[244],{4819:(k,T,r)=>{r.d(T,{M:()=>p});var i=r(9212),O=r(2181),S=r(3920);class v{create(){return{svg:null,mainG:null,innerWidth:null,innerHeight:null,margin:{top:40,right:60,bottom:50,left:50},scales:null,focusLine:null}}}var D=r(3633),m=r(3503);let a=(()=>{class d{constructor(s,t,n){this.dashboard=s,this.ngZone=t,this.calc=n}init(s,t,n,c){this.height=t,this.width=s,this.id=n,this.st=(new v).create(),this.st.innerHeight=t-this.st.margin.top-this.st.margin.bottom,this.st.innerWidth=s-this.st.margin.left-this.st.margin.right,this.initSvg(s,t,c),this.data=this.dashboard.activeProject$,this.sub=this.data.pipe((0,O.h)(l=>!!l)).subscribe(l=>{this.ngZone.runOutsideAngular(()=>{this.createChart(l)})})}renderStatic(s,t,n,c){null!=s&&(this.width=+t,this.height=+n,this.st=(new v).create(),this.st.innerHeight=n-this.st.margin.top-this.st.margin.bottom,this.st.innerWidth=t-this.st.margin.left-this.st.margin.right,this.initSvg(t,n,c),this.createChart(s))}destroy(){this.sub&&this.sub.unsubscribe()}initSvg(s,t,n){const c=this.st,l="shallow-s-snapshot"+this.id;S.Ys(n).select("svg").remove(),c.svg=S.Ys(n).append("svg").attr("class",l),c.svg.style("width","100%").style("height",null).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${s} ${t}`),c.mainG=c.svg.append("g").attr("transform","translate("+this.st.margin.left+","+this.st.margin.top+")")}createChart(s){const t=0===s.integrations.length;if(this.st.mainG.selectAll("*").remove(),this.st.svg.select("g.empty-msg").remove(),t){const l="No data exists for Shallow S Diagram";return this.st.svg.attr("transform",null),void this.st.svg.append("g").attr("class","empty-msg").append("text").attr("class","missing-data").attr("y",this.height/3).attr("x",this.width/2+100).style("text-anchor","end").text(l)}const n=this.getDataset(s),c=this.calc.calculateShallowSSnapshotProps(n,s);c&&this.drawChart(c)}drawChart(s){const t=S.Xf().range([0,this.st.innerWidth]).domain(s.extents.x),n=S.BYU().range([this.st.innerHeight,0]).domain(s.extents.y);this.drawAxes(t,n),this.drawLines(s,t,n)}getDataset(s){return s.activities.filter(t=>!t.chartInfo.isDummy).map(t=>({id:t.profile.id,actual:t.profile.finish_dt,planned:t.profile.planned_completion_date_dt,name:t.profile.name,duration:t.profile.duration,percentActualFinished:null,percentPlannedFinished:null,isMilestone:!!t.chartInfo.milestoneNodeId}))}drawAxes(s,t){const n=S.i$Z("%-m/%-d/%-Y"),c=S.LLu(s).tickFormat(n).ticks(4),l=S.y4O(t).ticks(5);this.st.mainG.append("g").attr("class","x axis").attr("transform","translate(0,"+this.st.innerHeight+")").call(c).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-25)"),this.st.mainG.append("g").attr("class","y axis axisLeft").call(l).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("% Completion")}drawLines(s,t,n){const c=S.jvg().x(_=>t(_.planned)).y(_=>n(_.percentPlannedFinished)).curve(S.c_6),l=S.jvg().x(_=>t(_.actual)).y(_=>n(_.percentActualFinished)).curve(S.c_6),g=s.data.filter(_=>!!_.planned).sort((_,w)=>this.getSortComparator(_.planned,w.planned)),A=s.data.filter(_=>!!_.actual).sort((_,w)=>this.getSortComparator(_.actual,w.actual));this.st.mainG.append("path").datum(g).attr("clip-path","url(#clip)").attr("class","line planned").attr("d",c),this.st.mainG.append("path").datum(A).attr("clip-path","url(#clip)").attr("class","line actual").attr("d",l)}getSortComparator(s,t){return s||t?s?t?s.getTime()-t.getTime():-1:1:0}static#t=this.\u0275fac=function(t){return new(t||d)(i.LFG(D.Ou),i.LFG(i.R0b),i.LFG(m.o))};static#e=this.\u0275prov=i.Yz7({token:d,factory:d.\u0275fac})}return d})();const f=["chart"];let p=(()=>{class d{constructor(){this.ui=(0,i.f3M)(a)}ngOnInit(){this.project?this.ui.renderStatic(this.project,this.width,this.height,this.chart.nativeElement):this.ui.init(this.width,this.height,this.id,this.chart.nativeElement)}ngOnDestroy(){this.ui.destroy()}static#t=this.\u0275fac=function(t){return new(t||d)};static#e=this.\u0275cmp=i.Xpm({type:d,selectors:[["cp-shallow-s-snapshot"]],viewQuery:function(t,n){if(1&t&&i.Gf(f,7),2&t){let c;i.iGM(c=i.CRH())&&(n.chart=c.first)}},inputs:{id:"id",width:"width",height:"height",project:"project"},features:[i._Bn([a])],decls:3,vars:0,consts:[[1,"shallow-s-component-wrapper"],[1,"shallow-s-container"],["chart",""]],template:function(t,n){1&t&&(i.TgZ(0,"div",0),i._UZ(1,"div",1,2),i.qZA())},styles:["cp-shallow-s-snapshot .shallow-s-container{width:auto;height:auto;position:relative}cp-shallow-s-snapshot .shallow-s-empty{position:absolute;top:25%;left:50%;transform:translate(-50%,-50%);font-weight:700}cp-shallow-s-snapshot .line{fill:none;stroke:#4682b4;stroke-width:2px}cp-shallow-s-snapshot .planned{stroke:#4682b4}cp-shallow-s-snapshot .actual{stroke:#cd5c5c}cp-shallow-s-snapshot .regression{opacity:.6;stroke-dasharray:3 3}cp-shallow-s-snapshot .overrun{opacity:.2}cp-shallow-s-snapshot .over{fill:#cd5c5c}cp-shallow-s-snapshot .planned.coord{stroke:#4682b4;fill:#4682b4}cp-shallow-s-snapshot .actual.coord{stroke:#cd5c5c;fill:#cd5c5c}cp-shallow-s-snapshot .overlay{fill:none;pointer-events:all}cp-shallow-s-snapshot line.actual-marker{stroke:#cd5c5c;stroke-dasharray:3 3}cp-shallow-s-snapshot line.x0{stroke:#4682b4;stroke-dasharray:3 3}cp-shallow-s-snapshot text.actual-marker{stroke:#cd5c5c}cp-shallow-s-snapshot text.planned-marker{stroke:#4682b4}cp-shallow-s-snapshot circle.click-circle{fill:none}cp-shallow-s-snapshot circle.actual-marker{fill:none;stroke:#cd5c5c}cp-shallow-s-snapshot .shallow-s-component-wrapper{position:relative;top:0;left:0}cp-shallow-s-snapshot .shallow-s-component-wrapper .shallow-s-empty-message{position:absolute;top:33%;left:50%;transform:translate(-50%,-50%);font-weight:700}cp-shallow-s-snapshot .shallow-s-component-wrapper svg{background-color:#fff}cp-shallow-s-snapshot .axis text{font:10px sans-serif;pointer-events:none;text-shadow:0 1px 1px rgba(255,255,255,.8)}cp-shallow-s-snapshot .y.axis path{display:none}cp-shallow-s-snapshot .y.axis line{display:none}cp-shallow-s-snapshot text,cp-shallow-s-snapshot .x.axis path{color:#333}cp-shallow-s-snapshot .planned,cp-shallow-s-snapshot .actual{stroke-width:.75px}cp-shallow-s-snapshot .missing-data{font-weight:700}\n"],encapsulation:2})}return d})()},415:(k,T,r)=>{r.d(T,{r:()=>S});var i=r(6814),O=r(9212);let S=(()=>{class v{static#t=this.\u0275fac=function(a){return new(a||v)};static#e=this.\u0275mod=O.oAB({type:v});static#i=this.\u0275inj=O.cJS({imports:[i.ez]})}return v})()},3503:(k,T,r)=>{r.d(T,{o:()=>S});var i=r(4734),O=r(9212);let S=(()=>{class v{constructor(){}getSortComparator(m,a){return m||a?m?a?m.getTime()-a.getTime():-1:1:0}calculateCompletionPercent(m){const a=m.filter(d=>!!d.actual).sort((d,o)=>this.getSortComparator(d.actual,o.actual)),f=m.filter(d=>!!d.planned).sort((d,o)=>this.getSortComparator(d.planned,o.planned)),p=m.reduce((d,o)=>o.duration?d+o.duration:d,0);f.reduce((d,o)=>{const s=d+(o.duration??0);return o.percentPlannedFinished=Math.round(s/p*100),s},0),a.reduce((d,o)=>{const s=d+(o.duration??0);return o.percentActualFinished=Math.round(s/p*100),s},0)}calculateShallowSSnapshotProps(m,a){const f=this.calculateShallowSProps(m,a,!0);if(!f)return null;const p=Math.max(...f.data.filter(s=>!!s.actual).map(s=>s.actual.getTime())),d=Math.max(...f.data.filter(s=>!!s.planned).map(s=>s.planned.getTime())),o=Math.max(...[p,d].filter(s=>!isNaN(s)));return f.extents.x[1]=o,f}calculateShallowSProps(m,a,f=!1){if(!m.find(M=>!!M.duration))return null;this.calculateCompletionPercent(m);const p=m.filter(M=>!!M.actual),d=m.filter(M=>!!M.planned);let o=Math.min(...p.map(M=>M.actual.getTime())),s=Math.min(...d.map(M=>M.planned.getTime()));if(a.profile.view.useStartDates&&(o=Math.min(...p.map(M=>(0,i.Z)(M.actual,M.duration??0).getTime())),s=Math.min(...d.map(M=>(0,i.Z)(M.planned,M.duration??0).getTime()))),o===1/0&&s===1/0)return null;o===1/0?o=s:s===1/0&&(s=o);const t={duration:0,planned:new Date(s),actual:null,name:"Start Planned",percentActualFinished:0,percentPlannedFinished:0,isMilestone:!1,id:-1},c=[{duration:0,planned:null,actual:new Date(o),name:"Start Actual",percentActualFinished:0,percentPlannedFinished:0,isMilestone:!1,id:-2},t,...m],l=this.lineRegSlope(m,o,s),g=0!==l.slopeA?Math.round(100/l.slopeA)+o:null,A=0!==l.slopeP?Math.round(100/l.slopeP)+s:null,_=Math.max(g,A),w=Math.max(...c.filter(M=>!!M.actual).map(M=>M.actual.getTime())),I=Math.max(...c.filter(M=>!!M.planned).map(M=>M.planned.getTime())),b=Math.max(...[g,A,w,I].filter(M=>!isNaN(M))),y=Math.min(o,s),x=[y,b],L=l.slopeA?Math.round(l.slopeA*(_-o)):null,F=l.slopeP?Math.round(l.slopeP*(_-s)):null,R=Math.max(L,F);if(!a.profile.view.showOverrun||f)return{regression:{actual:isNaN(g)?null:[{x:o,y:0},{x:g,y:100}],planned:isNaN(A)?null:[{x:s,y:0},{x:A,y:100}]},extents:{x,y:[0,100]},showOverRun:a.profile.view.showOverrun,overRunPoints:null,data:c,step:a.profile.view.showStepChart};const G={x:[[{x:g,y:0},{x:g,y:R}],[{x:A,y:0},{x:A,y:R}]],y:[[{x:y,y:L},{x:b,y:L}],[{x:y,y:F},{x:b,y:F}]]};return{regression:{actual:isNaN(_)?null:[{x:o,y:0},{x:_,y:L}],planned:isNaN(_)?null:[{x:s,y:0},{x:_,y:F}]},extents:{x,y:[0,!isNaN(L)&&L||!isNaN(F)&&F?Math.max(L,F):100]},showOverRun:a.profile.view.showOverrun,overRunPoints:G,data:c,step:a.profile.view.showStepChart}}lineRegSlope(m,a,f){const p=m.filter(g=>!!g.actual),d=m.filter(g=>!!g.planned);return{slopeA:p.reduce((g,A)=>g+A.percentActualFinished*(A.actual.getTime()-a),0)/p.reduce((g,A)=>{const _=A.actual.getTime()-a;return g+_*_},0),slopeP:d.reduce((g,A)=>g+A.percentPlannedFinished*(A.planned.getTime()-f),0)/d.reduce((g,A)=>{const _=A.planned.getTime()-f;return g+_*_},0)}}static#t=this.\u0275fac=function(a){return new(a||v)};static#e=this.\u0275prov=O.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()},2497:(k,T,r)=>{r.d(T,{b:()=>d});var i=r(9212),O=r(5619),S=r(3633),v=r(3920),D=r(2181);class m{create(){return{svg:null,mainG:null,innerWidth:null,innerHeight:null,margin:{top:60,right:90,bottom:100,left:90},scales:null,focusLine:null,barWidth:null,showAxes:null,el:null}}}let a=(()=>{class o{constructor(){this.barWidth=25,this.size=1200}getStackedResourceData(t,n){this.barWidth=n.barWidth,this.size=n.innerWidth;const c=this.getValidActivities(t);if(0===c.length)return null;const l=this.getUniqueRoles(t),g=this.splitProjectIntoEqualTimeframes(t);return this.initRolesForBars(l,g),this.proccessDataForBars(t.resources,c,g),g}getValidActivities(t){return t.activities.filter(l=>this.validTimeframe(l)).filter(l=>l.assign.resources.length>0)}validTimeframe(t){return!(null===t.profile.planned_completion_date_dt||null===t.profile.duration)}getUniqueRoles(t){return t.roles.filter(c=>c.name)}splitProjectIntoEqualTimeframes(t){const c=t.activities.filter(R=>null!==R.profile.planned_completion_date_dt&&0!==R.profile.duration).map(R=>({date:this.getPlannedStartDate(R),duration:R.profile.duration})),A=c.sort((R,G)=>R.date.getTime()-G.date.getTime())[0].date.getTime(),_=c.sort((R,G)=>this.getDateFromStart(R)-this.getDateFromStart(G)),b=this.getDateFromStart(_[_.length-1])-A,y=Math.ceil(this.size/this.barWidth),x=Math.floor(b*this.barWidth/this.size),L=[];let F=Math.ceil(A+x/2);for(let R=0;R<y;++R)L.push({midDate:new Date(F),startDate:new Date(F-x/2),endDate:new Date(F+x/2),unmarked:0}),F+=x;return L}getDateFromTimeframe(t){const n=this.getDateFromStart(t);return new Date(n)}getDateFromStart(t){const n=1e3*t.duration*60*60*24;return t.date.getTime()+n}getActivityPlannedEndMs(t){return t.profile.planned_completion_date_dt.getTime()}getPlannedStart(t){const n=1e3*t.profile.duration*60*60*24;return t.profile.planned_completion_date_dt.getTime()-n}getPlannedStartDate(t){const n=1e3*t.profile.duration*60*60*24,c=t.profile.planned_completion_date_dt.getTime()-n;return new Date(c)}initRolesForBars(t,n){return 0===t.length||0===n.length||n.forEach(c=>{t.forEach(l=>{const g=new RegExp(" ","g"),A=l.name.replace(g,"_");c[A]=0})}),n}proccessDataForBars(t,n,c){t.forEach(l=>{const g=this.getUsersActivities(l,n);if(g.length>0)if(l.profile.chargeInbetweenTasks){const A=g.sort((b,y)=>this.getPlannedStart(b)-this.getPlannedStart(y)),_=this.getPlannedStart(A[0]),w=g.sort((b,y)=>this.getActivityPlannedEndMs(b)-this.getActivityPlannedEndMs(y)),I=this.getActivityPlannedEndMs(w[w.length-1]);c.forEach(b=>{this.barFitsWithinActivityTimeframe(_,I,b)&&this.incrementRoleOnbar(l,b)})}else g.forEach(A=>{const _=this.getPlannedStart(A),w=this.getActivityPlannedEndMs(A);c.forEach(I=>{this.barFitsWithinActivityTimeframe(_,w,I)&&this.incrementRoleOnbar(l,I)})})})}getUsersActivities(t,n){return n.filter(l=>this.activityContainsResource(l,t.profile.name))}activityContainsResource(t,n){return null!=t.assign.resources.find(l=>l.name===n)}barFitsWithinActivityTimeframe(t,n,c){const l=c.startDate.getTime(),g=c.endDate.getTime();return t<=l&&l<n||t<g&&g<=n||t<=l&&g<=n||l<=t&&n<=g}incrementRoleOnbar(t,n){const c=t.assign.roles.find(g=>""!==g.name);let l=null;if(void 0===c)l="unmarked";else{const g=new RegExp(" ","g");l=c.name.replace(g,"_")}void 0!==n[l]&&n[l]++}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275prov=i.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})(),f=(()=>{class o{constructor(t,n,c){this.dashboard=t,this.ngZone=n,this.scheduler=c}init(t,n,c,l,g,A,_){this.id=g,this.st=(new m).create(),this.st.margin=c,this.st.innerHeight=n-this.st.margin.top-this.st.margin.bottom,this.st.innerWidth=t-this.st.margin.left-this.st.margin.right,this.st.showAxes=l,this.st.barWidth=A,this.st.el=_,this.initSvg(t,n,_),this.data=this.dashboard.activeProject$,this.sub=this.data.pipe((0,D.h)(w=>!!w)).subscribe(w=>{this.ngZone.runOutsideAngular(()=>{this.createChart(w)})})}renderStatic(t,n,c,l,g,A,_){this.st=(new m).create(),this.st.margin=c,this.st.innerHeight=n-this.st.margin.top-this.st.margin.bottom,this.st.innerWidth=t-this.st.margin.left-this.st.margin.right,this.st.showAxes=l,this.st.barWidth=A,this.st.el=_,this.initSvg(t,n,_),this.createChart(g)}destroy(){this.sub&&this.sub.unsubscribe()}setProjIsEmpty(t){this.projIsEmpty=t}initSvg(t,n,c){const l="stacked-resources-"+this.id;v.Ys(c).select("svg").remove();const g=v.Ys(c).append("svg").attr("class",l);this.st.svg=g.style("width","100%").style("height",null).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${t} ${n}`).append("g"),this.st.mainG=this.st.svg.append("g").attr("transform",`translate(${this.st.margin.left},${this.st.margin.top})`)}createChart(t){const n=0===t.integrations.length;if(this.projIsEmpty.next(n),n)return void this.drawChart(null);this.st.mainG.remove(),this.st.mainG=this.st.svg.append("g").attr("transform",`translate(${this.st.margin.left},${this.st.margin.top})`);const c=this.scheduler.getStackedResourceData(t,this.st);this.drawChart(c)}drawChart(t){if(null===t)return void this.st.mainG.append("g").attr("width",this.st.innerWidth+this.st.margin.left+this.st.margin.right).attr("height",this.st.innerHeight+this.st.margin.top+this.st.margin.bottom).append("g").append("text").attr("class","missing-data").attr("y",(this.st.innerHeight+this.st.margin.top+this.st.margin.bottom)/3+10).attr("x",(this.st.innerWidth+this.st.margin.left+this.st.margin.right)/2+100).style("text-anchor","end").text("No data exists for Stacked Resources");const n=[];for(const y in t[0])"endDate"!==y&&"midDate"!==y&&"startDate"!==y&&n.push(y);const c=v.tiA().rangeRound([0,this.st.innerWidth]),l=v.BYU().rangeRound([this.st.innerHeight,0]),g=v.PKp(v.Cn1),A=v.LLu(c).scale(c).tickFormat(v.i$Z("%m-%d-%Y")),_=v.Khx(l).scale(l),w=v.knu().keys(n)(t);c.domain(w[0].map(y=>y.data.midDate)),l.domain([0,v.Fp7(w[w.length-1],y=>y[1])]).nice();const I=[],b=this.st.mainG.selectAll("layer").data(w).enter().append("g").attr("class","layer").style("fill",(y,x)=>(I.push(x),g(x.toString()))).attr("pos",(y,x)=>n[x].toString()).attr("index",(y,x)=>x.toString());b.selectAll("rect").data(y=>y).enter().append("rect").attr("x",y=>c(y.data.midDate.toString())).attr("y",y=>l(y[1])).attr("bottom",y=>y[0]).attr("top",y=>y[1]).attr("height",y=>l(y[0])-l(y[1])).attr("width",c.bandwidth()-1),b.selectAll("rect").call(v.ohM().on("drag",y=>{})),this.st.showAxes&&(this.st.mainG.append("g").attr("class","axis axis--x").attr("transform",`translate(0,${this.st.innerHeight})`).call(A).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)"),this.st.mainG.append("g").attr("class","axis axis--y").attr("transform",`translate(${this.st.innerWidth},0)`).call(_))}static#t=this.\u0275fac=function(n){return new(n||o)(i.LFG(S.Ou),i.LFG(i.R0b),i.LFG(a))};static#e=this.\u0275prov=i.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();const p=["chart"];let d=(()=>{class o{constructor(){this.ui=(0,i.f3M)(f),this.isEmpty=new O.X(!0)}ngOnInit(){this.ui.setProjIsEmpty(this.isEmpty),this.project?this.ui.renderStatic(this.width,this.height,this.margin,this.showAxes,this.project,this.barWidth,this.chart.nativeElement):this.ui.init(this.width,this.height,this.margin,this.showAxes,this.id,this.barWidth,this.chart.nativeElement)}ngOnDestroy(){this.ui.destroy()}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275cmp=i.Xpm({type:o,selectors:[["cp-stacked-resources"]],viewQuery:function(n,c){if(1&n&&i.Gf(p,7),2&n){let l;i.iGM(l=i.CRH())&&(c.chart=l.first)}},inputs:{height:"height",width:"width",barWidth:"barWidth",showAxes:"showAxes",id:"id",margin:"margin",project:"project"},features:[i._Bn([f])],decls:3,vars:0,consts:[[1,"stacked-resources-component-wrapper"],[1,"stacked-resources-container"],["chart",""]],template:function(n,c){1&n&&(i.TgZ(0,"div",0),i._UZ(1,"div",1,2),i.qZA())},styles:["cp-stacked-resources .stacked-resources-container svg{opacity:.7;background-color:#fff}cp-stacked-resources .stacked-resources-container svg text.missing-data{font-weight:700}\n"],encapsulation:2})}return o})()},9810:(k,T,r)=>{r.d(T,{M:()=>S});var i=r(6814),O=r(9212);let S=(()=>{class v{static#t=this.\u0275fac=function(a){return new(a||v)};static#e=this.\u0275mod=O.oAB({type:v});static#i=this.\u0275inj=O.cJS({imports:[i.ez]})}return v})()},1339:(k,T,r)=>{r.d(T,{Z:()=>v});class i{constructor(m){null!=m&&m.profile.planned_completion_date?this.endDate=new Date(m.profile.planned_completion_date).getTime():(this.endDate=null,this.duration=0,this.startDate=null),this.duration=m.profile.duration??0,this.activityId=m.profile.id;const a=new Date(m.profile.planned_completion_date??"").getTime()-864e5*this.duration;this.startDate=a}isOverlap(m,a){return!(!this.startDate||!this.endDate)&&(this.startDate<m&&this.endDate>a||this.startDate>m&&this.startDate<a||this.endDate>m&&this.endDate<a||this.startDate>m&&this.endDate<a)}}class O{constructor(){this.name="",this.schedule=[]}scheduleActivity(m){let a=!0;for(const f of this.schedule)a=a&&!this.isOverlap(f,m);if(a){const f=new i(m);return this.schedule.push(f),!0}return!1}isOverlap(m,a){if(!a.profile.planned_completion_date||void 0===a.profile.duration)return!1;const f=new Date(a.profile.planned_completion_date),p=new Date(f.getTime()-864e5*a.profile.duration);return m.isOverlap(p.getTime(),f.getTime())}}var S=r(9212);let v=(()=>{class D{constructor(){}sortDummiesLast(a){const f=a.activities.sort((o,s)=>o.profile.id-s.profile.id),p=f.filter(o=>!o.chartInfo.isDummy||null!==o.chartInfo.milestoneNodeId);f.filter(o=>o.chartInfo.isDummy&&null===o.chartInfo.milestoneNodeId).forEach(o=>p.push(o)),a.activities=p}reorderIds(a){a.activities.sort((o,s)=>o.profile.id-s.profile.id);const f=a.activities.filter(o=>null!==o.profile.planned_completion_date),p=a.activities.filter(o=>null===o.profile.planned_completion_date),d=f.concat(p);a.activities=d,a.activities.forEach((o,s)=>{o.profile.sortOrder=s}),a.activities.forEach((o,s)=>{o.profile.sortOrder=s})}sortById(a){a.activities.sort((f,p)=>f.profile.id-p.profile.id),a.activities.forEach(f=>f.assign.isStartBranch=!1)}sortByBranches(a){const p=a.activities.filter(t=>t.assign.phases.length>0).length>0;let d=[];const o=a.activities.filter(t=>null!==t.profile.planned_completion_date&&0!==t.profile.duration),s=a.activities.filter(t=>null===t.profile.planned_completion_date||0===t.profile.duration);if(this.sortActivitiesForResources(o),!0===p)a.phases.map(c=>c.name).filter((c,l,g)=>g.indexOf(c)===l).forEach(c=>{const l=o.filter(A=>void 0!==A.assign.phases.find(w=>w.name===c)),g=this.assignResources(l);d.push(g)});else{const t=this.assignResources(o);d.push(t)}d=d.filter(t=>void 0!==t),this.sortActivities(a,d,s)}sortActivities(a,f,p){const d=[];f.forEach(o=>{o.forEach(s=>{const t=s.schedule.sort((c,l)=>(c.startDate??0)-(l.startDate??0));let n=0;t.forEach(c=>{const l=a.activities.find(g=>g.profile.id===c.activityId);null!=l&&(0===n&&(l.assign.isStartBranch=!0),d.push(l)),n++})})}),p.forEach(o=>{d.push(o)}),a.activities=d}getStartDate(a){return new Date(a.profile.planned_completion_date??"").getTime()-864e5*(a.profile.duration??0)}sortActivitiesForResources(a){return a.sort((f,p)=>this.getStartDate(f)-this.getStartDate(p)),a.sort((f,p)=>f.chartInfo.tf-p.chartInfo.tf),a}assignResources(a){if(!this.validateActivities(a))return[];const p=[];return a.forEach(d=>{!1===d.chartInfo.isDummy&&this.setResource(d,p)}),p}validateActivities(a){return a.filter(p=>this.validTimeframe(p)).length>0}validTimeframe(a){return!(null===a.profile.planned_completion_date||0===a.profile.duration)}setResource(a,f){if(0===f.length){const d=new O;return d.name="Resource 1",d.scheduleActivity(a),void f.push(d)}let p=!1;if(f.forEach(d=>{if(!p){const o=d.scheduleActivity(a);p=p||o}}),!p){const d=new O;d.name="Resource "+(f.length+1),d.scheduleActivity(a),f.push(d)}}static#t=this.\u0275fac=function(f){return new(f||D)};static#e=this.\u0275prov=S.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"})}return D})()},155:(k,T,r)=>{r.d(T,{v:()=>f});var i=r(9862),O=r(7398),S=r(7631),v=r(9500),D=r(2119),m=r(3830),a=r(9212);let f=(()=>{class p{constructor(o,s){this.http=o,this.projectSerializer=s}compileMsProject(o){const s=new FormData;return s.append("file",o,o.name),this.http.post((0,v.Z)(S.N.mappingApi,m.sv),s).pipe((0,O.U)(t=>(new D.z).fromJson(t)))}compileArrowGraph(o){const s=JSON.stringify(o),t=(new i.WM).set("Content-Type","application/json");return this.http.post((0,v.Z)(S.N.mappingApi,m.l0),s,{headers:t}).pipe((0,O.U)(n=>n?this.projectSerializer.fromJson(n):null))}autoAssignResourceCount(o,s=null){const n=JSON.stringify({project:o,resourceCount:s}),c=(new i.WM).set("Content-Type","application/json");return this.http.post((0,v.Z)(S.N.mappingApi,m.dO),n,{headers:c}).pipe((0,O.U)(l=>l?this.projectSerializer.fromJson(l):null))}static#t=this.\u0275fac=function(s){return new(s||p)(a.LFG(i.eN),a.LFG(D.z))};static#e=this.\u0275prov=a.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()},5300:(k,T,r)=>{r.d(T,{D:()=>f});var i=r(5861),O=r(1374),S=r(9397),v=r(3633),D=r(3830),m=r(9212),a=r(8962);let f=(()=>{class p{constructor(o,s,t,n){this.dashboard=o,this.projectApi=s,this.storageApi=t,this.nodeConnector=n}resolve(o){var s=this;return(0,i.Z)(function*(){if(s.dashboard.secondaryProject$.next(null),+o.params.id===D.ph){const t=yield s.storageApi.get(D._k);return null!==t&&(t.profile.view.autoZoom=!0,s.dashboard.cleanSlateForNewPage(t)),s.dashboard.activeProject$.pipe((0,O.P)()).toPromise()}return s.projectApi.get(o.params.id).pipe((0,S.b)(t=>{s.nodeConnector.connectArrowsToNodes(t),s.dashboard.activeProject$.next(t)}),(0,O.P)()).toPromise()})()}static#t=this.\u0275fac=function(s){return new(s||p)(m.LFG(v.Ou),m.LFG(v.$6),m.LFG(v.$y),m.LFG(a.E))};static#e=this.\u0275prov=m.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()},7649:(k,T,r)=>{r.d(T,{h:()=>a});var i=r(9212),O=r(8962),S=r(9011),v=r(1339),D=r(7808),m=r(1568);let a=(()=>{class f{constructor(d,o,s,t,n){this.nodeConstructor=d,this.riskCompiler=o,this.endNodesLocator=s,this.nodeArranger=t,this.activitySorter=n}compileProjectFromFile(d){this.nodeConstructor.connectArrowsToNodes(d),this.endNodesLocator.setStartEndNodesFromLongestPath(d),this.riskCompiler.compileRiskProperties(d),this.nodeArranger.arrangeNodes(d),this.activitySorter.sortDummiesLast(d)}static#t=this.\u0275fac=function(o){return new(o||f)(i.LFG(O.E),i.LFG(S.r),i.LFG(D.d),i.LFG(m.g),i.LFG(v.Z))};static#e=this.\u0275prov=i.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()},6140:(k,T,r)=>{r.d(T,{z:()=>m});var i=r(4734),O=r(1e3),S=r(3706),v=r(9844),D=r(9212);let m=(()=>{class a{constructor(){}autogeneratePcds(p){if(p.activities.length<1||!p.activities[0].profile.planned_completion_date)return;const d=p.activities[0].profile.planned_completion_date_dt;if(null!==d){const o=(0,i.Z)(d,p.activities[0].profile.duration??0);for(let s=1;s<p.activities.length;++s){const t=p.activities[s];if(t.chartInfo.target&&t.chartInfo.target.eft){t.profile.planned_completion_date=(0,O.Z)((0,S.Z)(o,+t.chartInfo.target.eft),v.R7),t.profile.planned_completion_date_dt=new Date(t.profile.planned_completion_date);const c=(0,i.Z)(t.profile.planned_completion_date_dt,t.profile.duration??0);t.profile.start_date=(0,O.Z)(c,v.R7),t.profile.start_date_dt=c}}}}static#t=this.\u0275fac=function(d){return new(d||a)};static#e=this.\u0275prov=D.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})()},6381:(k,T,r)=>{r.d(T,{XC:()=>ot,Bb:()=>ht,ZL:()=>Z});var i=r(9212),O=r(3680),S=r(6814),v=r(6702),D=r(3651),m=r(5643),a=r(2495),f=r(2831),p=r(6825),d=r(7394),o=r(8645),s=r(4911),t=r(3019),n=r(2096),c=r(2438),l=r(6028),g=r(8484),A=r(6223),_=r(4170),w=r(7921),I=r(4664),b=r(8180),y=r(2181),x=r(7398),L=r(9397),F=r(6321),R=r(5211),G=r(9360),U=r(8251),Y=r(2420),N=r(975),$=r(1631),X=r(4829);function H(P,W){return W?e=>(0,R.z)(W.pipe((0,b.q)(1),function M(){return(0,G.e)((P,W)=>{P.subscribe((0,U.x)(W,Y.Z))})}()),e.pipe(H(P))):(0,$.z)((e,h)=>(0,X.Xf)(P(e,h)).pipe((0,b.q)(1),(0,N.h)(e)))}var j=r(4825),Q=r(9388);const q=["panel"];function tt(P,W){if(1&P){const e=i.EpF();i.TgZ(0,"div",0,1),i.NdJ("@panelAnimation.done",function(u){i.CHM(e);const E=i.oxw();return i.KtG(E._animationDone.next(u))}),i.Hsn(2),i.qZA()}if(2&P){const e=W.id,h=i.oxw();i.Q6J("id",h.id)("ngClass",h._classList)("@panelAnimation",h.isOpen?"visible":"hidden"),i.uIk("aria-label",h.ariaLabel||null)("aria-labelledby",h._getPanelAriaLabelledby(e))}}const et=["*"],it=(0,p.X$)("panelAnimation",[(0,p.SB)("void, hidden",(0,p.oB)({opacity:0,transform:"scaleY(0.8)"})),(0,p.eR)(":enter, hidden => visible",[(0,p.ru)([(0,p.jt)("0.03s linear",(0,p.oB)({opacity:1})),(0,p.jt)("0.12s cubic-bezier(0, 0, 0.2, 1)",(0,p.oB)({transform:"scaleY(1)"}))])]),(0,p.eR)(":leave, visible => hidden",[(0,p.jt)("0.075s linear",(0,p.oB)({opacity:0}))])]);let st=0;class nt{constructor(W,e){this.source=W,this.option=e}}const V=new i.OlP("mat-autocomplete-default-options",{providedIn:"root",factory:function at(){return{autoActiveFirstOption:!1,autoSelectActiveOption:!1,hideSingleSelectionIndicator:!1,requireSelection:!1}}});let ot=(()=>{class P{get isOpen(){return this._isOpen&&this.showPanel}_setColor(e){this._color=e,this._setThemeClasses(this._classList)}set classList(e){this._classList=e&&e.length?(0,a.du)(e).reduce((h,u)=>(h[u]=!0,h),{}):{},this._setVisibilityClasses(this._classList),this._setThemeClasses(this._classList),this._elementRef.nativeElement.className=""}get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._syncParentProperties()}_syncParentProperties(){if(this.options)for(const e of this.options)e._changeDetectorRef.markForCheck()}constructor(e,h,u,E){this._changeDetectorRef=e,this._elementRef=h,this._defaults=u,this._activeOptionChanges=d.w0.EMPTY,this._visibleClass="mat-mdc-autocomplete-visible",this._hiddenClass="mat-mdc-autocomplete-hidden",this._animationDone=new i.vpe,this.showPanel=!1,this._isOpen=!1,this.displayWith=null,this.optionSelected=new i.vpe,this.opened=new i.vpe,this.closed=new i.vpe,this.optionActivated=new i.vpe,this._classList={},this.id="mat-autocomplete-"+st++,this.inertGroups=E?.SAFARI||!1,this.autoActiveFirstOption=!!u.autoActiveFirstOption,this.autoSelectActiveOption=!!u.autoSelectActiveOption,this.requireSelection=!!u.requireSelection,this._hideSingleSelectionIndicator=this._defaults.hideSingleSelectionIndicator??!1}ngAfterContentInit(){this._keyManager=new m.s1(this.options).withWrap().skipPredicate(this._skipPredicate),this._activeOptionChanges=this._keyManager.change.subscribe(e=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[e]||null})}),this._setVisibility()}ngOnDestroy(){this._keyManager?.destroy(),this._activeOptionChanges.unsubscribe(),this._animationDone.complete()}_setScrollTop(e){this.panel&&(this.panel.nativeElement.scrollTop=e)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options.length,this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(e){const h=new nt(this,e);this.optionSelected.emit(h)}_getPanelAriaLabelledby(e){return this.ariaLabel?null:this.ariaLabelledby?(e?e+" ":"")+this.ariaLabelledby:e}_setVisibilityClasses(e){e[this._visibleClass]=this.showPanel,e[this._hiddenClass]=!this.showPanel}_setThemeClasses(e){e["mat-primary"]="primary"===this._color,e["mat-warn"]="warn"===this._color,e["mat-accent"]="accent"===this._color}_skipPredicate(){return!1}static#t=this.\u0275fac=function(h){return new(h||P)(i.Y36(i.sBO),i.Y36(i.SBq),i.Y36(V),i.Y36(f.t4))};static#e=this.\u0275cmp=i.Xpm({type:P,selectors:[["mat-autocomplete"]],contentQueries:function(h,u,E){if(1&h&&(i.Suo(E,O.ey,5),i.Suo(E,O.K7,5)),2&h){let C;i.iGM(C=i.CRH())&&(u.options=C),i.iGM(C=i.CRH())&&(u.optionGroups=C)}},viewQuery:function(h,u){if(1&h&&(i.Gf(i.Rgc,7),i.Gf(q,5)),2&h){let E;i.iGM(E=i.CRH())&&(u.template=E.first),i.iGM(E=i.CRH())&&(u.panel=E.first)}},hostAttrs:["ngSkipHydration","",1,"mat-mdc-autocomplete"],inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],displayWith:"displayWith",autoActiveFirstOption:["autoActiveFirstOption","autoActiveFirstOption",i.VuI],autoSelectActiveOption:["autoSelectActiveOption","autoSelectActiveOption",i.VuI],requireSelection:["requireSelection","requireSelection",i.VuI],panelWidth:"panelWidth",disableRipple:["disableRipple","disableRipple",i.VuI],classList:["class","classList"],hideSingleSelectionIndicator:["hideSingleSelectionIndicator","hideSingleSelectionIndicator",i.VuI]},outputs:{optionSelected:"optionSelected",opened:"opened",closed:"closed",optionActivated:"optionActivated"},exportAs:["matAutocomplete"],features:[i._Bn([{provide:O.HF,useExisting:P}]),i.Xq5],ngContentSelectors:et,decls:1,vars:0,consts:[["role","listbox",1,"mat-mdc-autocomplete-panel","mdc-menu-surface","mdc-menu-surface--open",3,"id","ngClass"],["panel",""]],template:function(h,u){1&h&&(i.F$t(),i.YNc(0,tt,3,5,"ng-template"))},dependencies:[S.mk],styles:["div.mat-mdc-autocomplete-panel{box-shadow:0px 5px 5px -3px rgba(0, 0, 0, 0.2), 0px 8px 10px 1px rgba(0, 0, 0, 0.14), 0px 3px 14px 2px rgba(0, 0, 0, 0.12);width:100%;max-height:256px;visibility:hidden;transform-origin:center top;overflow:auto;padding:8px 0;border-radius:4px;box-sizing:border-box;position:static;background-color:var(--mat-autocomplete-background-color)}.cdk-high-contrast-active div.mat-mdc-autocomplete-panel{outline:solid 1px}.cdk-overlay-pane:not(.mat-mdc-autocomplete-panel-above) div.mat-mdc-autocomplete-panel{border-top-left-radius:0;border-top-right-radius:0}.mat-mdc-autocomplete-panel-above div.mat-mdc-autocomplete-panel{border-bottom-left-radius:0;border-bottom-right-radius:0;transform-origin:center bottom}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-visible{visibility:visible}div.mat-mdc-autocomplete-panel.mat-mdc-autocomplete-hidden{visibility:hidden}mat-autocomplete{display:none}"],encapsulation:2,data:{animation:[it]},changeDetection:0})}return P})();const rt={provide:A.JU,useExisting:(0,i.Gpc)(()=>Z),multi:!0},z=new i.OlP("mat-autocomplete-scroll-strategy"),ct={provide:z,deps:[D.aV],useFactory:function lt(P){return()=>P.scrollStrategies.reposition()}};let Z=(()=>{class P{constructor(e,h,u,E,C,K,dt,pt,ut,mt,ft){this._element=e,this._overlay=h,this._viewContainerRef=u,this._zone=E,this._changeDetectorRef=C,this._dir=dt,this._formField=pt,this._document=ut,this._viewportRuler=mt,this._defaults=ft,this._componentDestroyed=!1,this._manuallyFloatingLabel=!1,this._viewportSubscription=d.w0.EMPTY,this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new o.x,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position="auto",this.autocompleteAttribute="off",this._aboveClass="mat-mdc-autocomplete-panel-above",this._overlayAttached=!1,this.optionSelections=(0,s.P)(()=>{const B=this.autocomplete?this.autocomplete.options:null;return B?B.changes.pipe((0,w.O)(B),(0,I.w)(()=>(0,t.T)(...B.map(gt=>gt.onSelectionChange)))):this._zone.onStable.pipe((0,b.q)(1),(0,I.w)(()=>this.optionSelections))}),this._handlePanelKeydown=B=>{(B.keyCode===l.hY&&!(0,l.Vb)(B)||B.keyCode===l.LH&&(0,l.Vb)(B,"altKey"))&&(this._pendingAutoselectedOption&&(this._updateNativeInputValue(this._valueBeforeAutoSelection??""),this._pendingAutoselectedOption=null),this._closeKeyEventStream.next(),this._resetActiveItem(),B.stopPropagation(),B.preventDefault())},this._trackedModal=null,this._scrollStrategy=K}ngAfterViewInit(){const e=this._getWindow();typeof e<"u"&&this._zone.runOutsideAngular(()=>e.addEventListener("blur",this._windowBlurHandler))}ngOnChanges(e){e.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const e=this._getWindow();typeof e<"u"&&e.removeEventListener("blur",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete(),this._clearFromModal()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay(),this._floatLabel(),this._trackedModal&&(0,m.Zf)(this._trackedModal,"aria-owns",this.autocomplete.id)}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this._zone.run(()=>{this.autocomplete.closed.emit()}),this.autocomplete._isOpen=this._overlayAttached=!1,this._pendingAutoselectedOption=null,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._updatePanelState(),this._componentDestroyed||this._changeDetectorRef.detectChanges(),this._trackedModal)&&(0,m.iD)(this._trackedModal,"aria-owns",this.autocomplete.id)}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return(0,t.T)(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe((0,y.h)(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe((0,y.h)(()=>this._overlayAttached)):(0,n.of)()).pipe((0,x.U)(e=>e instanceof O.rN?e:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return(0,t.T)((0,c.R)(this._document,"click"),(0,c.R)(this._document,"auxclick"),(0,c.R)(this._document,"touchend")).pipe((0,y.h)(e=>{const h=(0,f.sA)(e),u=this._formField?this._formField._elementRef.nativeElement:null,E=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&h!==this._element.nativeElement&&this._document.activeElement!==this._element.nativeElement&&(!u||!u.contains(h))&&(!E||!E.contains(h))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(h)}))}writeValue(e){Promise.resolve(null).then(()=>this._assignOptionValue(e))}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this._element.nativeElement.disabled=e}_handleKeydown(e){const h=e.keyCode,u=(0,l.Vb)(e);if(h===l.hY&&!u&&e.preventDefault(),this.activeOption&&h===l.K5&&this.panelOpen&&!u)this.activeOption._selectViaInteraction(),this._resetActiveItem(),e.preventDefault();else if(this.autocomplete){const E=this.autocomplete._keyManager.activeItem,C=h===l.LH||h===l.JH;h===l.Mf||C&&!u&&this.panelOpen?this.autocomplete._keyManager.onKeydown(e):C&&this._canOpen()&&this.openPanel(),(C||this.autocomplete._keyManager.activeItem!==E)&&(this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0),this.autocomplete.autoSelectActiveOption&&this.activeOption&&(this._pendingAutoselectedOption||(this._valueBeforeAutoSelection=this._element.nativeElement.value),this._pendingAutoselectedOption=this.activeOption,this._assignOptionValue(this.activeOption.value)))}}_handleInput(e){let h=e.target,u=h.value;"number"===h.type&&(u=""==u?null:parseFloat(u)),this._previousValue!==u&&(this._previousValue=u,this._pendingAutoselectedOption=null,(!this.autocomplete||!this.autocomplete.requireSelection)&&this._onChange(u),u||this._clearPreviousSelectedOption(null,!1),this._canOpen()&&this._document.activeElement===e.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_handleClick(){this._canOpen()&&!this.panelOpen&&this.openPanel()}_floatLabel(e=!1){this._formField&&"auto"===this._formField.floatLabel&&(e?this._formField._animateAndLockLabel():this._formField.floatLabel="always",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField&&(this._formField.floatLabel="auto"),this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){const e=this._zone.onStable.pipe((0,b.q)(1)),h=this.autocomplete.options.changes.pipe((0,L.b)(()=>this._positionStrategy.reapplyLastPosition()),function J(P,W=F.z){const e=(0,j.H)(P,W);return H(()=>e)}(0));return(0,t.T)(e,h).pipe((0,I.w)(()=>(this._zone.run(()=>{const u=this.panelOpen;this._resetActiveItem(),this._updatePanelState(),this._changeDetectorRef.detectChanges(),this.panelOpen&&this._overlayRef.updatePosition(),u!==this.panelOpen&&(this.panelOpen?this._emitOpened():this.autocomplete.closed.emit())}),this.panelClosingActions)),(0,b.q)(1)).subscribe(u=>this._setValueAndClose(u))}_emitOpened(){this.autocomplete.opened.emit()}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_assignOptionValue(e){const h=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(e):e;this._updateNativeInputValue(h??"")}_updateNativeInputValue(e){e||this._clearPreviousSelectedOption(null,!1),this._formField?this._formField._control.value=e:this._element.nativeElement.value=e,this._previousValue=e}_setValueAndClose(e){const h=this.autocomplete,u=e?e.source:this._pendingAutoselectedOption;u?(this._clearPreviousSelectedOption(u),this._assignOptionValue(u.value),this._onChange(u.value),h._emitSelectEvent(u),this._element.nativeElement.focus()):h.requireSelection&&this._element.nativeElement.value!==this._valueOnAttach&&(this._clearPreviousSelectedOption(null),this._assignOptionValue(null),h._animationDone?h._animationDone.pipe((0,b.q)(1)).subscribe(()=>this._onChange(null)):this._onChange(null)),this.closePanel()}_clearPreviousSelectedOption(e,h){this.autocomplete?.options?.forEach(u=>{u!==e&&u.selected&&u.deselect(h)})}_attachOverlay(){let e=this._overlayRef;e?(this._positionStrategy.setOrigin(this._getConnectedElement()),e.updateSize({width:this._getPanelWidth()})):(this._portal=new g.UE(this.autocomplete.template,this._viewContainerRef,{id:this._formField?.getLabelId()}),e=this._overlay.create(this._getOverlayConfig()),this._overlayRef=e,this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&e&&e.updateSize({width:this._getPanelWidth()})})),e&&!e.hasAttached()&&(e.attach(this._portal),this._valueOnAttach=this._element.nativeElement.value,this._closingActionsSubscription=this._subscribeToClosingActions());const h=this.panelOpen;this.autocomplete._isOpen=this._overlayAttached=!0,this.autocomplete._setColor(this._formField?.color),this._updatePanelState(),this._applyModalPanelOwnership(),this.panelOpen&&h!==this.panelOpen&&this._emitOpened()}_updatePanelState(){if(this.autocomplete._setVisibility(),this.panelOpen){const e=this._overlayRef;this._keydownSubscription||(this._keydownSubscription=e.keydownEvents().subscribe(this._handlePanelKeydown)),this._outsideClickSubscription||(this._outsideClickSubscription=e.outsidePointerEvents().subscribe())}else this._keydownSubscription?.unsubscribe(),this._outsideClickSubscription?.unsubscribe(),this._keydownSubscription=this._outsideClickSubscription=null}_getOverlayConfig(){return new D.X_({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir??void 0,panelClass:this._defaults?.overlayPanelClass})}_getOverlayPosition(){const e=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(e),this._positionStrategy=e,e}_setStrategyPositions(e){const h=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],u=this._aboveClass,E=[{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom",panelClass:u},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom",panelClass:u}];let C;C="above"===this.position?E:"below"===this.position?h:[...h,...E],e.withPositions(C)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const e=this.autocomplete;if(e.autoActiveFirstOption){let h=-1;for(let u=0;u<e.options.length;u++)if(!e.options.get(u).disabled){h=u;break}e._keyManager.setActiveItem(h)}else e._keyManager.setActiveItem(-1)}_canOpen(){const e=this._element.nativeElement;return!e.readOnly&&!e.disabled&&!this.autocompleteDisabled}_getWindow(){return this._document?.defaultView||window}_scrollToOption(e){const h=this.autocomplete,u=(0,O.CB)(e,h.options,h.optionGroups);if(0===e&&1===u)h._setScrollTop(0);else if(h.panel){const E=h.options.toArray()[e];if(E){const C=E._getHostElement(),K=(0,O.jH)(C.offsetTop,C.offsetHeight,h._getScrollTop(),h.panel.nativeElement.offsetHeight);h._setScrollTop(K)}}}_applyModalPanelOwnership(){const e=this._element.nativeElement.closest('body > .cdk-overlay-container [aria-modal="true"]');if(!e)return;const h=this.autocomplete.id;this._trackedModal&&(0,m.iD)(this._trackedModal,"aria-owns",h),(0,m.Zf)(e,"aria-owns",h),this._trackedModal=e}_clearFromModal(){this._trackedModal&&((0,m.iD)(this._trackedModal,"aria-owns",this.autocomplete.id),this._trackedModal=null)}static#t=this.\u0275fac=function(h){return new(h||P)(i.Y36(i.SBq),i.Y36(D.aV),i.Y36(i.s_b),i.Y36(i.R0b),i.Y36(i.sBO),i.Y36(z),i.Y36(Q.Is,8),i.Y36(_.G_,9),i.Y36(S.K0,8),i.Y36(v.rL),i.Y36(V,8))};static#e=this.\u0275dir=i.lG2({type:P,selectors:[["input","matAutocomplete",""],["textarea","matAutocomplete",""]],hostAttrs:[1,"mat-mdc-autocomplete-trigger"],hostVars:7,hostBindings:function(h,u){1&h&&i.NdJ("focusin",function(){return u._handleFocus()})("blur",function(){return u._onTouched()})("input",function(C){return u._handleInput(C)})("keydown",function(C){return u._handleKeydown(C)})("click",function(){return u._handleClick()}),2&h&&i.uIk("autocomplete",u.autocompleteAttribute)("role",u.autocompleteDisabled?null:"combobox")("aria-autocomplete",u.autocompleteDisabled?null:"list")("aria-activedescendant",u.panelOpen&&u.activeOption?u.activeOption.id:null)("aria-expanded",u.autocompleteDisabled?null:u.panelOpen.toString())("aria-controls",u.autocompleteDisabled||!u.panelOpen||null==u.autocomplete?null:u.autocomplete.id)("aria-haspopup",u.autocompleteDisabled?null:"listbox")},inputs:{autocomplete:["matAutocomplete","autocomplete"],position:["matAutocompletePosition","position"],connectedTo:["matAutocompleteConnectedTo","connectedTo"],autocompleteAttribute:["autocomplete","autocompleteAttribute"],autocompleteDisabled:["matAutocompleteDisabled","autocompleteDisabled",i.VuI]},exportAs:["matAutocompleteTrigger"],features:[i._Bn([rt]),i.Xq5,i.TTD]})}return P})(),ht=(()=>{class P{static#t=this.\u0275fac=function(h){return new(h||P)};static#e=this.\u0275mod=i.oAB({type:P});static#i=this.\u0275inj=i.cJS({providers:[ct],imports:[D.U8,O.Ng,O.BQ,S.ez,v.ZD,O.Ng,O.BQ]})}return P})()}}]);