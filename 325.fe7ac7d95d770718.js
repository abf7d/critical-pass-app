"use strict";(self.webpackChunkcritical_web=self.webpackChunkcritical_web||[]).push([[325],{2357:(qt,Ot,it)=>{it.d(Ot,{w:()=>ce});var S=it(9212),m=it(3920),et=it(4595),z=it(5619),X=it(2181),K=it(3633),Z=it(4745),$=it(9989);let st=(()=>{class G{constructor(){}getNodeById(s,f){return f.integrations.find(v=>v.id===s)}getInEdges(s,f){return f.activities.filter(v=>v.chartInfo.target_id===s)}getOutEdges(s,f){return f.activities.filter(v=>v.chartInfo.source_id===s)}joinNodes(s,f,v){const M=this.getInEdges(s.id,v),P=this.getOutEdges(s.id,v);for(const D of M)D.chartInfo.target_id=f.id,D.chartInfo.target=f;for(const D of P)D.chartInfo.source_id=f.id,D.chartInfo.source=f;v.integrations.splice(v.integrations.indexOf(s),1)}splitUpNode(s,f){if(null==s)return null;const v=this.getInEdges(s.id,f),M=this.getOutEdges(s.id,f);let P=Math.max(...f.integrations.map(L=>L.id));const D=s.y,q=s.x,ht=v.length,ct=new Map,T=new Map;let H=0;v.forEach(L=>{P++;const O=D-6*(ht-H),R=(new $.i).new(P,P.toString(),0,q,O);L.chartInfo.target_id=P,L.chartInfo.target=R,f.integrations.push(R),T.set(P,R),H++,L.chartInfo.dPath=void 0});const yt=M.length;return H=0,M.forEach(L=>{P++;const O=D+6*(yt-H),R=(new $.i).new(P,P.toString(),0,q,O);L.chartInfo.source_id=P,L.chartInfo.source=R,f.integrations.push(R),ct.set(P,R),L.chartInfo.dPath=void 0}),f.integrations.splice(f.integrations.indexOf(s),1),{sources:ct,targets:T}}static#t=this.\u0275fac=function(f){return new(f||G)};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})();var ot=it(4961),mt=it(9304);let dt=(()=>{class G{constructor(){this.blockDelete=!1,this.selected_node=null,this.last_selected_node=null,this.activity_created=null,this.selected_link=null,this.links=null,this.mousedown_node=null,this.drag_node=null,this.mouseover_node=null,this.mouseup_node=null,this.mousedown_link=null,this.ctrl_down=!1,this.lastKeyDown=null,this.macMetaDown=!1,this.allowDeletes=!0,this.width=null,this.height=null,this.prevProjId=null,this.nodeRisk=new Map,this.arrowRisk=new Map}static#t=this.\u0275fac=function(f){return new(f||G)};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})();var Pt=it(9127);let rt=(()=>{class G{constructor(s,f,v){this.st=s,this.actBuilder=f,this.msFactory=v}addProjectActivity(s,f,v){const P=Math.max(...v.activities.map(q=>q.profile.id),0)+1,D=(new mt.w).new(P,P.toString(),s.id,f.id,0,0);return D.chartInfo.isDummy=v.profile.view.createAsDummy,D.chartInfo.source=s,D.chartInfo.target=f,D.subProject.subGraphId=-1,D.profile.sortOrder=P,v.activities.push(D),v.profile.view.selectedActivity=D,D}handleNodeCreation(s,f,v){if(this.st.blockDelete=!1,s||this.st.mousedown_node||this.st.mousedown_link)return!1;this.clearSelectedLink(v),this.clearSelectedNode(v);const M=Math.max(...v.integrations.map(D=>D.id),0)+1,P=(new $.i).new(M,M.toString(),0,f[0],f[1]);return P.x=Math.round(f[0]),P.y=Math.round(f[1]),v.integrations.push(P),!0}addFastActivity(s,f,v,M){const P=s.key,q=s.target.value.trim();if("Enter"===P&&""!==q){const ht=q.split(","),ct=ht[0].trim();let T=0;if(ht.length>1){const H=ht[1].trim();isNaN(+H)||(T=+H)}return f.profile.view.autoZoom=!0,this.actBuilder.addActivity(f,ct,T,v,M)}return null}clearSelectedLink(s){const f=this.st.selected_link;f&&(f.chartInfo.isSelected=!1,this.st.selected_link=null),s.profile.view.selectedActivity=null}clearSelectedNode(s){const f=this.st.selected_node;f&&(f.selected=!1,this.st.selected_node=null),s.profile.view.selectedIntegration=null}updateStartEndNodes(s,f,v=null){let M;const P=this.filterOutMilestones(f);if("end"!==v&&f.profile.start===s.id){let D=0,q=null;M=P.forEach(ht=>{ht.chartInfo.source.id===s.id&&(D++,q=ht.chartInfo.target.id)}),1===D&&null!==q&&(f.profile.start=q)}if("start"!==v&&f.profile.end===s.id){let D=0,q=null;M=P.forEach(ht=>{ht.chartInfo.target.id===s.id&&(D++,q=ht.chartInfo.source.id)}),1===D&&null!==q&&(f.profile.end=q)}}filterOutMilestones(s){return s.activities.filter(f=>null===f.chartInfo.milestoneNodeId)}deleteSelectedNodeOrLink(s){const f=this.filterOutMilestones(s);if(!this.st.blockDelete){let v;if(null!=this.st.selected_node)this.updateStartEndNodes(this.st.selected_node,s),this.msFactory.removeMilestoneByNode(this.st.selected_node,s);else if(this.st.selected_link){const M=this.st.selected_link,P=s.activities.find(T=>T.profile.id===M.profile.id);if(void 0===P)return;const{source:D,target:q}=P.chartInfo;if(void 0===D||void 0===q)return;this.updateStartEndNodes(D,s,"start"),this.updateStartEndNodes(q,s,"end"),v=s.activities.indexOf(P),s.activities.splice(v,1);const ht=f.find(T=>T.chartInfo.source_id===D.id||T.chartInfo.target_id===D.id),ct=f.find(T=>T.chartInfo.source_id===q.id||T.chartInfo.target_id===q.id);if(null==ht){const T=s.integrations.indexOf(D);s.integrations.splice(T,1)}if(null==ct){const T=s.integrations.indexOf(q);s.integrations.splice(T,1)}}this.clearSelectedLink(s),this.st.selected_link=null,this.st.selected_node=null,s.profile.view.selectedActivity=null}}static#t=this.\u0275fac=function(f){return new(f||G)(S.LFG(dt),S.LFG(Pt.I),S.LFG(ot.y))};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})(),W=(()=>{class G{constructor(s,f,v,M){this.networkOps=s,this.msFactory=f,this.elFactory=v,this.st=M}checkDeselect(s){return!(!this.st.selected_node&&null===s.profile.view.selectedActivity&&null===s.profile.view.selectedIntegration&&!this.st.selected_link)}deselectActivity(s){s.activities.forEach(f=>f.chartInfo.isSelected=!1),s.profile.view.selectedActivity=null,this.st.selected_link=null,this.st.links?.classed("selected",!1)}filterOutMilestones(s){return s.activities.filter(f=>null===f.chartInfo.milestoneNodeId)}deselectNode(s){s.integrations.forEach(f=>f.selected=!1),s.profile.view.selectedActivity=null,s.profile.view.selectedIntegration=null,this.st.selected_node=null,this.st.links?.classed("selected",!1)}selectNode(s,f){f.integrations.forEach(v=>v.selected=v.id===s.id),f.profile.view.selectedIntegration=s}sortNodes(s,f){f.sort((v,M)=>v.id!==s.id?1:-1)}initNodeDragState(s,f,v){this.st.nodes.classed("selected",M=>s==M),this.deselectNode(v),s.selected||(s.selected=!0),this.st.nodes.select("circle").classed("active",!1),this.st.drag_node=s,this.sortNodes(this.st.drag_node,this.st.nodes)}deactivateSelectedNode(s,f){this.deselectNode(s),f.select("circle").classed("active",!1)}activateSelectedNode(s,f,v){f.classed("selected",s.selected=!0),this.st.selected_node=this.st.mousedown_node,this.st.last_selected_node=this.st.mousedown_node,this.selectNode(this.st.selected_node,v),f.select("circle").classed("active",!0)}hideDragLine(){this.st.drag_line.classed("hidden",!0).style("marker-end","")}updateDragLine(s){this.st.drag_line.style("marker-end","url(#end-arrow)").classed("hidden",!1).attr("d",`M${s.x},${s.y}L${s.x},${s.y}`)}createArrowEvent(s,f){if(!this.st.mousedown_node)return!1;if(this.hideDragLine(),this.st.mouseup_node=s,this.st.mouseup_node===this.st.mousedown_node)return this.resetState(),!1;this.st.nodes.selectAll("circle").attr("transform",D=>"");const v=this.st.mousedown_node,M=this.st.mouseup_node;if(v===M)return!1;let P=this.filterOutMilestones(f).filter(D=>D.chartInfo.source===v&&D.chartInfo.target===M)[0];if(!P){P=this.elFactory.addProjectActivity(v,M,f);const D=this.st.activity_created;null!=D&&"name"===f.profile.view.displayText&&setTimeout(()=>{D.next(!0)},100)}return this.st.selected_link=P,this.setLinkIsSelected(P,f,!0),null!=this.st.selected_node&&(this.st.selected_node.selected=!1),f.profile.view.selectedIntegration=null,this.st.selected_node=null,!0}setLinkIsSelected(s,f,v){s?.chartInfo&&(s.chartInfo.isSelected=v,f.profile.view.selectedActivity=s),v||(f.profile.view.selectedActivity=null)}resetState(){this.st.mousedown_node=null,this.st.mouseup_node=null,this.st.mousedown_link=null,this.st.drag_node=null}setNodeDownStates(s,f,v,M){this.deselectActivity(M),this.st.blockDelete=!1,f?this.initNodeDragState(s,v,M):(this.st.mousedown_node=s,this.st.nodes.select("circle").classed("active",!1),null!==this.st.selected_node&&this.st.mousedown_node.id===this.st.selected_node.id?this.deactivateSelectedNode(M,v):this.activateSelectedNode(s,v,M),this.updateDragLine(this.st.mousedown_node))}joinNodesOrCreateArrow(s,f){this.st.nodes.filter(D=>D==s);const M=this.st.mouseover_node;let P=!1;if(s.x=Math.round(s.x),s.y=Math.round(s.y),null!=M){const D=M.el.select("circle");P=this.joinNodesEvent(M.d,D,f),P||(P=this.createArrowEvent(M.d,f)),this.st.nodes?.classed("selected",!1)}return this.clearSelectionAndHideLine(),P}clearSelectionAndHideLine(){return this.st.mousedown_node&&(this.st.drag_line.classed("hidden",!0).style("marker-end",""),this.st.nodes?.classed("selected",!1)),this.st.mainG.classed("active",!1),this.resetState()}setMouseOverNodeStates(s,f){this.st.mouseover_node={d:s,el:f},null!=this.st.drag_node&&s!==this.st.drag_node&&f.select("circle").attr("transform",v=>s===v?"scale(1.3)":""),this.st.mousedown_node&&s!==this.st.mousedown_node&&f.select("circle").attr("transform",v=>s===v?"scale(1.1)":"")}clearMouseOverNodeStates(s,f){this.st.mouseover_node=null,null!=this.st.drag_node&&s!==this.st.drag_node&&f.select("circle").attr("transform",v=>""),this.st.mousedown_node&&s!==this.st.mousedown_node&&f.select("circle").attr("transform",v=>"")}setSelectedLinkState(s,f,v){return!f&&(this.st.blockDelete=!1,this.st.mousedown_link=s,null!==this.st.selected_link&&this.st.mousedown_link.profile.id===this.st.selected_link.profile.id?(this.setLinkIsSelected(null,v,!1),this.st.links.classed("selected",!1),this.st.selected_link=null):(this.st.selected_link=this.st.mousedown_link,this.setLinkIsSelected(this.st.selected_link,v,!0),this.st.links.classed("selected",M=>M===s)),null!=this.st.selected_node&&(this.st.selected_node.selected=!1),this.st.selected_node=null,v.profile.view.selectedIntegration=null,this.st.nodes.select("circle").classed("selected",!1),this.st.nodes.select("circle").classed("active",!1),!0)}joinNodesEvent(s,f,v){if(null!=this.st.drag_node){if(s===this.st.drag_node)return this.resetState(),!1;f.select("circle").attr("transform",D=>"");const M=this.st.drag_node,P=s;return P.id!==M.id&&!this.existsDirectConnectingLink(P.id,M.id,v)&&(this.st.drag_node=null,this.networkOps.joinNodes(P,M,v),!0)}return!1}existsDirectConnectingLink(s,f,v){return v.activities.some(M=>M.chartInfo.source_id===s&&M.chartInfo.target_id===f||M.chartInfo.source_id===f&&M.chartInfo.target_id===s)}makeDummy(){this.st.selected_node&&(this.st.selected_node.isDummy=!this.st.selected_node.isDummy)}makeMilestone(s){this.st.selected_node&&this.msFactory.createMilestone(s,this.st.selected_node)}splitUpNode(s,f){this.networkOps.splitUpNode(s,f),f.profile.view.selectedIntegration=null}static#t=this.\u0275fac=function(f){return new(f||G)(S.LFG(st),S.LFG(ot.y),S.LFG(rt),S.LFG(dt))};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})(),lt=(()=>{class G{constructor(s){this.st=s}getNodeCss(s,f){const v=this.filterOutMilestones(f);if(f.profile.view.showOrphaned){const M=v.filter(D=>D.chartInfo.source_id===s.id),P=v.filter(D=>D.chartInfo.target_id===s.id);return 0===M.length?"risk-end":0===P.length?"risk-start":"unprocessed risk-0"}return null===s.lft?"unprocessed risk-"+s.risk:"risk-"+s.risk}getNodeName(s){return s.isMilestone?s.milestoneName:s.name}getTextAboveNode(s,f){return"label"===f.profile.view.showEftLft&&s.label?s.label:"eft"===f.profile.view.showEftLft&&s.eft?s.eft+"/"+s.lft:"pcd"===f.profile.view.showEftLft&&null!=s.maxPCD?s.maxPCD:"milestone"===f.profile.view.showEftLft&&s.milestoneActivity?s.milestoneActivity.profile.name:""}getTagColor(s,f){if(s.tags){const v=s.tags.find(M=>M.name===f);if(v){const M=v.tags[0];return M?M.backgroundcolor:et.xU.UNPROCESSED}return et.xU.UNPROCESSED}return et.xU.UNPROCESSED}getRiskColor(s){let f;switch(s){case et.uF.NEW:f=et.xU.NEW;break;case et.uF.LOW:f=et.xU.LOW;break;case et.uF.MEDIUM:f=et.xU.MEDIUM;break;case et.uF.HIGH:f=et.xU.HIGH;break;case et.uF.CRITICAL:f=et.xU.CRITICAL;break;default:f=et.xU.UNPROCESSED}return f}getArrowColor(s,f,v,M,P){const D=v.profile.view.selectedTagGroup;if(D)return this.getTagColor(f,D);let q=f.chartInfo.risk;const ht=M.get(f.profile.id);!P&&s&&M&&void 0!==ht&&(q=ht);let ct=this.getRiskColor(q);return null===f.chartInfo.tf&&(ct=et.xU.UNPROCESSED),f.chartInfo.tf===1/0&&(ct=et.xU.UNPROCESSED),v.profile.view.showOrphaned&&(ct=et.xU.UNPROCESSED),(v.profile.view.fade&&f.processInfo.completed||v.profile.view.fade&&f.processInfo.completed)&&(ct=et.xU.COMPLETED),ct}getWrappedTextColor(s,f){const v=this.getArrowColor(!1,s,f,new Map,!0),M=this.expandColor(v);return this.darkenColor(M,.3)}expandColor(s){return 4===s.length?"#"+s[1]+s[1]+s[2]+s[2]+s[3]+s[3]:s}darkenColor(s,f){const v=parseInt(s.slice(1,3),16),M=parseInt(s.slice(3,5),16),P=parseInt(s.slice(5,7),16),D=Math.floor(v*(1-f)),q=Math.floor(M*(1-f)),ht=Math.floor(P*(1-f));return"#"+D.toString(16).padStart(2,"0")+q.toString(16).padStart(2,"0")+ht.toString(16).padStart(2,"0")}getNodeColor(s,f,v,M,P){if(v.profile.view.selectedTagGroup)return et.xU.UNASSIGNED;let q=f.risk;const ht=M.get(f.id);!P&&s&&M&&void 0!==ht&&(q=ht);let ct=this.getRiskColor(q);if((null===f.lft||f.lft===1/0)&&(ct=et.xU.UNPROCESSED),v.profile.view.fade&&f.completed&&(ct=et.xU.COMPLETED),v.profile.view.showOrphaned){const T=v.activities.filter(yt=>yt.chartInfo.source_id===f.id),H=v.activities.filter(yt=>yt.chartInfo.target_id===f.id);ct=et.xU.UNPROCESSED,0===T.length&&(ct=et.xU.END),0===H.length&&(ct=et.xU.START)}return ct}getLinkCss(s,f){return f.profile.view.selectedTagGroup?"assigning":null==s.chartInfo.tf?s.chartInfo.isDummy?"dummy unprocessed":"unprocessed":f.profile.view.showOrphaned?"risk-0":s.chartInfo.isDummy?"dummy risk-"+s.chartInfo.risk:"risk-"+s.chartInfo.risk}isCompleted(s,f){return f.profile.view.markCompleted&&s.processInfo.completed}isHighlighted(s,f){return s.subProject.subGraphId===f.profile.view.activeSubProjectId}isSelected(s,f){return s===this.st.selected_link||s===f.profile.view.selectedActivity}getLinkEndMarker(s,f){return null==s.chartInfo.tf||s.chartInfo.tf===1/0||f.profile.view.showOrphaned?"url(#end-u)":f.profile.view.markCompleted&&s.processInfo.completed?"url(#end-completed)":`url(#end-${s.chartInfo.risk})`}getLowerLinkText(s,f){return"float"!==f.profile.view.lowerArrowText||null===s.chartInfo.ff||null===s.chartInfo.tf||s.chartInfo.isDummy?"subproj"===f.profile.view.lowerArrowText&&(null!==s.subProject.subGraphLoaded||s.subProject.isParent||s.risk.criticalCount>0||s.risk.greenCount>0)?`g${s.risk.greenCount}  y${s.risk.yellowCount}  r${s.risk.redCount}  c${s.risk.criticalCount}`:"":s.chartInfo.ff+"/"+s.chartInfo.tf}getLowerLinkTextYPos(s,f){return void 0===s.chartInfo.source?.y||void 0===s.chartInfo.target?.y?(console.error("getLowerLinkTextYPos link node is missing y position"),0):s.chartInfo.source.y+(s.chartInfo.target.y-s.chartInfo.source.y)/2+14}getLowerLinkTextXPos(s,f){return void 0===s.chartInfo.source?.x||void 0===s.chartInfo.target?.x?(console.error("getLowerLinkTextXPos link node is missing x position"),0):"subproj"===f.profile.view.lowerArrowText?s.chartInfo.source.x+(s.chartInfo.target.x-s.chartInfo.source.x)/2:s.chartInfo.source.x+(s.chartInfo.target.x-s.chartInfo.source.x)/2-10}getActivityFontSize(s,f){return"subproj"===f.profile.view.lowerArrowText?"9px":"8px"}getLinkTextPosY(s,f){return void 0===s.chartInfo.source?.y||void 0===s.chartInfo.target?.y?(console.error("getLinkTextPosY link node is missing y position"),0):"name"===f.profile.view.displayText?s.chartInfo.source.y+(s.chartInfo.target.y-s.chartInfo.source.y)/2-14:s.chartInfo.source.y+(s.chartInfo.target.y-s.chartInfo.source.y)/2-6}getLinkTextPosX(s,f){return void 0===s.chartInfo.source?.x||void 0===s.chartInfo.target?.x?(console.error("getLinkTextPosX link node is missing x position"),0):s.chartInfo.source.x+(s.chartInfo.target.x-s.chartInfo.source.x)/2-10}getLinkText(s,f){let v;if("id"===f.profile.view.displayText){if(!f.profile.view.showDummies&&s.chartInfo.isDummy)return"";v=s.profile.id}else if("duration"===f.profile.view.displayText)v=s.profile.duration;else if("name"===f.profile.view.displayText){if(s.chartInfo.isDummy&&!f.profile.view.showDummies)return"";v=s.profile.name}else{if("resource"===f.profile.view.displayText)return s.assign.resources.map(M=>M.name).join(", ");if("abbreviated"===f.profile.view.displayText){if(s.chartInfo.isDummy&&!f.profile.view.showDummies)return"";if(+s.profile.name==+s.profile.id)return s.profile.id.toString();v=s.profile.id+" "+s.profile.name.split(" ").map(M=>M.substring(0,3)).join(" ")+" "+s.profile.duration+"d"}else if(f.profile.view.displayText.startsWith("tag")){const M=parseInt(f.profile.view.displayText.split(".")[1])??-1;if(-1===M)return s.assign.resources.map(P=>P.name).join(", ");{const P=s.tags?.find(D=>D.name===f.tags?.[M].name);if(P&&P.tags[0])return P.tags.map(q=>q.name).join(", ")}return""}}return v=this.getSubProjMarkerText(s,v?.toString()??""),v}getSubProjMarkerText(s,f){return null!==s.subProject.subGraphLoaded||s.subProject.isParent||s.risk.criticalCount>0||s.risk.greenCount>0?f+=":":-1!==s.subProject.subGraphId&&!s.chartInfo.isDummy&&(f+="*"),f}filterOutMilestones(s){return s.activities.filter(f=>null===f.chartInfo.milestoneNodeId)}static#t=this.\u0275fac=function(f){return new(f||G)(S.LFG(dt))};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})(),Y=(()=>{class G{constructor(s){this.st=s}nudgeGroup(s,f,v,M){this.moveNode(s,f),this.repositionConnectedArrows(),this.repositionArrowText("text.label",M),this.repositionArrowText("text.glow",M),this.repositionArrowText("foreignObject",M,null,-25,-15),this.repositionArrowFloatText(M)}updateGroupPosition(s,f){this.repositionConnectedArrows(f),this.repositionArrowText("text.label",s,f),this.repositionArrowText("text.glow",s,f),this.repositionArrowText("foreignObject",s,null,-25,-15),this.repositionArrowFloatText(s,f)}moveNode(s,f){this.st.nodes.filter(v=>v===this.st.drag_node).attr("transform",v=>(v.x+=s,v.y+=f,`translate(${v.x},${v.y})`))}repositionConnectedArrows(s=null){this.st.links.filter(f=>s?s.includes(f.chartInfo.source_id):f.chartInfo.source.selected).select("path").attr("d",f=>(f.chartInfo.dPath=void 0,this.getPath(f))),this.st.links.filter(f=>s?s.includes(f.chartInfo.target_id):f.chartInfo.target.selected).select("path").attr("d",f=>(f.chartInfo.dPath=void 0,this.getPath(f)))}repositionArrowText(s,f,v=null,M=0,P=0){this.st.links.filter(D=>v?v.includes(D.chartInfo.source.id)||v.includes(D.chartInfo.target.id):D.chartInfo.target.selected||D.chartInfo.source.selected).select(s).attr("y",D=>{const q=D.chartInfo;return"name"===f.profile.view.displayText?q.source.y+(q.target.y-q.source.y)/2-14:q.source.y+(q.target.y-q.source.y)/2-6+P}).attr("x",function(D){const q=D.chartInfo;return"name"===f.profile.view.displayText?q.source.x+(q.target.x-q.source.x)/4:q.source.x+(q.target.x-q.source.x)/2+M})}repositionArrowFloatText(s,f=null){this.st.links.filter(v=>f?f.includes(v.chartInfo.source.id)||f.includes(v.chartInfo.target.id):v.chartInfo.target.selected||v.chartInfo.source.selected).select("text.float").attr("y",v=>v.chartInfo.source.y+(v.chartInfo.target.y-v.chartInfo.source.y)/2+14).attr("x",v=>{const M=v.subProject,P=v.risk,D=v.chartInfo;return null!==M.subGraphLoaded||M.isParent||P.criticalCount>0||P.greenCount>0?D.source.x+(D.target.x-D.source.x)/2-25:D.source.x+(D.target.x-D.source.x)/2-3})}getPath(s){if(s.chartInfo.dPath)return s.chartInfo.dPath;const f=s.chartInfo.target.x-s.chartInfo.source.x,v=s.chartInfo.target.y-s.chartInfo.source.y,M=Math.sqrt(f*f+v*v),P=f/M,D=v/M;return"M"+(s.chartInfo.source.x+12*P)+","+(s.chartInfo.source.y+12*D)+"L"+(s.chartInfo.target.x-17*P)+","+(s.chartInfo.target.y-17*D)}setElPositions(s,f,v,M,P){this.st.ctrl_down?(this.st.drag_line.classed("hidden",!0).style("marker-end",""),this.nudgeGroup(f,v,M,P)):this.updateLinePos(s)}updateLinePos(s){const f=this.st.mousedown_node;f&&this.st.drag_line.attr("d",`M${f.x},${f.y}L${s[0]},${s[1]}`)}static#t=this.\u0275fac=function(f){return new(f||G)(S.LFG(dt))};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})(),gt=(()=>{class G{constructor(s,f,v,M){this.events=s,this.props=f,this.factory=v,this.positioner=M}getPath(s){return this.positioner.getPath(s)}onNodeGroupDrag(s,f,v,M,P){return this.positioner.setElPositions(s,f,v,M,P)}updateLinePos(s){return this.positioner.updateLinePos(s)}handleNodeCreation(s,f,v){return this.factory.handleNodeCreation(s,f,v)}deleteSelectedNodeOrLink(s){return this.factory.deleteSelectedNodeOrLink(s)}addFastActivity(s,f,v,M){return this.factory.addFastActivity(s,f,v,M)}getNodeName(s){return this.props.getNodeName(s)}getTextAboveNode(s,f){return this.props.getTextAboveNode(s,f)}getNodeColor(s,f,v,M,P){return this.props.getNodeColor(s,f,v,M,P)}isCompleted(s,f){return this.props.isCompleted(s,f)}isSelected(s,f){return this.props.isSelected(s,f)}isHighlighted(s,f){return this.props.isHighlighted(s,f)}getArrowColor(s,f,v,M,P){return this.props.getArrowColor(s,f,v,M,P)}getWrappedTextColor(s,f){return this.props.getWrappedTextColor(s,f)}getLinkTextPosY(s,f){return this.props.getLinkTextPosY(s,f)}getLinkTextPosX(s,f){return this.props.getLinkTextPosX(s,f)}getLowerLinkTextYPos(s,f){return this.props.getLowerLinkTextYPos(s,f)}getLowerLinkTextXPos(s,f){return this.props.getLowerLinkTextXPos(s,f)}getActivityFontSize(s,f){return this.props.getActivityFontSize(s,f)}getLinkText(s,f){return this.props.getLinkText(s,f)}getLinkEndMarker(s,f){return this.props.getLinkEndMarker(s,f)}getLinkCss(s,f){return this.props.getLinkCss(s,f)}getNodeCss(s,f){return this.props.getNodeCss(s,f)}getLowerLinkText(s,f){return this.props.getLowerLinkText(s,f)}setMouseDownLink(s,f,v){return this.events.setSelectedLinkState(s,f,v)}onNodeGroupMouseUp(s,f){return this.events.joinNodesOrCreateArrow(s,f)}onNodeGroupMouseDown(s,f,v,M){return this.events.setNodeDownStates(s,f,v,M)}onNodeMouseOver(s,f){this.events.setMouseOverNodeStates(s,f)}onNodeMouseOut(s,f){this.events.clearMouseOverNodeStates(s,f)}clearClassesAndHideLine(){return this.events.clearSelectionAndHideLine()}splitUpNode(s,f){return this.events.splitUpNode(s,f)}makeDummy(){return this.events.makeDummy()}makeMilestone(s){return this.events.makeMilestone(s)}deselectNode(s){return this.events.deselectNode(s)}deselectActivity(s){return this.events.deselectActivity(s)}checkDeselect(s){return this.events.checkDeselect(s)}updateGroupPosition(s,f){return this.positioner.updateGroupPosition(s,f)}static#t=this.\u0275fac=function(f){return new(f||G)(S.LFG(W),S.LFG(lt),S.LFG(rt),S.LFG(Y))};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})(),xt=(()=>{class G{constructor(s,f,v){this.dashboard=s,this.arrowController=f,this.st=v,this.transform={k:1,x:0,y:0},this.lassoStart=null,this.lassoEnd=null,this.pivotNode=null,this.clickCount=0,this.clickTimer=null,this.originalDragPoint=null,this.previousPos=null,this.skipDrag=!1}setTransform(s){this.transform=s}buildLasso(s){!0===s.profile.view.lassoOn?this.init(s,this.id):this.remove(this.id)}init(s,f){this.id=f,this.st.svg.selectAll(".lasso").remove(),this.mainG=this.st.svg,this.lassoG=this.st.svg.append("g"),this.lassoG.classed("lasso",!0),this.targetArea=this.lassoG.append("rect"),this.selectedNodes=s.profile.view.lassoedNodes,this.selectedActivities=s.profile.view.lassoedLinks,this.targetArea.attr("width","100%").attr("height","100%").style("fill","red").style("opacity",.1),this.project=s,this.dynPath=this.lassoG.append("path").attr("class","drawn"),this.closePath=this.lassoG.append("path").attr("class","loop_close"),this.originNode=this.lassoG.append("circle").attr("class","origin"),this.drawnCoords=[],this.tpath="";const v=m.ohM().filter(M=>!M.button).on("start",M=>this.dragstart(M)).on("drag",M=>this.dragmove(M)).on("end",()=>this.dragend());this.targetArea.call(v),this.st.nodes.classed("possible",M=>this.selectedNodes.indexOf(M.id)>-1),this.st.links.classed("possible",M=>this.selectedActivities.indexOf(M.profile.id)>-1),this.st.nodes.classed("pivot",M=>this.pivotNode?.id===M.id)}keydown(s){if(s.keyCode===Z.s.Ctrl&&!0===this.project?.profile.view.lassoOn){this.previousPos=null;const f=m.ohM().filter(v=>!v.button).on("start",this.nodeMoveDragStart).on("drag",v=>this.nodeMoveDragMove(v)).on("end",this.nodeMoveDragEnd);this.targetArea.call(f)}}keyup(s){s.keyCode===Z.s.Ctrl&&!0===this.project?.profile.view.lassoOn&&this.init(this.project,this.id)}nodeMoveDragStart(){}nodeMoveDragMove(s){const f=m.cx$(s,this.mainG.node()),[v,M]=this.unTransformPt(f);if(null!==this.pivotNode&&null!==this.originalDragPoint){const[P,D]=this.originalDragPoint;this.transformPoints([v-P,M-D]),this.arrowController.updateGroupPosition(this.project,this.selectedNodes)}else if(this.previousPos){const[P,D]=this.previousPos,q=v-P,ht=M-D;this.st.nodes.attr("transform",ct=>this.selectedNodes.indexOf(ct.id)>-1?(ct.x=ct.x+q,ct.y=ct.y+ht,`translate(${ct.x}, ${ct.y})`):`translate(${ct.x}, ${ct.y})`),this.arrowController.updateGroupPosition(this.project,this.selectedNodes)}this.previousPos=[v,M],this.originalDragPoint=[v,M]}nodeMoveDragEnd(){this.previousPos=null,this.originalDragPoint=null}remove(s){this.id=s,this.st.svg.selectAll(".lasso").remove()}isInsideNode(s){const[f,v]=s,M=this.project.integrations.find(P=>{const D=this.transformPt([P.x,P.y]);return Math.sqrt(Math.pow(f-D[0],2)+Math.pow(v-D[1],2))<20});if(M&&this.selectedNodes.indexOf(M.id)>-1)return this.pivotNode&&M&&this.pivotNode.id===M.id?void(this.pivotNode=null):(this.pivotNode=M??null,M);this.pivotNode=null}transformPoints(s){if(!this.pivotNode||!this.originalDragPoint)return;const[f,v]=s,[M,P]=this.originalDragPoint,D=M+f,q=P+v,ht=Math.sqrt(Math.pow(M-this.pivotNode.x,2)+Math.pow(P-this.pivotNode.y,2)),T=Math.sqrt(Math.pow(D-this.pivotNode.x,2)+Math.pow(q-this.pivotNode.y,2))/ht,H=Math.atan2(P-this.pivotNode.y,M-this.pivotNode.x),L=Math.atan2(q-this.pivotNode.y,D-this.pivotNode.x)-H;this.st.nodes.attr("transform",O=>{if(this.selectedNodes.indexOf(O.id)>-1){if(!this.pivotNode||void 0===this.pivotNode.x||void 0===this.pivotNode.y)return`translate(${O.x}, ${O.y})`;const R=O.x-this.pivotNode.x,nt=O.y-this.pivotNode.y;let pt=R*Math.cos(L)-nt*Math.sin(L),_t=R*Math.sin(L)+nt*Math.cos(L);pt*=T,_t*=T;const Ht=pt+this.pivotNode.x,Rt=_t+this.pivotNode.y;return O.x=Ht,O.y=Rt,`translate(${Ht}, ${Rt})`}return`translate(${O.x}, ${O.y})`})}dragstart(s){if(this.clickCount>0){console.log("double click detected!");const f=m.cx$(s,this.mainG.node());this.isInsideNode(f),this.clickCount=0,this.skipDrag=!0}this.clickTimer||(this.clickTimer=setTimeout(()=>{this.clickCount=0,clearTimeout(this.clickTimer),this.clickTimer=null},300)),this.clickCount++,this.drawnCoords=[],this.dynPath.attr("d",null),this.closePath.attr("d",null)}dragmove(s){if(this.skipDrag)return void(this.skipDrag=!1);const{x:f,y:v}=s,[M,P]=m.cx$(s,this.mainG.node());""===this.tpath?(this.tpath=this.tpath+"M "+M+" "+P,this.origin=[f,v],this.torigin=[M,P],this.originNode.attr("cx",M).attr("cy",P).attr("r",7).attr("display",null)):this.tpath=this.tpath+" L "+M+" "+P,this.drawnCoords.push([f,v]);const D=Math.sqrt(Math.pow(f-this.origin[0],2)+Math.pow(v-this.origin[1],2)),q="M "+M+" "+P+" L "+this.torigin[0]+" "+this.torigin[1];this.dynPath.attr("d",this.tpath),this.closePath.attr("d",q);const T=D<=75;this.selectedNodes=[],this.project.integrations.forEach(H=>{const L=this.transformPt([H.x,H.y]);this.pointInPolygon(L,this.drawnCoords)&&this.selectedNodes.push(H.id)}),this.st.nodes.classed("possible",H=>this.selectedNodes.indexOf(H.id)>-1),this.st.nodes.classed("pivot",H=>this.pivotNode?.id===H.id),this.closePath.attr("display",T?null:"none")}transformPt(s){return[s[0]*this.transform.k+this.transform.x,s[1]*this.transform.k+this.transform.y]}unTransformPt(s){return[s[0]/this.transform.k-this.transform.x,s[1]/this.transform.k-this.transform.y]}dragend(){this.tpath="",this.drawnCoords=[],this.dynPath.attr("d",null),this.closePath.attr("d",null),this.originNode.attr("display","none"),this.selectedActivities=[],this.selectActivities(),this.project.profile.view.isSubProjSelected=this.isSubProject(),this.project.profile.view.lassoedLinks=this.selectedActivities,this.project.profile.view.lassoedNodes=this.selectedNodes,this.project.profile.view.lassoStart=this.lassoStart,this.project.profile.view.lassoEnd=this.lassoEnd,this.lassoEnd=null,this.lassoStart=null,this.selectedNodes=[],this.dashboard.updateProject(this.project,!1)}isSubProject(){if(this.selectedNodes.length<3)return!1;const s=[],f=[];this.project.activities.forEach(T=>{this.selectedNodes.indexOf(T.chartInfo.target_id)>-1&&-1===this.selectedNodes.indexOf(T.chartInfo.source_id)&&s.push(T),this.selectedNodes.indexOf(T.chartInfo.source_id)>-1&&-1===this.selectedNodes.indexOf(T.chartInfo.target_id)&&f.push(T)});const v=[],M=[];if(this.selectedNodes.forEach(T=>{this.project.activities.filter(R=>R.chartInfo.source_id===T).find(R=>this.selectedNodes.indexOf(R.chartInfo.target_id)>-1)||M.push(T),this.project.activities.filter(R=>R.chartInfo.target_id===T).find(R=>this.selectedNodes.indexOf(R.chartInfo.source_id)>-1)||v.push(T)}),M.length>1||v.length>1||this.project.activities.find(T=>T.chartInfo.target_id===M[0]&&T.chartInfo.source_id===v[0]))return!1;this.lassoStart=v[0],this.lassoEnd=M[0];const D=s.map(T=>T.chartInfo.target_id),q=f.map(T=>T.chartInfo.source_id),ht=D.filter(T=>-1===v.indexOf(T)&&-1===M.indexOf(T)),ct=q.filter(T=>-1===v.indexOf(T)&&-1===M.indexOf(T));return 0===ht.length&&0===ct.length}selectActivities(){this.project.activities.forEach(s=>{this.selectedNodes.indexOf(s.chartInfo.source_id)>-1&&this.selectedNodes.indexOf(s.chartInfo.target_id)>-1&&this.selectedActivities.push(s.profile.id)}),this.st.links.classed("possible",s=>this.selectedActivities.indexOf(s.profile.id)>-1)}pointInPolygon(s,f){let v,M,P,D,ht;const ct=s[0],T=s[1];let H=!1;for(let yt=0,L=f.length-1;yt<f.length;L=yt++)v=f[yt][0],P=f[yt][1],M=f[L][0],D=f[L][1],ht=P>T!=D>T&&ct<(M-v)*(T-P)/(D-P)+v,ht&&(H=!H);return H}static#t=this.\u0275fac=function(f){return new(f||G)(S.LFG(K.Ou),S.LFG(gt),S.LFG(dt))};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})();var Mt=it(1568);let V=(()=>{class G{constructor(s,f,v,M){this.st=s,this.controller=f,this.lassoTool=v,this.dashboard=M}bindGlobalEvents(){this.st.svg.on("dblclick",s=>{s.preventDefault(),this.dblclick(s)}).on("click",s=>{this.st.allowDeletes=!0,this.st.last_selected_node=null}).on("mousemove",s=>this.mousemove(s)).on("mouseup",()=>this.mouseup()),m.Ys(window).on("keydown",s=>{this.keydown(s),this.lassoTool.keydown(s)}).on("keyup",s=>{this.keyup(s),this.lassoTool.keyup(s)})}dblclick(s){(!s.ctrlKey||null!=this.st.drag_node)&&s.stopPropagation(),this.st.mainG.classed("active",!0);const f=this.dashboard.activeProject$.getValue();this.controller.handleNodeCreation(s.ctrlKey,m.cx$(s,this.st.mainG.node()),f)&&this.dashboard.updateProject(f,!0)}mousemove(s){s.ctrlKey||s.stopPropagation(),this.controller.updateLinePos(m.cx$(this.st.mainG.node()))}mouseup(){this.controller.clearClassesAndHideLine()}keydown(s){const f=this.dashboard.activeProject$.getValue();(this.st.lastKeyDown===Z.s.Ctrl||this.st.macMetaDown)&&s.keyCode===Z.s.X&&(s.preventDefault(),null!=this.st.selected_node&&this.controller.splitUpNode(this.st.selected_node,f),this.dashboard.updateProject(f,!0)),(this.st.lastKeyDown===Z.s.Ctrl||this.st.macMetaDown)&&s.keyCode===Z.s.D&&(s.preventDefault(),this.controller.makeDummy(),this.dashboard.updateProject(f,!0)),(this.st.lastKeyDown===Z.s.Ctrl||this.st.macMetaDown)&&s.keyCode===Z.s.M&&(s.preventDefault(),this.controller.makeMilestone(f),this.dashboard.updateProject(f,!0)),s.keyCode===Z.s.Backspace&&s.metaKey&&this.st.allowDeletes&&(this.controller.deleteSelectedNodeOrLink(f),this.dashboard.updateProject(f,!0)),this.st.lastKeyDown||(this.st.lastKeyDown=s.keyCode,s.metaKey&&(s.preventDefault(),this.st.macMetaDown=!0,this.st.ctrl_down=!0),s.keyCode===Z.s.Ctrl&&(this.st.ctrl_down=!0),s.keyCode!==Z.s.Delete)||this.st.allowDeletes&&(this.controller.deleteSelectedNodeOrLink(f),this.dashboard.updateProject(f,!0))}keyup(s){this.st.lastKeyDown=null,this.st.macMetaDown&&!s.metaKey&&(this.st.macMetaDown=!1,this.st.ctrl_down=!1),s.keyCode===Z.s.Ctrl&&(this.st.ctrl_down=!1)}static#t=this.\u0275fac=function(f){return new(f||G)(S.LFG(dt),S.LFG(gt),S.LFG(xt),S.LFG(K.Ou))};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})(),bt=(()=>{class G{constructor(s,f,v){this.st=s,this.controller=f,this.dashboard=v}createNodes(s){this.st.nodes=this.st.mainG.append("g").attr("class","node").selectAll("g");let f=this.st.mainG.select("g.node");f.empty()&&(f=this.st.mainG.append("g").attr("class","node"));const v=f.selectAll("g"),M=m.eRy().duration(et.aV).ease(et.I2),P=v.data(s.integrations,T=>T.id);P.exit().remove();const D=P.enter().append("g").attr("class",T=>this.controller.getNodeCss(T,s)).classed("milestone",T=>T.isMilestone).classed("completed",T=>s.profile.view.markCompleted&&T.completed).attr("transform",T=>`translate(${T.x},${T.y})`);D.append("circle").attr("r",T=>T.isMilestone?14:12).classed("node",!0).classed("dummy",T=>T.isDummy).classed("active",T=>T===this.st.selected_node).classed("last-selected",T=>T===this.st.last_selected_node),D.append("text").attr("class","label").attr("text-anchor","middle").attr("y",".3em").text(T=>this.controller.getNodeName(T)),"none"!==s.profile.view.showEftLft&&D.append("text").attr("class","label float risk-stats").attr("text-anchor","middle").attr("y",T=>T.isMilestone?"-2.3em":"-1.9em").text(T=>this.controller.getTextAboveNode(T,s));const q=m.ohM().filter(T=>!T.button).on("start",T=>{}).on("drag",(T,H)=>{this.controller.onNodeGroupDrag([T.x,T.y],T.dx,T.dy,H,s)}).on("end",(T,H)=>{this.controller.onNodeGroupMouseUp(H,s),this.dashboard.updateProject(s,!0)});D.on("mousedown",(T,H)=>{this.st.allowDeletes=!0,this.controller.onNodeGroupMouseDown(H,this.st.ctrl_down||this.st.macMetaDown,m.Ys(T.currentTarget),s)}).on("mouseover",(T,H)=>this.controller.onNodeMouseOver(H,m.Ys(T.currentTarget))).on("mouseout",(T,H)=>this.controller.onNodeMouseOut(H,m.Ys(T.currentTarget))).call(q);const ht=D.merge(P),ct=this.st.prevProjId!==s.profile.id;ht.style("stroke",T=>this.controller.getNodeColor(!0,T,s,this.st.nodeRisk,ct)).transition(M).style("stroke",T=>this.controller.getNodeColor(!1,T,s,this.st.nodeRisk,ct)),this.st.nodes=ht}createArrows(s){let f=this.st.mainG.select("g.link");f.empty()&&(f=this.st.mainG.append("g").attr("class","link"));const v=f.selectAll("g.activity"),M=s.activities.filter(T=>!T.chartInfo.milestoneNodeId),P=v.data(M,T=>T.profile.id);P.exit().remove();const D=P.enter().append("g").attr("class","activity").on("mouseover",T=>m.Ys(T.currentTarget).classed("hover",!0)).on("mouseout",T=>m.Ys(T.currentTarget).classed("hover",!1)).on("mousedown",(T,H)=>{this.st.allowDeletes=!0,this.controller.setMouseDownLink(H,this.st.ctrl_down,s),this.dashboard.updateProject(s,!0),T.stopPropagation()});this.createArrowBody(s,D),this.createMainArrowText(s,D),this.createTextGlow(s,D),this.createLowerText(s,D);const q=D.merge(P),ht=m.eRy().duration(et.aV).ease(et.I2),ct=this.st.prevProjId!==s.profile.id;q.attr("class",T=>this.controller.getLinkCss(T,s)).classed("completed",T=>this.controller.isCompleted(T,s)).classed("selected",T=>this.controller.isSelected(T,s)).classed("sub-project",T=>this.controller.isHighlighted(T,s)).style("stroke",T=>this.controller.getArrowColor(!0,T,s,this.st.arrowRisk,ct)).transition(ht).style("stroke",T=>this.controller.getArrowColor(!1,T,s,this.st.arrowRisk,ct)),this.st.links=q,s.profile.view.activeSubProjectId=void 0}createMainArrowText(s,f){if(s.profile.view.wrapText){const v=this;f.append("foreignObject").attr("x",M=>this.controller.getLinkTextPosX(M,s)-25).attr("y",M=>this.controller.getLinkTextPosY(M,s)-15).attr("width","80px").each(function(M){let P=null;M!==s.profile.view.selectedActivity&&(P=v.controller.getWrappedTextColor(M,s));const D=m.Ys(this).append("xhtml:div").style("font-size",v.controller.getActivityFontSize(M,s)).style("color","#aaa").style("font-weight","bold").style("color",()=>P),q=v.controller.getLinkText(M,s).split(",");if(D.selectAll("div").data(q).enter().append("xhtml:div").style("font-size",v.controller.getActivityFontSize(M,s)).text(ht=>ht),D){const ht=D.node().getBoundingClientRect();m.Ys(this).attr("height",ht.height+"px")}})}else f.append("text").attr("class","label").classed("selected",v=>v===this.st.selected_link).attr("y",v=>this.controller.getLinkTextPosY(v,s)).attr("x",v=>this.controller.getLinkTextPosX(v,s)).style("font-size",v=>this.controller.getActivityFontSize(v,s)).style("text-anchor","middle").text(v=>this.controller.getLinkText(v,s))}createArrowBody(s,f){f.append("svg:path").attr("class","link main").classed("dummy",v=>v.chartInfo.isDummy).classed("selected",v=>v===this.st.selected_link).attr("d",v=>this.controller.getPath(v)).style("marker-end",v=>this.controller.getLinkEndMarker(v,s))}createTextGlow(s,f){s.profile.view.wrapText||f.insert("text","text").attr("class","glow").style("font-size",v=>this.controller.getActivityFontSize(v,s)).attr("y",v=>this.controller.getLinkTextPosY(v,s)).attr("x",v=>this.controller.getLinkTextPosX(v,s)).text(v=>this.controller.getLinkText(v,s))}createLowerText(s,f){f.append("text").attr("class","label float").attr("y",v=>this.controller.getLowerLinkTextYPos(v,s)).attr("x",v=>this.controller.getLowerLinkTextXPos(v,s)).style("text-anchor","middle").text(v=>this.controller.getLowerLinkText(v,s)).style("font-size",v=>this.controller.getActivityFontSize(v,s))}createArrowHeads(){const s=this.st.mainG.append("svg:defs").selectAll("marker");this.addArrowHead(s,"end-0","risk-0"),this.addArrowHead(s,"end-1","risk-1"),this.addArrowHead(s,"end-2","risk-2"),this.addArrowHead(s,"end-3","risk-3"),this.addArrowHead(s,"end-undefined","risk-undefined"),this.addArrowHead(s,"end-u","unprocessed"),this.addArrowHead(s,"end-completed","completed"),s.data(["end-arrow"]).enter().append("svg:marker").attr("id",String).attr("class","endarrow").attr("viewBox","0 -5 10 10").attr("refX",6).attr("markerWidth",3).attr("markerHeight",3).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").attr("fill","#000")}addArrowHead(s,f,v){s=s.data([f]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",6).attr("markerWidth",3).attr("markerHeight",3).attr("orient","auto").attr("class",v).append("svg:path").attr("d","M0,-5L10,0L0,5")}clearElements(){this.st.mainG.selectAll("g.link").remove(),this.st.mainG.selectAll("g.node").remove(),this.st.mainG.selectAll("defs").remove(),this.st.mainG.selectAll("g.missing-data").remove()}static#t=this.\u0275fac=function(f){return new(f||G)(S.LFG(dt),S.LFG(gt),S.LFG(K.Ou))};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})(),ft=(()=>{class G{constructor(s,f){this.st=s,this.lassoTool=f}zoom(s){if(1==s.profile.view.lassoOn)return void this.st.svg.on(".zoom",null);if(s.integrations.length<2)return void(s.profile.view.autoZoom=!1);const f=this.getSvgZoom(s);if(f){const v=this.getZoomOrigin(s);m.sPX().translateTo(this.st.svg,v.translate[0],v.translate[1]),m.sPX().scaleTo(this.st.svg,v.scale)}this.st.svg.call(m.sPX().on("zoom",(v,M)=>{this.st.mainG.attr("transform",v.transform),this.lassoTool.setTransform(v.transform)})),this.st.svg.on("dblclick.zoom",null),null!=f&&(this.st.mainG.attr("transform",`translate(${f.translate})scale(${f.scale})`),this.lassoTool.setTransform({k:f.scale,x:f.translate[0],y:f.translate[1]}))}getSvgZoom(s){if(null==s||0===s.integrations.length)return{scale:1,translate:[0,0]};if(!s.profile.view.autoZoom)return null;s.profile.view.autoZoom=!1;const M=s.integrations.map(Rt=>Rt.x),P=s.integrations.map(Rt=>Rt.y),D=Math.max(...M),q=Math.min(...M),ht=Math.max(...P),ct=Math.min(...P),O=(D+q)/2,R=(ht+ct)/2,nt=.9/Math.max((D-q)/this.st.width,(ht-ct)/this.st.height);return{translate:[this.st.width/2-nt*O-0,this.st.height/2-nt*R-0],scale:nt}}getZoomOrigin(s){const f=s.integrations.map(O=>O.x),v=s.integrations.map(O=>O.y),M=Math.max(...f),P=Math.min(...f),D=Math.max(...v),q=Math.min(...v);return{translate:[(M-P)/2+P,(D-q)/2+q],scale:.9/Math.max((M-P)/this.st.width,(D-q)/this.st.height)}}static#t=this.\u0275fac=function(f){return new(f||G)(S.LFG(dt),S.LFG(xt))};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})(),At=(()=>{class G{constructor(s,f,v,M,P,D,q,ht,ct,T){this.dashboard=s,this.eventService=f,this.ngZone=v,this.lassoTool=M,this.controller=P,this.nodeArranger=D,this.events=q,this.elements=ht,this.svgZoom=ct,this.st=T,this.projIsEmpty=new z.X(!0)}init(s,f,v,M,P){this.id=v,this.st.width=s,this.st.height=f,this.rebuild=M,this.initSvg(s,f,P),this.events.bindGlobalEvents(),this.data=this.dashboard.activeProject$,this.sub=this.data.pipe((0,X.h)(D=>!!D)).subscribe(D=>{this.ngZone.runOutsideAngular(()=>{this.createChart(D)})}),this.st.activity_created=this.eventService.get(et.BT)}destroy(){this.sub&&this.sub.unsubscribe()}createFastActivity(s,f,v=!1){const M=this.controller.addFastActivity(s,this.proj,f,this.st.last_selected_node);M&&(f===et.T5&&(this.st.last_selected_node=M.chartInfo.target??null),!0===v&&this.nodeArranger.arrangeNodes(this.proj),this.dashboard.updateProject(this.proj,!0))}deselectItem(){this.st.allowDeletes=!1,this.controller.checkDeselect(this.proj)&&(this.controller.deselectActivity(this.proj),this.controller.deselectNode(this.proj),this.dashboard.updateProject(this.proj,!1))}disableDeletes(){this.st.allowDeletes=!1}initSvg(s,f,v){const M=this.st,P="big-arrow-"+this.id;if(this.rebuild&&m.Ys(v).select("svg").remove(),!this.st.svg||this.rebuild){const D=m.Ys(v).append("svg").attr("class",P);this.st.svg=D.style("width","100%").style("height",null).attr("preserveAspectRatio","xMinYMin meet").attr("viewBox",`0 0 ${s} ${f}`),M.mainG=M.svg.append("g"),M.mainG.classed("main-arrow",!0),M.drag_line=M.mainG.append("svg:path").attr("class","link dragline hidden").attr("d","M0,0L0,0")}}createChart(s){this.proj=s;const f=0===s.integrations.length;this.projIsEmpty.next(f),this.rebuild&&this.elements.clearElements(),!f&&(this.svgZoom.zoom(s),this.elements.createArrowHeads(),this.elements.createNodes(s),this.elements.createArrows(s),this.buildDict(s),this.lassoTool.buildLasso(s),this.st.prevProjId=s.profile.id)}buildDict(s){this.st.arrowRisk=new Map,s.activities.forEach((f,v)=>this.st.arrowRisk.set(f.profile.id,f.chartInfo.risk)),this.st.nodeRisk=new Map,s.integrations.forEach((f,v)=>this.st.nodeRisk.set(f.id,f.risk))}static#t=this.\u0275fac=function(f){return new(f||G)(S.LFG(K.Ou),S.LFG(K.WO),S.LFG(S.R0b),S.LFG(xt),S.LFG(gt),S.LFG(Mt.g),S.LFG(V),S.LFG(bt),S.LFG(ft),S.LFG(dt))};static#e=this.\u0275prov=S.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}return G})();const Nt=["chart"];function It(G,Me){if(1&G){const s=S.EpF();S.TgZ(0,"div",8)(1,"div")(2,"div"),S._uU(3,"Add Activity"),S.qZA(),S.TgZ(4,"input",9),S.NdJ("ngModelChange",function(v){S.CHM(s);const M=S.oxw();return S.KtG(M.activityTxt=v)})("keydown",function(v){S.CHM(s);const M=S.oxw();return S.KtG(M.processActivityTxt(v))}),S.qZA()(),S.TgZ(5,"div",10)(6,"div"),S._uU(7,"Mode"),S.qZA(),S.TgZ(8,"div",11)(9,"div",12)(10,"input",13),S.NdJ("ngModelChange",function(v){S.CHM(s);const M=S.oxw();return S.KtG(M.creationMode=v)}),S.qZA(),S.TgZ(11,"label",14),S._uU(12,"Subgroup"),S.qZA()(),S.TgZ(13,"div",12)(14,"input",15),S.NdJ("ngModelChange",function(v){S.CHM(s);const M=S.oxw();return S.KtG(M.creationMode=v)}),S.qZA(),S.TgZ(15,"label",16),S._uU(16,"Multigroup"),S.qZA()(),S.TgZ(17,"div",17)(18,"input",18),S.NdJ("change",function(){S.CHM(s);const v=S.oxw();return S.KtG(v.autoArrange=!v.autoArrange)}),S.qZA(),S.TgZ(19,"label",19),S._uU(20,"Auto Arrange"),S.qZA()()()()()}if(2&G){const s=S.oxw();S.xp6(4),S.Q6J("ngModel",s.activityTxt),S.xp6(6),S.Q6J("ngModel",s.creationMode),S.xp6(4),S.Q6J("ngModel",s.creationMode),S.xp6(4),S.Q6J("checked",s.autoArrange)}}const Vt=()=>["mat-calendar-body-cell-content","keep-selected-item"];let ce=(()=>{class G{constructor(){this.showFastCreator=!0,this.creationMode=et.MB,this.autoArrange=!1,this.showList=!1,this.ui=(0,S.f3M)(At)}ngOnInit(){this.isEmpty=this.ui.projIsEmpty,this.ui.init(this.width,this.height,this.id,this.rebuild,this.chart.nativeElement)}deselectItem(s){this.ui.deselectItem()}disableDeletes(s){this.ui.disableDeletes()}processActivityTxt(s){this.ui.createFastActivity(s,this.creationMode,this.autoArrange),"Enter"===s.key&&(this.activityTxt="")}ngOnDestroy(){this.ui.destroy()}static#t=this.\u0275fac=function(f){return new(f||G)};static#e=this.\u0275cmp=S.Xpm({type:G,selectors:[["cp-arrow-chart"]],viewQuery:function(f,v){if(1&f&&S.Gf(Nt,7),2&f){let M;S.iGM(M=S.CRH())&&(v.chart=M.first)}},hostAttrs:[1,"cp-arrow-chart"],inputs:{id:"id",width:"width",height:"height",rebuild:"rebuild",showFastCreator:"showFastCreator"},features:[S._Bn([At,gt,ft,W,V,rt,xt,bt,dt,Y,lt])],decls:11,vars:7,consts:[[1,"arrow-empty-message",3,"hidden"],[1,"arrow-component-wrapper"],["class","create-txt",4,"ngIf"],["outsideClick","",1,"arrow-chart-container",3,"skipList","outListSelect","inListSelect"],["chart",""],[1,"arrow-list"],[1,"list",3,"hidden"],[1,"toggle","fas","fa-list",3,"click"],[1,"create-txt"],["type","text",3,"ngModel","ngModelChange","keydown"],[1,"create-mode"],[1,"creation-config"],[1,"custom-control","custom-radio","custom-control-inline"],["type","radio","id","sub","name","create","value","sub",1,"custom-control-input",3,"ngModel","ngModelChange"],["for","sub",1,"custom-control-label"],["type","radio","id","multi","name","create","value","multi",1,"custom-control-input",3,"ngModel","ngModelChange"],["for","multi",1,"custom-control-label"],[1,"custom-control","custom-checkbox","custom-control-inline"],["type","checkbox","id","arrange",1,"custom-control-input",3,"checked","change"],["for","arrange",1,"custom-control-label"]],template:function(f,v){1&f&&(S.TgZ(0,"div",0),S.ALo(1,"async"),S._uU(2,"Arrow diagram: click to add nodes and arrows"),S.qZA(),S.TgZ(3,"div",1),S.YNc(4,It,21,4,"div",2),S.TgZ(5,"div",3,4),S.NdJ("outListSelect",function(P){return v.deselectItem(P)})("inListSelect",function(P){return v.disableDeletes(P)}),S.qZA(),S.TgZ(7,"div",5)(8,"div",6),S._UZ(9,"cp-arrow-list"),S.qZA(),S.TgZ(10,"i",7),S.NdJ("click",function(){return v.showList=!v.showList}),S.qZA()()()),2&f&&(S.Q6J("hidden",!S.lcZ(1,4,v.isEmpty)),S.xp6(4),S.Q6J("ngIf",v.showFastCreator),S.xp6(1),S.Q6J("skipList",S.DdM(6,Vt)),S.xp6(3),S.Q6J("hidden",!v.showList))},styles:[".cp-arrow-chart{display:block;position:relative}.cp-arrow-chart .arrow-component-wrapper{position:relative;top:0;left:0}.cp-arrow-chart .arrow-component-wrapper .create-txt{position:absolute;top:10px;left:5px;padding:7px;border-radius:7px;background-color:#f9f9f9;z-index:12;display:flex}.cp-arrow-chart .arrow-component-wrapper .create-txt .create-mode{padding-left:20px}.cp-arrow-chart .arrow-component-wrapper svg{background-color:#fff}.cp-arrow-chart path.dragline{stroke:#000}.cp-arrow-chart path.link{stroke-width:4px;cursor:default}.cp-arrow-chart svg:not(.active):not(.ctrl) path.link{cursor:pointer}.cp-arrow-chart path.link{fill:none;stroke-width:4px;cursor:default}.cp-arrow-chart .link{stroke-opacity:.6}.cp-arrow-chart .node{stroke-width:1px;fill:#fff}.cp-arrow-chart g.selected *{stroke-opacity:1}.cp-arrow-chart g.selected .node{fill:#aaf}.cp-arrow-chart .node .risk-0{stroke-opacity:.5}.cp-arrow-chart .node .risk-1,.cp-arrow-chart .node .risk-2{stroke-opacity:.6}.cp-arrow-chart .node .risk-3{stroke-opacity:.9}.cp-arrow-chart .link .risk-0 text{stroke-opacity:.5}.cp-arrow-chart .link .risk-1 text{stroke-opacity:.6}.cp-arrow-chart .link .risk-2 text{stroke-opacity:.6}.cp-arrow-chart .link .risk-3 text{stroke-opacity:.5}.cp-arrow-chart .risk-undefined{stroke:#bbb;stroke-opacity:.9}.cp-arrow-chart g.completed{fill:#fdf;stroke-opacity:.9}.cp-arrow-chart marker.risk-0{fill:#1c1;opacity:1}.cp-arrow-chart marker.risk-1{fill:#ffd800;opacity:1}.cp-arrow-chart marker.risk-2{fill:red;opacity:1}.cp-arrow-chart marker.risk-3{fill:#000;opacity:1}.cp-arrow-chart marker.risk-undefined{fill:#bbb;opacity:1}.cp-arrow-chart marker.unprocessed{fill:#bbb;opacity:1}.cp-arrow-chart marker.completed{fill:#fdf;opacity:1}.cp-arrow-chart .risk-0 path.link{stroke-opacity:.4}.cp-arrow-chart .risk-1 path.link{stroke-opacity:.6}.cp-arrow-chart .risk-2 path.link{stroke-opacity:.6}.cp-arrow-chart .risk-3 path.link{stroke-opacity:.9}.cp-arrow-chart .risk-undefined path.link{opacity:1}.cp-arrow-chart .completed path.link{stroke:#fdf;stroke-opacity:.8}.cp-arrow-chart .unprocessed path.link{stroke-opacity:.9}.cp-arrow-chart .glow{text-anchor:middle;font-size:13px;stroke:#fff;stroke-width:6;stroke-opacity:.7;fill:#fff}.cp-arrow-chart g path.dummy{stroke-dasharray:10,2}.cp-arrow-chart .dummy text{stroke-dasharray:10,0}.cp-arrow-chart g.sub-project path.link.main{stroke:purple;opacity:.9}.cp-arrow-chart circle.last-selected{stroke:purple}.cp-arrow-chart g.selected text.label{stroke:#00f}.cp-arrow-chart g.selected foreignObject>div{color:#00f}.cp-arrow-chart foreignObject>div{text-shadow:rgb(255,255,255) 0px 0px 3px,rgb(255,255,255) 0px 0px 4px,rgb(255,255,255) 0px 0px 3px,rgb(255,255,255) 0px 0px 3px;font-size:15px}.cp-arrow-chart text.glow,.cp-arrow-chart text.label,.cp-arrow-chart foreignObject>div{pointer-events:all;cursor:pointer}.cp-arrow-chart path.link.dragline{pointer-events:none}.cp-arrow-chart path.link.hidden{stroke-width:0}.cp-arrow-chart circle.node{stroke-width:1.5px;cursor:pointer}.cp-arrow-chart text,.cp-arrow-chart foreignObject>div{font:12px sans-serif;pointer-events:none}.cp-arrow-chart text.id{text-anchor:middle;font-weight:700}.cp-arrow-chart .activity-labels div{float:left;width:158px}.cp-arrow-chart .activity-labels div:first-child{width:23px}.cp-arrow-chart .dim{opacity:.8}.cp-arrow-chart g.dummy path{stroke-dasharray:10,2}.cp-arrow-chart g circle.dummy{stroke-dasharray:7,3;stroke-width:2.5px}.cp-arrow-chart g.milestone circle{stroke-width:4px}.cp-arrow-chart g.milestone{stroke-opacity:.8;fill:#000}.cp-arrow-chart g.selected path.link.main{stroke:#00f;opacity:.9}.cp-arrow-chart circle.active{stroke:#00f;stroke-width:2.5}.cp-arrow-chart .hover path{stroke-width:5.5px}.cp-arrow-chart text.risk-stats{font-size:8px;stroke-opacity:.4;fill:#000;font-weight:400}.cp-arrow-chart .arrow-empty-message{position:absolute;top:40%;left:50%;z-index:11;transform:translate(-50%,-50%)}.cp-arrow-chart .risk-end{stroke-opacity:.8;stroke-width:3px}.cp-arrow-chart .risk-end circle.node,.cp-arrow-chart .risk-start circle.node{stroke-width:3px}.cp-arrow-chart .risk-start{stroke-opacity:.8;stroke-width:3px}.cp-arrow-chart .arrow-empty-message{font-weight:700}.cp-arrow-chart .creation-config{display:flex;align-items:baseline}.cp-arrow-chart .lasso path{stroke:#505050;stroke-width:2px}.cp-arrow-chart .lasso .drawn{fill-opacity:.05}.cp-arrow-chart .lasso .loop_close{fill:none;stroke-dasharray:4,4}.cp-arrow-chart .lasso .origin{fill:#39f;fill-opacity:.5}.cp-arrow-chart .not_possible{fill:#c8c8c8}.cp-arrow-chart .possible circle,.cp-arrow-chart .possible path,.cp-arrow-chart .unprocessed.possible path.link{fill:#ec888c;stroke:#ec888c}.cp-arrow-chart .pivot circle{fill:#00f;stroke:#00f}.cp-arrow-chart .arrow-list{position:absolute;right:0;top:0;display:flex}.cp-arrow-chart .toggle{padding:5px}.cp-arrow-chart .arrow-list{height:100%}.cp-arrow-chart .list{padding-left:5px;height:100%;width:350px;overflow-y:auto;box-shadow:-6px 0 6px -4px #00000040;background-color:#fff}\n"],encapsulation:2})}return G})()},40:(qt,Ot,it)=>{it.d(Ot,{S:()=>rt});var S=it(6814),m=it(2357),et=it(6223),z=it(9212);let X=(()=>{class W{static#t=this.\u0275fac=function(gt){return new(gt||W)};static#e=this.\u0275mod=z.oAB({type:W});static#i=this.\u0275inj=z.cJS({})}return W})();var K=it(3633),Z=it(2181);const $=W=>({selected:W});function st(W,lt){if(1&W){const Y=z.EpF();z.ynx(0),z.TgZ(1,"div",3),z.NdJ("click",function(){z.CHM(Y);const xt=z.oxw().$implicit,Mt=z.oxw(2);return z.KtG(Mt.selectActivity(xt))}),z._uU(2),z.qZA(),z.TgZ(3,"div")(4,"input",4),z.NdJ("ngModelChange",function(xt){z.CHM(Y);const Mt=z.oxw().$implicit;return z.KtG(Mt.profile.name=xt)})("ngModelChange",function(){z.CHM(Y);const xt=z.oxw(3);return z.KtG(xt.updateProject())}),z.qZA()(),z.TgZ(5,"div")(6,"input",5),z.NdJ("ngModelChange",function(xt){z.CHM(Y);const Mt=z.oxw().$implicit;return z.KtG(Mt.profile.depends_on=xt)})("ngModelChange",function(){z.CHM(Y);const xt=z.oxw(3);return z.KtG(xt.updateProject())}),z.qZA()(),z.TgZ(7,"div")(8,"input",6),z.NdJ("ngModelChange",function(xt){z.CHM(Y);const Mt=z.oxw().$implicit;return z.KtG(Mt.profile.duration=xt)})("ngModelChange",function(){z.CHM(Y);const xt=z.oxw(3);return z.KtG(xt.updateProject())}),z.qZA()(),z.BQk()}if(2&W){const Y=z.oxw().$implicit,gt=z.oxw(2);z.xp6(1),z.Q6J("ngClass",z.VKq(6,$,gt.selectedActivity===Y)),z.xp6(1),z.Oqu(Y.profile.id),z.xp6(2),z.Q6J("title",Y.profile.name)("ngModel",Y.profile.name),z.xp6(2),z.Q6J("ngModel",Y.profile.depends_on),z.xp6(2),z.Q6J("ngModel",Y.profile.duration)}}function ot(W,lt){if(1&W&&(z.TgZ(0,"div",2),z.YNc(1,st,9,8,"ng-container",0),z.qZA()),2&W){const Y=lt.$implicit;z.xp6(1),z.Q6J("ngIf",!Y.chartInfo.isDummy)}}function mt(W,lt){if(1&W&&(z.TgZ(0,"div"),z.YNc(1,ot,2,1,"div",1),z.qZA()),2&W){const Y=z.oxw();z.xp6(1),z.Q6J("ngForOf",Y.project.activities)}}let dt=(()=>{class W{constructor(Y,gt){this.dashboard=Y,this.eventService=gt}ngOnInit(){this.sub=this.dashboard.activeProject$.pipe((0,Z.h)(Y=>!!Y)).subscribe(Y=>{this.project=Y})}selectActivity(Y){this.selectedActivity=Y,this.project.profile.view.selectedActivity=Y,this.dashboard.updateProject(this.project)}ngOnDestroy(){this.sub?.unsubscribe()}updateProject(){null!==this.project&&this.dashboard.updateProject(this.project,!0)}static#t=this.\u0275fac=function(gt){return new(gt||W)(z.Y36(K.Ou),z.Y36(K.WO))};static#e=this.\u0275cmp=z.Xpm({type:W,selectors:[["cp-arrow-list"]],decls:3,vars:1,consts:[[4,"ngIf"],["class","activity",4,"ngFor","ngForOf"],[1,"activity"],[1,"cursor-pointer",3,"ngClass","click"],["type","text",3,"title","ngModel","ngModelChange"],["type","text",1,"depends-on",3,"ngModel","ngModelChange"],["type","number",1,"duration",3,"ngModel","ngModelChange"]],template:function(gt,xt){1&gt&&(z.TgZ(0,"p"),z._uU(1,"Activity List"),z.qZA(),z.YNc(2,mt,2,1,"div",0)),2&gt&&(z.xp6(2),z.Q6J("ngIf",void 0!==xt.project))},dependencies:[S.mk,S.sg,S.O5,et.Fj,et.wV,et.JJ,et.On],styles:[".activity[_ngcontent-%COMP%]{display:flex}input[_ngcontent-%COMP%]{border-left:none;border-top:none;border-right:none;border-bottom:1px solid #999}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer;flex-basis:25px;flex-grow:0;flex-shrink:0}.depends-on[_ngcontent-%COMP%]{max-width:105px}.duration[_ngcontent-%COMP%]{max-width:45px;text-align:right}.selected[_ngcontent-%COMP%]{background-color:#00f;color:#fff}"]})}return W})(),Pt=(()=>{class W{onClick(Y){let gt=Y.target,xt=!0;for(;gt;){if("string"==typeof gt.className&&this.skipList.filter(V=>gt.className?.includes(V)).length){xt=!1;break}gt=gt.parentElement}!this.elementRef.nativeElement.contains(Y.target)&&xt?this.outListSelect.emit(Y):!this.elementRef.nativeElement.contains(Y.target)&&this.inListSelect.observers.length>0&&this.inListSelect.emit(Y)}constructor(Y){this.elementRef=Y,this.outListSelect=new z.vpe,this.inListSelect=new z.vpe}static#t=this.\u0275fac=function(gt){return new(gt||W)(z.Y36(z.SBq))};static#e=this.\u0275dir=z.lG2({type:W,selectors:[["","outsideClick",""]],hostBindings:function(gt,xt){1&gt&&z.NdJ("mousedown",function(V){return xt.onClick(V)},!1,z.evT)},inputs:{skipList:"skipList"},outputs:{outListSelect:"outListSelect",inListSelect:"inListSelect"}})}return W})(),rt=(()=>{class W{static#t=this.\u0275fac=function(gt){return new(gt||W)};static#e=this.\u0275mod=z.oAB({type:W});static#i=this.\u0275inj=z.cJS({imports:[S.ez,et.u5,X]})}return W})();z.B6R(m.w,[S.O5,et.Fj,et._,et.JJ,et.On,Pt,dt],[S.Ov])},4403:(qt,Ot,it)=>{it.d(Ot,{FU:()=>Z,Lc:()=>ot,MP:()=>Pt,N4:()=>X,Nz:()=>dt,S6:()=>Y,SI:()=>S,_w:()=>mt,cT:()=>rt,dZ:()=>lt,dt:()=>et,nE:()=>z,nQ:()=>K,tu:()=>m,u_:()=>$,v0:()=>W,vx:()=>st});const S="Activities",m="Arrow Info",et="Integrations",z="Profile",X="Sub-Parent Projects",K="Phases",Z="Roles",$="Resources",st="Activity Assigned Resources",ot="Activity Assinged Phases",mt="Resource Roles",dt="Tag Pool",Pt="Activity Tags",rt="parentNodeId",W="nodeId",lt="Jira Assignee";let Y=(()=>{class gt{static#t=this.XLSX="xlsx";static#e=this.JSON="json";static#i=this.ELECTRON_SAVE="electron-save"}return gt})()},9127:(qt,Ot,it)=>{it.d(Ot,{I:()=>X});var S=it(9989),m=it(9304),et=it(9844),z=it(9212);let X=(()=>{class K{constructor(){this.nodeSerializer=new S.i}addActivity($,st="",ot=0,mt=et.MB,dt=null){let Pt=0;$.activities.length>0&&(Pt=Math.max(...$.activities.map(G=>G.profile.id)));const rt=Pt+1;let W=-1;if($.integrations.length>0&&(W=Math.max(...$.integrations.map(ce=>ce.id))),dt&&-1!==$.integrations.indexOf(dt))return this.addToExistingActivity(dt,rt,W+1,$,st,ot,mt);const lt=W+1,Y=lt+1,gt=Math.floor(lt/20),xt=lt%20,ft=120+120*gt,At=20*(xt+1)+100,Nt=this.nodeSerializer.new(lt,lt+"",0,50+120*gt,20*(xt+1)+100),It=this.nodeSerializer.new(Y,Y+"",0,ft,At);$.integrations.push(Nt),$.integrations.push(It);const Vt=(new m.w).new(rt,st,lt,Y,0,ot);return Vt.subProject.subGraphId=-1,Vt.chartInfo.source=Nt,Vt.chartInfo.target=It,Vt.profile.sortOrder=rt,$.activities.push(Vt),Vt}addToExistingActivity($,st,ot,mt,dt,Pt,rt){const W=($.x??0)+120,lt=$.y??0,Y=(new m.w).new(st,dt,$.id,ot,0,Pt),gt=this.nodeSerializer.new(ot,ot+"",0,W,lt);mt.integrations.push(gt),Y.subProject.subGraphId=-1,Y.chartInfo.source=$,Y.chartInfo.target=gt,Y.profile.sortOrder=st,mt.activities.push(Y);const xt=mt.activities.filter(Nt=>Nt.chartInfo.source===$),Mt=xt.filter(Nt=>void 0===mt.activities.find(It=>It.chartInfo.source===Nt.chartInfo.target)),bt=(xt.filter(Nt=>!Mt.includes(Nt)),$.x??0),ft=$.y??0;let At=0;return Mt.forEach((Nt,It)=>{At=this.calculatePos(Nt,mt.activities,bt,ft,At),At++}),Y}calculatePos($,st,ot,mt,dt){if($.chartInfo.target){$.chartInfo.target.x=ot+120;const rt=30*(dt%2==0?-1:1)*Math.ceil(dt/2);$.chartInfo.target.y=mt+rt,st.find(lt=>!!lt.chartInfo.target&&lt.profile.id!==$.profile.id&&lt.chartInfo.target.y===$.chartInfo.target?.y&&lt.chartInfo.target.x===$.chartInfo.target?.x)&&(dt=this.calculatePos($,st,ot,mt,dt+1))}return dt}static#t=this.\u0275fac=function(st){return new(st||K)};static#e=this.\u0275prov=z.Yz7({token:K,factory:K.\u0275fac,providedIn:"root"})}return K})()},2787:(qt,Ot,it)=>{it.d(Ot,{v:()=>m});var S=it(9212);let m=(()=>{class et{constructor(){}setDependencyDataFromGraph(X){for(const K of X.activities){const Z=this.getActivityDependencies(X,K);K.profile.depends_on=Z.toString()}}getActivityDependencies(X,K){if(null!=K.chartInfo.milestoneNodeId)return this.setMilestoneDependencies(X,K.chartInfo.milestoneNodeId);let Z=[];if(K.chartInfo.source){const $=this.getInArrows(K.chartInfo.source,X);for(const st of $)if(st.chartInfo.isDummy){const ot=this.getActivityDependencies(X,st);Z=this.union(ot,Z)}else Z.push(st.profile.id)}return Z=this.uniq(Z),Z}uniq(X){return[...Array.from(new Set(X))]}union(X,K){const Z=Array.from(new Set(X)),$=Array.from(new Set(K));return[...Array.from(new Set([...Z,...$]))]}getInArrows(X,K){return K.activities.filter(Z=>Z.chartInfo.target===X)}setMilestoneDependencies(X,K){if(null===K)return[];const Z=X.integrations.find($=>$.id===K);if(Z){const $=X.activities.filter(ot=>ot.chartInfo.target_id===Z.id);let st=[];for(const ot of $)if(ot.chartInfo.isDummy){const mt=this.getActivityDependencies(X,ot);st=this.union(mt,st)}else st.push(ot.profile.id);return st=this.uniq(st),st}return[]}static#t=this.\u0275fac=function(K){return new(K||et)};static#e=this.\u0275prov=S.Yz7({token:et,factory:et.\u0275fac,providedIn:"root"})}return et})()},7808:(qt,Ot,it)=>{it.d(Ot,{d:()=>m});var S=it(9212);let m=(()=>{class et{constructor(){}getInEdges(X,K){return K.activities.filter(Z=>Z.chartInfo.target_id===X)}setStartEndNodesFromLongestPath(X){if(0===X.activities.length)return;if(1===X.activities.length)return X.profile.start=X.activities[0].chartInfo.source?.id,void(X.profile.end=X.activities[0].chartInfo.target?.id);const Z=X.activities.filter($=>null!=X.activities.find(ot=>$.chartInfo.source_id===ot.chartInfo.target_id||$.chartInfo.target_id===ot.chartInfo.source_id)).filter($=>0===this.getInEdges($.chartInfo.source_id,X).length);if(X.profile.start=Z[0].chartInfo.source?.id,void 0!==X.profile.start){const $=this.calcLongestPath(X,X.profile.start,null);null!=$&&$.length>0&&(X.profile.end=$[$.length-1].id)}return X}getOutEdges(X,K){return X.activities.filter(Z=>Z.chartInfo.source_id===K)}calcLongestPath(X,K,Z){const $=X.integrations.find(dt=>dt.id===K),st=X.integrations.find(dt=>dt.id===Z),ot=[];return null==$?ot:this.walkTree(X,$,ot,st)}walkTree(X,K,Z,$){const st=Z.slice(0);if(void 0===K)return st;st.push(K);const ot=this.getOutEdges(X,K.id);if(K===$||0===ot.length)return st;let mt=st;for(const dt of ot){const Pt=this.walkTree(X,dt.chartInfo.target,st,$);Pt.length>mt.length&&(mt=Pt)}return mt}static#t=this.\u0275fac=function(K){return new(K||et)};static#e=this.\u0275prov=S.Yz7({token:et,factory:et.\u0275fac,providedIn:"root"})}return et})()},4961:(qt,Ot,it)=>{it.d(Ot,{y:()=>z});var S=it(9304),m=it(9212),et=it(2787);let z=(()=>{class X{constructor(Z){this.depCrawler=Z}createMilestoneActivity(Z,$){let st=-1/0;$.activities.forEach(rt=>{rt.profile.id>st&&(st=rt.profile.id)});let ot=-1;isNaN(st)&&(ot=0),ot=st+1;const mt=(new S.w).new(ot,ot.toString(),null,null,0,0);mt.chartInfo.isDummy=!0,mt.chartInfo.milestoneNodeId=Z.id,mt.subProject.subGraphId=-1;const dt=$.integrations.filter(rt=>rt.isMilestone).length;Z.milestoneNumber=dt,Z.milestoneName="M"+dt,mt.profile.name=Z.milestoneName,$.activities.push(mt),Z.milestoneActivityId=mt.profile.id,Z.milestoneActivity=mt;const Pt=this.depCrawler.getActivityDependencies($,mt);return mt.profile.depends_on=Pt.join(),mt}createMilestone(Z,$){if(null!==$)if($.isMilestone)this.changeBackToNonMilestone($,Z),$.isMilestone=!1,$.milestoneNumber=0,$.milestoneName="";else{const st=Z.integrations.find(ot=>ot.isMilestone);if(void 0===st)$.milestoneNumber=0,$.milestoneName="M0",$.isMilestone=!0;else{const ot=Math.max(...Z.integrations.map(mt=>mt.milestoneNumber))+1;$.milestoneNumber=st.milestoneNumber+1,$.milestoneName="M"+ot,$.isMilestone=!0}this.createMilestoneActivity($,Z)}}changeBackToNonMilestone(Z,$){const st=$.activities.findIndex(ot=>ot.profile.id===Z.milestoneActivityId);$.activities.splice(st,1),Z.milestoneActivityId=null,Z.milestoneActivity=null,Z.isMilestone=!1,Z.milestoneNumber=0,Z.milestoneName=""}removeMilestoneByNode(Z,$){const st=$.activities.find(dt=>dt.profile.id===Z.milestoneActivityId);if(st){const dt=$.activities.indexOf(st);$.activities.splice(dt,1)}const ot=$.integrations.findIndex(dt=>dt.id===Z.id);$.integrations.splice(ot,1),$.activities.filter(dt=>void 0!==dt.chartInfo.source&&void 0!==dt.chartInfo.target&&(dt.chartInfo.source.id===Z.id||dt.chartInfo.target.id===Z.id)).forEach(dt=>$.activities.splice($.activities.indexOf(dt),1))}removeMilestoneByActivity(Z,$){if(!Z||!$||!Z.chartInfo.milestoneNodeId)return;const st=$.activities.findIndex(mt=>mt.profile.id===Z.profile.id);$.activities.splice(st,1);const ot=$.integrations.find(mt=>mt.id===Z.chartInfo.milestoneNodeId);ot&&(ot.milestoneName="",ot.milestoneNumber=0,ot.milestoneActivity=null,ot.milestoneActivityId=null,ot.isMilestone=!1)}static#t=this.\u0275fac=function($){return new($||X)(m.LFG(et.v))};static#e=this.\u0275prov=m.Yz7({token:X,factory:X.\u0275fac,providedIn:"root"})}return X})()},1568:(qt,Ot,it)=>{it.d(Ot,{g:()=>$n});var S=it(3920),m=Object.create,et=Object.defineProperty,z=Object.defineProperties,X=Object.getOwnPropertyDescriptor,K=Object.getOwnPropertyDescriptors,Z=Object.getOwnPropertyNames,$=Object.getOwnPropertySymbols,st=Object.getPrototypeOf,ot=Object.prototype.hasOwnProperty,mt=Object.prototype.propertyIsEnumerable,dt=(t,e)=>{if(e=Symbol[t])return e;throw Error("Symbol."+t+" is not defined")},Pt=(t,e,n)=>e in t?et(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,rt=(t,e)=>{for(var n in e||(e={}))ot.call(e,n)&&Pt(t,n,e[n]);if($)for(var n of $(e))mt.call(e,n)&&Pt(t,n,e[n]);return t},W=(t,e)=>z(t,K(e)),lt=(t,e)=>{var n={};for(var i in t)ot.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&$)for(var i of $(t))e.indexOf(i)<0&&mt.call(t,i)&&(n[i]=t[i]);return n},Y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),xt=(t,e,n)=>(n=null!=t?m(st(t)):{},((t,e,n,i)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let r of Z(e))!ot.call(t,r)&&undefined!==r&&et(t,r,{get:()=>e[r],enumerable:!(i=X(e,r))||i.enumerable});return t})(!e&&t&&t.__esModule?n:et(n,"default",{value:t,enumerable:!0}),t)),Mt=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},V=(t,e,n)=>(Mt(t,e,"read from private field"),n?n.call(t):e.get(t)),bt=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},ft=(t,e,n,i)=>(Mt(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),At=(t,e,n)=>(Mt(t,e,"access private method"),n),Nt=function(t,e){this[0]=t,this[1]=e},It=t=>{var i,e=t[dt("asyncIterator")],n=!1,r={};return null==e?(e=t[dt("iterator")](),i=o=>r[o]=a=>e[o](a)):(e=e.call(t),i=o=>r[o]=a=>{if(n){if(n=!1,"throw"===o)throw a;return a}return n=!0,{done:!1,value:new Nt(new Promise(l=>{var d=e[o](a);if(!(d instanceof Object))throw TypeError("Object expected");l(d)}),1)}}),r[dt("iterator")]=()=>r,i("next"),"throw"in e?i("throw"):r.throw=o=>{throw o},"return"in e&&i("return"),r},Vt=Y((t,e)=>{function n(i,r,o,a){this.feasible=o,this.evaluation=r,this.bounded=a,this._tableau=i}e.exports=n,n.prototype.generateSolutionSet=function(){for(var i={},r=this._tableau,o=r.varIndexByRow,a=r.variablesPerIndex,l=r.matrix,d=r.rhsColumn,h=r.height-1,c=Math.round(1/r.precision),u=1;u<=h;u+=1){var g=a[o[u]];void 0!==g&&!0!==g.isSlack&&(i[g.id]=Math.round((Number.EPSILON+l[u][d])*c)/c)}return i}}),ce=Y((t,e)=>{var n=Vt();function i(r,o,a,l,d){n.call(this,r,o,a,l),this.iter=d}e.exports=i,i.prototype=Object.create(n.prototype),i.constructor=i}),G=Y((t,e)=>{var n=Vt(),i=ce();function r(a){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=a||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}function o(a,l){this.priority=a,this.reducedCosts=new Array(l);for(var d=0;d<l;d+=1)this.reducedCosts[d]=0}e.exports=r,r.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()},o.prototype.copy=function(){var a=new o(this.priority,this.reducedCosts.length);return a.reducedCosts=this.reducedCosts.slice(),a},r.prototype.setOptionalObjective=function(a,l,d){var h=this.objectivesByPriority[a];void 0===h&&(h=new o(a,Math.max(this.width,l+1)),this.objectivesByPriority[a]=h,this.optionalObjectives.push(h),this.optionalObjectives.sort(function(u,p){return u.priority-p.priority})),h.reducedCosts[l]=d},r.prototype.initialize=function(a,l,d,h){this.variables=d,this.unrestrictedVars=h,this.width=a,this.height=l;for(var c=new Array(a),u=0;u<a;u++)c[u]=0;this.matrix=new Array(l);for(var p=0;p<l;p++)this.matrix[p]=c.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=a+l-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars},r.prototype._resetMatrix=function(){var c,u,a=this.model.variables,l=this.model.constraints,d=a.length,h=l.length,p=this.matrix[0],g=!0===this.model.isMinimization?-1:1;for(c=0;c<d;c+=1){var k=a[c],y=k.priority,I=g*k.cost;0===y?p[c+1]=I:this.setOptionalObjective(y,c+1,I),this.rowByVarIndex[u=a[c].index]=-1,this.colByVarIndex[u]=c+1,this.varIndexByCol[c+1]=u}for(var _=1,w=0;w<h;w+=1){var x=l[w],E=x.index;this.rowByVarIndex[E]=_,this.colByVarIndex[E]=-1,this.varIndexByRow[_]=E;var A,b,N=x.terms,F=N.length,U=this.matrix[_++];if(x.isUpperBound){for(A=0;A<F;A+=1)U[this.colByVarIndex[(b=N[A]).variable.index]]=b.coefficient;U[0]=x.rhs}else{for(A=0;A<F;A+=1)U[this.colByVarIndex[(b=N[A]).variable.index]]=-b.coefficient;U[0]=-x.rhs}}},r.prototype.setModel=function(a){return this.model=a,this.initialize(a.nVariables+1,a.nConstraints+1,a.variables,a.unrestrictedVariables),this._resetMatrix(),this},r.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var a=this.lastElementIndex;return this.lastElementIndex+=1,a},r.prototype.density=function(){for(var a=0,l=this.matrix,d=0;d<this.height;d++)for(var h=l[d],c=0;c<this.width;c++)0!==h[c]&&(a+=1);return a/(this.height*this.width)},r.prototype.setEvaluation=function(){var a=Math.round(1/this.precision),d=Math.round((Number.EPSILON+this.matrix[this.costRowIndex][this.rhsColumn])*a)/a;this.evaluation=d,0===this.simplexIters&&(this.bestPossibleEval=d)},r.prototype.getSolution=function(){var a=!0===this.model.isMinimization?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new i(this,a,this.feasible,this.bounded,this.branchAndCutIterations):new n(this,a,this.feasible,this.bounded)}}),Me=Y(()=>{var t=G();t.prototype.simplex=function(){return this.bounded=!0,this.phase1(),!0===this.feasible&&this.phase2(),this},t.prototype.phase1=function(){for(var n=this.model.checkForCycles,i=[],r=this.matrix,o=this.rhsColumn,a=this.width-1,l=this.height-1,h=0;;){for(var c=0,u=-this.precision,p=1;p<=l;p++){var g=r[p][o];g<u&&(u=g,c=p)}if(0===c)return this.feasible=!0,h;for(var k=0,y=-1/0,I=r[0],_=r[c],w=1;w<=a;w++){var x=_[w];if(!0===this.unrestrictedVars[this.varIndexByCol[w]]||x<-this.precision){var E=-I[w]/x;y<E&&(y=E,k=w)}}if(0===k)return this.feasible=!1,h;if(n){i.push([this.varIndexByRow[c],this.varIndexByCol[k]]);var A=this.checkForCycles(i);if(A.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+A[0]),this.model.messages.push("Length :"+A[1]),this.feasible=!1,h}this.pivot(c,k),h+=1}},t.prototype.phase2=function(){for(var p,g,n=this.model.checkForCycles,i=[],r=this.matrix,o=this.rhsColumn,a=this.width-1,l=this.height-1,d=this.precision,h=this.optionalObjectives.length,c=null,u=0;;){var k=r[this.costRowIndex];h>0&&(c=[]);for(var y=0,I=d,_=!1,w=1;w<=a;w++)p=k[w],g=!0===this.unrestrictedVars[this.varIndexByCol[w]],h>0&&-d<p&&p<d?c.push(w):g&&p<0?-p>I&&(I=-p,y=w,_=!0):p>I&&(I=p,y=w,_=!1);if(h>0)for(var x=0;0===y&&c.length>0&&x<h;){var E=[],A=this.optionalObjectives[x].reducedCosts;I=d;for(var b=0;b<c.length;b++)g=!0===this.unrestrictedVars[this.varIndexByCol[w=c[b]]],-d<(p=A[w])&&p<d?E.push(w):g&&p<0?-p>I&&(I=-p,y=w,_=!0):p>I&&(I=p,y=w,_=!1);c=E,x+=1}if(0===y)return this.setEvaluation(),this.simplexIters+=1,u;for(var B=0,N=1/0,U=1;U<=l;U++){var J=r[U],Q=J[o],tt=J[y];if(!(-d<tt&&tt<d)){if(tt>0&&d>Q&&Q>-d){N=0,B=U;break}var ut=_?-Q/tt:Q/tt;ut>d&&N>ut&&(N=ut,B=U)}}if(N===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[y],u;if(n){i.push([this.varIndexByRow[B],this.varIndexByCol[y]]);var kt=this.checkForCycles(i);if(kt.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+kt[0]),this.model.messages.push("Length :"+kt[1]),this.feasible=!1,u}this.pivot(B,y,!0),u+=1}};var e=[];t.prototype.pivot=function(n,i){var r=this.matrix,o=r[n][i],a=this.height-1,l=this.width-1,d=this.varIndexByRow[n],h=this.varIndexByCol[i];this.varIndexByRow[n]=h,this.varIndexByCol[i]=d,this.rowByVarIndex[h]=n,this.rowByVarIndex[d]=-1,this.colByVarIndex[h]=-1,this.colByVarIndex[d]=i;for(var c=r[n],u=0,p=0;p<=l;p++)c[p]>=-1e-16&&c[p]<=1e-16?c[p]=0:(c[p]/=o,e[u]=p,u+=1);c[i]=1/o;for(var g,k,y,_=0;_<=a;_++)if(_!==n&&!(r[_][i]>=-1e-16&&r[_][i]<=1e-16)){var w=r[_];if((g=w[i])>=-1e-16&&g<=1e-16)0!==g&&(w[i]=0);else{for(k=0;k<u;k++)(y=c[p=e[k]])>=-1e-16&&y<=1e-16?0!==y&&(c[p]=0):w[p]=w[p]-g*y;w[i]=-g/o}}var x=this.optionalObjectives.length;if(x>0)for(var E=0;E<x;E+=1){var A=this.optionalObjectives[E].reducedCosts;if(0!==(g=A[i])){for(k=0;k<u;k++)0!==(y=c[p=e[k]])&&(A[p]=A[p]-g*y);A[i]=-g/o}}},t.prototype.checkForCycles=function(n){for(var i=0;i<n.length-1;i++)for(var r=i+1;r<n.length;r++){var o=n[i],a=n[r];if(o[0]===a[0]&&o[1]===a[1]){if(r-i>n.length-r)break;for(var l=!0,d=1;d<r-i;d++){var h=n[i+d],c=n[r+d];if(h[0]!==c[0]||h[1]!==c[1]){l=!1;break}}if(l)return[i,r-i]}}return[]}}),s=Y((t,e)=>{function n(h,c,u,p){this.id=h,this.cost=c,this.index=u,this.value=0,this.priority=p}function i(h,c,u,p){n.call(this,h,c,u,p)}function r(h,c){n.call(this,h,0,c,0)}function o(h,c){this.variable=h,this.coefficient=c}function a(h,c,u){return 0===u||"required"===u?null:(c=c||1,u=u||1,!1===h.isMinimization&&(c=-c),h.addVariable(c,"r"+h.relaxationIndex++,!1,!1,u))}function l(h,c,u,p){this.slack=new r("s"+u,u),this.index=u,this.model=p,this.rhs=h,this.isUpperBound=c,this.terms=[],this.termsByVarIndex={},this.relaxation=null}function d(h,c){this.upperBound=h,this.lowerBound=c,this.model=h.model,this.rhs=h.rhs,this.relaxation=null}i.prototype.isInteger=!0,r.prototype.isSlack=!0,l.prototype.addTerm=function(h,c){var u=c.index,p=this.termsByVarIndex[u];return void 0===p?(p=new o(c,h),this.termsByVarIndex[u]=p,this.terms.push(p),!0===this.isUpperBound&&(h=-h),this.model.updateConstraintCoefficient(this,c,h)):this.setVariableCoefficient(p.coefficient+h,c),this},l.prototype.removeTerm=function(h){return this},l.prototype.setRightHandSide=function(h){if(h!==this.rhs){var c=h-this.rhs;!0===this.isUpperBound&&(c=-c),this.rhs=h,this.model.updateRightHandSide(this,c)}return this},l.prototype.setVariableCoefficient=function(h,c){var u=c.index;if(-1!==u){var p=this.termsByVarIndex[u];if(void 0===p)this.addTerm(h,c);else if(h!==p.coefficient){var g=h-p.coefficient;!0===this.isUpperBound&&(g=-g),p.coefficient=h,this.model.updateConstraintCoefficient(this,c,g)}return this}console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.")},l.prototype.relax=function(h,c){this.relaxation=a(this.model,h,c),this._relax(this.relaxation)},l.prototype._relax=function(h){null!==h&&this.setVariableCoefficient(this.isUpperBound?-1:1,h)},d.prototype.isEquality=!0,d.prototype.addTerm=function(h,c){return this.upperBound.addTerm(h,c),this.lowerBound.addTerm(h,c),this},d.prototype.removeTerm=function(h){return this.upperBound.removeTerm(h),this.lowerBound.removeTerm(h),this},d.prototype.setRightHandSide=function(h){this.upperBound.setRightHandSide(h),this.lowerBound.setRightHandSide(h),this.rhs=h},d.prototype.relax=function(h,c){this.relaxation=a(this.model,h,c),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)},e.exports={Constraint:l,Variable:n,IntegerVariable:i,SlackVariable:r,Equality:d,Term:o}}),f=Y(()=>{var t=G(),e=s().SlackVariable;t.prototype.addCutConstraints=function(n){for(var i=n.length,r=this.height,o=r+i,a=r;a<o;a+=1)void 0===this.matrix[a]&&(this.matrix[a]=this.matrix[a-1].slice());this.height=o,this.nVars=this.width+this.height-2;for(var l,d=this.width-1,h=0;h<i;h+=1){var c=n[h],u=r+h,p="min"===c.type?-1:1,g=c.varIndex,k=this.rowByVarIndex[g],y=this.matrix[u];if(-1===k){for(y[this.rhsColumn]=p*c.value,l=1;l<=d;l+=1)y[l]=0;y[this.colByVarIndex[g]]=p}else{var I=this.matrix[k];for(y[this.rhsColumn]=p*(c.value-I[this.rhsColumn]),l=1;l<=d;l+=1)y[l]=-p*I[l]}var w=this.getNewElementIndex();this.varIndexByRow[u]=w,this.rowByVarIndex[w]=u,this.colByVarIndex[w]=-1,this.variablesPerIndex[w]=new e("s"+w,w),this.nVars+=1}},t.prototype._addLowerBoundMIRCut=function(n){if(n===this.costRowIndex)return!1;var r=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[n]].isInteger)return!1;var a=r[n][this.rhsColumn],l=a-Math.floor(a);if(l<this.precision||1-this.precision<l)return!1;var d=this.height;r[d]=r[d-1].slice(),this.height+=1,this.nVars+=1;var h=this.getNewElementIndex();this.varIndexByRow[d]=h,this.rowByVarIndex[h]=d,this.colByVarIndex[h]=-1,this.variablesPerIndex[h]=new e("s"+h,h),r[d][this.rhsColumn]=Math.floor(a);for(var c=1;c<this.varIndexByCol.length;c+=1)if(this.variablesPerIndex[this.varIndexByCol[c]].isInteger){var p=r[n][c],g=Math.floor(p)+Math.max(0,p-Math.floor(p)-l)/(1-l);r[d][c]=g}else r[d][c]=Math.min(0,r[n][c]/(1-l));for(var k=0;k<this.width;k+=1)r[d][k]-=r[n][k];return!0},t.prototype._addUpperBoundMIRCut=function(n){if(n===this.costRowIndex)return!1;var r=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[n]].isInteger)return!1;var a=r[n][this.rhsColumn],l=a-Math.floor(a);if(l<this.precision||1-this.precision<l)return!1;var d=this.height;r[d]=r[d-1].slice(),this.height+=1,this.nVars+=1;var h=this.getNewElementIndex();this.varIndexByRow[d]=h,this.rowByVarIndex[h]=d,this.colByVarIndex[h]=-1,this.variablesPerIndex[h]=new e("s"+h,h),r[d][this.rhsColumn]=-l;for(var c=1;c<this.varIndexByCol.length;c+=1){var u=this.variablesPerIndex[this.varIndexByCol[c]],p=r[n][c],g=p-Math.floor(p);r[d][c]=u.isInteger?g<=l?-g:-(1-g)*l/g:p>=0?-p:p*l/(1-l)}return!0},t.prototype.applyMIRCuts=function(){}}),v=Y(()=>{var t=G();t.prototype._putInBase=function(e){var n=this.rowByVarIndex[e];if(-1===n){for(var i=this.colByVarIndex[e],r=1;r<this.height;r+=1){var o=this.matrix[r][i];if(o<-this.precision||this.precision<o){n=r;break}}this.pivot(n,i)}return n},t.prototype._takeOutOfBase=function(e){var n=this.colByVarIndex[e];if(-1===n){for(var i=this.rowByVarIndex[e],r=this.matrix[i],o=1;o<this.height;o+=1){var a=r[o];if(a<-this.precision||this.precision<a){n=o;break}}this.pivot(i,n)}return n},t.prototype.updateVariableValues=function(){for(var e=this.variables.length,n=Math.round(1/this.precision),i=0;i<e;i+=1){var r=this.variables[i],a=this.rowByVarIndex[r.index];r.value=-1===a?0:Math.round((this.matrix[a][this.rhsColumn]+Number.EPSILON)*n)/n}},t.prototype.updateRightHandSide=function(e,n){var i=this.height-1,r=this.rowByVarIndex[e.index];if(-1===r){for(var o=this.colByVarIndex[e.index],a=0;a<=i;a+=1){var l=this.matrix[a];l[this.rhsColumn]-=n*l[o]}var d=this.optionalObjectives.length;if(d>0)for(var h=0;h<d;h+=1){var c=this.optionalObjectives[h].reducedCosts;c[this.rhsColumn]-=n*c[o]}}else this.matrix[r][this.rhsColumn]-=n},t.prototype.updateConstraintCoefficient=function(e,n,i){if(e.index===n.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var r=this._putInBase(e.index),o=this.colByVarIndex[n.index];if(-1===o)for(var a=this.rowByVarIndex[n.index],l=0;l<this.width;l+=1)this.matrix[r][l]+=i*this.matrix[a][l];else this.matrix[r][o]-=i},t.prototype.updateCost=function(e,n){var i=e.index,r=this.width-1,o=this.colByVarIndex[i];if(-1===o){var l,a=this.matrix[this.rowByVarIndex[i]];if(0===e.priority){var d=this.matrix[0];for(l=0;l<=r;l+=1)d[l]+=n*a[l]}else{var h=this.objectivesByPriority[e.priority].reducedCosts;for(l=0;l<=r;l+=1)h[l]+=n*a[l]}}else this.matrix[0][o]-=n},t.prototype.addConstraint=function(e){var n=e.isUpperBound?1:-1,i=this.height,r=this.matrix[i];void 0===r&&(r=this.matrix[0].slice(),this.matrix[i]=r);for(var o=this.width-1,a=0;a<=o;a+=1)r[a]=0;r[this.rhsColumn]=n*e.rhs;for(var l=e.terms,d=l.length,h=0;h<d;h+=1){var c=l[h],u=c.coefficient,p=c.variable.index,g=this.rowByVarIndex[p];if(-1===g)r[this.colByVarIndex[p]]+=n*u;else{var k=this.matrix[g];for(a=0;a<=o;a+=1)r[a]-=n*u*k[a]}}var I=e.index;this.varIndexByRow[i]=I,this.rowByVarIndex[I]=i,this.colByVarIndex[I]=-1,this.height+=1},t.prototype.removeConstraint=function(e){var n=e.index,i=this.height-1,r=this._putInBase(n),o=this.matrix[i];this.matrix[i]=this.matrix[r],this.matrix[r]=o,this.varIndexByRow[r]=this.varIndexByRow[i],this.varIndexByRow[i]=-1,this.rowByVarIndex[n]=-1,this.availableIndexes[this.availableIndexes.length]=n,e.slack.index=-1,this.height-=1},t.prototype.addVariable=function(e){var n=this.height-1,i=this.width,r=!0===this.model.isMinimization?-e.cost:e.cost,o=e.priority,a=this.optionalObjectives.length;if(a>0)for(var l=0;l<a;l+=1)this.optionalObjectives[l].reducedCosts[i]=0;0===o?this.matrix[0][i]=r:(this.setOptionalObjective(o,i,r),this.matrix[0][i]=0);for(var d=1;d<=n;d+=1)this.matrix[d][i]=0;var h=e.index;this.varIndexByCol[i]=h,this.rowByVarIndex[h]=-1,this.colByVarIndex[h]=i,this.width+=1},t.prototype.removeVariable=function(e){var n=e.index,i=this._takeOutOfBase(n),r=this.width-1;if(i!==r){for(var o=this.height-1,a=0;a<=o;a+=1){var l=this.matrix[a];l[i]=l[r]}var d=this.optionalObjectives.length;if(d>0)for(var h=0;h<d;h+=1){var c=this.optionalObjectives[h].reducedCosts;c[i]=c[r]}var u=this.varIndexByCol[r];this.varIndexByCol[i]=u,this.colByVarIndex[u]=i}this.varIndexByCol[r]=-1,this.colByVarIndex[n]=-1,this.availableIndexes[this.availableIndexes.length]=n,e.index=-1,this.width-=1}}),M=Y(()=>{G().prototype.log=function(e,n){console.log("****",e,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var a,l,h,c,u,p,g,y,I,_,w,r="",o=[" "];for(l=1;l<this.width;l+=1)g=(p=void 0===(c=this.variablesPerIndex[u=this.varIndexByCol[l]])?"c"+u:c.id).length,Math.abs(g-5),y=" ",I="\t",g>5?y+=" ":I+="\t",o[l]=y,r+=I+p;console.log(r);var E=this.matrix[this.costRowIndex],A="\t";for(a=1;a<this.width;a+=1)A+="\t",A+=o[a],A+=E[a].toFixed(5);for(A+="\t"+o[0]+E[0].toFixed(5),console.log(A+"\tZ"),h=1;h<this.height;h+=1){for(_=this.matrix[h],w="\t",l=1;l<this.width;l+=1)w+="\t"+o[l]+_[l].toFixed(5);w+="\t"+o[0]+_[0].toFixed(5),p=void 0===(c=this.variablesPerIndex[u=this.varIndexByRow[h]])?"c"+u:c.id,console.log(w+"\t"+p)}console.log("");var b=this.optionalObjectives.length;if(b>0){console.log("    Optional objectives:");for(var B=0;B<b;B+=1){var N=this.optionalObjectives[B].reducedCosts,F="";for(a=1;a<this.width;a+=1)F+=N[a]<0?"":" ",F+=o[a],F+=N[a].toFixed(5);F+=(N[0]<0?"":" ")+o[0]+N[0].toFixed(5),console.log(F+" z"+B)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this}}),P=Y(()=>{var t=G();t.prototype.copy=function(){var e=new t(this.precision);e.width=this.width,e.height=this.height,e.nVars=this.nVars,e.model=this.model,e.variables=this.variables,e.variablesPerIndex=this.variablesPerIndex,e.unrestrictedVars=this.unrestrictedVars,e.lastElementIndex=this.lastElementIndex,e.varIndexByRow=this.varIndexByRow.slice(),e.varIndexByCol=this.varIndexByCol.slice(),e.rowByVarIndex=this.rowByVarIndex.slice(),e.colByVarIndex=this.colByVarIndex.slice(),e.availableIndexes=this.availableIndexes.slice();for(var n=[],i=0;i<this.optionalObjectives.length;i++)n[i]=this.optionalObjectives[i].copy();e.optionalObjectives=n;for(var r=this.matrix,o=new Array(this.height),a=0;a<this.height;a++)o[a]=r[a].slice();return e.matrix=o,e},t.prototype.save=function(){this.savedState=this.copy()},t.prototype.restore=function(){if(null!==this.savedState){var i,r,e=this.savedState,n=e.matrix;for(this.nVars=e.nVars,this.model=e.model,this.variables=e.variables,this.variablesPerIndex=e.variablesPerIndex,this.unrestrictedVars=e.unrestrictedVars,this.lastElementIndex=e.lastElementIndex,this.width=e.width,this.height=e.height,i=0;i<this.height;i+=1){var o=n[i],a=this.matrix[i];for(r=0;r<this.width;r+=1)a[r]=o[r]}var l=e.varIndexByRow;for(r=0;r<this.height;r+=1)this.varIndexByRow[r]=l[r];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var d=e.varIndexByCol;for(i=0;i<this.width;i+=1)this.varIndexByCol[i]=d[i];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var h=e.rowByVarIndex,c=e.colByVarIndex,u=0;u<this.nVars;u+=1)this.rowByVarIndex[u]=h[u],this.colByVarIndex[u]=c[u];if(e.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var p=0;p<e.optionalObjectives.length;p++){var g=e.optionalObjectives[p].copy();this.optionalObjectives[p]=g,this.optionalObjectivePerPriority[g.priority]=g}}}}}),D=Y(()=>{var t=G();function e(n,i){this.index=n,this.value=i}t.prototype.getMostFractionalVar=function(){for(var n=0,i=null,r=null,a=this.model.integerVariables,l=a.length,d=0;d<l;d++){var h=a[d].index,c=this.rowByVarIndex[h];if(-1!==c){var u=this.matrix[c][this.rhsColumn],p=Math.abs(u-Math.round(u));n<p&&(n=p,i=h,r=u)}}return new e(i,r)},t.prototype.getFractionalVarWithLowestCost=function(){for(var n=1/0,i=null,r=null,o=this.model.integerVariables,a=o.length,l=0;l<a;l++){var d=o[l],h=d.index,c=this.rowByVarIndex[h];if(-1!==c){var u=this.matrix[c][this.rhsColumn];if(Math.abs(u-Math.round(u))>this.precision){var p=d.cost;n>p&&(n=p,i=h,r=u)}}}return new e(i,r)}}),q=Y(()=>{var t=G();t.prototype.countIntegerValues=function(){for(var e=0,n=1;n<this.height;n+=1)if(this.variablesPerIndex[this.varIndexByRow[n]].isInteger){var i=this.matrix[n][this.rhsColumn];(i-=Math.floor(i))<this.precision&&-i<this.precision&&(e+=1)}return e},t.prototype.isIntegral=function(){for(var e=this.model.integerVariables,n=e.length,i=0;i<n;i++){var r=this.rowByVarIndex[e[i].index];if(-1!==r){var o=this.matrix[r][this.rhsColumn];if(Math.abs(o-Math.round(o))>this.precision)return!1}}return!0},t.prototype.computeFractionalVolume=function(e){for(var n=-1,i=1;i<this.height;i+=1)if(this.variablesPerIndex[this.varIndexByRow[i]].isInteger){var r=this.matrix[i][this.rhsColumn];if(r=Math.abs(r),Math.min(r-Math.floor(r),Math.floor(r+1))<this.precision){if(!e)return 0}else-1===n?n=r:n*=r}return-1===n?0:n}}),ht=Y((t,e)=>{Me(),f(),v(),M(),P(),D(),q(),e.exports=G()}),ct=Y(()=>{var t=G();function e(r,o,a){this.type=r,this.varIndex=o,this.value=a}function n(r,o){this.relaxedEvaluation=r,this.cuts=o}function i(r,o){return o.relaxedEvaluation-r.relaxedEvaluation}t.prototype.applyCuts=function(r){if(this.restore(),this.addCutConstraints(r),this.simplex(),this.model.useMIRCuts)for(var o=!0;o;){var a=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex(),this.computeFractionalVolume(!0)>=.9*a&&(o=!1)}},t.prototype.branchAndCut=function(){var r=[],o=0,a=this.model.tolerance,l=!0,d=1e99;this.model.timeout&&(d=Date.now()+this.model.timeout);for(var h=1/0,c=null,u=[],p=0;p<this.optionalObjectives.length;p+=1)u.push(1/0);var g=new n(-1/0,[]);for(r.push(g);r.length>0&&!0===l&&Date.now()<d;)if(a>0&&h<(this.model.isMinimization?this.bestPossibleEval*(1+a):this.bestPossibleEval*(1-a))&&(l=!1),!((g=r.pop()).relaxedEvaluation>h)){var y=g.cuts;if(this.applyCuts(y),o++,!1!==this.feasible){var I=this.evaluation;if(!(I>h)){if(I===h){for(var _=!0,w=0;w<this.optionalObjectives.length&&!(this.optionalObjectives[w].reducedCosts[0]>u[w]);w+=1)if(this.optionalObjectives[w].reducedCosts[0]<u[w]){_=!1;break}if(_)continue}if(!0===this.isIntegral()){if(this.__isIntegral=!0,1===o)return void(this.branchAndCutIterations=o);c=g,h=I;for(var x=0;x<this.optionalObjectives.length;x+=1)u[x]=this.optionalObjectives[x].reducedCosts[0]}else{1===o&&this.save();for(var E=this.getMostFractionalVar(),A=E.index,b=[],B=[],N=y.length,F=0;F<N;F+=1){var U=y[F];U.varIndex===A?"min"===U.type?B.push(U):b.push(U):(b.push(U),B.push(U))}var J=Math.ceil(E.value),Q=Math.floor(E.value),tt=new e("min",A,J);b.push(tt);var ut=new e("max",A,Q);B.push(ut),r.push(new n(I,b)),r.push(new n(I,B)),r.sort(i)}}}}null!==c&&this.applyCuts(c.cuts),this.branchAndCutIterations=o}}),T=Y((t,e)=>{var n=G(),r=(ct(),s()),o=r.Constraint,a=r.Equality,l=r.Variable,d=r.IntegerVariable;function c(u,p){this.tableau=new n(u),this.name=p,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}e.exports=c,c.prototype.minimize=function(){return this.isMinimization=!0,this},c.prototype.maximize=function(){return this.isMinimization=!1,this},c.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var u=this.lastElementIndex;return this.lastElementIndex+=1,u},c.prototype._addConstraint=function(u){var p=u.slack;this.tableau.variablesPerIndex[p.index]=p,this.constraints.push(u),this.nConstraints+=1,!0===this.tableauInitialized&&this.tableau.addConstraint(u)},c.prototype.smallerThan=function(u){var p=new o(u,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(p),p},c.prototype.greaterThan=function(u){var p=new o(u,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(p),p},c.prototype.equal=function(u){var p=new o(u,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(p);var g=new o(u,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(g),new a(p,g)},c.prototype.addVariable=function(u,p,g,k,y){if("string"==typeof y)switch(y){case"required":default:y=0;break;case"strong":y=1;break;case"medium":y=2;break;case"weak":y=3}var _,I=this.tableau.getNewElementIndex();return null==p&&(p="v"+I),null==u&&(u=0),null==y&&(y=0),g?(_=new d(p,u,I,y),this.integerVariables.push(_)):_=new l(p,u,I,y),this.variables.push(_),this.tableau.variablesPerIndex[I]=_,k&&(this.unrestrictedVariables[I]=!0),this.nVariables+=1,!0===this.tableauInitialized&&this.tableau.addVariable(_),_},c.prototype._removeConstraint=function(u){var p=this.constraints.indexOf(u);-1!==p?(this.constraints.splice(p,1),this.nConstraints-=1,!0===this.tableauInitialized&&this.tableau.removeConstraint(u),u.relaxation&&this.removeVariable(u.relaxation)):console.warn("[Model.removeConstraint] Constraint not present in model")},c.prototype.removeConstraint=function(u){return u.isEquality?(this._removeConstraint(u.upperBound),this._removeConstraint(u.lowerBound)):this._removeConstraint(u),this},c.prototype.removeVariable=function(u){var p=this.variables.indexOf(u);if(-1!==p)return this.variables.splice(p,1),!0===this.tableauInitialized&&this.tableau.removeVariable(u),this;console.warn("[Model.removeVariable] Variable not present in model")},c.prototype.updateRightHandSide=function(u,p){return!0===this.tableauInitialized&&this.tableau.updateRightHandSide(u,p),this},c.prototype.updateConstraintCoefficient=function(u,p,g){return!0===this.tableauInitialized&&this.tableau.updateConstraintCoefficient(u,p,g),this},c.prototype.setCost=function(u,p){var g=u-p.cost;return!1===this.isMinimization&&(g=-g),p.cost=u,this.tableau.updateCost(p,g),this},c.prototype.loadJson=function(u){this.isMinimization="max"!==u.opType;for(var p=u.variables,g=u.constraints,k={},y={},I=Object.keys(g),_=I.length,w=0;w<_;w+=1){var F,U,x=I[w],E=g[x],A=E.equal,b=E.weight,B=E.priority,N=void 0!==b||void 0!==B;if(void 0===A){var J=E.min;void 0!==J&&(F=this.greaterThan(J),k[x]=F,N&&F.relax(b,B));var Q=E.max;void 0!==Q&&(U=this.smallerThan(Q),y[x]=U,N&&U.relax(b,B))}else{F=this.greaterThan(A),k[x]=F,U=this.smallerThan(A),y[x]=U;var tt=new a(F,U);N&&tt.relax(b,B)}}var ut=Object.keys(p),kt=ut.length;this.tolerance=u.tolerance||0,u.timeout&&(this.timeout=u.timeout),u.options&&(u.options.timeout&&(this.timeout=u.options.timeout),0===this.tolerance&&(this.tolerance=u.options.tolerance||0),u.options.useMIRCuts&&(this.useMIRCuts=u.options.useMIRCuts),this.checkForCycles=typeof u.options.exitOnCycles>"u"||u.options.exitOnCycles);for(var vt=u.ints||{},wt=u.binaries||{},Ct=u.unrestricted||{},Dt=u.optimize,Gt=0;Gt<kt;Gt+=1){var Lt=ut[Gt],zt=p[Lt],Fe=!!wt[Lt],Tt=this.addVariable(zt[Dt]||0,Lt,!!vt[Lt]||Fe,!!Ct[Lt]);Fe&&this.smallerThan(1).addTerm(1,Tt);var me=Object.keys(zt);for(w=0;w<me.length;w+=1){var Yt=me[w];if(Yt!==Dt){var Ce=zt[Yt],Xe=k[Yt];void 0!==Xe&&Xe.addTerm(Ce,Tt);var qe=y[Yt];void 0!==qe&&qe.addTerm(Ce,Tt)}}}return this},c.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length},c.prototype.solve=function(){return!1===this.tableauInitialized&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()},c.prototype.isFeasible=function(){return this.tableau.feasible},c.prototype.save=function(){return this.tableau.save()},c.prototype.restore=function(){return this.tableau.restore()},c.prototype.activateMIRCuts=function(u){this.useMIRCuts=u},c.prototype.debug=function(u){this.checkForCycles=u},c.prototype.log=function(u){return this.tableau.log(u)}}),H=Y(t=>{t.CleanObjectiveAttributes=function(e){var n,i,r;if("string"==typeof e.optimize){if(e.constraints[e.optimize]){for(i in n=Math.random(),e.variables)e.variables[i][e.optimize]&&(e.variables[i][n]=e.variables[i][e.optimize]);return e.constraints[n]=e.constraints[e.optimize],delete e.constraints[e.optimize],e}return e}for(r in e.optimize)if(e.constraints[r])if("equal"===e.constraints[r])delete e.optimize[r];else{for(i in n=Math.random(),e.variables)e.variables[i][r]&&(e.variables[i][n]=e.variables[i][r]);e.constraints[n]=e.constraints[r],delete e.constraints[r]}return e}}),yt=Y((t,e)=>{e.exports=function(r){return r.length?function n(r){var o={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},a={opType:"",optimize:"_obj",constraints:{},variables:{}},l={">=":"min","<=":"max","=":"equal"},d="",c=null,u="",p="",g="",k=0;"string"==typeof r&&(r=r.split("\n"));for(var y=0;y<r.length;y++)if(g="__"+y,c=null,o.is_objective.test(d=r[y]))a.opType=d.match(/(max|min)/gi)[0],(c=d.match(o.parse_lhs).map(function(w){return w.replace(/\s+/,"")}).slice(1)).forEach(function(w){u=null===(u=w.match(o.get_num))?"-"===w.substr(0,1)?-1:1:u[0],u=parseFloat(u),p=w.match(o.get_word)[0].replace(/\;$/,""),a.variables[p]=a.variables[p]||{},a.variables[p]._obj=u});else if(o.is_int.test(d))c=d.match(o.parse_int).slice(1),a.ints=a.ints||{},c.forEach(function(w){w=w.replace(";",""),a.ints[w]=1});else if(o.is_bin.test(d))c=d.match(o.parse_bin).slice(1),a.binaries=a.binaries||{},c.forEach(function(w){w=w.replace(";",""),a.binaries[w]=1});else if(o.is_constraint.test(d)){var I=d.indexOf(":");(c=(-1===I?d:d.slice(I+1)).match(o.parse_lhs).map(function(w){return w.replace(/\s+/,"")})).forEach(function(w){u=null===(u=w.match(o.get_num))?"-"===w.substr(0,1)?-1:1:u[0],u=parseFloat(u),p=w.match(o.get_word)[0],a.variables[p]=a.variables[p]||{},a.variables[p][g]=u}),k=parseFloat(d.match(o.parse_rhs)[0]),d=l[d.match(o.parse_dir)[0]],a.constraints[g]=a.constraints[g]||{},a.constraints[g][d]=k}else o.is_unrestricted.test(d)&&(c=d.match(o.parse_int).slice(1),a.unrestricted=a.unrestricted||{},c.forEach(function(w){w=w.replace(";",""),a.unrestricted[w]=1}));return a}(r):function i(r){if(!r)throw new Error("Solver requires a model to operate on");var o="",d={max:"<=",min:">=",equal:"="},h=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(r.opType)for(var c in o+=r.opType+":",r.variables)r.variables[c][c]=r.variables[c][c]?r.variables[c][c]:1,r.variables[c][r.optimize]&&(o+=" "+r.variables[c][r.optimize]+" "+c.replace(h,"_"));else o+="max:";for(var u in o+=";\n\n",r.constraints)for(var p in r.constraints[u])if(typeof d[p]<"u"){for(var g in r.variables)typeof r.variables[g][u]<"u"&&(o+=" "+r.variables[g][u]+" "+g.replace(h,"_"));o+=" "+d[p]+" "+r.constraints[u][p],o+=";\n"}if(r.ints)for(var k in o+="\n\n",r.ints)o+="int "+k.replace(h,"_")+";\n";if(r.unrestricted)for(var y in o+="\n\n",r.unrestricted)o+="unrestricted "+y.replace(h,"_")+";\n";return o}(r)}}),L=Y(()=>{}),O=Y(()=>{}),R=Y(t=>{function e(n){return(n=(n=n.replace("\\r\\n","\r\n")).split("\r\n")).filter(function(i){var r;return!(!0===(r=new RegExp(" 0$","gi")).test(i)||(r=new RegExp("\\d$","gi"),!1===r.test(i)))}).map(function(i){return i.split(/\:{0,1} +(?=\d)/)}).reduce(function(i,r,o){return i[r[0]]=r[1],i},{})}t.reformat=yt(),t.solve=function(n){return new Promise(function(i,r){typeof window<"u"&&r("Function Not Available in Browser");var o=yt()(n);n.external||r("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),n.external.binPath||r("No Executable | Binary path provided in arguments as 'binPath'"),n.external.args||r("No arguments array for cli | bash provided on 'args' attribute"),n.external.tempName||r("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on"),L().writeFile(n.external.tempName,o,function(l,d){if(l)r(l);else{var h=O().execFile;n.external.args.push(n.external.tempName),h(n.external.binPath,n.external.args,function(c,u){c?1===c.code?i(e(u)):r({code:c.code,meaning:{"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"}[c.code],data:u}):i(e(u))})}})})}}),nt=Y((t,e)=>{e.exports={lpsolve:R()}}),pt=Y((t,e)=>{e.exports=function(n,i){var l,g,k,y,I,r=i.optimize,o=JSON.parse(JSON.stringify(i.optimize)),a=Object.keys(i.optimize),d=0,h={},c="",u={},p=[];for(delete i.optimize,g=0;g<a.length;g++)o[a[g]]=0;for(g=0;g<a.length;g++){for(I in i.optimize=a[g],i.opType=r[a[g]],l=n.Solve(i,void 0,void 0,!0),a)if(!i.variables[a[I]])for(y in l[a[I]]=l[a[I]]?l[a[I]]:0,i.variables)i.variables[y][a[I]]&&l[y]&&(l[a[I]]+=l[y]*i.variables[y][a[I]]);for(c="base",k=0;k<a.length;k++)c+=l[a[k]]?"-"+(1e3*l[a[k]]|0)/1e3:"-0";if(!h[c]){for(h[c]=1,d++,k=0;k<a.length;k++)l[a[k]]&&(o[a[k]]+=l[a[k]]);delete l.feasible,delete l.result,p.push(l)}}for(g=0;g<a.length;g++)i.constraints[a[g]]={equal:o[a[g]]/d};for(g in i.optimize="cheater-"+Math.random(),i.opType="max",i.variables)i.variables[g].cheater=1;for(g in p)for(y in p[g])u[y]=u[y]||{min:1e99,max:-1e99};for(g in u)for(y in p)p[y][g]?(p[y][g]>u[g].max&&(u[g].max=p[y][g]),p[y][g]<u[g].min&&(u[g].min=p[y][g])):(p[y][g]=0,u[g].min=0);return{midpoint:l=n.Solve(i,void 0,void 0,!0),vertices:p,ranges:u}}}),_t=Y((t,e)=>{var n=ht(),i=T(),r=ct(),o=s(),a=H(),l=o.Constraint,d=o.Variable,h=o.Numeral,c=o.Term,u=nt(),p=function(){this.Model=i,this.branchAndCut=r,this.Constraint=l,this.Variable=d,this.Numeral=h,this.Term=c,this.Tableau=n,this.lastSolvedModel=null,this.External=u,this.Solve=function(g,k,y,I){if(I)for(var _ in a)g=a[_](g);if(!g)throw new Error("Solver requires a model to operate on");if("object"==typeof g.optimize&&Object.keys(g.optimize>1))return pt()(this,g);if(g.external){var w=Object.keys(u);if(w=JSON.stringify(w),!g.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+w);if(!u[g.external.solver])throw new Error("No support (yet) for "+g.external.solver+". Please use one of these instead:"+w);return u[g.external.solver].solve(g)}g instanceof i||(g=new i(k).loadJson(g));var x=g.solve();if(this.lastSolvedModel=g,x.solutionSet=x.generateSolutionSet(),y)return x;var E={};return E.feasible=x.feasible,E.result=x.evaluation,E.bounded=x.bounded,x._tableau.__isIntegral&&(E.isIntegral=!0),Object.keys(x.solutionSet).forEach(function(A){0!==x.solutionSet[A]&&(E[A]=x.solutionSet[A])}),E},this.ReformatLP=yt(),this.MultiObjective=function(g){return pt()(this,g)}};"function"==typeof define?define([],function(){return new p}):"object"==typeof window?window.solver=new p:"object"==typeof self&&(self.solver=new p),e.exports=new p}),Ht=Y((t,e)=>{var i,r,n=1e-60;do{i=1+.1*(n+=n),r=1+.2*n}while(i<=1||r<=1);e.exports=n}),Rt=Y((t,e)=>{e.exports=function n(i,r,o){let a,l;for(let d=1;d<=o;d+=1){i[d][d]=1/i[d][d],l=-i[d][d];for(let h=1;h<d;h+=1)i[h][d]*=l;if(a=d+1,o<a)break;for(let h=a;h<=o;h+=1){l=i[d][h],i[d][h]=0;for(let c=1;c<=d;c+=1)i[c][h]+=l*i[c][d]}}}}),we=Y((t,e)=>{e.exports=function n(i,r,o,a){let l,d;for(l=1;l<=o;l+=1){d=0;for(let h=1;h<l;h+=1)d+=i[h][l]*a[h];a[l]=(a[l]-d)/i[l][l]}for(let h=1;h<=o;h+=1){l=o+1-h,a[l]/=i[l][l],d=-a[l];for(let c=1;c<l;c+=1)a[c]+=d*i[c][l]}}}),rr=Y((t,e)=>{e.exports=function n(i,r,o,a){let l,d,h;for(let c=1;c<=o;c+=1){if(a[1]=c,h=0,l=c-1,l<1){if(h=i[c][c]-h,h<=0)break;i[c][c]=Math.sqrt(h)}else{for(let u=1;u<=l;u+=1){d=i[u][c];for(let p=1;p<u;p+=1)d-=i[p][c]*i[p][u];d/=i[u][u],i[u][c]=d,h+=d*d}if(h=i[c][c]-h,h<=0)break;i[c][c]=Math.sqrt(h)}a[1]=0}}}),nr=Y((t,e)=>{var n=Ht(),i=Rt(),r=we(),o=rr();e.exports=function a(l,d,h,c,u,p,g,k,y,I,_,w,x,E=0,A,b,B){let N,F,U,J,Q,tt,ut,kt,vt,wt,Ct,Dt,Gt,Lt,zt=Math.min(c,_),Bt=2*c+zt*(zt+5)/2+2*_+1;for(let C=1;C<=c;C+=1)b[C]=d[C];for(let C=c+1;C<=Bt;C+=1)b[C]=0;for(let C=1;C<=_;C+=1)x[C]=0,p[C]=0;let Fe=[];if(0===B[1]){if(o(l,h,c,Fe),0!==Fe[1])return void(B[1]=2);r(l,h,c,d),i(l,h,c)}else{for(let C=1;C<=c;C+=1){u[C]=0;for(let at=1;at<=C;at+=1)u[C]+=l[at][C]*d[at]}for(let C=1;C<=c;C+=1){d[C]=0;for(let at=C;at<=c;at+=1)d[C]+=l[C][at]*u[at]}}g[1]=0;for(let C=1;C<=c;C+=1){u[C]=d[C],g[1]+=b[C]*u[C],b[C]=0;for(let at=C+1;at<=c;at+=1)l[at][C]=0}g[1]=-g[1]/2,B[1]=0;let le=c,Kt=le+c,Tt=Kt+zt,me=Tt+zt+1,Yt=me+zt*(zt+1)/2,Ce=Yt+_;for(let C=1;C<=_;C+=1){tt=0;for(let at=1;at<=c;at+=1)tt+=k[at][C]*k[at][C];b[Ce+C]=Math.sqrt(tt)}function Xe(){A[1]+=1,Bt=Yt;for(let C=1;C<=_;C+=1){Bt+=1,tt=-y[C];for(let at=1;at<=c;at+=1)tt+=k[at][C]*u[at];if(Math.abs(tt)<n&&(tt=0),C>w)b[Bt]=tt;else if(b[Bt]=-Math.abs(tt),tt>0){for(let at=1;at<=c;at+=1)k[at][C]=-k[at][C];y[C]=-y[C]}}for(let C=1;C<=J;C+=1)b[Yt+x[C]]=0;U=0,Q=0;for(let C=1;C<=_;C+=1)b[Yt+C]<Q*b[Ce+C]&&(U=C,Q=b[Yt+C]/b[Ce+C]);if(0===U){for(let C=1;C<=J;C+=1)p[x[C]]=b[Tt+C];return 999}return 0}function qe(){for(let C=1;C<=c;C+=1){tt=0;for(let at=1;at<=c;at+=1)tt+=l[at][C]*k[at][U];b[C]=tt}N=le;for(let C=1;C<=c;C+=1)b[N+C]=0;for(let C=J+1;C<=c;C+=1)for(let at=1;at<=c;at+=1)b[N+at]=b[N+at]+l[at][C]*b[C];Dt=!0;for(let C=J;C>=1;C-=1){tt=b[C],Bt=me+C*(C+3)/2,N=Bt-C;for(let at=C+1;at<=J;at+=1)tt-=b[Bt]*b[Kt+at],Bt+=at;tt/=b[N],b[Kt+C]=tt,!(x[C]<=w)&&(tt<=0||(Dt=!1,F=C))}if(!Dt){ut=b[Tt+F]/b[Kt+F];for(let C=1;C<=J;C+=1)x[C]<=w||b[Kt+C]<=0||(Q=b[Tt+C]/b[Kt+C],Q<ut&&(ut=Q,F=C))}tt=0;for(let C=le+1;C<=le+c;C+=1)tt+=b[C]*b[C];if(Math.abs(tt)<=n){if(Dt)return B[1]=1,999;for(let C=1;C<=J;C+=1)b[Tt+C]=b[Tt+C]-ut*b[Kt+C];return b[Tt+J+1]=b[Tt+J+1]+ut,700}tt=0;for(let C=1;C<=c;C+=1)tt+=b[le+C]*k[C][U];kt=-b[Yt+U]/tt,Gt=!0,Dt||ut<kt&&(kt=ut,Gt=!1);for(let C=1;C<=c;C+=1)u[C]+=kt*b[le+C],Math.abs(u[C])<n&&(u[C]=0);g[1]+=kt*tt*(kt/2+b[Tt+J+1]);for(let C=1;C<=J;C+=1)b[Tt+C]=b[Tt+C]-kt*b[Kt+C];if(b[Tt+J+1]=b[Tt+J+1]+kt,!Gt){tt=-y[U];for(let C=1;C<=c;C+=1)tt+=u[C]*k[C][U];if(U>w)b[Yt+U]=tt;else if(b[Yt+U]=-Math.abs(tt),tt>0){for(let C=1;C<=c;C+=1)k[C][U]=-k[C][U];y[U]=-y[U]}return 700}J+=1,x[J]=U,Bt=me+(J-1)*J/2+1;for(let C=1;C<=J-1;C+=1)b[Bt]=b[C],Bt+=1;if(J===c)b[Bt]=b[c];else{for(let C=c;C>=J+1;C-=1)if(0!==b[C]&&(vt=Math.max(Math.abs(b[C-1]),Math.abs(b[C])),wt=Math.min(Math.abs(b[C-1]),Math.abs(b[C])),Q=b[C-1]>=0?Math.abs(vt*Math.sqrt(1+wt*wt/(vt*vt))):-Math.abs(vt*Math.sqrt(1+wt*wt/(vt*vt))),vt=b[C-1]/Q,wt=b[C]/Q,1!==vt))if(0===vt){b[C-1]=wt*Q;for(let at=1;at<=c;at+=1)Q=l[at][C-1],l[at][C-1]=l[at][C],l[at][C]=Q}else{b[C-1]=Q,Ct=wt/(1+vt);for(let at=1;at<=c;at+=1)Q=vt*l[at][C-1]+wt*l[at][C],l[at][C]=Ct*(l[at][C-1]+Q)-l[at][C],l[at][C-1]=Q}b[Bt]=b[J]}return 0}function Rn(){if(Bt=me+F*(F+1)/2+1,N=Bt+F,0===b[N]||(vt=Math.max(Math.abs(b[N-1]),Math.abs(b[N])),wt=Math.min(Math.abs(b[N-1]),Math.abs(b[N])),Q=b[N-1]>=0?Math.abs(vt*Math.sqrt(1+wt*wt/(vt*vt))):-Math.abs(vt*Math.sqrt(1+wt*wt/(vt*vt))),vt=b[N-1]/Q,wt=b[N]/Q,1===vt))return 798;if(0===vt){for(let C=F+1;C<=J;C+=1)Q=b[N-1],b[N-1]=b[N],b[N]=Q,N+=C;for(let C=1;C<=c;C+=1)Q=l[C][F],l[C][F]=l[C][F+1],l[C][F+1]=Q}else{Ct=wt/(1+vt);for(let C=F+1;C<=J;C+=1)Q=vt*b[N-1]+wt*b[N],b[N]=Ct*(b[N-1]+Q)-b[N],b[N-1]=Q,N+=C;for(let C=1;C<=c;C+=1)Q=vt*l[C][F]+wt*l[C][F+1],l[C][F+1]=Ct*(l[C][F]+Q)-l[C][F+1],l[C][F]=Q}return 0}function zn(){N=Bt-F;for(let C=1;C<=F;C+=1)b[N]=b[Bt],Bt+=1,N+=1;return b[Tt+F]=b[Tt+F+1],x[F]=x[F+1],F+=1,F<J?797:0}function ir(){return b[Tt+J]=b[Tt+J+1],b[Tt+J+1]=0,x[J]=0,J-=1,A[2]+=1,0}for(J=E,A[1]=0,A[2]=0,Lt=0;;){if(Lt=Xe(),999===Lt)return;for(;Lt=qe(),0!==Lt;){if(999===Lt)return;if(700===Lt)if(F===J)ir();else{for(;Rn(),Lt=zn(),797===Lt;);ir()}}}}}),or=Y(t=>{var e=nr();t.solveQP=function n(i,r,o,a=[],l=0,d=[0,0]){let h=[],c=[],u=[],p=[],g=[],k=[],y="",I=i.length-1,_=o[1].length-1;if(!a)for(let E=1;E<=_;E+=1)a[E]=0;if(I!==i[1].length-1&&(y="Dmat is not symmetric!"),I!==r.length-1&&(y="Dmat and dvec are incompatible!"),I!==o.length-1&&(y="Amat and dvec are incompatible!"),_!==a.length-1&&(y="Amat and bvec are incompatible!"),(l>_||l<0)&&(y="Value of meq is invalid!"),""!==y)return{message:y};for(let E=1;E<=_;E+=1)c[E]=0,p[E]=0;let x=Math.min(I,_);for(let E=1;E<=I;E+=1)u[E]=0;h[1]=0;for(let E=1;E<=2*I+x*(x+5)/2+2*_+1;E+=1)g[E]=0;for(let E=1;E<=2;E+=1)k[E]=0;return e(i,r,I,I,u,p,h,o,a,I,_,l,c,0,k,g,d),1===d[1]&&(y="constraints are inconsistent, no solution!"),2===d[1]&&(y="matrix D in quadratic function is not positive definite!"),{solution:u,Lagrangian:p,value:h,unconstrained_solution:r,iterations:k,iact:c,message:y}}}),sr=Y((t,e)=>{e.exports=or()});function lr(t){for(let e of t)return e}function $e(t){for(let e of t)return t.delete(e),e}function Qe(t,e,n){let i=t.get(e);void 0===i?t.set(e,[n]):i.push(n)}function Ke(t,e,n){let i=t.get(e);void 0===i?t.set(e,new Set([n])):i.add(n)}function vi(t,e,n){let i=t.get(e);void 0!==i&&(i.delete(n),i.size||t.delete(e))}var{toString:cr}=Object.prototype,{propertyIsEnumerable:ur}=Object.prototype;function*Se(t,...e){let i,n=new Set;for(;void 0!==(i=e.pop());)n.has(i)||(yield i,n.add(i),e.push(...t(i)))}function ti(t,e){let n=[];for(let[i,r]of Ft(e))n.push(t[i]),n.push(r);return n.push(t[t.length-1]),n.join("")}function j(t,...e){let n=St(e,i=>function pr(t,e,n){let i=[];return function r(o,a={},l=""){let h,d=a.indent||"\t";h=void 0===a.inlineCharacterLimit?{newline:"\n",newlineOrSpace:"\n",pad:l,indent:l+d}:{newline:"@@__STRINGIFY_OBJECT_NEW_LINE__@@",newlineOrSpace:"@@__STRINGIFY_OBJECT_NEW_LINE_OR_SPACE__@@",pad:"@@__STRINGIFY_OBJECT_PAD__@@",indent:"@@__STRINGIFY_OBJECT_INDENT__@@"};let c=u=>{if(void 0===a.inlineCharacterLimit)return u;let p=u.replace(new RegExp(h.newline,"g"),"").replace(new RegExp(h.newlineOrSpace,"g")," ").replace(new RegExp(h.pad+"|"+h.indent,"g"),"");return p.length<=a.inlineCharacterLimit?p:u.replace(new RegExp(h.newline+"|"+h.newlineOrSpace,"g"),"\n").replace(new RegExp(h.pad,"g"),l).replace(new RegExp(h.indent,"g"),l+d)};if(i.includes(o))return'"[Circular]"';if(null==o||"number"==typeof o||"boolean"==typeof o||"function"==typeof o||"symbol"==typeof o||function hr(t){return"[object RegExp]"===cr.call(t)}(o))return String(o);if(o instanceof Date)return`new Date('${o.toISOString()}')`;if(Array.isArray(o)){if(0===o.length)return"[]";i.push(o);let u="["+h.newline+o.map((p,g)=>{let k=o.length-1===g?h.newline:","+h.newlineOrSpace,y=r(p,a,l+d);return a.transform&&(y=a.transform(o,g,y)),h.indent+y+k}).join("")+h.pad+"]";return i.pop(),c(u)}if(function dr(t){let e=typeof t;return null!==t&&("object"===e||"function"===e)}(o)){let u=function fr(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t).filter(e=>ur.call(t,e))]}(o);if(a.filter&&(u=u.filter(g=>a.filter(o,g))),0===u.length)return"{}";i.push(o);let p="{"+h.newline+u.map((g,k)=>{let y=u.length-1===k?h.newline:","+h.newlineOrSpace,I="symbol"==typeof g,_=!I&&/^[a-z$_][$\w]*$/i.test(g),w=I||_?g:r(g,a),x=r(o[g],a,l+d);return a.transform&&(x=a.transform(o,g,x)),h.indent+String(w)+": "+x+y}).join("")+h.pad+"}";return i.pop(),c(p)}return o=o.replace(/\\/g,"\\\\"),o=String(o).replace(/[\r\n]/g,u=>"\n"===u?"\\n":"\\r"),!1===a.singleQuotes?`"${o=o.replace(/"/g,'\\"')}"`:`'${o=o.replace(/'/g,"\\'")}'`}(t,e,n)}(i,{indent:"  ",singleQuotes:!1,inlineCharacterLimit:60}));return new Error(ti(t,n))}function mi(t){return`internal error: ${t}; if you encounter this please submit an issue at: https://github.com/erikbrinkman/d3-dag/issues`}function re(t,...e){let n=St(e,i=>i.toString());return new Error(mi(ti(t,n)))}function Jt(t,e,...n){let[i,...r]=t,a=ti(r,St(n,d=>d.toString())),l=e.name||"anonymous";return new Error("d3dagBuiltin"in e?mi(`builtin ${i}'${l}'${a}`):`custom ${i}'${l}'${a}`)}function*Ft(t){let e=0;for(let n of t)yield[e++,n]}function*Ee(t,e){for(let[n,i]of Ft(t))yield*It(e(i,n))}function*St(t,e){for(let[n,i]of Ft(t))yield e(i,n)}function*Ae(t,e){for(let[n,i]of Ft(t))e(i,n)&&(yield i)}function wi(t,e){for(let[n,i]of Ft(t))if(e(i,n))return!0;return!1}function Et(t,e=0,n=t.length,i=1){if(i>0)return function*mr(t,e,n,i){let r=Math.min(n,t.length);for(let o=e;o<r;o+=i)yield t[o]}(t,e,n,i);if(i<0)return function*wr(t,e,n,i){let r=Math.max(n,-1);for(let o=e;o>r;o+=i)yield t[o]}(t,e,n,i);throw j`can't slice with zero stride`}function*ne(...t){for(let e of t)yield*It(e)}function*Ut(t){let e=t[Symbol.iterator](),n=e.next();if(!n.done){let r,i=n.value;for(;!(r=e.next()).done;)yield[i,r.value],i=r.value}}function xi(t){let n,e=[],i=new Map;for(let[o,a]of Ft(t.nodes()))i.set(a,o),e.push({x:a.ux,y:a.uy,data:a.data}),a===t&&(n=o);let r=[];for(let{source:o,target:a,data:l,points:d}of t.links())r.push({source:i.get(o),target:i.get(a),points:d,data:l});return{nodes:e,links:r,index:n,v:1}}var _r=class{constructor(t,e,n,i="inactive"){this.node=t,this.indeg=e,this.outdeg=n,this.stat=i}bucket(){let t=0===this.indeg?-1/0:0===this.outdeg?1/0:this.indeg-this.outdeg;return"top"===this.stat?Math.min(t,0):"bottom"===this.stat?Math.max(t,0):t}isTop(){return this.indeg<=this.outdeg&&"bottom"!==this.stat||"top"===this.stat}};function bi(t,e){let n=t[e];if(void 0===n){let i=new Set;return t[e]=i,i}return n}function ki(t){var e;let n;for(;t.length&&(null==(e=n=t[t.length-1])||!e.size);)t.pop();return n||void 0}function Ii(t,e=(()=>{})){let n=new Map,i=new Map,r=new Set,o=new Set,a=[],l=[];function d(x){return x===-1/0?r:x===1/0?o:x<=0?bi(a,-x):bi(l,x-1)}for(let x of t){let E=x.nparentLinks(),A=x.nchildLinks(),b=new _r(x,E,A),B=e(x);n.set(x,b),void 0===B?(b.stat="active",d(b.bucket()).add(b)):Ke(i,B,b)}let h=[...i].sort(([x],[E])=>x-E).map(([,x])=>x),c=0,u=h.length,p=h.length?h[c++]:new Set,g=h.length>1?h[--u]:new Set;for(let x of p)x.stat="top",d(x.bucket()).add(x);for(let x of g)x.stat="bottom",d(x.bucket()).add(x);function k(){var x;let E;if(E=null!=(x=$e(r))?x:$e(o))return E;let A=ki(a),b=ki(l);return b?$e(a.length>l.length?A:b):A?$e(A):void 0}let w,y=Array(n.size),I=0,_=n.size;for(;w=k();){let{node:x}=w,E=w.isTop()?I++:--_;w.stat="ranked",y[E]=x;for(let[A,b]of x.parentCounts()){let B=n.get(A);d(B.bucket()).delete(B),B.outdeg-=b,"ranked"!==B.stat&&"inactive"!==B.stat&&d(B.bucket()).add(B)}for(let[A,b]of x.childCounts()){let B=n.get(A);d(B.bucket()).delete(B),B.indeg-=b,"ranked"!==B.stat&&"inactive"!==B.stat&&d(B.bucket()).add(B)}if(p.delete(w),!p.size&&c<u){p=h[c++];for(let A of p)A.stat="top",d(A.bucket()).add(A)}if(g.delete(w),!g.size&&c<u){g=h[--u];for(let A of g)A.stat="bottom",d(A.bucket()).add(A)}}return y}function _i(t,e){let o,n=new Set,i=new Set,r=[];for(let a of t)if(!i.has(a)){for(r.push(a);o=r.pop();)n.delete(o),!i.has(o)&&(i.add(o),r.push(...e(o)));n.add(a)}return n}var he,de,ue,Qt,Re,ze,ii,ri,ni,Mr=class{constructor(){bt(this,he,0),bt(this,de,0),bt(this,ue,0),bt(this,Qt,!0),bt(this,Re,new Set),bt(this,ze,new Set),bt(this,ii,()=>{ft(this,he,V(this,he)-1)}),bt(this,ri,(t,e)=>{ft(this,de,V(this,de)+1),t?ft(this,ue,V(this,ue)+1):!e&&!0===V(this,Qt)&&ft(this,Qt,null)}),bt(this,ni,t=>{ft(this,de,V(this,de)-1),t?ft(this,ue,V(this,ue)-1):!1===V(this,Qt)&&ft(this,Qt,null)})}*nodes(){for(let t of this.split())yield*It(t.nodes())}topological(t){return Ii(this.nodes(),t)}*links(){for(let t of this.nodes())yield*It(t.childLinks())}nnodes(){return V(this,he)}nlinks(){return V(this,de)}*roots(){for(let t of this.split())yield*It(t.roots())}*leaves(){for(let t of this.split())yield*It(t.leaves())}*split(){let t;for(yield*It(V(this,Re));t=lr(V(this,ze));)yield t,t.nnodes()}connected(){let t=!1;for(let e of this.split()){if(t)return!1;t=!0}return!0}multi(){return!!V(this,ue)}acyclic(){if(null===V(this,Qt)){for(let t of this.split())if(!t.acyclic())return ft(this,Qt,!1),!1;return ft(this,Qt,!0),!0}return V(this,Qt)}node(t){return ft(this,he,V(this,he)+1),new Mi(this,V(this,Re),V(this,ze),V(this,ii),V(this,ri),V(this,ni),t)}link(t,e,n){return t.link(t,e,n)}toJSON(){return xi(this)}};function Ci(t){for(let e of t.values())for(let n of e)return n}function ye(t){return t instanceof Mi}he=new WeakMap,de=new WeakMap,ue=new WeakMap,Qt=new WeakMap,Re=new WeakMap,ze=new WeakMap,ii=new WeakMap,ri=new WeakMap,ni=new WeakMap;var Wt,Ge,Ve,Ue,oe,fe,te,pe,jt,ge,Xt,Zt,$t,xe,Le,ee,se,oi,Mi=class{constructor(t,e,n,i,r,o,a){this.data=a,bt(this,xe),bt(this,ee),bt(this,Wt,void 0),bt(this,Ge,void 0),bt(this,Ve,void 0),bt(this,Ue,void 0),bt(this,oe,void 0),bt(this,fe,void 0),bt(this,te,0),bt(this,pe,0),bt(this,jt,new Map),bt(this,ge,0),bt(this,Xt,new Map),bt(this,Zt,void 0),bt(this,$t,void 0),bt(this,oi,l=>{var d,h;let{source:c,target:u}=l,p=c.nchildLinksTo(u)>1;if(p){ft(c,te,V(c,te)-1);let g=At(d=c,ee,se).call(d);g.nlinks-=1,g.multis-=1}else{let g=At(h=c,xe,Le).call(h);ft(g,$t,null),V(this,oe).delete(g),V(this,fe).add(c),ft(c,Zt,c),ft(c,$t,null),V(this,fe).add(u),ft(u,Zt,u),ft(u,$t,null)}V(this,Ue).call(this,p),vi(V(c,Xt),u,l),ft(c,ge,V(c,ge)-1),vi(V(u,jt),c,l),ft(u,pe,V(u,pe)-1)}),ft(this,Wt,t),ft(this,oe,e),ft(this,fe,n),ft(this,Ge,i),ft(this,Ve,r),ft(this,Ue,o),ft(this,Zt,this),ft(this,$t,{nnodes:1,nlinks:0,multis:0,acyclic:!0,roots:[this],leaves:[this]}),V(this,oe).add(this)}get x(){if(void 0===this.ux)throw j`can't get \`x\` when \`ux\` is undefined`;return this.ux}set x(t){this.ux=t}get y(){if(void 0===this.uy)throw j`can't get \`y\` when \`uy\` is undefined`;return this.uy}set y(t){this.uy=t}*nodes(){yield*It(Se(t=>ne(t.children(),t.parents()),this))}topological(t){return Ii(this.nodes(),t)}*links(){for(let t of this.nodes())yield*It(t.childLinks())}nnodes(){return At(this,ee,se).call(this).nnodes}nlinks(){return At(this,ee,se).call(this).nlinks}*split(){yield this}connected(){return!0}multi(){return At(this,ee,se).call(this).multis>0}acyclic(){let t=At(this,ee,se).call(this);return null===t.acyclic?t.acyclic=function Cr(t){let i,e=new Map(St(t,r=>[r,r.nparents()])),n=[...St(Ae(e,([,r])=>0===r),([r])=>r)];for(let r of n)e.delete(r);for(;i=n.pop();)for(let r of i.children()){let o=e.get(r)-1;o?e.set(r,o):(e.delete(r),n.push(r))}return!e.size}(this.nodes()):t.acyclic}node(t){if(V(this,Wt))return V(this,Wt).node(t);throw j`can't add a node from a deleted node`}link(t,e,n){var i,r;if(V(this,Wt)){if(t===e)throw j`tried to create a link between the same node, but self loops are not supported`;if(ye(t)&&ye(e)&&V(t,Wt)===V(e,Wt)&&V(this,Wt)===V(t,Wt)){let o=new Sr(V(this,Wt),t,e,V(this,oi),n),a=t.nchildLinksTo(e)>0,l=At(i=t,xe,Le).call(i),d=V(l,$t),h=At(r=e,xe,Le).call(r),c=V(h,$t);if(a&&d)ft(t,te,V(t,te)+1),d.nlinks+=1,d.multis+=1;else if(a)ft(t,te,V(t,te)+1);else if(l===h&&d)d.nlinks+=1,!0===d.acyclic&&(d.acyclic=null);else if(l!==h&&d&&c){let[u,p,g,k]=d.nnodes>c.nnodes?[l,d,h,c]:[h,c,l,d];V(this,oe).delete(g),ft(g,Zt,u),ft(g,$t,void 0),p.nnodes+=k.nnodes,p.nlinks+=k.nlinks+1,p.multis+=k.multis,p.acyclic=!1!==p.acyclic&&!1!==k.acyclic&&(!0===p.acyclic&&!0===k.acyclic||null),p.roots=null,p.leaves=null}else l!==h&&(ft(l,$t,null),ft(h,$t,null));return V(this,Ve).call(this,a,l!==h),ft(t,ge,V(t,ge)+1),Ke(V(t,Xt),e,o),ft(e,pe,V(e,pe)+1),Ke(V(e,jt),t,o),o}throw j`when creating a link, both source and target must be current members of the same graph, and can't have been deleted`}throw j`can't add a link from a deleted node`}nparents(){return V(this,jt).size}nchildren(){return V(this,Xt).size}nparentLinks(){return V(this,pe)}nchildLinks(){return V(this,ge)}nparentLinksTo(t){var e,n;return ye(t)&&null!=(n=null==(e=V(this,jt).get(t))?void 0:e.size)?n:0}*parentLinksTo(t){if(ye(t)){let e=V(this,jt).get(t);e&&(yield*It(e))}}nchildLinksTo(t){var e,n;return ye(t)&&null!=(n=null==(e=V(this,Xt).get(t))?void 0:e.size)?n:0}*childLinksTo(t){if(ye(t)){let e=V(this,Xt).get(t);e&&(yield*It(e))}}*parents(){yield*It(V(this,jt).keys())}*children(){yield*It(V(this,Xt).keys())}*parentCounts(){for(let[t,e]of V(this,jt))yield[t,e.size]}*childCounts(){for(let[t,e]of V(this,Xt))yield[t,e.size]}*parentLinks(){for(let t of V(this,jt).values())yield*It(t)}*childLinks(){for(let t of V(this,Xt).values())yield*It(t)}*ancestors(){yield*It(Se(t=>t.parents(),this))}*descendants(){yield*It(Se(t=>t.children(),this))}*roots(){let t=At(this,ee,se).call(this);t.roots||(t.roots=[..._i(this.nodes(),e=>e.children())]),yield*It(t.roots)}*leaves(){let t=At(this,ee,se).call(this);t.leaves||(t.leaves=[..._i(this.nodes(),e=>e.parents())]),yield*It(t.leaves)}parent(t,e){return this.link(t,this,e)}child(t,e){return this.link(this,t,e)}delete(){if(V(this,Wt)){let t;for(;t=Ci(V(this,Xt));)t.delete();for(;t=Ci(V(this,jt));)t.delete();V(this,oe).delete(this),V(this,fe).delete(this),V(this,Ge).call(this),ft(this,Wt,null),ft(this,$t,null)}}toJSON(){return xi(this)}};Wt=new WeakMap,Ge=new WeakMap,Ve=new WeakMap,Ue=new WeakMap,oe=new WeakMap,fe=new WeakMap,te=new WeakMap,pe=new WeakMap,jt=new WeakMap,ge=new WeakMap,Xt=new WeakMap,Zt=new WeakMap,$t=new WeakMap,xe=new WeakSet,Le=function(){let t=this;for(;V(t,Zt)!==t;)ft(t,Zt,V(V(t,Zt),Zt)),t=V(t,Zt);return t},ee=new WeakSet,se=function(){let t=At(this,xe,Le).call(this);if(void 0===V(t,$t))throw re`undefined cached info`;if(null!==V(t,$t))return V(t,$t);{let e=0,n=0,i=0;for(let r of this.nodes())e+=1,n+=r.nchildLinks(),i+=V(r,te),ft(r,Zt,this),ft(r,$t,void 0),V(this,fe).delete(r);return V(this,oe).add(this),ft(this,$t,{nnodes:e,nlinks:n,multis:i,acyclic:null,roots:null,leaves:null})}},oi=new WeakMap;var Oe,We,Sr=class{constructor(t,e,n,i,r){this.source=e,this.target=n,this.data=r,bt(this,Oe,void 0),bt(this,We,void 0),this.points=[],ft(this,Oe,t),ft(this,We,i)}delete(){V(this,Oe)&&(V(this,We).call(this,this),ft(this,Oe,null))}};function be(){return new Mr}function si(t){if("string"!=typeof t)throw j`id is supposed to be type string but got type ${typeof t}`;return t}function Ye(t){function e(o){var a;let l=be(),d=new Map,h=[];for(let[c,u]of o.entries()){let p=si(t.id(u,c)),g=l.node(u),k=null!=(a=t.parentData(u,c))?a:[];for(let[y,I]of k)h.push([y,g,I]);if(d.has(p))throw j`found a duplicate id: ${n}, but ids passed to \`graphStratify()\` must be unique`;d.set(p,g)}for(let[c,u,p]of h){let g=d.get(c);if(!g)throw j`missing id: ${c}; this id was references in a node's parentIds, but no node with that id exists`;l.link(g,u,p)}return l}function n(o){if(void 0===o)return t.id;{let d=lt(t,["id"]);return Ye(W(rt({},d),{id:o}))}}return e.id=n,e.parentData=function i(o){if(void 0===o)return t.parentData;{let h=lt(t,["parentIds","parentData"]);return Ye(W(rt({},h),{parentIds:Tr(o),parentData:o}))}},e.parentIds=function r(o){if(void 0===o)return t.parentIds;{let h=lt(t,["parentIds","parentData"]);return Ye(W(rt({},h),{parentIds:o,parentData:Ai(o)}))}},e}function Ai(t){function e(n,i){var r;return St(null!=(r=t(n,i))?r:[],o=>[o,void 0])}return e.wrapped=t,e}function Tr(t){function e(n,i){var r;return St(null!=(r=t(n,i))?r:[],([o])=>o)}return e.wrapped=t,e}function Pr(t){if("object"!=typeof t||null===t||!("id"in t))throw j`datum did not have an id field, and no id accessor was specified; try calling \`graphStratify().id(d => d...)\` to set a custom id accessor`;let{id:e}=t;if("string"==typeof e)return e;throw j`datum has an id field that was not a string, and no id accessor was specified; try calling \`graphStratify().id(d => d...)\` to set a custom id accessor`}function Li(t){if("object"!=typeof t||null===t)throw j`default parentIds function expected datum to be an object but got: ${t}; try setting a custom accessor for parentIds with \`graphStratify().parentIds(d => ...)\``;if(!("parentIds"in t))return;let{parentIds:e}=t;if(void 0===e||function yi(t){return"object"==typeof t&&null!==t&&Symbol.iterator in t&&"function"==typeof t[Symbol.iterator]}(e)&&function vr(t,e){return!wi(t,(n,i)=>!e(n,i))}(e,n=>"string"==typeof n))return e;throw j`default parentIds function expected parentIds to be an iterable of strings but got: ${e}; try setting a custom accessor for parentIds with \`graphStratify().parentIds(d => ...)\``}function Dr(...t){if(t.length)throw j`got arguments to graphStratify(${t}), but constructor takes no arguments; these were probably meant as data which should be called as \`graphStratify()(...)\``;return Ye({id:Pr,parentIds:Li,parentData:Ai(Li)})}function Te(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Oi(t,e){return(null==t||!(t>=t))-(null==e||!(e>=e))||(t<e?-1:t>e?1:0)}function Ni(t,e){let n;if(void 0===e)for(let i of t)null!=i&&(n<i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n<r||void 0===n&&r>=r)&&(n=r)}return n}function Ti(t,e){let n;if(void 0===e)for(let i of t)null!=i&&(n>i||void 0===n&&i>=i)&&(n=i);else{let i=-1;for(let r of t)null!=(r=e(r,++i,t))&&(n>r||void 0===n&&r>=r)&&(n=r)}return n}function Pi(t,e,n=0,i=1/0,r){if(e=Math.floor(e),n=Math.floor(Math.max(0,n)),i=Math.floor(Math.min(t.length-1,i)),!(n<=e&&e<=i))return t;for(r=void 0===r?Oi:function Fr(t=Te){if(t===Te)return Oi;if("function"!=typeof t)throw new TypeError("compare is not a function");return(e,n)=>{let i=t(e,n);return i||0===i?i:(0===t(n,n))-(0===t(e,e))}}(r);i>n;){if(i-n>600){let d=i-n+1,h=e-n+1,c=Math.log(d),u=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*u*(d-u)/d)*(h-d/2<0?-1:1);Pi(t,e,Math.max(n,Math.floor(e-h*u/d+p)),Math.min(i,Math.floor(e+(d-h)*u/d+p)),r)}let o=t[e],a=n,l=i;for(Pe(t,n,e),r(t[i],o)>0&&Pe(t,n,i);a<l;){for(Pe(t,a,l),++a,--l;r(t[a],o)<0;)++a;for(;r(t[l],o)>0;)--l}0===r(t[n],o)?Pe(t,n,l):(++l,Pe(t,l,i)),l<=e&&(n=l+1),e<=l&&(i=l-1)}return t}function Pe(t,e,n){let i=t[e];t[e]=t[n],t[n]=i}function li(t,e){return function $r(t,e,n){if(t=Float64Array.from(function*Br(t,e){if(void 0===e)for(let n of t)null!=n&&(n=+n)>=n&&(yield n);else{let n=-1;for(let i of t)null!=(i=e(i,++n,t))&&(i=+i)>=i&&(yield i)}}(t,n)),(i=t.length)&&!isNaN(e=+e)){if(e<=0||i<2)return Ti(t);if(e>=1)return Ni(t);var i,r=(i-1)*e,o=Math.floor(r),a=Ni(Pi(t,o).subarray(0,o+1));return a+(Ti(t.subarray(o+1))-a)*(r-o)}}(t,.5,e)}Oe=new WeakMap,We=new WeakMap;var Hr=xt(_t());function Ie(t,e,n,i,r={}){let o=Hr.Solve.call({},{optimize:t,opType:e,constraints:i,variables:n,ints:r}),{feasible:a}=o,l=lt(o,["feasible"]);if(!a)throw re`could not find a feasible simplex solution`;return l}var Xr=xt(sr());function Qr(t){let e=[...t];if(e.sort((n,i)=>n-i),0!==e.length){if(2===e.length)return(e[0]+e[1])/2;if(e.length%2==0){let n=e.length/2,r=e[n-1],o=e[n],l=r-e[0],d=e[e.length-1]-o;return(r*d+o*l)/(l+d)}return e[(e.length-1)/2]}}function Bi({aggregate:t}){function e(i,r,o){let[a,l]=o?[r,i]:[i,r],d=o?u=>u.parents():u=>u.children(),h=new Map(l.map((u,p)=>[u,p])),c=new Map(a.map(u=>[u,h.get(u)??t(St(d(u),k=>h.get(k)))]));!function Kr(t,e){let n=new Map;for(let c of t){let u=e.get(c);void 0!==u&&Qe(n,u,c)}let i=[...n.entries()].sort(([c],[u])=>c-u).flatMap(([,c])=>c),r=new Map(t.map((c,u)=>[c,u])),o=t.filter(c=>void 0===e.get(c)),a=new Array(o.length).fill(null);(function l(c,u,p,g){if(u<=c)return;let k=Math.floor((c+u)/2),I=r.get(o[k]),_=0,w=[_];for(let E=p;E<g;++E)_+=r.get(i[E])<I?-1:1,w.push(_);let x=p+w.indexOf(Math.min(...w));a[k]=x,l(c,k,p,x),l(k+1,u,x,g)})(0,o.length,0,i.length),a.push(i.length+1);let d=0,h=0;for(let[c,u]of i.entries()){for(;a[h]==c;)t[d++]=o[h++];t[d++]=u}for(;a[h]==i.length;)t[d++]=o[h++]}(a,c)}return e.aggregator=function n(i){return void 0===i?t:Bi({aggregate:i})},e.d3dagBuiltin=!0,e}function tn(...t){if(t.length)throw j`got arguments to twolayerAgg(${t}); you probably forgot to construct twolayerAgg before passing to order: \`decrossTwoLayer().order(twolayerAgg())\`, note the trailing "()"`;return Bi({aggregate:Qr})}function nn(t,e,n,i){t[n][n]+=i,t[n][e]-=i,t[e][n]-=i,t[e][e]+=i}function Ri(t,e,n,i,r,o){let a=r+o;t[i][i]+=o*o,t[i][n]-=o*a,t[i][e]+=o*r,t[n][i]-=a*o,t[n][n]+=a*a,t[n][e]-=a*r,t[e][i]+=r*o,t[e][n]-=r*a,t[e][e]+=r*r}function Je(t){return function qr(t){let e=0,n=0;for(let i of t)n++,e+=(i-e)/n;return n?e:void 0}(Ee(t,e=>St(e.children(),n=>n.y-e.y)))}function Gi([t,e,n]){if(t<=0||e<=0||n<=0)throw j`simplex weights must be positive, but got: ${t}, ${e}, ${n}`}function Vi(t){function e(i,r){var o;let a={},l={},d=function on(t,e){if("function"!=typeof e){let[n,i,r]=e;return(o,a)=>{switch(+("node"===o.data.role)+ +("node"===a.data.role)){case 0:return r;case 1:return i;case 2:return n;default:throw re`invalid count`}}}{let n=new Map;for(let i of Ee(t,r=>r))if("node"===i.data.role){let r=i.data.node,o=new Map;for(let a of r.childLinks()){let{target:l}=a,d=e(a);Gi(d),o.set(l,d)}n.set(r,o)}return(i,r)=>{if("link"===i.data.role){let{source:o,target:a}=i.data.link,[,l,d]=n.get(o).get(a);return"link"===r.data.role?d:l}if("link"===r.data.role){let{source:o,target:a}=r.data.link,[,l]=n.get(o).get(a);return l}{let[o]=n.get(i.data.node).get(r.data.node);return o}}}}(i,t.weight),h=new Map,c=0;for(let _ of i)for(let w of _)if(!h.has(w)){let x=""+c++;h.set(w,x),a[x]={}}function u(_){return h.get(_)}for(let _ of i)for(let[w,x]of Ut(_)){let E=u(w),A=u(x),b=`layer ${E} -> ${A}`,B=r(w,x);l[b]={min:B},a[E][b]=-1,a[A][b]=1}let p=Je(h.keys());for(let _ of h.keys()){let w=u(_);for(let x of _.children()){let E=u(x),A=`link ${w} -> ${E}`,b=`${A} parent`;l[b]={min:0};let B=`${A} child`;l[B]={min:0},a[w][b]=1,a[w][B]=-1,a[E][b]=-1,a[E][B]=1;let N=d(_,x);a[A]={opt:N/((x.y-_.y)/p),[b]:1,[B]:1}}}let g=Ie("opt","min",a,l);for(let[_,w]of h)_.x=null!=(o=g[w])?o:0;let k=0,y=0;for(let _ of i){let w=_[0];k=Math.min(k,w.x-r(void 0,w));let x=_[_.length-1];y=Math.max(y,x.x+r(x,void 0))}for(let _ of h.keys())_.x-=k;let I=y-k;if(I<=0)throw j`must assign nonzero width to at least one node; double check the callback passed to \`sugiyama().nodeSize(...)\``;return I}return e.weight=function n(i){if(void 0===i)return t.weight;{"function"!=typeof i&&Gi(i);let a=lt(t,["weight"]);return Vi(W(rt({},a),{weight:i}))}},e.d3dagBuiltin=!0,e}function sn(...t){if(t.length)throw j`got arguments to coordSimplex(${t}); you probably forgot to construct coordSimplex before passing to coord: \`sugiyama().coord(coordSimplex())\`, note the trailing "()"`;return Vi({weight:[1,2,8]})}function Ui(t,e){let n=new Map,i=new Map(t.map((o,a)=>[o,a]));return function r(o,a){var l;let d=null==(l=n.get(o))?void 0:l.get(a);if(void 0!==d)return d;if(i.has(o)||i.has(a))return-1/0;{let h=0;for(let[p,g]of e(o)){let k=i.get(p);for(let[y,I]of e(a)){let _=i.get(y);h+=Math.sign(k-_)*g*I}}let c=n.get(o);void 0===c?n.set(o,new Map([[a,h]])):c.set(a,h);let u=n.get(a);return void 0===u?n.set(a,new Map([[o,-h]])):u.set(o,-h),h}}}function ci({baseOp:t,doScan:e}){function n(o,a,l){t(o,a,l);let d=l?a:o,h=l?Ui(o,c=>c.parentCounts()):Ui(a,c=>c.childCounts());e?function ln(t,e){let n=Array(t.length*(t.length-1)/2);for(;;){let i=0;for(let h=1;h<t.length;++h){let c=0,u=i;for(let p=h-1;p>=0;--p)n[u]=c,c+=e(t[p],t[h]),u-=t.length-p-1;i+=t.length-h}let r=0,o=0,a=0,l=0;for(let h=0;h<t.length-1;++h){let c=0;for(let u=h+1;u<t.length;++u){c+=e(t[h],t[u]);let p=n[r++]+c;p>o&&(o=p,a=h,l=u)}}if(0===o)break;let d=t[l];t[l]=t[a],t[a]=d}}(d,h):function an(t,e){let i,n=[[0,t.length]];for(;i=n.pop();){let[r,o]=i;if(r>=o)continue;let a=0,l=o;for(let d=r;d<o-1;++d){let h=e(t[d],t[d+1]);h>a&&(a=h,l=d)}if(l!==o){let d=t[l+1];t[l+1]=t[l],t[l]=d,n.push([r,l],[l+2,o])}}}(d,h)}return n.base=function i(o){return void 0===o?t:ci({baseOp:o,doScan:e})},n.scan=function r(o){return void 0===o?e:ci({baseOp:t,doScan:o})},n.d3dagBuiltin=!0,n}function cn(...t){if(t.length)throw j`got arguments to twolayerGreedy(${t}); you probably forgot to construct twolayerGreedy before passing to order: \`decrossTwoLayer().order(twolayerGreedy())\`, note the trailing "()"`;return ci({baseOp:()=>{},doScan:!1})}function hi(t){let e=0;for(let[n,i]of Ut(t)){let r=new Map(i.map((o,a)=>[o,a]));for(let[o,a]of n.entries())for(let l of n.slice(o+1))for(let[d,h]of a.childCounts())for(let[c,u]of l.childCounts())d!==c&&r.get(d)>r.get(c)&&(e+=h*u)}return e}function Wi(t){function e(i){let r;r=t.topDown?Se(o=>[...o.children()].sort((a,l)=>l.nchildren()-a.nchildren()),...Ee(i,o=>[...Ae(o,a=>!a.nparents())].sort((a,l)=>l.nchildren()-a.nchildren()))):Se(o=>[...o.parents()].sort((a,l)=>l.nparents()-a.nparents()),...Ee(Et(i,i.length-1,-1,-1),o=>[...Ae(o,a=>!a.nchildren())].sort((a,l)=>l.nparents()-a.nparents())));for(let o of i)o.splice(0);for(let o of r){let{data:a}=o;if("node"===a.role)for(let l=a.topLayer;l<=a.bottomLayer;++l)i[l].push(o);else i[a.layer].push(o)}}return e.topDown=function n(i){return void 0===i?t.topDown:Wi({topDown:i})},e.d3dagBuiltin=!0,e}function Yi(...t){if(t.length)throw j`got arguments to decrossDfs(${t}); you probably forgot to construct decrossDfs before passing to decross: \`sugiyama().decross(decrossDfs())\`, note the trailing "()"`;return Wi({topDown:!0})}function je(t){function e(o){let a=o.slice().reverse(),l=o.map(c=>c.slice()),d=hi(l),h=t.inits.length?t.inits:[()=>{}];for(let c of h){c(o);let u=!0;for(let p=0;p<t.passes&&u;++p){u=!1;for(let[y,I]of Ut(o)){let _=I.slice();t.order(y,I,!0),I.some((w,x)=>_[x]!==w)&&(u=!0)}let g=hi(o);g<d&&(d=g,l=o.map(y=>y.slice()));for(let[y,I]of Ut(a)){let _=I.slice();t.order(I,y,!1),I.some((w,x)=>_[x]!==w)&&(u=!0)}let k=hi(o);k<d&&(d=k,l=o.map(y=>y.slice()))}}o.splice(0,o.length,...l)}return e.order=function n(o){if(void 0===o)return t.order;{let d=lt(t,["order"]);return je(W(rt({},d),{order:o}))}},e.inits=function i(o){if(void 0===o)return[...t.inits];{let d=lt(t,["inits"]);return je(W(rt({},d),{inits:o}))}},e.passes=function r(o){if(void 0===o)return t.passes;if(o<=0)throw j`number of passes must be positive`;return je(W(rt({},t),{passes:o}))},e.d3dagBuiltin=!0,e}function dn(...t){if(t.length)throw j`got arguments to decrossTwoLayer(${t}); you probably forgot to construct decrossTwoLayer before passing to decross: \`sugiyama().decross(decrossTwoLayer())\`, note the trailing "()"`;return je({order:cn().base(tn()),inits:[Yi().topDown(!0),Yi().topDown(!1)],passes:24})}function un(t,e){return+!(!t||!e)}function di(t){function e(r,o){var a;let l={},d={},h=new Map(St(r.nodes(),(w,x)=>[w,x.toString()]));function c(w){return h.get(w)}function u(w){return l[c(w)]}function p(w,x,E,A,b=0){let B=u(x),N=u(E),F=`${w}: ${c(x)} -> ${c(E)}`;d[F]={min:A},B[F]=-1,N[F]=1,B.opt+=b,N.opt-=b}function g(w,x,E){p(`${w} before`,x,E,0),p(`${w} after`,E,x,0)}let k=[],y=new Map;for(let w of r.nodes()){let x=c(w);l[x]={opt:0};let E=t.rank(w);void 0!==E&&k.push([E,w]);let A=t.group(w);if(void 0!==A){let b=y.get(A);b?b.push(w):y.set(A,[w])}}let I=new Set;for(let w of r.topological(t.rank)){for(let[x,E]of w.childCounts())I.has(x)?p("link",x,w,o(x,w),E):p("link",w,x,o(w,x),E);I.add(w)}let _=k.sort(([w],[x])=>w-x);for(let[[w,x],[E,A]]of Ut(_))w<E?p("rank",x,A,o(x,A)):g("rank",x,A);for(let w of y.values())for(let[x,E]of Ut(w))g("group",x,E);try{let w=Ie("opt","max",l,d,{}),x=0,E=0;for(let A of r.nodes()){let b=null!=(a=w[c(A)])?a:0;A.y=b,x=Math.min(x,b-o(void 0,A)),E=Math.max(E,b+o(A,void 0))}for(let A of r.nodes())A.y-=x;return E-x}catch{throw y.size?j`could not find a feasible simplex layout; this is likely due to group constraints producing an infeasible layout, try relaxing the functions you're passing to \`layeringSimplex().group(...)\``:re`could not find a feasible simplex solution`}}return e.rank=function n(r){if(void 0===r)return t.rank;{let l=lt(t,["rank"]);return di(W(rt({},l),{rank:r}))}},e.group=function i(r){if(void 0===r)return t.group;{let l=lt(t,["group"]);return di(W(rt({},l),{group:r}))}},e.d3dagBuiltin=!0,e}function Hi(){}function fn(...t){if(t.length)throw j`got arguments to layeringSimplex(${t}); you probably forgot to construct layeringSimplex before passing to layering: \`sugiyama().layering(layeringSimplex())\`, note the trailing "()"`;return di({rank:Hi,group:Hi})}function ve(t,e){function n(h){let c;if(h.nnodes()){let[u,p]=function jr(t){if("function"!=typeof t){let[e,n]=t;return[()=>e,()=>n]}{let e=t;return[n=>e(n)[0],n=>e(n)[1]]}}(function Jr(t){if("function"!=typeof t){let[e,n]=t;if(e<=0||n<=0)throw j`all node sizes must be positive, but got width ${e} and height ${n}`;return()=>[e,n]}{let e=new Map;return n=>{let i=e.get(n);if(void 0===i){i=t(n);let[r,o]=i;if(r<=0||o<=0)throw j`all node sizes must be positive, but got width ${r} and height ${o} for node with data: ${n.data}; make sure the callback passed to \`sugiyama().nodeSize(...)\` is doing that`;e.set(n,i)}return i}}}(t.nodeSize)),[g,k]=e.gap,y=t.layering(h,un)+1,[I,_]=function pn(t,e,n,i,r){let o=be(),a=Array(i).fill(!1),l=new Map;for(let p of t.nodes()){let g=p.uy;if(void 0===g)throw Jt`layering ${r} didn't assign a layer to a node`;if(g<0||g>=i)throw Jt`layering ${r} assigned node an invalid layer: ${g}`;{let k=ne(p.parentCounts(),p.childCounts());!a[g]&&wi(k,([{uy:I},_])=>_>1&&I===g-1)&&(a[g]=!0);let y={node:p,topLayer:g,bottomLayer:g,role:"node"};l.set(p,[y,o.node(y)])}}let d=0,h=a.map(p=>d+=+p);for(let[p]of l.values()){let g=h[p.topLayer];p.topLayer+=g,p.bottomLayer+=g}let c=function Zi(t,e,n,i){for(let[o,[a,l]]of e){let d=a.bottomLayer;for(let h of o.childLinks()){let[c,u]=e.get(h.target),p=c.topLayer;if(p>d){let g=l;for(let k=d+1;k<p;++k){let y=t.node({link:h,layer:k,role:"link"});g.child(y,void 0),g=y}g.child(u)}else{if(!(p<d))throw Jt`layering ${i} assigned nodes with an edge to the same layer`;{let g=u;for(let k=p+1;k<d;++k){let y=t.node({link:h,layer:k,role:"link"});g.child(y,void 0),g=y}g.child(l)}}}}let r=Array(n).fill(null).map(()=>[]);for(let o of t.nodes()){let{data:a}=o;if("node"===a.role){let{topLayer:l,bottomLayer:d}=a;for(let h=l;h<=d;++h)r[h].push(o)}else{let{layer:l}=a;r[l].push(o)}}for(let o of r)if(!o.length)throw Jt`layering ${i} didn't assign a node to every layer`;return r}(o,l,i+d,r),u=-n;for(let p of c){u+=n;let g=Math.max(-n,...St(p,({data:y})=>"node"===y.role?e(y.node):-1/0)),k=u+g/2;for(let y of p)y.y=k;u+=g}return[c,u]}(h,p,k,y,t.layering);t.decross(I);let w=function hn(t,e){return function n(i,r){let l=((i?t(i):0)+(r?t(r):0))/2;return i&&r?l+e:l}}(function vn(t,e=0){return({data:n})=>"node"===n.role?t(n.node):e}(u),g),x=t.coord(I,w);(function mn(t,e,n,i,r=.001){for(let o of t){for(let a of o)if(void 0===a.ux)throw Jt`coord ${i} didn't assign an x to every node`;for(let[[a,l],[d,h]]of Ut(ne([[void 0,0]],St(o,c=>[c,c.x]),[[void 0,n]])))if(h-l<e(a,d)-r)throw Jt`coord ${i} assigned nodes too close for separation`}})(I,w,x,t.coord),function gn(t){for(let e of t)for(let n of e)if("node"===n.data.role){let{node:i}=n.data;i.x=n.x,i.y=n.y;for(let r of n.children()){let a,o=[[n.x,n.y]];for(;"link"===r.data.role;)a=r.data.link,o.push([r.x,r.y]),[r]=r.children();o.push([r.x,r.y]);let l=r.data.node,d=ne(i.childLinksTo(l),i.parentLinksTo(l));a||([a]=d),a.source!==i&&o.reverse(),a.points.splice(0,a.points.length,...o)}}}(I),c={width:x,height:_}}else c={width:0,height:0};for(let u of t.tweaks)c=u(h,c);return c}return n.layering=function i(h){if(void 0===h)return t.layering;{let p=lt(t,["layering"]);return ve(W(rt({},p),{layering:h}),e)}},n.decross=function r(h){if(void 0===h)return t.decross;{let p=lt(t,["decross"]);return ve(W(rt({},p),{decross:h}),e)}},n.coord=function o(h){if(void 0===h)return t.coord;{let p=lt(t,["coord"]);return ve(W(rt({},p),{coord:h}),e)}},n.tweaks=function a(h){if(void 0===h)return t.tweaks;{let p=lt(t,["tweaks"]);return ve(W(rt({},p),{tweaks:h}),e)}},n.nodeSize=function l(h){if(void 0===h)return t.nodeSize;if("function"!=typeof h&&(h[0]<=0||h[1]<=0)){let[c,u]=h;throw j`constant nodeSize must be positive, but got: [${c}, ${u}]`}{let p=lt(t,["nodeSize"]);return ve(W(rt({},p),{nodeSize:h}),e)}},n.gap=function d(h){if(void 0!==h){let[c,u]=h;if(c<0||u<0)throw j`gap width (${c}) and height (${u}) must be non-negative`;return ve(t,W(rt({},e),{gap:h}))}{let[c,u]=e.gap;return[c,u]}},n}function Ji(t,e){for(let n of t){let i=li([...St(e(n),({x:r})=>r)]);void 0!==i&&(n.x=i)}}function ji(t,e){for(let n of t){let[i]=e(n);"link"===n.data.role&&"link"===i.data.role&&(n.x=i.x)}}function De(t,e){let n=t[t.length-1],i=n.x,r=[i];for(let o of Et(t,t.length-2,-1,-1)){let a=Math.min(o.x,i-e(n,o));r.push(a),n=o,i=a}r.reverse(),n=t[0],i=n.x,n.x=(i+r[0])/2;for(let[o,a]of Ft(Et(t,1))){let l=Math.max(a.x,i+e(n,a));a.x=(l+r[o+1])/2,n=a,i=l}}function yn(t,e){for(let[n,i]of t.entries()){let r=e[n];for(let[o,{x:a}]of i.entries())if(r[o]!==a)return!1}return!0}function ui(t,e,n){if("function"!=typeof t)return()=>t;{let i=new Map;return r=>{let o=i.get(r);if(void 0===o){let a=t(r);if(a<0)throw new Error(`${e} weights must be non-negative; double check the accessor passed into \`coordQuad().${n}(...)\``);return i.set(r,a),a}return o}}}function _e(t){function e(l,d){let x,h=function rn(t){let e=new Map,n=0;for(let i of t)for(let r of i)e.has(r)||e.set(r,n++);return e}(l),[c,u,p,g]=function $i(t,e,n,i=0){let r=1+Math.max(...e.values()),o=Array(r).fill(null).map((h,c)=>Array(r).fill(null).map((u,p)=>c===p?i:0)),a=Array(r).fill(0),l=[],d=[];for(let h of t)for(let[c,u]of Ut(h)){let p=e.get(c),g=e.get(u),k=Array(r).fill(0);k[p]=1,k[g]=-1,l.push(k),d.push(-n(c,u))}return[o,a,l,d]}(l,h,d,t.comp),k=function bn(t,e){if("function"!=typeof t)return()=>t;{let n=new Map;for(let i of Ee(e,r=>r))if("node"===i.data.role){let r=i.data.node,o=new Map;for(let a of r.childLinks()){let l=t(a);if(l<0)throw j`link weights must be non-negative; double check the accessor passed into \`coordQuad().vertWeak(...)\``;o.set(a.target,l)}n.set(r,o)}return(i,r)=>n.get(i).get(r)}}(t.vertWeak,l),y=ui(t.vertStrong,"link","vertStrong"),I=ui(t.linkCurve,"link","linkCurve"),_=ui(t.nodeCurve,"node","nodeCurve"),w=Je(h.keys());for(let[E,A]of h){let b=E.data,B="node"===b.role?b.node:b.link.source;for(let N of E.children()){let F=h.get(N),U=N.data,J="node"===U.role?U.node:U.link.target,Q="node"===b.role?k(B,J):y(b.link),tt="node"===U.role?k(B,J):y(U.link),ut="node"===U.role?_(U.node):I(U.link),kt=(N.y-E.y)/w;nn(c,A,F,(Q+tt)/kt);for(let vt of N.children())Ri(c,A,F,h.get(vt),ut/kt,ut/((vt.y-N.y)/w))}}try{x=function zi(t,e,n,i){for(let[a,l]of n)a.x=i[l];let r=1/0,o=-1/0;for(let a of t){let l=a[0],d=a[a.length-1];r=Math.min(r,l.x-e(void 0,l)),o=Math.max(o,d.x+e(d,void 0))}for(let a of n.keys())a.x-=r;return o-r}(l,d,h,function Fi(t,e,n,i,r=0){e.pop(),t.pop(),t.forEach(a=>a.pop()),n.forEach(a=>a.pop());let o=function en(t,e,n,i,r){if(!e.length)return[];let o=[[0]],a=[0],l=[[0]],d=[0];for(let u of t){let p=[0];p.push(...u),o.push(p)}a.push(...e),l.push(...e.map(()=>[0]));for(let u of n)for(let[p,g]of u.entries())l[p+1].push(-g);d.push(...i.map(u=>-u));let{solution:h,message:c}=(0,Xr.solveQP)(o,a,l,d,r);if(c.length)throw re`quadratic program failed: ${c}`;return h.shift(),h}(t,e,n,i,r);return o.push(0),o}(c,u,p,g))}catch(E){throw"string"==typeof E?re`${E}`:re`undefined quadprog exception`}if(x<=0)throw j`must assign nonzero width to at least one node; double check the callback passed to \`sugiyama().nodeSize(...)\``;return x}return e.vertWeak=function n(l){if(void 0===l)return t.vertWeak;if("number"==typeof l&&l<0)throw j`vertWeak must be non-negative but was: ${l}`;{let c=lt(t,["vertWeak"]);return _e(W(rt({},c),{vertWeak:l}))}},e.vertStrong=function i(l){if(void 0===l)return t.vertStrong;if("number"==typeof l&&l<0)throw j`vertStrong must be non-negative but was: ${l}`;{let c=lt(t,["vertStrong"]);return _e(W(rt({},c),{vertStrong:l}))}},e.linkCurve=function r(l){if(void 0===l)return t.linkCurve;if("number"==typeof l&&l<0)throw j`linkCurve must be non-negative but was: ${l}`;{let c=lt(t,["linkCurve"]);return _e(W(rt({},c),{linkCurve:l}))}},e.nodeCurve=function o(l){if(void 0===l)return t.nodeCurve;if("number"==typeof l&&l<0)throw j`nodeCurve must be non-negative but was: ${l}`;{let c=lt(t,["nodeCurve"]);return _e(W(rt({},c),{nodeCurve:l}))}},e.compress=function a(l){if(void 0===l)return t.comp;if(l<=0)throw j`compress weight must be positive, but was: ${l}`;return _e(W(rt({},t),{comp:l}))},e.d3dagBuiltin=!0,e}function fi(t){function e(r){var o;let a=r.reduce((A,b)=>A+b.length*Math.max(b.length-1,0)/2,0),l=[];if(t.dist)for(let[A,b]of Ut(r)){let B=b.filter(J=>!J.nparents()),N=A.map(J=>[...J.children()]);l.push([B,N]);let F=A.filter(J=>!J.nchildren()),U=b.map(J=>[...J.parents()]);l.push([F,U])}let d=function In(t){var e,n;let i=[],r=new Map,o=new Map;for(let h of t){let[c]=h;c!==i[i.length-1]&&i.push(c);for(let u of Et(h,1)){let p=null!=(e=o.get(u))?e:0;o.set(u,p+1)}for(let[u,p]of Ut(h))Qe(r,u,p)}let d,a=new Map,l=0;for(;d=i.pop();){a.set(d,l++);for(let h of null!=(n=r.get(d))?n:[]){let c=o.get(h)-1;o.set(h,c),c||i.push(h)}}return a}(r),h=new Map;function c(A,b){var B;let N=`${A} => ${b}`;return null!=(B=h.get(N))?B:N}let u=new Map;for(let[A,b]of Ft(Et(r,0,r.length-1)))for(let B of b){if("node"!==B.data.role||B.data.bottomLayer===A)continue;let N=d.get(B),F=!0;for(let U of b)if(U===B)F=!1;else if("node"!==U.data.role||U.data.bottomLayer===A){let J=d.get(U),Q=F?c(J,N):c(N,J);for(let tt of U.children()){let ut=d.get(tt),kt=F?c(ut,N):c(N,ut);u.set(kt,Q)}}}let p=new Map;for(let[A,b]of u){let N,B=b;for(;N=u.get(B);)B=N;let F=p.get(B);F?F.push(A):p.set(B,[B,A])}for(let A of p.values()){let b=`{ ${A.join(" & ")} }`;for(let B of A)h.set(B,b)}let g=1/(l.reduce((A,[b,B])=>B.reduce((N,F)=>N+F.length*F.length,0)*b.length,0)/4+1),k=g/(a+1),y={},I={},_={};for(let A of r){for(let[b,B]of A.entries()){let N=d.get(B);for(let F of Et(A,b+1)){let J=c(N,d.get(F));_[J]=1,I[J]={max:1},y[J]={opt:k,[J]:1}}}for(let[b,B]of A.entries()){let N=d.get(B);for(let[F,U]of Ft(Et(A,b+1))){let J=d.get(U);for(let Q of A.slice(b+F+2)){let tt=d.get(Q),ut=c(N,J),kt=c(N,tt),vt=c(J,tt),wt=`tri: ${N} - ${J} - ${tt}`,Ct=`${wt} +`,Dt=`${wt} -`;I[Ct]={max:1},y[ut][Ct]=1,y[kt][Ct]=-1,y[vt][Ct]=1,I[Dt]={min:0},y[ut][Dt]=1,y[kt][Dt]=-1,y[vt][Dt]=1}}}}for(let[A,b]of Ft(Et(r,0,r.length-1)))for(let[B,N]of b.entries()){if("node"===N.data.role&&N.data.bottomLayer!==A)continue;let F=d.get(N);for(let U of Et(b,B+1)){if("node"===U.data.role&&U.data.bottomLayer!==A)continue;let Q=c(F,d.get(U)),tt=new Map;for(let[ut,kt]of N.childCounts()){let vt=d.get(ut);for(let[wt,Ct]of U.childCounts()){if(ut===wt)continue;let Dt=d.get(wt),Gt=Math.sign(vt-Dt),Lt=Gt<0?c(vt,Dt):c(Dt,vt),zt=null!=(o=tt.get(Lt))?o:0;tt.set(Lt,Gt*kt*Ct+zt)}}for(let[ut,kt]of tt){let vt=`slack: ${Q} : ${ut}`,wt=`${vt} +`,Ct=`${vt} -`;kt<0?(y[vt]={opt:-kt,[wt]:1,[Ct]:1},I[wt]={min:0},y[Q][wt]=1,y[ut][wt]=-1,I[Ct]={min:0},y[Q][Ct]=-1,y[ut][Ct]=1):kt>0&&(y[vt]={opt:kt,[wt]:1,[Ct]:1},I[wt]={min:1},y[Q][wt]=1,y[ut][wt]=1,I[Ct]={min:-1},y[Q][Ct]=-1,y[ut][Ct]=-1)}}}for(let[A,b]of l)for(let B of A){let N=d.get(B);for(let F of b)for(let[U,J]of Ft(F)){let Q=d.get(J);for(let tt of Et(F,U+1)){let ut=d.get(tt),kt=`dist: ${Q} - ${N} - ${ut}`,vt=`${kt} :normal`,wt=`${kt} :reversed`;y[kt]={opt:g,[vt]:1,[wt]:1};let Ct=0;for(let[Dt,Gt]of[[Q,N],[Q,ut],[N,ut]]){let Lt=Math.sign(Dt-Gt),zt=Lt<0?c(Dt,Gt):c(Gt,Dt);Ct+=Lt,y[zt][vt]=-Lt,y[zt][wt]=Lt}I[vt]={min:(Ct+1)/-2},I[wt]={min:(Ct-1)/2}}}}let w=Object.keys(y).length,x=Object.keys(I).length;if("oom"!==t.check&&w>2e3)throw j`size of dag to decrossOpt is too large and will likely crash instead of complete; you probably want to use a cheaper decrossing strategy for sugiyama like \`sugiyama().decross(decrossTwoLayer())\`, but if you still want to continue you can suppress this check with \`sugiyama().decross(decrossOp().check("oom"))\``;if("fast"===t.check&&(w>1e3||x>5e3))throw j`size of dag to decrossOpt is too large and will likely not complete; you probably want to use a cheaper decrossing strategy for sugiyama like \`sugiyama().decross(decrossTwoLayer())\`, but if you still want to continue you can suppress this check with \`sugiyama().decross(decrossOp().check("slow"))\``;let E=Ie("opt","min",y,I,_);if(!E.bounded)throw re`optimization result was not bounded`;for(let A of r)A.sort((b,B)=>{let N=d.get(b),F=d.get(B);return N<F?E[c(N,F)]||-1:-(E[c(F,N)]||-1)})}return e.check=function n(r){return void 0===r?t.check:fi(W(rt({},t),{check:r}))},e.dist=function i(r){return void 0===r?t.dist:fi(W(rt({},t),{dist:r}))},e.d3dagBuiltin=!0,e}function pi(t,e){function n(o,a){let l=0,d=o.topological(t.rank);for(let h of d)h.uy=void 0;e.topDown&&d.reverse();for(let h of d){let c=Math.max(a(void 0,h),...St(ne(h.parents(),h.children()),u=>{var p;return(null!=(p=u.uy)?p:-1/0)+a(u,h)}));l=Math.max(l,c+a(h,void 0)),h.y=c}for(let h of d.reverse()){let c=Math.min(...St(Ae(ne(h.parents(),h.children()),u=>h.y<u.y),u=>u.y-a(u,h)));c!==1/0&&(h.y=c)}if(e.topDown)for(let h of d)h.y=l-h.y;return l}return n.rank=function i(o){if(void 0===o)return t.rank;{let d=lt(t,["rank"]);return pi(W(rt({},d),{rank:o}),e)}},n.topDown=function r(o){return void 0===o?e.topDown:pi(t,W(rt({},e),{topDown:o}))},n.d3dagBuiltin=!0,n}function Cn(){}function qi(...t){if(t.length)throw j`got arguments to layeringLongestPath(${t}); you probably forgot to construct layeringLongestPath before passing to layering: \`sugiyama().layering(layeringLongestPath())\`, note the trailing "()"`;return pi({rank:Cn},{topDown:!0})}function Qi(t){function e(i,r){let a,o=0;for(let l of i.topological(t.rank))o+=r(a,l),l.y=o,a=l;return o+=r(a,void 0),o}return e.rank=function n(i){if(void 0===i)return t.rank;{let a=lt(t,["rank"]);return Qi(W(rt({},a),{rank:i}))}},e.d3dagBuiltin=!0,e}function Mn(){}function Sn(...t){if(t.length)throw j`got arguments to layeringTopological(${t}); you probably forgot to construct layeringTopological before passing to layering: \`sugiyama().layering(layeringTopological())\`, note the trailing "()"`;return Qi({rank:Mn})}function On(t,e,n,i){let[r,o]=t,[a,l]=e,[d,h]=n,[c,u]=i,p=r-a/2,g=r+a/2,k=o-l/2,y=o+l/2;function I(x,E){let A=0;return x<p?A|=1:x>g&&(A|=2),E<k?A|=4:E>y&&(A|=8),A}let _=I(d,h),w=I(c,u);if(!w)throw j`line from [${d}, ${h}] -> [${c}, ${u}] ended inside rectangle centered at [${r}, ${o}] with size [${a}, ${l}]`;for(;;){if(!w)return[c,u];if(_&w)return[d,h];8&w?(c=d+(c-d)*(y-h)/(u-h),u=y):4&w?(c=d+(c-d)*(k-h)/(u-h),u=k):2&w?(u=h+(u-h)*(g-d)/(c-d),c=g):(u=h+(u-h)*(p-d)/(c-d),c=p),w=I(c,u)}}function Nn(t,e,n,i){let[r,o]=t,[a,l]=e,[d,h]=n,[c,u]=i,p=a/2,g=l/2,k=c-d,y=d-r,I=u-h,_=h-o,w=p*p,x=g*g,E=w*I*I+x*k*k,A=k*_-I*y,b=E-A*A;if(b>=0){let B=p*g*Math.sqrt(b),N=k*y*x+I*_*w,U=(N-B)/-E;if((N+B)/-E<1&&1<U)throw j`line from [${d}, ${h}] -> [${c}, ${u}] ended inside ellipse at [${r}, ${o}] with size [${a}, ${l}]`;return 0<=U&&U<=1?[U*k+d,U*I+h]:[d,h]}return[d,h]}function Tn(t,e=On){return function n(i,r){for(let o of i.nodes()){let a=[o.x,o.y],l="function"==typeof t?t(o):t;for(let{points:d}of o.parentLinks()){let[h,c]=d.slice(-2),u=e(a,l,c,h);d.splice(-1,1,u)}for(let{points:d}of o.childLinks()){let[h,c]=d,u=e(a,l,h,c);d.splice(0,1,u)}}return r}}var er=it(9212),Fn=it(7382);let $n=(()=>{class t{constructor(n){this.logger=n,this.offset=500,this.scaleFactor=7,this.multiChartOffset=0,this.multiChartscaleFactor=3,this.defaultLayoutProps={xGap:15,yGap:15,decross:!0,greedy:!1,quad:!1,layering:"longestPath",hasCurves:!0,bump:!0}}setXYLocations(n,i,r,o){const a=i.integrations.find(l=>l.id===+n.id);a&&(a.x=n.y*(r+i.activities.length*o),a.y=n.x*(r+i.activities.length*o)),n.children.forEach(l=>{this.setXYLocations(l,i,r,o)})}connectWithFakeStart(n,i){const r=n.integrations.filter(o=>0===n.activities.filter(l=>l.chartInfo.target_id===o.id).length);return r.length>1&&(i.push({id:-1e4,parentIds:[]}),r.forEach((o,a)=>{const l=i.find(d=>d.id===o.id);return l&&i.splice(i.indexOf(l),1),i.push({id:o.id,parentIds:[-1e4]}),{scale:this.multiChartscaleFactor,offset:this.multiChartOffset}})),{scale:this.scaleFactor,offset:this.offset}}arrangeNodes(n,i=this.defaultLayoutProps){const r=[];n.integrations.forEach(x=>{const E=n.activities.filter(A=>A.chartInfo.target_id===x.id).map(A=>A.chartInfo.source_id);r.push({id:x.id,parentIds:E.map(A=>A+"")})}),this.connectWithFakeStart(n,r);const a=Dr().id(x=>x.id+"")(r),d=[36,36],h=i.bump?S.jvg().curve(S.qpX):S.jvg().curve(S.FdL),c=Tn(d,Nn),u=function wn(...t){if(t.length)throw j`got arguments to sugiyama(${t}), but constructor takes no arguments; these were probably meant as data which should be called as \`sugiyama()(...)\``;return ve({layering:fn(),decross:dn(),coord:sn(),nodeSize:[1,1],tweaks:[]},{gap:[1,1]})}();let p;switch(i.layering){case"longestPath":default:p=u.layering(qi());break;case"topological":p=u.layering(Sn())}i.greedy&&(p=p.coord(function xn(...t){if(t.length)throw j`got arguments to coordGreedy(${t}); you probably forgot to construct coordGreedy before passing to coord: \`sugiyama().coord(coordGreedy())\`, note the trailing "()"`;function e(n,i){let r=0,o=0,a=new Set;for(let c of n)for(let u of c)a.has(u)||(a.add(u),void 0!==u.ux&&(r+=(u.ux-r)/++o));for(let c of n){let u=0,p=0;for(let k of c)void 0!==k.ux&&(u+=(k.ux-u)/++p);let g=p?u:r;for(let k of c)void 0===k.ux&&(k.ux=g);De(c,i)}for(let c of Et(n,1))Ji(c,u=>u.parents()),De(c,i);for(let c of Et(n,n.length-2,-1,-1))Ji(c,u=>u.children()),De(c,i);for(let c=0;c<n.length;++c){let u=n.map(p=>p.map(({x:g})=>g));for(let p of Et(n,1))ji(p,g=>g.parents()),De(p,i);for(let p of Et(n,n.length-2,-1,-1))ji(p,g=>g.children()),De(p,i);if(yn(n,u))break}let l=1/0,d=-1/0;for(let c of n){let u=c[0];l=Math.min(l,u.x-i(void 0,u));let p=c[c.length-1];d=Math.max(d,p.x+i(p,void 0))}for(let c of a)c.x-=l;let h=d-l;if(h<=0)throw j`must assign nonzero width to at least one node; double check the callback passed to \`sugiyama().nodeSize(...)\``;return h}return e.d3dagBuiltin=!0,e}())),i.quad&&(p=p.coord(function kn(...t){if(t.length)throw j`got arguments to coordQuad(${t}); you probably forgot to construct coordQuad before passing to coord: \`sugiyama().coord(coordQuad())\`, note the trailing "()"`;return _e({vertWeak:1,vertStrong:0,linkCurve:1,nodeCurve:0,comp:1e-6})}()));const g=p.nodeSize(d).gap([18+i.yGap,18+i.xGap]).tweaks([c]);let k=!1;if(i.decross){const x=p.decross(function _n(...t){if(t.length)throw j`got arguments to decrossOpt(${t}); you probably forgot to construct decrossOpt before passing to decross: \`sugiyama().decross(decrossOpt())\`, note the trailing "()"`;return fi({check:"fast",dist:!1})}()).nodeSize(d).gap([18+i.yGap,18+i.xGap]).tweaks([c]);try{x(a),this.logger.debug("decrossing layout")}catch{g(a),this.logger.debug("crossed layout"),k=!0}}else g(a),this.logger.debug("crossed layout");const y=Array.from(a.nodes()),I=Array.from(a.links()),_=new Map;n.activities.filter(x=>!x.chartInfo.milestoneNodeId).forEach(x=>{this.addActivity(_,x.chartInfo.target_id,x.chartInfo.source_id,x)});const w=new Map;return n.integrations.forEach(x=>{w.set(x.id,x)}),y.forEach(x=>{const E=w.get(+x.data.id);E.y=x.ux,E.x=x.uy}),I.forEach(x=>{const E=_.get(+x.target.data.id)?.get(+x.source.data.id);if(E&&x.points){if(!i.hasCurves)return void(E.chartInfo.dPath=void 0);E.chartInfo.dPath=h(x.points.map(A=>[A[1],A[0]]))??void 0}}),n.profile.view.autoZoom=!0,k}addActivity(n,i,r,o){n.has(i)||n.set(i,new Map),n.get(i).set(r,o)}static#t=this.\u0275fac=function(i){return new(i||t)(er.LFG(Fn.m))};static#e=this.\u0275prov=er.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()},9680:(qt,Ot,it)=>{it.d(Ot,{B:()=>m});var S=it(9212);let m=(()=>{class et{constructor(){}sanatizeForSave(X){this.sanitizeNumbers(X),this.removeCircularStructure(X),this.calculateSortOrder(X)}sanitizeNumbers(X){X.integrations.forEach(K=>{K.x=K.x?Math.round(K.x):K.x,K.y=K.y?Math.round(K.y):K.y})}removeCircularStructure(X){for(const K of X.activities)null!=K.subProject.subGraphLoaded&&(K.subProject.subGraphLoaded.profile.parentProject=null,this.removeCircularStructure(K.subProject.subGraphLoaded))}updateIds(X,K){X.profile.id=K.profile.id;for(let Z=0;Z<K.activities.length;++Z){const $=K.activities[Z],st=X.activities[Z];null!=$.subProject.subGraphLoaded&&(st.subProject.subGraphId=$.subProject.subGraphId,void 0!==st.subProject.subGraphLoaded&&this.updateIds(st.subProject.subGraphLoaded,$.subProject.subGraphLoaded))}}calculateSortOrder(X){X.activities.forEach((K,Z)=>K.profile.sortOrder=Z)}static#t=this.\u0275fac=function(K){return new(K||et)};static#e=this.\u0275prov=S.Yz7({token:et,factory:et.\u0275fac,providedIn:"root"})}return et})()},4745:(qt,Ot)=>{var m;(m=Ot.s||(Ot.s={}))[m.Backspace=8]="Backspace",m[m.Tab=9]="Tab",m[m.Enter=13]="Enter",m[m.Shift=16]="Shift",m[m.Ctrl=17]="Ctrl",m[m.Alt=18]="Alt",m[m.PauseBreak=19]="PauseBreak",m[m.CapsLock=20]="CapsLock",m[m.Escape=27]="Escape",m[m.Space=32]="Space",m[m.PageUp=33]="PageUp",m[m.PageDown=34]="PageDown",m[m.End=35]="End",m[m.Home=36]="Home",m[m.LeftArrow=37]="LeftArrow",m[m.UpArrow=38]="UpArrow",m[m.RightArrow=39]="RightArrow",m[m.DownArrow=40]="DownArrow",m[m.Insert=45]="Insert",m[m.Delete=46]="Delete",m[m.Zero=48]="Zero",m[m.ClosedParen=48]="ClosedParen",m[m.One=49]="One",m[m.ExclamationMark=49]="ExclamationMark",m[m.Two=50]="Two",m[m.AtSign=50]="AtSign",m[m.Three=51]="Three",m[m.PoundSign=51]="PoundSign",m[m.Hash=51]="Hash",m[m.Four=52]="Four",m[m.DollarSign=52]="DollarSign",m[m.Five=53]="Five",m[m.PercentSign=53]="PercentSign",m[m.Six=54]="Six",m[m.Caret=54]="Caret",m[m.Hat=54]="Hat",m[m.Seven=55]="Seven",m[m.Ampersand=55]="Ampersand",m[m.Eight=56]="Eight",m[m.Star=56]="Star",m[m.Asterik=56]="Asterik",m[m.Nine=57]="Nine",m[m.OpenParen=57]="OpenParen",m[m.A=65]="A",m[m.B=66]="B",m[m.C=67]="C",m[m.D=68]="D",m[m.E=69]="E",m[m.F=70]="F",m[m.G=71]="G",m[m.H=72]="H",m[m.I=73]="I",m[m.J=74]="J",m[m.K=75]="K",m[m.L=76]="L",m[m.M=77]="M",m[m.N=78]="N",m[m.O=79]="O",m[m.P=80]="P",m[m.Q=81]="Q",m[m.R=82]="R",m[m.S=83]="S",m[m.T=84]="T",m[m.U=85]="U",m[m.V=86]="V",m[m.W=87]="W",m[m.X=88]="X",m[m.Y=89]="Y",m[m.Z=90]="Z",m[m.LeftWindowKey=91]="LeftWindowKey",m[m.RightWindowKey=92]="RightWindowKey",m[m.SelectKey=93]="SelectKey",m[m.Numpad0=96]="Numpad0",m[m.Numpad1=97]="Numpad1",m[m.Numpad2=98]="Numpad2",m[m.Numpad3=99]="Numpad3",m[m.Numpad4=100]="Numpad4",m[m.Numpad5=101]="Numpad5",m[m.Numpad6=102]="Numpad6",m[m.Numpad7=103]="Numpad7",m[m.Numpad8=104]="Numpad8",m[m.Numpad9=105]="Numpad9",m[m.Multiply=106]="Multiply",m[m.Add=107]="Add",m[m.Subtract=109]="Subtract",m[m.DecimalPoint=110]="DecimalPoint",m[m.Divide=111]="Divide",m[m.F1=112]="F1",m[m.F2=113]="F2",m[m.F3=114]="F3",m[m.F4=115]="F4",m[m.F5=116]="F5",m[m.F6=117]="F6",m[m.F7=118]="F7",m[m.F8=119]="F8",m[m.F9=120]="F9",m[m.F10=121]="F10",m[m.F11=122]="F11",m[m.F12=123]="F12",m[m.NumLock=144]="NumLock",m[m.ScrollLock=145]="ScrollLock",m[m.SemiColon=186]="SemiColon",m[m.Equals=187]="Equals",m[m.Comma=188]="Comma",m[m.Dash=189]="Dash",m[m.Period=190]="Period",m[m.UnderScore=189]="UnderScore",m[m.PlusSign=187]="PlusSign",m[m.ForwardSlash=191]="ForwardSlash",m[m.Tilde=192]="Tilde",m[m.GraveAccent=192]="GraveAccent",m[m.OpenBracket=219]="OpenBracket",m[m.ClosedBracket=221]="ClosedBracket",m[m.Quote=222]="Quote"},617:(qt,Ot,it)=>{it.d(Ot,{Hw:()=>ct,Ps:()=>T});var S=it(9212),m=it(3680),et=it(2495),z=it(6814),X=it(2096),K=it(8504),Z=it(9315),$=it(7394),st=it(9397),ot=it(7398),mt=it(6306),dt=it(4716),Pt=it(3020),rt=it(8180),W=it(9862),lt=it(6593);const Y=["*"];let gt;function Mt(H){return function xt(){if(void 0===gt&&(gt=null,typeof window<"u")){const H=window;void 0!==H.trustedTypes&&(gt=H.trustedTypes.createPolicy("angular#components",{createHTML:yt=>yt}))}return gt}()?.createHTML(H)||H}function V(H){return Error(`Unable to find icon with the name "${H}"`)}function ft(H){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${H}".`)}function At(H){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${H}".`)}class Nt{constructor(yt,L,O){this.url=yt,this.svgText=L,this.options=O}}let It=(()=>{class H{constructor(L,O,R,nt){this._httpClient=L,this._sanitizer=O,this._errorHandler=nt,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["material-icons","mat-ligature-font"],this._document=R}addSvgIcon(L,O,R){return this.addSvgIconInNamespace("",L,O,R)}addSvgIconLiteral(L,O,R){return this.addSvgIconLiteralInNamespace("",L,O,R)}addSvgIconInNamespace(L,O,R,nt){return this._addSvgIconConfig(L,O,new Nt(R,null,nt))}addSvgIconResolver(L){return this._resolvers.push(L),this}addSvgIconLiteralInNamespace(L,O,R,nt){const pt=this._sanitizer.sanitize(S.q3G.HTML,R);if(!pt)throw At(R);const _t=Mt(pt);return this._addSvgIconConfig(L,O,new Nt("",_t,nt))}addSvgIconSet(L,O){return this.addSvgIconSetInNamespace("",L,O)}addSvgIconSetLiteral(L,O){return this.addSvgIconSetLiteralInNamespace("",L,O)}addSvgIconSetInNamespace(L,O,R){return this._addSvgIconSetConfig(L,new Nt(O,null,R))}addSvgIconSetLiteralInNamespace(L,O,R){const nt=this._sanitizer.sanitize(S.q3G.HTML,O);if(!nt)throw At(O);const pt=Mt(nt);return this._addSvgIconSetConfig(L,new Nt("",pt,R))}registerFontClassAlias(L,O=L){return this._fontCssClassesByAlias.set(L,O),this}classNameForFontAlias(L){return this._fontCssClassesByAlias.get(L)||L}setDefaultFontSetClass(...L){return this._defaultFontSetClass=L,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(L){const O=this._sanitizer.sanitize(S.q3G.RESOURCE_URL,L);if(!O)throw ft(L);const R=this._cachedIconsByUrl.get(O);return R?(0,X.of)(G(R)):this._loadSvgIconFromConfig(new Nt(L,null)).pipe((0,st.b)(nt=>this._cachedIconsByUrl.set(O,nt)),(0,ot.U)(nt=>G(nt)))}getNamedSvgIcon(L,O=""){const R=Me(O,L);let nt=this._svgIconConfigs.get(R);if(nt)return this._getSvgFromConfig(nt);if(nt=this._getIconConfigFromResolvers(O,L),nt)return this._svgIconConfigs.set(R,nt),this._getSvgFromConfig(nt);const pt=this._iconSetConfigs.get(O);return pt?this._getSvgFromIconSetConfigs(L,pt):(0,K._)(V(R))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(L){return L.svgText?(0,X.of)(G(this._svgElementFromConfig(L))):this._loadSvgIconFromConfig(L).pipe((0,ot.U)(O=>G(O)))}_getSvgFromIconSetConfigs(L,O){const R=this._extractIconWithNameFromAnySet(L,O);if(R)return(0,X.of)(R);const nt=O.filter(pt=>!pt.svgText).map(pt=>this._loadSvgIconSetFromConfig(pt).pipe((0,mt.K)(_t=>{const Rt=`Loading icon set URL: ${this._sanitizer.sanitize(S.q3G.RESOURCE_URL,pt.url)} failed: ${_t.message}`;return this._errorHandler.handleError(new Error(Rt)),(0,X.of)(null)})));return(0,Z.D)(nt).pipe((0,ot.U)(()=>{const pt=this._extractIconWithNameFromAnySet(L,O);if(!pt)throw V(L);return pt}))}_extractIconWithNameFromAnySet(L,O){for(let R=O.length-1;R>=0;R--){const nt=O[R];if(nt.svgText&&nt.svgText.toString().indexOf(L)>-1){const pt=this._svgElementFromConfig(nt),_t=this._extractSvgIconFromSet(pt,L,nt.options);if(_t)return _t}}return null}_loadSvgIconFromConfig(L){return this._fetchIcon(L).pipe((0,st.b)(O=>L.svgText=O),(0,ot.U)(()=>this._svgElementFromConfig(L)))}_loadSvgIconSetFromConfig(L){return L.svgText?(0,X.of)(null):this._fetchIcon(L).pipe((0,st.b)(O=>L.svgText=O))}_extractSvgIconFromSet(L,O,R){const nt=L.querySelector(`[id="${O}"]`);if(!nt)return null;const pt=nt.cloneNode(!0);if(pt.removeAttribute("id"),"svg"===pt.nodeName.toLowerCase())return this._setSvgAttributes(pt,R);if("symbol"===pt.nodeName.toLowerCase())return this._setSvgAttributes(this._toSvgElement(pt),R);const _t=this._svgElementFromString(Mt("<svg></svg>"));return _t.appendChild(pt),this._setSvgAttributes(_t,R)}_svgElementFromString(L){const O=this._document.createElement("DIV");O.innerHTML=L;const R=O.querySelector("svg");if(!R)throw Error("<svg> tag not found");return R}_toSvgElement(L){const O=this._svgElementFromString(Mt("<svg></svg>")),R=L.attributes;for(let nt=0;nt<R.length;nt++){const{name:pt,value:_t}=R[nt];"id"!==pt&&O.setAttribute(pt,_t)}for(let nt=0;nt<L.childNodes.length;nt++)L.childNodes[nt].nodeType===this._document.ELEMENT_NODE&&O.appendChild(L.childNodes[nt].cloneNode(!0));return O}_setSvgAttributes(L,O){return L.setAttribute("fit",""),L.setAttribute("height","100%"),L.setAttribute("width","100%"),L.setAttribute("preserveAspectRatio","xMidYMid meet"),L.setAttribute("focusable","false"),O&&O.viewBox&&L.setAttribute("viewBox",O.viewBox),L}_fetchIcon(L){const{url:O,options:R}=L,nt=R?.withCredentials??!1;if(!this._httpClient)throw function bt(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}();if(null==O)throw Error(`Cannot fetch icon from URL "${O}".`);const pt=this._sanitizer.sanitize(S.q3G.RESOURCE_URL,O);if(!pt)throw ft(O);const _t=this._inProgressUrlFetches.get(pt);if(_t)return _t;const Ht=this._httpClient.get(pt,{responseType:"text",withCredentials:nt}).pipe((0,ot.U)(Rt=>Mt(Rt)),(0,dt.x)(()=>this._inProgressUrlFetches.delete(pt)),(0,Pt.B)());return this._inProgressUrlFetches.set(pt,Ht),Ht}_addSvgIconConfig(L,O,R){return this._svgIconConfigs.set(Me(L,O),R),this}_addSvgIconSetConfig(L,O){const R=this._iconSetConfigs.get(L);return R?R.push(O):this._iconSetConfigs.set(L,[O]),this}_svgElementFromConfig(L){if(!L.svgElement){const O=this._svgElementFromString(L.svgText);this._setSvgAttributes(O,L.options),L.svgElement=O}return L.svgElement}_getIconConfigFromResolvers(L,O){for(let R=0;R<this._resolvers.length;R++){const nt=this._resolvers[R](O,L);if(nt)return s(nt)?new Nt(nt.url,null,nt.options):new Nt(nt,null)}}static#t=this.\u0275fac=function(O){return new(O||H)(S.LFG(W.eN,8),S.LFG(lt.H7),S.LFG(z.K0,8),S.LFG(S.qLn))};static#e=this.\u0275prov=S.Yz7({token:H,factory:H.\u0275fac,providedIn:"root"})}return H})();function G(H){return H.cloneNode(!0)}function Me(H,yt){return H+":"+yt}function s(H){return!(!H.url||!H.options)}const f=(0,m.pj)(class{constructor(H){this._elementRef=H}}),v=new S.OlP("MAT_ICON_DEFAULT_OPTIONS"),M=new S.OlP("mat-icon-location",{providedIn:"root",factory:function P(){const H=(0,S.f3M)(z.K0),yt=H?H.location:null;return{getPathname:()=>yt?yt.pathname+yt.search:""}}}),D=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],q=D.map(H=>`[${H}]`).join(", "),ht=/^url\(['"]?#(.*?)['"]?\)$/;let ct=(()=>{class H extends f{get inline(){return this._inline}set inline(L){this._inline=(0,et.Ig)(L)}get svgIcon(){return this._svgIcon}set svgIcon(L){L!==this._svgIcon&&(L?this._updateSvgIcon(L):this._svgIcon&&this._clearSvgElement(),this._svgIcon=L)}get fontSet(){return this._fontSet}set fontSet(L){const O=this._cleanupFontValue(L);O!==this._fontSet&&(this._fontSet=O,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(L){const O=this._cleanupFontValue(L);O!==this._fontIcon&&(this._fontIcon=O,this._updateFontIconClasses())}constructor(L,O,R,nt,pt,_t){super(L),this._iconRegistry=O,this._location=nt,this._errorHandler=pt,this._inline=!1,this._previousFontSetClass=[],this._currentIconFetch=$.w0.EMPTY,_t&&(_t.color&&(this.color=this.defaultColor=_t.color),_t.fontSet&&(this.fontSet=_t.fontSet)),R||L.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(L){if(!L)return["",""];const O=L.split(":");switch(O.length){case 1:return["",O[0]];case 2:return O;default:throw Error(`Invalid icon name: "${L}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){const L=this._elementsWithExternalReferences;if(L&&L.size){const O=this._location.getPathname();O!==this._previousPath&&(this._previousPath=O,this._prependPathToReferences(O))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(L){this._clearSvgElement();const O=this._location.getPathname();this._previousPath=O,this._cacheChildrenWithExternalReferences(L),this._prependPathToReferences(O),this._elementRef.nativeElement.appendChild(L)}_clearSvgElement(){const L=this._elementRef.nativeElement;let O=L.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();O--;){const R=L.childNodes[O];(1!==R.nodeType||"svg"===R.nodeName.toLowerCase())&&R.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;const L=this._elementRef.nativeElement,O=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(R=>R.length>0);this._previousFontSetClass.forEach(R=>L.classList.remove(R)),O.forEach(R=>L.classList.add(R)),this._previousFontSetClass=O,this.fontIcon!==this._previousFontIconClass&&!O.includes("mat-ligature-font")&&(this._previousFontIconClass&&L.classList.remove(this._previousFontIconClass),this.fontIcon&&L.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(L){return"string"==typeof L?L.trim().split(" ")[0]:L}_prependPathToReferences(L){const O=this._elementsWithExternalReferences;O&&O.forEach((R,nt)=>{R.forEach(pt=>{nt.setAttribute(pt.name,`url('${L}#${pt.value}')`)})})}_cacheChildrenWithExternalReferences(L){const O=L.querySelectorAll(q),R=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let nt=0;nt<O.length;nt++)D.forEach(pt=>{const _t=O[nt],Ht=_t.getAttribute(pt),Rt=Ht?Ht.match(ht):null;if(Rt){let we=R.get(_t);we||(we=[],R.set(_t,we)),we.push({name:pt,value:Rt[1]})}})}_updateSvgIcon(L){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),L){const[O,R]=this._splitIconName(L);O&&(this._svgNamespace=O),R&&(this._svgName=R),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(R,O).pipe((0,rt.q)(1)).subscribe(nt=>this._setSvgElement(nt),nt=>{this._errorHandler.handleError(new Error(`Error retrieving icon ${O}:${R}! ${nt.message}`))})}}static#t=this.\u0275fac=function(O){return new(O||H)(S.Y36(S.SBq),S.Y36(It),S.$8M("aria-hidden"),S.Y36(M),S.Y36(S.qLn),S.Y36(v,8))};static#e=this.\u0275cmp=S.Xpm({type:H,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:8,hostBindings:function(O,R){2&O&&(S.uIk("data-mat-icon-type",R._usingFontIcon()?"font":"svg")("data-mat-icon-name",R._svgName||R.fontIcon)("data-mat-icon-namespace",R._svgNamespace||R.fontSet)("fontIcon",R._usingFontIcon()?R.fontIcon:null),S.ekj("mat-icon-inline",R.inline)("mat-icon-no-color","primary"!==R.color&&"accent"!==R.color&&"warn"!==R.color))},inputs:{color:"color",inline:"inline",svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[S.qOj],ngContentSelectors:Y,decls:1,vars:0,template:function(O,R){1&O&&(S.F$t(),S.Hsn(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0})}return H})(),T=(()=>{class H{static#t=this.\u0275fac=function(O){return new(O||H)};static#e=this.\u0275mod=S.oAB({type:H});static#i=this.\u0275inj=S.cJS({imports:[m.BQ,m.BQ]})}return H})()}}]);